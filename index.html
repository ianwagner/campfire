<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Campfire</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="preload"
      href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap"
      as="style"
      onload="this.onload=null;this.rel='stylesheet'"
    />
    <noscript>
      <link
        href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap"
        rel="stylesheet"
      />
    </noscript>
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#000000" />
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png" />
    <script>
      document.documentElement.classList.add('loading');
      const params = new URLSearchParams(window.location.search);
      const agencyId = window.location.pathname.startsWith('/agency/')
        ? params.get('agencyId')
        : null;
      const accent = (() => {
        if (agencyId) {
          try {
            const stored = localStorage.getItem(`agencyTheme-${agencyId}`);
            if (stored) {
              const { themeColor } = JSON.parse(stored);
              if (themeColor) return themeColor;
            }
          } catch (e) {
            /* ignore parse errors */
          }
        }
        return localStorage.getItem('accentColor');
      })();
      const themePref = localStorage.getItem("theme") || "system";
      const applyTheme = (p) => {
        const dark = p === "dark" || (p === "system" && window.matchMedia("(prefers-color-scheme: dark)").matches);
        document.documentElement.classList.toggle("dark", dark);
      };
      applyTheme(themePref);
      if (accent) {
        const hexToRgba = (hex, alpha = 0.1) => {
          let h = hex.replace('#', '');
          if (h.length === 3) h = h.split('').map((c) => c + c).join('');
          const int = parseInt(h, 16);
          const r = (int >> 16) & 255;
          const g = (int >> 8) & 255;
          const b = int & 255;
          return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        };
        document.documentElement.style.setProperty('--accent-color', accent);
        document.documentElement.style.setProperty(
          '--accent-color-10',
          hexToRgba(accent)
        );
      }
      document.fonts.ready.finally(() => {
        document.documentElement.classList.remove('loading');
      });
    </script>
  </head>
  <body class="pre-theme">
    <div id="root"></div>
    <script type="module" src="/src/index.jsx"></script>
    <script type="module" src="/main.js"></script>
  </body>
</html>
