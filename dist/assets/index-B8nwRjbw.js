function NS(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const a=Object.getOwnPropertyDescriptor(r,s);a&&Object.defineProperty(t,s,a.get?a:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();window.FIREBASE_CONFIG={apiKey:"AIzaSyDZ7h9KXAwIvzqFf9gMrMBOJvkMxSMjjRw",authDomain:"tak-campfire.firebaseapp.com",projectId:"tak-campfire",storageBucket:"tak-campfire-main",messagingSenderId:"198332728326",appId:"1:198332728326:web:d7eec9d577fb30fa916f87",vapidKey:"BHVn4o8nW7nriA-hnKA_wGXtVnL5xy5-M-iE9bKQfLXDVnKMRb06pT7JT9CqOQFbPdiAVk1IHYg_XD4GFMEzwQ4"};function TS(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var j_={exports:{}},lf={},E_={exports:{}},pt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Iu=Symbol.for("react.element"),IS=Symbol.for("react.portal"),AS=Symbol.for("react.fragment"),RS=Symbol.for("react.strict_mode"),PS=Symbol.for("react.profiler"),DS=Symbol.for("react.provider"),LS=Symbol.for("react.context"),OS=Symbol.for("react.forward_ref"),MS=Symbol.for("react.suspense"),FS=Symbol.for("react.memo"),VS=Symbol.for("react.lazy"),Ox=Symbol.iterator;function US(t){return t===null||typeof t!="object"?null:(t=Ox&&t[Ox]||t["@@iterator"],typeof t=="function"?t:null)}var k_={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C_=Object.assign,S_={};function Fl(t,e,n){this.props=t,this.context=e,this.refs=S_,this.updater=n||k_}Fl.prototype.isReactComponent={};Fl.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Fl.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function N_(){}N_.prototype=Fl.prototype;function zg(t,e,n){this.props=t,this.context=e,this.refs=S_,this.updater=n||k_}var Gg=zg.prototype=new N_;Gg.constructor=zg;C_(Gg,Fl.prototype);Gg.isPureReactComponent=!0;var Mx=Array.isArray,T_=Object.prototype.hasOwnProperty,Hg={current:null},I_={key:!0,ref:!0,__self:!0,__source:!0};function A_(t,e,n){var r,s={},a=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(a=""+e.key),e)T_.call(e,r)&&!I_.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];s.children=c}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)s[r]===void 0&&(s[r]=l[r]);return{$$typeof:Iu,type:t,key:a,ref:o,props:s,_owner:Hg.current}}function BS(t,e){return{$$typeof:Iu,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function qg(t){return typeof t=="object"&&t!==null&&t.$$typeof===Iu}function $S(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Fx=/\/+/g;function dp(t,e){return typeof t=="object"&&t!==null&&t.key!=null?$S(""+t.key):e.toString(36)}function Md(t,e,n,r,s){var a=typeof t;(a==="undefined"||a==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(a){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Iu:case IS:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+dp(o,0):r,Mx(s)?(n="",t!=null&&(n=t.replace(Fx,"$&/")+"/"),Md(s,e,n,"",function(d){return d})):s!=null&&(qg(s)&&(s=BS(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(Fx,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",Mx(t))for(var l=0;l<t.length;l++){a=t[l];var c=r+dp(a,l);o+=Md(a,e,n,c,s)}else if(c=US(t),typeof c=="function")for(t=c.call(t),l=0;!(a=t.next()).done;)a=a.value,c=r+dp(a,l++),o+=Md(a,e,n,c,s);else if(a==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function ad(t,e,n){if(t==null)return t;var r=[],s=0;return Md(t,r,"","",function(a){return e.call(n,a,s++)}),r}function zS(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Wr={current:null},Fd={transition:null},GS={ReactCurrentDispatcher:Wr,ReactCurrentBatchConfig:Fd,ReactCurrentOwner:Hg};function R_(){throw Error("act(...) is not supported in production builds of React.")}pt.Children={map:ad,forEach:function(t,e,n){ad(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return ad(t,function(){e++}),e},toArray:function(t){return ad(t,function(e){return e})||[]},only:function(t){if(!qg(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};pt.Component=Fl;pt.Fragment=AS;pt.Profiler=PS;pt.PureComponent=zg;pt.StrictMode=RS;pt.Suspense=MS;pt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=GS;pt.act=R_;pt.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=C_({},t.props),s=t.key,a=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(a=e.ref,o=Hg.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)T_.call(e,c)&&!I_.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:Iu,type:t.type,key:s,ref:a,props:r,_owner:o}};pt.createContext=function(t){return t={$$typeof:LS,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:DS,_context:t},t.Consumer=t};pt.createElement=A_;pt.createFactory=function(t){var e=A_.bind(null,t);return e.type=t,e};pt.createRef=function(){return{current:null}};pt.forwardRef=function(t){return{$$typeof:OS,render:t}};pt.isValidElement=qg;pt.lazy=function(t){return{$$typeof:VS,_payload:{_status:-1,_result:t},_init:zS}};pt.memo=function(t,e){return{$$typeof:FS,type:t,compare:e===void 0?null:e}};pt.startTransition=function(t){var e=Fd.transition;Fd.transition={};try{t()}finally{Fd.transition=e}};pt.unstable_act=R_;pt.useCallback=function(t,e){return Wr.current.useCallback(t,e)};pt.useContext=function(t){return Wr.current.useContext(t)};pt.useDebugValue=function(){};pt.useDeferredValue=function(t){return Wr.current.useDeferredValue(t)};pt.useEffect=function(t,e){return Wr.current.useEffect(t,e)};pt.useId=function(){return Wr.current.useId()};pt.useImperativeHandle=function(t,e,n){return Wr.current.useImperativeHandle(t,e,n)};pt.useInsertionEffect=function(t,e){return Wr.current.useInsertionEffect(t,e)};pt.useLayoutEffect=function(t,e){return Wr.current.useLayoutEffect(t,e)};pt.useMemo=function(t,e){return Wr.current.useMemo(t,e)};pt.useReducer=function(t,e,n){return Wr.current.useReducer(t,e,n)};pt.useRef=function(t){return Wr.current.useRef(t)};pt.useState=function(t){return Wr.current.useState(t)};pt.useSyncExternalStore=function(t,e,n){return Wr.current.useSyncExternalStore(t,e,n)};pt.useTransition=function(){return Wr.current.useTransition()};pt.version="18.3.1";E_.exports=pt;var m=E_.exports;const bt=TS(m),HS=NS({__proto__:null,default:bt},[m]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qS=m,WS=Symbol.for("react.element"),KS=Symbol.for("react.fragment"),QS=Object.prototype.hasOwnProperty,YS=qS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,JS={key:!0,ref:!0,__self:!0,__source:!0};function P_(t,e,n){var r,s={},a=null,o=null;n!==void 0&&(a=""+n),e.key!==void 0&&(a=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)QS.call(e,r)&&!JS.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:WS,type:t,key:a,ref:o,props:s,_owner:YS.current}}lf.Fragment=KS;lf.jsx=P_;lf.jsxs=P_;j_.exports=lf;var i=j_.exports,dm={},D_={exports:{}},_s={},L_={exports:{}},O_={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(K,z){var Y=K.length;K.push(z);e:for(;0<Y;){var V=Y-1>>>1,q=K[V];if(0<s(q,z))K[V]=z,K[Y]=q,Y=V;else break e}}function n(K){return K.length===0?null:K[0]}function r(K){if(K.length===0)return null;var z=K[0],Y=K.pop();if(Y!==z){K[0]=Y;e:for(var V=0,q=K.length,ae=q>>>1;V<ae;){var Ee=2*(V+1)-1,L=K[Ee],B=Ee+1,G=K[B];if(0>s(L,Y))B<q&&0>s(G,L)?(K[V]=G,K[B]=Y,V=B):(K[V]=L,K[Ee]=Y,V=Ee);else if(B<q&&0>s(G,Y))K[V]=G,K[B]=Y,V=B;else break e}}return z}function s(K,z){var Y=K.sortIndex-z.sortIndex;return Y!==0?Y:K.id-z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],d=[],h=1,f=null,p=3,k=!1,S=!1,T=!1,C=typeof setTimeout=="function"?setTimeout:null,j=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(K){for(var z=n(d);z!==null;){if(z.callback===null)r(d);else if(z.startTime<=K)r(d),z.sortIndex=z.expirationTime,e(c,z);else break;z=n(d)}}function R(K){if(T=!1,v(K),!S)if(n(c)!==null)S=!0,Ae(O);else{var z=n(d);z!==null&&J(R,z.startTime-K)}}function O(K,z){S=!1,T&&(T=!1,j(x),x=-1),k=!0;var Y=p;try{for(v(z),f=n(c);f!==null&&(!(f.expirationTime>z)||K&&!N());){var V=f.callback;if(typeof V=="function"){f.callback=null,p=f.priorityLevel;var q=V(f.expirationTime<=z);z=t.unstable_now(),typeof q=="function"?f.callback=q:f===n(c)&&r(c),v(z)}else r(c);f=n(c)}if(f!==null)var ae=!0;else{var Ee=n(d);Ee!==null&&J(R,Ee.startTime-z),ae=!1}return ae}finally{f=null,p=Y,k=!1}}var M=!1,b=null,x=-1,w=5,E=-1;function N(){return!(t.unstable_now()-E<w)}function D(){if(b!==null){var K=t.unstable_now();E=K;var z=!0;try{z=b(!0,K)}finally{z?I():(M=!1,b=null)}}else M=!1}var I;if(typeof y=="function")I=function(){y(D)};else if(typeof MessageChannel<"u"){var pe=new MessageChannel,Xe=pe.port2;pe.port1.onmessage=D,I=function(){Xe.postMessage(null)}}else I=function(){C(D,0)};function Ae(K){b=K,M||(M=!0,I())}function J(K,z){x=C(function(){K(t.unstable_now())},z)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(K){K.callback=null},t.unstable_continueExecution=function(){S||k||(S=!0,Ae(O))},t.unstable_forceFrameRate=function(K){0>K||125<K?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):w=0<K?Math.floor(1e3/K):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(K){switch(p){case 1:case 2:case 3:var z=3;break;default:z=p}var Y=p;p=z;try{return K()}finally{p=Y}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(K,z){switch(K){case 1:case 2:case 3:case 4:case 5:break;default:K=3}var Y=p;p=K;try{return z()}finally{p=Y}},t.unstable_scheduleCallback=function(K,z,Y){var V=t.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?V+Y:V):Y=V,K){case 1:var q=-1;break;case 2:q=250;break;case 5:q=1073741823;break;case 4:q=1e4;break;default:q=5e3}return q=Y+q,K={id:h++,callback:z,priorityLevel:K,startTime:Y,expirationTime:q,sortIndex:-1},Y>V?(K.sortIndex=Y,e(d,K),n(c)===null&&K===n(d)&&(T?(j(x),x=-1):T=!0,J(R,Y-V))):(K.sortIndex=q,e(c,K),S||k||(S=!0,Ae(O))),K},t.unstable_shouldYield=N,t.unstable_wrapCallback=function(K){var z=p;return function(){var Y=p;p=z;try{return K.apply(this,arguments)}finally{p=Y}}}})(O_);L_.exports=O_;var XS=L_.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ZS=m,xs=XS;function ge(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var M_=new Set,Qc={};function Co(t,e){vl(t,e),vl(t+"Capture",e)}function vl(t,e){for(Qc[t]=e,t=0;t<e.length;t++)M_.add(e[t])}var Fi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),hm=Object.prototype.hasOwnProperty,eN=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Vx={},Ux={};function tN(t){return hm.call(Ux,t)?!0:hm.call(Vx,t)?!1:eN.test(t)?Ux[t]=!0:(Vx[t]=!0,!1)}function nN(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function rN(t,e,n,r){if(e===null||typeof e>"u"||nN(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Kr(t,e,n,r,s,a,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=a,this.removeEmptyString=o}var yr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){yr[t]=new Kr(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];yr[e]=new Kr(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){yr[t]=new Kr(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){yr[t]=new Kr(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){yr[t]=new Kr(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){yr[t]=new Kr(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){yr[t]=new Kr(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){yr[t]=new Kr(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){yr[t]=new Kr(t,5,!1,t.toLowerCase(),null,!1,!1)});var Wg=/[\-:]([a-z])/g;function Kg(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Wg,Kg);yr[e]=new Kr(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Wg,Kg);yr[e]=new Kr(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Wg,Kg);yr[e]=new Kr(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){yr[t]=new Kr(t,1,!1,t.toLowerCase(),null,!1,!1)});yr.xlinkHref=new Kr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){yr[t]=new Kr(t,1,!1,t.toLowerCase(),null,!0,!0)});function Qg(t,e,n,r){var s=yr.hasOwnProperty(e)?yr[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(rN(e,n,s,r)&&(n=null),r||s===null?tN(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Ki=ZS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,od=Symbol.for("react.element"),Ho=Symbol.for("react.portal"),qo=Symbol.for("react.fragment"),Yg=Symbol.for("react.strict_mode"),fm=Symbol.for("react.profiler"),F_=Symbol.for("react.provider"),V_=Symbol.for("react.context"),Jg=Symbol.for("react.forward_ref"),pm=Symbol.for("react.suspense"),mm=Symbol.for("react.suspense_list"),Xg=Symbol.for("react.memo"),ea=Symbol.for("react.lazy"),U_=Symbol.for("react.offscreen"),Bx=Symbol.iterator;function rc(t){return t===null||typeof t!="object"?null:(t=Bx&&t[Bx]||t["@@iterator"],typeof t=="function"?t:null)}var dn=Object.assign,hp;function pc(t){if(hp===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);hp=e&&e[1]||""}return`
`+hp+t}var fp=!1;function pp(t,e){if(!t||fp)return"";fp=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){r=d}t.call(e.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),a=r.stack.split(`
`),o=s.length-1,l=a.length-1;1<=o&&0<=l&&s[o]!==a[l];)l--;for(;1<=o&&0<=l;o--,l--)if(s[o]!==a[l]){if(o!==1||l!==1)do if(o--,l--,0>l||s[o]!==a[l]){var c=`
`+s[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=l);break}}}finally{fp=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?pc(t):""}function sN(t){switch(t.tag){case 5:return pc(t.type);case 16:return pc("Lazy");case 13:return pc("Suspense");case 19:return pc("SuspenseList");case 0:case 2:case 15:return t=pp(t.type,!1),t;case 11:return t=pp(t.type.render,!1),t;case 1:return t=pp(t.type,!0),t;default:return""}}function gm(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case qo:return"Fragment";case Ho:return"Portal";case fm:return"Profiler";case Yg:return"StrictMode";case pm:return"Suspense";case mm:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case V_:return(t.displayName||"Context")+".Consumer";case F_:return(t._context.displayName||"Context")+".Provider";case Jg:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Xg:return e=t.displayName||null,e!==null?e:gm(t.type)||"Memo";case ea:e=t._payload,t=t._init;try{return gm(t(e))}catch{}}return null}function iN(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return gm(e);case 8:return e===Yg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Sa(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function B_(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function aN(t){var e=B_(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,a=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,a.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function ld(t){t._valueTracker||(t._valueTracker=aN(t))}function $_(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=B_(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function uh(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function ym(t,e){var n=e.checked;return dn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function $x(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Sa(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function z_(t,e){e=e.checked,e!=null&&Qg(t,"checked",e,!1)}function vm(t,e){z_(t,e);var n=Sa(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?xm(t,e.type,n):e.hasOwnProperty("defaultValue")&&xm(t,e.type,Sa(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function zx(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function xm(t,e,n){(e!=="number"||uh(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var mc=Array.isArray;function il(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Sa(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function wm(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ge(91));return dn({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Gx(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(ge(92));if(mc(n)){if(1<n.length)throw Error(ge(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Sa(n)}}function G_(t,e){var n=Sa(e.value),r=Sa(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Hx(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function H_(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function bm(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?H_(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var cd,q_=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(cd=cd||document.createElement("div"),cd.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=cd.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Yc(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Sc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},oN=["Webkit","ms","Moz","O"];Object.keys(Sc).forEach(function(t){oN.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Sc[e]=Sc[t]})});function W_(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Sc.hasOwnProperty(t)&&Sc[t]?(""+e).trim():e+"px"}function K_(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=W_(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var lN=dn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function _m(t,e){if(e){if(lN[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ge(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ge(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ge(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ge(62))}}function jm(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Em=null;function Zg(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var km=null,al=null,ol=null;function qx(t){if(t=Pu(t)){if(typeof km!="function")throw Error(ge(280));var e=t.stateNode;e&&(e=ff(e),km(t.stateNode,t.type,e))}}function Q_(t){al?ol?ol.push(t):ol=[t]:al=t}function Y_(){if(al){var t=al,e=ol;if(ol=al=null,qx(t),e)for(t=0;t<e.length;t++)qx(e[t])}}function J_(t,e){return t(e)}function X_(){}var mp=!1;function Z_(t,e,n){if(mp)return t(e,n);mp=!0;try{return J_(t,e,n)}finally{mp=!1,(al!==null||ol!==null)&&(X_(),Y_())}}function Jc(t,e){var n=t.stateNode;if(n===null)return null;var r=ff(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(ge(231,e,typeof n));return n}var Cm=!1;if(Fi)try{var sc={};Object.defineProperty(sc,"passive",{get:function(){Cm=!0}}),window.addEventListener("test",sc,sc),window.removeEventListener("test",sc,sc)}catch{Cm=!1}function cN(t,e,n,r,s,a,o,l,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(h){this.onError(h)}}var Nc=!1,dh=null,hh=!1,Sm=null,uN={onError:function(t){Nc=!0,dh=t}};function dN(t,e,n,r,s,a,o,l,c){Nc=!1,dh=null,cN.apply(uN,arguments)}function hN(t,e,n,r,s,a,o,l,c){if(dN.apply(this,arguments),Nc){if(Nc){var d=dh;Nc=!1,dh=null}else throw Error(ge(198));hh||(hh=!0,Sm=d)}}function So(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function e1(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Wx(t){if(So(t)!==t)throw Error(ge(188))}function fN(t){var e=t.alternate;if(!e){if(e=So(t),e===null)throw Error(ge(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var a=s.alternate;if(a===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===a.child){for(a=s.child;a;){if(a===n)return Wx(s),t;if(a===r)return Wx(s),e;a=a.sibling}throw Error(ge(188))}if(n.return!==r.return)n=s,r=a;else{for(var o=!1,l=s.child;l;){if(l===n){o=!0,n=s,r=a;break}if(l===r){o=!0,r=s,n=a;break}l=l.sibling}if(!o){for(l=a.child;l;){if(l===n){o=!0,n=a,r=s;break}if(l===r){o=!0,r=a,n=s;break}l=l.sibling}if(!o)throw Error(ge(189))}}if(n.alternate!==r)throw Error(ge(190))}if(n.tag!==3)throw Error(ge(188));return n.stateNode.current===n?t:e}function t1(t){return t=fN(t),t!==null?n1(t):null}function n1(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=n1(t);if(e!==null)return e;t=t.sibling}return null}var r1=xs.unstable_scheduleCallback,Kx=xs.unstable_cancelCallback,pN=xs.unstable_shouldYield,mN=xs.unstable_requestPaint,En=xs.unstable_now,gN=xs.unstable_getCurrentPriorityLevel,ey=xs.unstable_ImmediatePriority,s1=xs.unstable_UserBlockingPriority,fh=xs.unstable_NormalPriority,yN=xs.unstable_LowPriority,i1=xs.unstable_IdlePriority,cf=null,pi=null;function vN(t){if(pi&&typeof pi.onCommitFiberRoot=="function")try{pi.onCommitFiberRoot(cf,t,void 0,(t.current.flags&128)===128)}catch{}}var Qs=Math.clz32?Math.clz32:bN,xN=Math.log,wN=Math.LN2;function bN(t){return t>>>=0,t===0?32:31-(xN(t)/wN|0)|0}var ud=64,dd=4194304;function gc(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function ph(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,a=t.pingedLanes,o=n&268435455;if(o!==0){var l=o&~s;l!==0?r=gc(l):(a&=o,a!==0&&(r=gc(a)))}else o=n&~s,o!==0?r=gc(o):a!==0&&(r=gc(a));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,a=e&-e,s>=a||s===16&&(a&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Qs(e),s=1<<n,r|=t[n],e&=~s;return r}function _N(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function jN(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,a=t.pendingLanes;0<a;){var o=31-Qs(a),l=1<<o,c=s[o];c===-1?(!(l&n)||l&r)&&(s[o]=_N(l,e)):c<=e&&(t.expiredLanes|=l),a&=~l}}function Nm(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function a1(){var t=ud;return ud<<=1,!(ud&4194240)&&(ud=64),t}function gp(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Au(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Qs(e),t[e]=n}function EN(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-Qs(n),a=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~a}}function ty(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Qs(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var $t=0;function o1(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var l1,ny,c1,u1,d1,Tm=!1,hd=[],fa=null,pa=null,ma=null,Xc=new Map,Zc=new Map,na=[],kN="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Qx(t,e){switch(t){case"focusin":case"focusout":fa=null;break;case"dragenter":case"dragleave":pa=null;break;case"mouseover":case"mouseout":ma=null;break;case"pointerover":case"pointerout":Xc.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Zc.delete(e.pointerId)}}function ic(t,e,n,r,s,a){return t===null||t.nativeEvent!==a?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[s]},e!==null&&(e=Pu(e),e!==null&&ny(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function CN(t,e,n,r,s){switch(e){case"focusin":return fa=ic(fa,t,e,n,r,s),!0;case"dragenter":return pa=ic(pa,t,e,n,r,s),!0;case"mouseover":return ma=ic(ma,t,e,n,r,s),!0;case"pointerover":var a=s.pointerId;return Xc.set(a,ic(Xc.get(a)||null,t,e,n,r,s)),!0;case"gotpointercapture":return a=s.pointerId,Zc.set(a,ic(Zc.get(a)||null,t,e,n,r,s)),!0}return!1}function h1(t){var e=Xa(t.target);if(e!==null){var n=So(e);if(n!==null){if(e=n.tag,e===13){if(e=e1(n),e!==null){t.blockedOn=e,d1(t.priority,function(){c1(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Vd(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Im(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Em=r,n.target.dispatchEvent(r),Em=null}else return e=Pu(n),e!==null&&ny(e),t.blockedOn=n,!1;e.shift()}return!0}function Yx(t,e,n){Vd(t)&&n.delete(e)}function SN(){Tm=!1,fa!==null&&Vd(fa)&&(fa=null),pa!==null&&Vd(pa)&&(pa=null),ma!==null&&Vd(ma)&&(ma=null),Xc.forEach(Yx),Zc.forEach(Yx)}function ac(t,e){t.blockedOn===e&&(t.blockedOn=null,Tm||(Tm=!0,xs.unstable_scheduleCallback(xs.unstable_NormalPriority,SN)))}function eu(t){function e(s){return ac(s,t)}if(0<hd.length){ac(hd[0],t);for(var n=1;n<hd.length;n++){var r=hd[n];r.blockedOn===t&&(r.blockedOn=null)}}for(fa!==null&&ac(fa,t),pa!==null&&ac(pa,t),ma!==null&&ac(ma,t),Xc.forEach(e),Zc.forEach(e),n=0;n<na.length;n++)r=na[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<na.length&&(n=na[0],n.blockedOn===null);)h1(n),n.blockedOn===null&&na.shift()}var ll=Ki.ReactCurrentBatchConfig,mh=!0;function NN(t,e,n,r){var s=$t,a=ll.transition;ll.transition=null;try{$t=1,ry(t,e,n,r)}finally{$t=s,ll.transition=a}}function TN(t,e,n,r){var s=$t,a=ll.transition;ll.transition=null;try{$t=4,ry(t,e,n,r)}finally{$t=s,ll.transition=a}}function ry(t,e,n,r){if(mh){var s=Im(t,e,n,r);if(s===null)Cp(t,e,r,gh,n),Qx(t,r);else if(CN(s,t,e,n,r))r.stopPropagation();else if(Qx(t,r),e&4&&-1<kN.indexOf(t)){for(;s!==null;){var a=Pu(s);if(a!==null&&l1(a),a=Im(t,e,n,r),a===null&&Cp(t,e,r,gh,n),a===s)break;s=a}s!==null&&r.stopPropagation()}else Cp(t,e,r,null,n)}}var gh=null;function Im(t,e,n,r){if(gh=null,t=Zg(r),t=Xa(t),t!==null)if(e=So(t),e===null)t=null;else if(n=e.tag,n===13){if(t=e1(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return gh=t,null}function f1(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(gN()){case ey:return 1;case s1:return 4;case fh:case yN:return 16;case i1:return 536870912;default:return 16}default:return 16}}var ca=null,sy=null,Ud=null;function p1(){if(Ud)return Ud;var t,e=sy,n=e.length,r,s="value"in ca?ca.value:ca.textContent,a=s.length;for(t=0;t<n&&e[t]===s[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===s[a-r];r++);return Ud=s.slice(t,1<r?1-r:void 0)}function Bd(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function fd(){return!0}function Jx(){return!1}function js(t){function e(n,r,s,a,o){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=a,this.target=o,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(a):a[l]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?fd:Jx,this.isPropagationStopped=Jx,this}return dn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=fd)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=fd)},persist:function(){},isPersistent:fd}),e}var Vl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},iy=js(Vl),Ru=dn({},Vl,{view:0,detail:0}),IN=js(Ru),yp,vp,oc,uf=dn({},Ru,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ay,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==oc&&(oc&&t.type==="mousemove"?(yp=t.screenX-oc.screenX,vp=t.screenY-oc.screenY):vp=yp=0,oc=t),yp)},movementY:function(t){return"movementY"in t?t.movementY:vp}}),Xx=js(uf),AN=dn({},uf,{dataTransfer:0}),RN=js(AN),PN=dn({},Ru,{relatedTarget:0}),xp=js(PN),DN=dn({},Vl,{animationName:0,elapsedTime:0,pseudoElement:0}),LN=js(DN),ON=dn({},Vl,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),MN=js(ON),FN=dn({},Vl,{data:0}),Zx=js(FN),VN={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},UN={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},BN={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function $N(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=BN[t])?!!e[t]:!1}function ay(){return $N}var zN=dn({},Ru,{key:function(t){if(t.key){var e=VN[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Bd(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?UN[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ay,charCode:function(t){return t.type==="keypress"?Bd(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Bd(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),GN=js(zN),HN=dn({},uf,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ew=js(HN),qN=dn({},Ru,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ay}),WN=js(qN),KN=dn({},Vl,{propertyName:0,elapsedTime:0,pseudoElement:0}),QN=js(KN),YN=dn({},uf,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),JN=js(YN),XN=[9,13,27,32],oy=Fi&&"CompositionEvent"in window,Tc=null;Fi&&"documentMode"in document&&(Tc=document.documentMode);var ZN=Fi&&"TextEvent"in window&&!Tc,m1=Fi&&(!oy||Tc&&8<Tc&&11>=Tc),tw=" ",nw=!1;function g1(t,e){switch(t){case"keyup":return XN.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function y1(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Wo=!1;function eT(t,e){switch(t){case"compositionend":return y1(e);case"keypress":return e.which!==32?null:(nw=!0,tw);case"textInput":return t=e.data,t===tw&&nw?null:t;default:return null}}function tT(t,e){if(Wo)return t==="compositionend"||!oy&&g1(t,e)?(t=p1(),Ud=sy=ca=null,Wo=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return m1&&e.locale!=="ko"?null:e.data;default:return null}}var nT={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function rw(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!nT[t.type]:e==="textarea"}function v1(t,e,n,r){Q_(r),e=yh(e,"onChange"),0<e.length&&(n=new iy("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Ic=null,tu=null;function rT(t){T1(t,0)}function df(t){var e=Yo(t);if($_(e))return t}function sT(t,e){if(t==="change")return e}var x1=!1;if(Fi){var wp;if(Fi){var bp="oninput"in document;if(!bp){var sw=document.createElement("div");sw.setAttribute("oninput","return;"),bp=typeof sw.oninput=="function"}wp=bp}else wp=!1;x1=wp&&(!document.documentMode||9<document.documentMode)}function iw(){Ic&&(Ic.detachEvent("onpropertychange",w1),tu=Ic=null)}function w1(t){if(t.propertyName==="value"&&df(tu)){var e=[];v1(e,tu,t,Zg(t)),Z_(rT,e)}}function iT(t,e,n){t==="focusin"?(iw(),Ic=e,tu=n,Ic.attachEvent("onpropertychange",w1)):t==="focusout"&&iw()}function aT(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return df(tu)}function oT(t,e){if(t==="click")return df(e)}function lT(t,e){if(t==="input"||t==="change")return df(e)}function cT(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Xs=typeof Object.is=="function"?Object.is:cT;function nu(t,e){if(Xs(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!hm.call(e,s)||!Xs(t[s],e[s]))return!1}return!0}function aw(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function ow(t,e){var n=aw(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=aw(n)}}function b1(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?b1(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function _1(){for(var t=window,e=uh();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=uh(t.document)}return e}function ly(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function uT(t){var e=_1(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&b1(n.ownerDocument.documentElement,n)){if(r!==null&&ly(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,a=Math.min(r.start,s);r=r.end===void 0?a:Math.min(r.end,s),!t.extend&&a>r&&(s=r,r=a,a=s),s=ow(n,a);var o=ow(n,r);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),a>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var dT=Fi&&"documentMode"in document&&11>=document.documentMode,Ko=null,Am=null,Ac=null,Rm=!1;function lw(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Rm||Ko==null||Ko!==uh(r)||(r=Ko,"selectionStart"in r&&ly(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Ac&&nu(Ac,r)||(Ac=r,r=yh(Am,"onSelect"),0<r.length&&(e=new iy("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Ko)))}function pd(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Qo={animationend:pd("Animation","AnimationEnd"),animationiteration:pd("Animation","AnimationIteration"),animationstart:pd("Animation","AnimationStart"),transitionend:pd("Transition","TransitionEnd")},_p={},j1={};Fi&&(j1=document.createElement("div").style,"AnimationEvent"in window||(delete Qo.animationend.animation,delete Qo.animationiteration.animation,delete Qo.animationstart.animation),"TransitionEvent"in window||delete Qo.transitionend.transition);function hf(t){if(_p[t])return _p[t];if(!Qo[t])return t;var e=Qo[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in j1)return _p[t]=e[n];return t}var E1=hf("animationend"),k1=hf("animationiteration"),C1=hf("animationstart"),S1=hf("transitionend"),N1=new Map,cw="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Oa(t,e){N1.set(t,e),Co(e,[t])}for(var jp=0;jp<cw.length;jp++){var Ep=cw[jp],hT=Ep.toLowerCase(),fT=Ep[0].toUpperCase()+Ep.slice(1);Oa(hT,"on"+fT)}Oa(E1,"onAnimationEnd");Oa(k1,"onAnimationIteration");Oa(C1,"onAnimationStart");Oa("dblclick","onDoubleClick");Oa("focusin","onFocus");Oa("focusout","onBlur");Oa(S1,"onTransitionEnd");vl("onMouseEnter",["mouseout","mouseover"]);vl("onMouseLeave",["mouseout","mouseover"]);vl("onPointerEnter",["pointerout","pointerover"]);vl("onPointerLeave",["pointerout","pointerover"]);Co("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Co("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Co("onBeforeInput",["compositionend","keypress","textInput","paste"]);Co("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Co("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Co("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var yc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),pT=new Set("cancel close invalid load scroll toggle".split(" ").concat(yc));function uw(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,hN(r,e,void 0,t),t.currentTarget=null}function T1(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var a=void 0;if(e)for(var o=r.length-1;0<=o;o--){var l=r[o],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==a&&s.isPropagationStopped())break e;uw(s,l,d),a=c}else for(o=0;o<r.length;o++){if(l=r[o],c=l.instance,d=l.currentTarget,l=l.listener,c!==a&&s.isPropagationStopped())break e;uw(s,l,d),a=c}}}if(hh)throw t=Sm,hh=!1,Sm=null,t}function Zt(t,e){var n=e[Mm];n===void 0&&(n=e[Mm]=new Set);var r=t+"__bubble";n.has(r)||(I1(e,t,2,!1),n.add(r))}function kp(t,e,n){var r=0;e&&(r|=4),I1(n,t,r,e)}var md="_reactListening"+Math.random().toString(36).slice(2);function ru(t){if(!t[md]){t[md]=!0,M_.forEach(function(n){n!=="selectionchange"&&(pT.has(n)||kp(n,!1,t),kp(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[md]||(e[md]=!0,kp("selectionchange",!1,e))}}function I1(t,e,n,r){switch(f1(e)){case 1:var s=NN;break;case 4:s=TN;break;default:s=ry}n=s.bind(null,e,n,t),s=void 0,!Cm||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function Cp(t,e,n,r,s){var a=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var l=r.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;o=o.return}for(;l!==null;){if(o=Xa(l),o===null)return;if(c=o.tag,c===5||c===6){r=a=o;continue e}l=l.parentNode}}r=r.return}Z_(function(){var d=a,h=Zg(n),f=[];e:{var p=N1.get(t);if(p!==void 0){var k=iy,S=t;switch(t){case"keypress":if(Bd(n)===0)break e;case"keydown":case"keyup":k=GN;break;case"focusin":S="focus",k=xp;break;case"focusout":S="blur",k=xp;break;case"beforeblur":case"afterblur":k=xp;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":k=Xx;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":k=RN;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":k=WN;break;case E1:case k1:case C1:k=LN;break;case S1:k=QN;break;case"scroll":k=IN;break;case"wheel":k=JN;break;case"copy":case"cut":case"paste":k=MN;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":k=ew}var T=(e&4)!==0,C=!T&&t==="scroll",j=T?p!==null?p+"Capture":null:p;T=[];for(var y=d,v;y!==null;){v=y;var R=v.stateNode;if(v.tag===5&&R!==null&&(v=R,j!==null&&(R=Jc(y,j),R!=null&&T.push(su(y,R,v)))),C)break;y=y.return}0<T.length&&(p=new k(p,S,null,n,h),f.push({event:p,listeners:T}))}}if(!(e&7)){e:{if(p=t==="mouseover"||t==="pointerover",k=t==="mouseout"||t==="pointerout",p&&n!==Em&&(S=n.relatedTarget||n.fromElement)&&(Xa(S)||S[Vi]))break e;if((k||p)&&(p=h.window===h?h:(p=h.ownerDocument)?p.defaultView||p.parentWindow:window,k?(S=n.relatedTarget||n.toElement,k=d,S=S?Xa(S):null,S!==null&&(C=So(S),S!==C||S.tag!==5&&S.tag!==6)&&(S=null)):(k=null,S=d),k!==S)){if(T=Xx,R="onMouseLeave",j="onMouseEnter",y="mouse",(t==="pointerout"||t==="pointerover")&&(T=ew,R="onPointerLeave",j="onPointerEnter",y="pointer"),C=k==null?p:Yo(k),v=S==null?p:Yo(S),p=new T(R,y+"leave",k,n,h),p.target=C,p.relatedTarget=v,R=null,Xa(h)===d&&(T=new T(j,y+"enter",S,n,h),T.target=v,T.relatedTarget=C,R=T),C=R,k&&S)t:{for(T=k,j=S,y=0,v=T;v;v=Vo(v))y++;for(v=0,R=j;R;R=Vo(R))v++;for(;0<y-v;)T=Vo(T),y--;for(;0<v-y;)j=Vo(j),v--;for(;y--;){if(T===j||j!==null&&T===j.alternate)break t;T=Vo(T),j=Vo(j)}T=null}else T=null;k!==null&&dw(f,p,k,T,!1),S!==null&&C!==null&&dw(f,C,S,T,!0)}}e:{if(p=d?Yo(d):window,k=p.nodeName&&p.nodeName.toLowerCase(),k==="select"||k==="input"&&p.type==="file")var O=sT;else if(rw(p))if(x1)O=lT;else{O=aT;var M=iT}else(k=p.nodeName)&&k.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(O=oT);if(O&&(O=O(t,d))){v1(f,O,n,h);break e}M&&M(t,p,d),t==="focusout"&&(M=p._wrapperState)&&M.controlled&&p.type==="number"&&xm(p,"number",p.value)}switch(M=d?Yo(d):window,t){case"focusin":(rw(M)||M.contentEditable==="true")&&(Ko=M,Am=d,Ac=null);break;case"focusout":Ac=Am=Ko=null;break;case"mousedown":Rm=!0;break;case"contextmenu":case"mouseup":case"dragend":Rm=!1,lw(f,n,h);break;case"selectionchange":if(dT)break;case"keydown":case"keyup":lw(f,n,h)}var b;if(oy)e:{switch(t){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else Wo?g1(t,n)&&(x="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(x="onCompositionStart");x&&(m1&&n.locale!=="ko"&&(Wo||x!=="onCompositionStart"?x==="onCompositionEnd"&&Wo&&(b=p1()):(ca=h,sy="value"in ca?ca.value:ca.textContent,Wo=!0)),M=yh(d,x),0<M.length&&(x=new Zx(x,t,null,n,h),f.push({event:x,listeners:M}),b?x.data=b:(b=y1(n),b!==null&&(x.data=b)))),(b=ZN?eT(t,n):tT(t,n))&&(d=yh(d,"onBeforeInput"),0<d.length&&(h=new Zx("onBeforeInput","beforeinput",null,n,h),f.push({event:h,listeners:d}),h.data=b))}T1(f,e)})}function su(t,e,n){return{instance:t,listener:e,currentTarget:n}}function yh(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,a=s.stateNode;s.tag===5&&a!==null&&(s=a,a=Jc(t,n),a!=null&&r.unshift(su(t,a,s)),a=Jc(t,e),a!=null&&r.push(su(t,a,s))),t=t.return}return r}function Vo(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function dw(t,e,n,r,s){for(var a=e._reactName,o=[];n!==null&&n!==r;){var l=n,c=l.alternate,d=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&d!==null&&(l=d,s?(c=Jc(n,a),c!=null&&o.unshift(su(n,c,l))):s||(c=Jc(n,a),c!=null&&o.push(su(n,c,l)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var mT=/\r\n?/g,gT=/\u0000|\uFFFD/g;function hw(t){return(typeof t=="string"?t:""+t).replace(mT,`
`).replace(gT,"")}function gd(t,e,n){if(e=hw(e),hw(t)!==e&&n)throw Error(ge(425))}function vh(){}var Pm=null,Dm=null;function Lm(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Om=typeof setTimeout=="function"?setTimeout:void 0,yT=typeof clearTimeout=="function"?clearTimeout:void 0,fw=typeof Promise=="function"?Promise:void 0,vT=typeof queueMicrotask=="function"?queueMicrotask:typeof fw<"u"?function(t){return fw.resolve(null).then(t).catch(xT)}:Om;function xT(t){setTimeout(function(){throw t})}function Sp(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),eu(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);eu(e)}function ga(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function pw(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Ul=Math.random().toString(36).slice(2),di="__reactFiber$"+Ul,iu="__reactProps$"+Ul,Vi="__reactContainer$"+Ul,Mm="__reactEvents$"+Ul,wT="__reactListeners$"+Ul,bT="__reactHandles$"+Ul;function Xa(t){var e=t[di];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Vi]||n[di]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=pw(t);t!==null;){if(n=t[di])return n;t=pw(t)}return e}t=n,n=t.parentNode}return null}function Pu(t){return t=t[di]||t[Vi],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Yo(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ge(33))}function ff(t){return t[iu]||null}var Fm=[],Jo=-1;function Ma(t){return{current:t}}function en(t){0>Jo||(t.current=Fm[Jo],Fm[Jo]=null,Jo--)}function Jt(t,e){Jo++,Fm[Jo]=t.current,t.current=e}var Na={},Or=Ma(Na),rs=Ma(!1),po=Na;function xl(t,e){var n=t.type.contextTypes;if(!n)return Na;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},a;for(a in n)s[a]=e[a];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function ss(t){return t=t.childContextTypes,t!=null}function xh(){en(rs),en(Or)}function mw(t,e,n){if(Or.current!==Na)throw Error(ge(168));Jt(Or,e),Jt(rs,n)}function A1(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(ge(108,iN(t)||"Unknown",s));return dn({},n,r)}function wh(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Na,po=Or.current,Jt(Or,t),Jt(rs,rs.current),!0}function gw(t,e,n){var r=t.stateNode;if(!r)throw Error(ge(169));n?(t=A1(t,e,po),r.__reactInternalMemoizedMergedChildContext=t,en(rs),en(Or),Jt(Or,t)):en(rs),Jt(rs,n)}var Ai=null,pf=!1,Np=!1;function R1(t){Ai===null?Ai=[t]:Ai.push(t)}function _T(t){pf=!0,R1(t)}function Fa(){if(!Np&&Ai!==null){Np=!0;var t=0,e=$t;try{var n=Ai;for($t=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Ai=null,pf=!1}catch(s){throw Ai!==null&&(Ai=Ai.slice(t+1)),r1(ey,Fa),s}finally{$t=e,Np=!1}}return null}var Xo=[],Zo=0,bh=null,_h=0,Is=[],As=0,mo=null,Ri=1,Pi="";function Ka(t,e){Xo[Zo++]=_h,Xo[Zo++]=bh,bh=t,_h=e}function P1(t,e,n){Is[As++]=Ri,Is[As++]=Pi,Is[As++]=mo,mo=t;var r=Ri;t=Pi;var s=32-Qs(r)-1;r&=~(1<<s),n+=1;var a=32-Qs(e)+s;if(30<a){var o=s-s%5;a=(r&(1<<o)-1).toString(32),r>>=o,s-=o,Ri=1<<32-Qs(e)+s|n<<s|r,Pi=a+t}else Ri=1<<a|n<<s|r,Pi=t}function cy(t){t.return!==null&&(Ka(t,1),P1(t,1,0))}function uy(t){for(;t===bh;)bh=Xo[--Zo],Xo[Zo]=null,_h=Xo[--Zo],Xo[Zo]=null;for(;t===mo;)mo=Is[--As],Is[As]=null,Pi=Is[--As],Is[As]=null,Ri=Is[--As],Is[As]=null}var ys=null,ms=null,nn=!1,qs=null;function D1(t,e){var n=Rs(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function yw(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,ys=t,ms=ga(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,ys=t,ms=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=mo!==null?{id:Ri,overflow:Pi}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Rs(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,ys=t,ms=null,!0):!1;default:return!1}}function Vm(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Um(t){if(nn){var e=ms;if(e){var n=e;if(!yw(t,e)){if(Vm(t))throw Error(ge(418));e=ga(n.nextSibling);var r=ys;e&&yw(t,e)?D1(r,n):(t.flags=t.flags&-4097|2,nn=!1,ys=t)}}else{if(Vm(t))throw Error(ge(418));t.flags=t.flags&-4097|2,nn=!1,ys=t}}}function vw(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;ys=t}function yd(t){if(t!==ys)return!1;if(!nn)return vw(t),nn=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Lm(t.type,t.memoizedProps)),e&&(e=ms)){if(Vm(t))throw L1(),Error(ge(418));for(;e;)D1(t,e),e=ga(e.nextSibling)}if(vw(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ge(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){ms=ga(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}ms=null}}else ms=ys?ga(t.stateNode.nextSibling):null;return!0}function L1(){for(var t=ms;t;)t=ga(t.nextSibling)}function wl(){ms=ys=null,nn=!1}function dy(t){qs===null?qs=[t]:qs.push(t)}var jT=Ki.ReactCurrentBatchConfig;function lc(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(ge(309));var r=n.stateNode}if(!r)throw Error(ge(147,t));var s=r,a=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===a?e.ref:(e=function(o){var l=s.refs;o===null?delete l[a]:l[a]=o},e._stringRef=a,e)}if(typeof t!="string")throw Error(ge(284));if(!n._owner)throw Error(ge(290,t))}return t}function vd(t,e){throw t=Object.prototype.toString.call(e),Error(ge(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function xw(t){var e=t._init;return e(t._payload)}function O1(t){function e(j,y){if(t){var v=j.deletions;v===null?(j.deletions=[y],j.flags|=16):v.push(y)}}function n(j,y){if(!t)return null;for(;y!==null;)e(j,y),y=y.sibling;return null}function r(j,y){for(j=new Map;y!==null;)y.key!==null?j.set(y.key,y):j.set(y.index,y),y=y.sibling;return j}function s(j,y){return j=wa(j,y),j.index=0,j.sibling=null,j}function a(j,y,v){return j.index=v,t?(v=j.alternate,v!==null?(v=v.index,v<y?(j.flags|=2,y):v):(j.flags|=2,y)):(j.flags|=1048576,y)}function o(j){return t&&j.alternate===null&&(j.flags|=2),j}function l(j,y,v,R){return y===null||y.tag!==6?(y=Lp(v,j.mode,R),y.return=j,y):(y=s(y,v),y.return=j,y)}function c(j,y,v,R){var O=v.type;return O===qo?h(j,y,v.props.children,R,v.key):y!==null&&(y.elementType===O||typeof O=="object"&&O!==null&&O.$$typeof===ea&&xw(O)===y.type)?(R=s(y,v.props),R.ref=lc(j,y,v),R.return=j,R):(R=Kd(v.type,v.key,v.props,null,j.mode,R),R.ref=lc(j,y,v),R.return=j,R)}function d(j,y,v,R){return y===null||y.tag!==4||y.stateNode.containerInfo!==v.containerInfo||y.stateNode.implementation!==v.implementation?(y=Op(v,j.mode,R),y.return=j,y):(y=s(y,v.children||[]),y.return=j,y)}function h(j,y,v,R,O){return y===null||y.tag!==7?(y=ao(v,j.mode,R,O),y.return=j,y):(y=s(y,v),y.return=j,y)}function f(j,y,v){if(typeof y=="string"&&y!==""||typeof y=="number")return y=Lp(""+y,j.mode,v),y.return=j,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case od:return v=Kd(y.type,y.key,y.props,null,j.mode,v),v.ref=lc(j,null,y),v.return=j,v;case Ho:return y=Op(y,j.mode,v),y.return=j,y;case ea:var R=y._init;return f(j,R(y._payload),v)}if(mc(y)||rc(y))return y=ao(y,j.mode,v,null),y.return=j,y;vd(j,y)}return null}function p(j,y,v,R){var O=y!==null?y.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return O!==null?null:l(j,y,""+v,R);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case od:return v.key===O?c(j,y,v,R):null;case Ho:return v.key===O?d(j,y,v,R):null;case ea:return O=v._init,p(j,y,O(v._payload),R)}if(mc(v)||rc(v))return O!==null?null:h(j,y,v,R,null);vd(j,v)}return null}function k(j,y,v,R,O){if(typeof R=="string"&&R!==""||typeof R=="number")return j=j.get(v)||null,l(y,j,""+R,O);if(typeof R=="object"&&R!==null){switch(R.$$typeof){case od:return j=j.get(R.key===null?v:R.key)||null,c(y,j,R,O);case Ho:return j=j.get(R.key===null?v:R.key)||null,d(y,j,R,O);case ea:var M=R._init;return k(j,y,v,M(R._payload),O)}if(mc(R)||rc(R))return j=j.get(v)||null,h(y,j,R,O,null);vd(y,R)}return null}function S(j,y,v,R){for(var O=null,M=null,b=y,x=y=0,w=null;b!==null&&x<v.length;x++){b.index>x?(w=b,b=null):w=b.sibling;var E=p(j,b,v[x],R);if(E===null){b===null&&(b=w);break}t&&b&&E.alternate===null&&e(j,b),y=a(E,y,x),M===null?O=E:M.sibling=E,M=E,b=w}if(x===v.length)return n(j,b),nn&&Ka(j,x),O;if(b===null){for(;x<v.length;x++)b=f(j,v[x],R),b!==null&&(y=a(b,y,x),M===null?O=b:M.sibling=b,M=b);return nn&&Ka(j,x),O}for(b=r(j,b);x<v.length;x++)w=k(b,j,x,v[x],R),w!==null&&(t&&w.alternate!==null&&b.delete(w.key===null?x:w.key),y=a(w,y,x),M===null?O=w:M.sibling=w,M=w);return t&&b.forEach(function(N){return e(j,N)}),nn&&Ka(j,x),O}function T(j,y,v,R){var O=rc(v);if(typeof O!="function")throw Error(ge(150));if(v=O.call(v),v==null)throw Error(ge(151));for(var M=O=null,b=y,x=y=0,w=null,E=v.next();b!==null&&!E.done;x++,E=v.next()){b.index>x?(w=b,b=null):w=b.sibling;var N=p(j,b,E.value,R);if(N===null){b===null&&(b=w);break}t&&b&&N.alternate===null&&e(j,b),y=a(N,y,x),M===null?O=N:M.sibling=N,M=N,b=w}if(E.done)return n(j,b),nn&&Ka(j,x),O;if(b===null){for(;!E.done;x++,E=v.next())E=f(j,E.value,R),E!==null&&(y=a(E,y,x),M===null?O=E:M.sibling=E,M=E);return nn&&Ka(j,x),O}for(b=r(j,b);!E.done;x++,E=v.next())E=k(b,j,x,E.value,R),E!==null&&(t&&E.alternate!==null&&b.delete(E.key===null?x:E.key),y=a(E,y,x),M===null?O=E:M.sibling=E,M=E);return t&&b.forEach(function(D){return e(j,D)}),nn&&Ka(j,x),O}function C(j,y,v,R){if(typeof v=="object"&&v!==null&&v.type===qo&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case od:e:{for(var O=v.key,M=y;M!==null;){if(M.key===O){if(O=v.type,O===qo){if(M.tag===7){n(j,M.sibling),y=s(M,v.props.children),y.return=j,j=y;break e}}else if(M.elementType===O||typeof O=="object"&&O!==null&&O.$$typeof===ea&&xw(O)===M.type){n(j,M.sibling),y=s(M,v.props),y.ref=lc(j,M,v),y.return=j,j=y;break e}n(j,M);break}else e(j,M);M=M.sibling}v.type===qo?(y=ao(v.props.children,j.mode,R,v.key),y.return=j,j=y):(R=Kd(v.type,v.key,v.props,null,j.mode,R),R.ref=lc(j,y,v),R.return=j,j=R)}return o(j);case Ho:e:{for(M=v.key;y!==null;){if(y.key===M)if(y.tag===4&&y.stateNode.containerInfo===v.containerInfo&&y.stateNode.implementation===v.implementation){n(j,y.sibling),y=s(y,v.children||[]),y.return=j,j=y;break e}else{n(j,y);break}else e(j,y);y=y.sibling}y=Op(v,j.mode,R),y.return=j,j=y}return o(j);case ea:return M=v._init,C(j,y,M(v._payload),R)}if(mc(v))return S(j,y,v,R);if(rc(v))return T(j,y,v,R);vd(j,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,y!==null&&y.tag===6?(n(j,y.sibling),y=s(y,v),y.return=j,j=y):(n(j,y),y=Lp(v,j.mode,R),y.return=j,j=y),o(j)):n(j,y)}return C}var bl=O1(!0),M1=O1(!1),jh=Ma(null),Eh=null,el=null,hy=null;function fy(){hy=el=Eh=null}function py(t){var e=jh.current;en(jh),t._currentValue=e}function Bm(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function cl(t,e){Eh=t,hy=el=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(ts=!0),t.firstContext=null)}function Ls(t){var e=t._currentValue;if(hy!==t)if(t={context:t,memoizedValue:e,next:null},el===null){if(Eh===null)throw Error(ge(308));el=t,Eh.dependencies={lanes:0,firstContext:t}}else el=el.next=t;return e}var Za=null;function my(t){Za===null?Za=[t]:Za.push(t)}function F1(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,my(e)):(n.next=s.next,s.next=n),e.interleaved=n,Ui(t,r)}function Ui(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var ta=!1;function gy(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function V1(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Li(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function ya(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Nt&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Ui(t,n)}return s=r.interleaved,s===null?(e.next=e,my(r)):(e.next=s.next,s.next=e),r.interleaved=e,Ui(t,n)}function $d(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,ty(t,n)}}function ww(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,a=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};a===null?s=a=o:a=a.next=o,n=n.next}while(n!==null);a===null?s=a=e:a=a.next=e}else s=a=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:a,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function kh(t,e,n,r){var s=t.updateQueue;ta=!1;var a=s.firstBaseUpdate,o=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var c=l,d=c.next;c.next=null,o===null?a=d:o.next=d,o=c;var h=t.alternate;h!==null&&(h=h.updateQueue,l=h.lastBaseUpdate,l!==o&&(l===null?h.firstBaseUpdate=d:l.next=d,h.lastBaseUpdate=c))}if(a!==null){var f=s.baseState;o=0,h=d=c=null,l=a;do{var p=l.lane,k=l.eventTime;if((r&p)===p){h!==null&&(h=h.next={eventTime:k,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var S=t,T=l;switch(p=e,k=n,T.tag){case 1:if(S=T.payload,typeof S=="function"){f=S.call(k,f,p);break e}f=S;break e;case 3:S.flags=S.flags&-65537|128;case 0:if(S=T.payload,p=typeof S=="function"?S.call(k,f,p):S,p==null)break e;f=dn({},f,p);break e;case 2:ta=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,p=s.effects,p===null?s.effects=[l]:p.push(l))}else k={eventTime:k,lane:p,tag:l.tag,payload:l.payload,callback:l.callback,next:null},h===null?(d=h=k,c=f):h=h.next=k,o|=p;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;p=l,l=p.next,p.next=null,s.lastBaseUpdate=p,s.shared.pending=null}}while(!0);if(h===null&&(c=f),s.baseState=c,s.firstBaseUpdate=d,s.lastBaseUpdate=h,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else a===null&&(s.shared.lanes=0);yo|=o,t.lanes=o,t.memoizedState=f}}function bw(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(ge(191,s));s.call(r)}}}var Du={},mi=Ma(Du),au=Ma(Du),ou=Ma(Du);function eo(t){if(t===Du)throw Error(ge(174));return t}function yy(t,e){switch(Jt(ou,e),Jt(au,t),Jt(mi,Du),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:bm(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=bm(e,t)}en(mi),Jt(mi,e)}function _l(){en(mi),en(au),en(ou)}function U1(t){eo(ou.current);var e=eo(mi.current),n=bm(e,t.type);e!==n&&(Jt(au,t),Jt(mi,n))}function vy(t){au.current===t&&(en(mi),en(au))}var cn=Ma(0);function Ch(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Tp=[];function xy(){for(var t=0;t<Tp.length;t++)Tp[t]._workInProgressVersionPrimary=null;Tp.length=0}var zd=Ki.ReactCurrentDispatcher,Ip=Ki.ReactCurrentBatchConfig,go=0,un=null,Fn=null,Qn=null,Sh=!1,Rc=!1,lu=0,ET=0;function Er(){throw Error(ge(321))}function wy(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Xs(t[n],e[n]))return!1;return!0}function by(t,e,n,r,s,a){if(go=a,un=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,zd.current=t===null||t.memoizedState===null?NT:TT,t=n(r,s),Rc){a=0;do{if(Rc=!1,lu=0,25<=a)throw Error(ge(301));a+=1,Qn=Fn=null,e.updateQueue=null,zd.current=IT,t=n(r,s)}while(Rc)}if(zd.current=Nh,e=Fn!==null&&Fn.next!==null,go=0,Qn=Fn=un=null,Sh=!1,e)throw Error(ge(300));return t}function _y(){var t=lu!==0;return lu=0,t}function oi(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Qn===null?un.memoizedState=Qn=t:Qn=Qn.next=t,Qn}function Os(){if(Fn===null){var t=un.alternate;t=t!==null?t.memoizedState:null}else t=Fn.next;var e=Qn===null?un.memoizedState:Qn.next;if(e!==null)Qn=e,Fn=t;else{if(t===null)throw Error(ge(310));Fn=t,t={memoizedState:Fn.memoizedState,baseState:Fn.baseState,baseQueue:Fn.baseQueue,queue:Fn.queue,next:null},Qn===null?un.memoizedState=Qn=t:Qn=Qn.next=t}return Qn}function cu(t,e){return typeof e=="function"?e(t):e}function Ap(t){var e=Os(),n=e.queue;if(n===null)throw Error(ge(311));n.lastRenderedReducer=t;var r=Fn,s=r.baseQueue,a=n.pending;if(a!==null){if(s!==null){var o=s.next;s.next=a.next,a.next=o}r.baseQueue=s=a,n.pending=null}if(s!==null){a=s.next,r=r.baseState;var l=o=null,c=null,d=a;do{var h=d.lane;if((go&h)===h)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var f={lane:h,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=f,o=r):c=c.next=f,un.lanes|=h,yo|=h}d=d.next}while(d!==null&&d!==a);c===null?o=r:c.next=l,Xs(r,e.memoizedState)||(ts=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do a=s.lane,un.lanes|=a,yo|=a,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Rp(t){var e=Os(),n=e.queue;if(n===null)throw Error(ge(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,a=e.memoizedState;if(s!==null){n.pending=null;var o=s=s.next;do a=t(a,o.action),o=o.next;while(o!==s);Xs(a,e.memoizedState)||(ts=!0),e.memoizedState=a,e.baseQueue===null&&(e.baseState=a),n.lastRenderedState=a}return[a,r]}function B1(){}function $1(t,e){var n=un,r=Os(),s=e(),a=!Xs(r.memoizedState,s);if(a&&(r.memoizedState=s,ts=!0),r=r.queue,jy(H1.bind(null,n,r,t),[t]),r.getSnapshot!==e||a||Qn!==null&&Qn.memoizedState.tag&1){if(n.flags|=2048,uu(9,G1.bind(null,n,r,s,e),void 0,null),Xn===null)throw Error(ge(349));go&30||z1(n,e,s)}return s}function z1(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=un.updateQueue,e===null?(e={lastEffect:null,stores:null},un.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function G1(t,e,n,r){e.value=n,e.getSnapshot=r,q1(e)&&W1(t)}function H1(t,e,n){return n(function(){q1(e)&&W1(t)})}function q1(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Xs(t,n)}catch{return!0}}function W1(t){var e=Ui(t,1);e!==null&&Ys(e,t,1,-1)}function _w(t){var e=oi();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:cu,lastRenderedState:t},e.queue=t,t=t.dispatch=ST.bind(null,un,t),[e.memoizedState,t]}function uu(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=un.updateQueue,e===null?(e={lastEffect:null,stores:null},un.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function K1(){return Os().memoizedState}function Gd(t,e,n,r){var s=oi();un.flags|=t,s.memoizedState=uu(1|e,n,void 0,r===void 0?null:r)}function mf(t,e,n,r){var s=Os();r=r===void 0?null:r;var a=void 0;if(Fn!==null){var o=Fn.memoizedState;if(a=o.destroy,r!==null&&wy(r,o.deps)){s.memoizedState=uu(e,n,a,r);return}}un.flags|=t,s.memoizedState=uu(1|e,n,a,r)}function jw(t,e){return Gd(8390656,8,t,e)}function jy(t,e){return mf(2048,8,t,e)}function Q1(t,e){return mf(4,2,t,e)}function Y1(t,e){return mf(4,4,t,e)}function J1(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function X1(t,e,n){return n=n!=null?n.concat([t]):null,mf(4,4,J1.bind(null,e,t),n)}function Ey(){}function Z1(t,e){var n=Os();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&wy(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function ej(t,e){var n=Os();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&wy(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function tj(t,e,n){return go&21?(Xs(n,e)||(n=a1(),un.lanes|=n,yo|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,ts=!0),t.memoizedState=n)}function kT(t,e){var n=$t;$t=n!==0&&4>n?n:4,t(!0);var r=Ip.transition;Ip.transition={};try{t(!1),e()}finally{$t=n,Ip.transition=r}}function nj(){return Os().memoizedState}function CT(t,e,n){var r=xa(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},rj(t))sj(e,n);else if(n=F1(t,e,n,r),n!==null){var s=Hr();Ys(n,t,r,s),ij(n,e,r)}}function ST(t,e,n){var r=xa(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(rj(t))sj(e,s);else{var a=t.alternate;if(t.lanes===0&&(a===null||a.lanes===0)&&(a=e.lastRenderedReducer,a!==null))try{var o=e.lastRenderedState,l=a(o,n);if(s.hasEagerState=!0,s.eagerState=l,Xs(l,o)){var c=e.interleaved;c===null?(s.next=s,my(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}n=F1(t,e,s,r),n!==null&&(s=Hr(),Ys(n,t,r,s),ij(n,e,r))}}function rj(t){var e=t.alternate;return t===un||e!==null&&e===un}function sj(t,e){Rc=Sh=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function ij(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,ty(t,n)}}var Nh={readContext:Ls,useCallback:Er,useContext:Er,useEffect:Er,useImperativeHandle:Er,useInsertionEffect:Er,useLayoutEffect:Er,useMemo:Er,useReducer:Er,useRef:Er,useState:Er,useDebugValue:Er,useDeferredValue:Er,useTransition:Er,useMutableSource:Er,useSyncExternalStore:Er,useId:Er,unstable_isNewReconciler:!1},NT={readContext:Ls,useCallback:function(t,e){return oi().memoizedState=[t,e===void 0?null:e],t},useContext:Ls,useEffect:jw,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Gd(4194308,4,J1.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Gd(4194308,4,t,e)},useInsertionEffect:function(t,e){return Gd(4,2,t,e)},useMemo:function(t,e){var n=oi();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=oi();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=CT.bind(null,un,t),[r.memoizedState,t]},useRef:function(t){var e=oi();return t={current:t},e.memoizedState=t},useState:_w,useDebugValue:Ey,useDeferredValue:function(t){return oi().memoizedState=t},useTransition:function(){var t=_w(!1),e=t[0];return t=kT.bind(null,t[1]),oi().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=un,s=oi();if(nn){if(n===void 0)throw Error(ge(407));n=n()}else{if(n=e(),Xn===null)throw Error(ge(349));go&30||z1(r,e,n)}s.memoizedState=n;var a={value:n,getSnapshot:e};return s.queue=a,jw(H1.bind(null,r,a,t),[t]),r.flags|=2048,uu(9,G1.bind(null,r,a,n,e),void 0,null),n},useId:function(){var t=oi(),e=Xn.identifierPrefix;if(nn){var n=Pi,r=Ri;n=(r&~(1<<32-Qs(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=lu++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=ET++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},TT={readContext:Ls,useCallback:Z1,useContext:Ls,useEffect:jy,useImperativeHandle:X1,useInsertionEffect:Q1,useLayoutEffect:Y1,useMemo:ej,useReducer:Ap,useRef:K1,useState:function(){return Ap(cu)},useDebugValue:Ey,useDeferredValue:function(t){var e=Os();return tj(e,Fn.memoizedState,t)},useTransition:function(){var t=Ap(cu)[0],e=Os().memoizedState;return[t,e]},useMutableSource:B1,useSyncExternalStore:$1,useId:nj,unstable_isNewReconciler:!1},IT={readContext:Ls,useCallback:Z1,useContext:Ls,useEffect:jy,useImperativeHandle:X1,useInsertionEffect:Q1,useLayoutEffect:Y1,useMemo:ej,useReducer:Rp,useRef:K1,useState:function(){return Rp(cu)},useDebugValue:Ey,useDeferredValue:function(t){var e=Os();return Fn===null?e.memoizedState=t:tj(e,Fn.memoizedState,t)},useTransition:function(){var t=Rp(cu)[0],e=Os().memoizedState;return[t,e]},useMutableSource:B1,useSyncExternalStore:$1,useId:nj,unstable_isNewReconciler:!1};function $s(t,e){if(t&&t.defaultProps){e=dn({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function $m(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:dn({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var gf={isMounted:function(t){return(t=t._reactInternals)?So(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Hr(),s=xa(t),a=Li(r,s);a.payload=e,n!=null&&(a.callback=n),e=ya(t,a,s),e!==null&&(Ys(e,t,s,r),$d(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Hr(),s=xa(t),a=Li(r,s);a.tag=1,a.payload=e,n!=null&&(a.callback=n),e=ya(t,a,s),e!==null&&(Ys(e,t,s,r),$d(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Hr(),r=xa(t),s=Li(n,r);s.tag=2,e!=null&&(s.callback=e),e=ya(t,s,r),e!==null&&(Ys(e,t,r,n),$d(e,t,r))}};function Ew(t,e,n,r,s,a,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,a,o):e.prototype&&e.prototype.isPureReactComponent?!nu(n,r)||!nu(s,a):!0}function aj(t,e,n){var r=!1,s=Na,a=e.contextType;return typeof a=="object"&&a!==null?a=Ls(a):(s=ss(e)?po:Or.current,r=e.contextTypes,a=(r=r!=null)?xl(t,s):Na),e=new e(n,a),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=gf,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=a),e}function kw(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&gf.enqueueReplaceState(e,e.state,null)}function zm(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},gy(t);var a=e.contextType;typeof a=="object"&&a!==null?s.context=Ls(a):(a=ss(e)?po:Or.current,s.context=xl(t,a)),s.state=t.memoizedState,a=e.getDerivedStateFromProps,typeof a=="function"&&($m(t,e,a,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&gf.enqueueReplaceState(s,s.state,null),kh(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function jl(t,e){try{var n="",r=e;do n+=sN(r),r=r.return;while(r);var s=n}catch(a){s=`
Error generating stack: `+a.message+`
`+a.stack}return{value:t,source:e,stack:s,digest:null}}function Pp(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Gm(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var AT=typeof WeakMap=="function"?WeakMap:Map;function oj(t,e,n){n=Li(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Ih||(Ih=!0,eg=r),Gm(t,e)},n}function lj(t,e,n){n=Li(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){Gm(t,e)}}var a=t.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(n.callback=function(){Gm(t,e),typeof r!="function"&&(va===null?va=new Set([this]):va.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function Cw(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new AT;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=HT.bind(null,t,e,n),e.then(t,t))}function Sw(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Nw(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Li(-1,1),e.tag=2,ya(n,e,1))),n.lanes|=1),t)}var RT=Ki.ReactCurrentOwner,ts=!1;function zr(t,e,n,r){e.child=t===null?M1(e,null,n,r):bl(e,t.child,n,r)}function Tw(t,e,n,r,s){n=n.render;var a=e.ref;return cl(e,s),r=by(t,e,n,r,a,s),n=_y(),t!==null&&!ts?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Bi(t,e,s)):(nn&&n&&cy(e),e.flags|=1,zr(t,e,r,s),e.child)}function Iw(t,e,n,r,s){if(t===null){var a=n.type;return typeof a=="function"&&!Ry(a)&&a.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=a,cj(t,e,a,r,s)):(t=Kd(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(a=t.child,!(t.lanes&s)){var o=a.memoizedProps;if(n=n.compare,n=n!==null?n:nu,n(o,r)&&t.ref===e.ref)return Bi(t,e,s)}return e.flags|=1,t=wa(a,r),t.ref=e.ref,t.return=e,e.child=t}function cj(t,e,n,r,s){if(t!==null){var a=t.memoizedProps;if(nu(a,r)&&t.ref===e.ref)if(ts=!1,e.pendingProps=r=a,(t.lanes&s)!==0)t.flags&131072&&(ts=!0);else return e.lanes=t.lanes,Bi(t,e,s)}return Hm(t,e,n,r,s)}function uj(t,e,n){var r=e.pendingProps,s=r.children,a=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Jt(nl,hs),hs|=n;else{if(!(n&1073741824))return t=a!==null?a.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Jt(nl,hs),hs|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=a!==null?a.baseLanes:n,Jt(nl,hs),hs|=r}else a!==null?(r=a.baseLanes|n,e.memoizedState=null):r=n,Jt(nl,hs),hs|=r;return zr(t,e,s,n),e.child}function dj(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Hm(t,e,n,r,s){var a=ss(n)?po:Or.current;return a=xl(e,a),cl(e,s),n=by(t,e,n,r,a,s),r=_y(),t!==null&&!ts?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Bi(t,e,s)):(nn&&r&&cy(e),e.flags|=1,zr(t,e,n,s),e.child)}function Aw(t,e,n,r,s){if(ss(n)){var a=!0;wh(e)}else a=!1;if(cl(e,s),e.stateNode===null)Hd(t,e),aj(e,n,r),zm(e,n,r,s),r=!0;else if(t===null){var o=e.stateNode,l=e.memoizedProps;o.props=l;var c=o.context,d=n.contextType;typeof d=="object"&&d!==null?d=Ls(d):(d=ss(n)?po:Or.current,d=xl(e,d));var h=n.getDerivedStateFromProps,f=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==r||c!==d)&&kw(e,o,r,d),ta=!1;var p=e.memoizedState;o.state=p,kh(e,r,o,s),c=e.memoizedState,l!==r||p!==c||rs.current||ta?(typeof h=="function"&&($m(e,n,h,r),c=e.memoizedState),(l=ta||Ew(e,n,l,r,p,c,d))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),o.props=r,o.state=c,o.context=d,r=l):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,V1(t,e),l=e.memoizedProps,d=e.type===e.elementType?l:$s(e.type,l),o.props=d,f=e.pendingProps,p=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=Ls(c):(c=ss(n)?po:Or.current,c=xl(e,c));var k=n.getDerivedStateFromProps;(h=typeof k=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==f||p!==c)&&kw(e,o,r,c),ta=!1,p=e.memoizedState,o.state=p,kh(e,r,o,s);var S=e.memoizedState;l!==f||p!==S||rs.current||ta?(typeof k=="function"&&($m(e,n,k,r),S=e.memoizedState),(d=ta||Ew(e,n,d,r,p,S,c)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,S,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,S,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=S),o.props=r,o.state=S,o.context=c,r=d):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),r=!1)}return qm(t,e,n,r,a,s)}function qm(t,e,n,r,s,a){dj(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&gw(e,n,!1),Bi(t,e,a);r=e.stateNode,RT.current=e;var l=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=bl(e,t.child,null,a),e.child=bl(e,null,l,a)):zr(t,e,l,a),e.memoizedState=r.state,s&&gw(e,n,!0),e.child}function hj(t){var e=t.stateNode;e.pendingContext?mw(t,e.pendingContext,e.pendingContext!==e.context):e.context&&mw(t,e.context,!1),yy(t,e.containerInfo)}function Rw(t,e,n,r,s){return wl(),dy(s),e.flags|=256,zr(t,e,n,r),e.child}var Wm={dehydrated:null,treeContext:null,retryLane:0};function Km(t){return{baseLanes:t,cachePool:null,transitions:null}}function fj(t,e,n){var r=e.pendingProps,s=cn.current,a=!1,o=(e.flags&128)!==0,l;if((l=o)||(l=t!==null&&t.memoizedState===null?!1:(s&2)!==0),l?(a=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),Jt(cn,s&1),t===null)return Um(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,a?(r=e.mode,a=e.child,o={mode:"hidden",children:o},!(r&1)&&a!==null?(a.childLanes=0,a.pendingProps=o):a=xf(o,r,0,null),t=ao(t,r,n,null),a.return=e,t.return=e,a.sibling=t,e.child=a,e.child.memoizedState=Km(n),e.memoizedState=Wm,t):ky(e,o));if(s=t.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return PT(t,e,o,r,l,s,n);if(a){a=r.fallback,o=e.mode,s=t.child,l=s.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=wa(s,c),r.subtreeFlags=s.subtreeFlags&14680064),l!==null?a=wa(l,a):(a=ao(a,o,n,null),a.flags|=2),a.return=e,r.return=e,r.sibling=a,e.child=r,r=a,a=e.child,o=t.child.memoizedState,o=o===null?Km(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},a.memoizedState=o,a.childLanes=t.childLanes&~n,e.memoizedState=Wm,r}return a=t.child,t=a.sibling,r=wa(a,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function ky(t,e){return e=xf({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function xd(t,e,n,r){return r!==null&&dy(r),bl(e,t.child,null,n),t=ky(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function PT(t,e,n,r,s,a,o){if(n)return e.flags&256?(e.flags&=-257,r=Pp(Error(ge(422))),xd(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(a=r.fallback,s=e.mode,r=xf({mode:"visible",children:r.children},s,0,null),a=ao(a,s,o,null),a.flags|=2,r.return=e,a.return=e,r.sibling=a,e.child=r,e.mode&1&&bl(e,t.child,null,o),e.child.memoizedState=Km(o),e.memoizedState=Wm,a);if(!(e.mode&1))return xd(t,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var l=r.dgst;return r=l,a=Error(ge(419)),r=Pp(a,r,void 0),xd(t,e,o,r)}if(l=(o&t.childLanes)!==0,ts||l){if(r=Xn,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==a.retryLane&&(a.retryLane=s,Ui(t,s),Ys(r,t,s,-1))}return Ay(),r=Pp(Error(ge(421))),xd(t,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=qT.bind(null,t),s._reactRetry=e,null):(t=a.treeContext,ms=ga(s.nextSibling),ys=e,nn=!0,qs=null,t!==null&&(Is[As++]=Ri,Is[As++]=Pi,Is[As++]=mo,Ri=t.id,Pi=t.overflow,mo=e),e=ky(e,r.children),e.flags|=4096,e)}function Pw(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Bm(t.return,e,n)}function Dp(t,e,n,r,s){var a=t.memoizedState;a===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=s)}function pj(t,e,n){var r=e.pendingProps,s=r.revealOrder,a=r.tail;if(zr(t,e,r.children,n),r=cn.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Pw(t,n,e);else if(t.tag===19)Pw(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Jt(cn,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&Ch(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),Dp(e,!1,s,n,a);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&Ch(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}Dp(e,!0,n,null,a);break;case"together":Dp(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Hd(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Bi(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),yo|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(ge(153));if(e.child!==null){for(t=e.child,n=wa(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=wa(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function DT(t,e,n){switch(e.tag){case 3:hj(e),wl();break;case 5:U1(e);break;case 1:ss(e.type)&&wh(e);break;case 4:yy(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Jt(jh,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Jt(cn,cn.current&1),e.flags|=128,null):n&e.child.childLanes?fj(t,e,n):(Jt(cn,cn.current&1),t=Bi(t,e,n),t!==null?t.sibling:null);Jt(cn,cn.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return pj(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Jt(cn,cn.current),r)break;return null;case 22:case 23:return e.lanes=0,uj(t,e,n)}return Bi(t,e,n)}var mj,Qm,gj,yj;mj=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Qm=function(){};gj=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,eo(mi.current);var a=null;switch(n){case"input":s=ym(t,s),r=ym(t,r),a=[];break;case"select":s=dn({},s,{value:void 0}),r=dn({},r,{value:void 0}),a=[];break;case"textarea":s=wm(t,s),r=wm(t,r),a=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=vh)}_m(n,r);var o;n=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var l=s[d];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Qc.hasOwnProperty(d)?a||(a=[]):(a=a||[]).push(d,null));for(d in r){var c=r[d];if(l=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(a||(a=[]),a.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(a=a||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(a=a||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Qc.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&Zt("scroll",t),a||l===c||(a=[])):(a=a||[]).push(d,c))}n&&(a=a||[]).push("style",n);var d=a;(e.updateQueue=d)&&(e.flags|=4)}};yj=function(t,e,n,r){n!==r&&(e.flags|=4)};function cc(t,e){if(!nn)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function kr(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function LT(t,e,n){var r=e.pendingProps;switch(uy(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return kr(e),null;case 1:return ss(e.type)&&xh(),kr(e),null;case 3:return r=e.stateNode,_l(),en(rs),en(Or),xy(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(yd(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,qs!==null&&(rg(qs),qs=null))),Qm(t,e),kr(e),null;case 5:vy(e);var s=eo(ou.current);if(n=e.type,t!==null&&e.stateNode!=null)gj(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(ge(166));return kr(e),null}if(t=eo(mi.current),yd(e)){r=e.stateNode,n=e.type;var a=e.memoizedProps;switch(r[di]=e,r[iu]=a,t=(e.mode&1)!==0,n){case"dialog":Zt("cancel",r),Zt("close",r);break;case"iframe":case"object":case"embed":Zt("load",r);break;case"video":case"audio":for(s=0;s<yc.length;s++)Zt(yc[s],r);break;case"source":Zt("error",r);break;case"img":case"image":case"link":Zt("error",r),Zt("load",r);break;case"details":Zt("toggle",r);break;case"input":$x(r,a),Zt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},Zt("invalid",r);break;case"textarea":Gx(r,a),Zt("invalid",r)}_m(n,a),s=null;for(var o in a)if(a.hasOwnProperty(o)){var l=a[o];o==="children"?typeof l=="string"?r.textContent!==l&&(a.suppressHydrationWarning!==!0&&gd(r.textContent,l,t),s=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(a.suppressHydrationWarning!==!0&&gd(r.textContent,l,t),s=["children",""+l]):Qc.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&Zt("scroll",r)}switch(n){case"input":ld(r),zx(r,a,!0);break;case"textarea":ld(r),Hx(r);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(r.onclick=vh)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=H_(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[di]=e,t[iu]=r,mj(t,e,!1,!1),e.stateNode=t;e:{switch(o=jm(n,r),n){case"dialog":Zt("cancel",t),Zt("close",t),s=r;break;case"iframe":case"object":case"embed":Zt("load",t),s=r;break;case"video":case"audio":for(s=0;s<yc.length;s++)Zt(yc[s],t);s=r;break;case"source":Zt("error",t),s=r;break;case"img":case"image":case"link":Zt("error",t),Zt("load",t),s=r;break;case"details":Zt("toggle",t),s=r;break;case"input":$x(t,r),s=ym(t,r),Zt("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=dn({},r,{value:void 0}),Zt("invalid",t);break;case"textarea":Gx(t,r),s=wm(t,r),Zt("invalid",t);break;default:s=r}_m(n,s),l=s;for(a in l)if(l.hasOwnProperty(a)){var c=l[a];a==="style"?K_(t,c):a==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&q_(t,c)):a==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&Yc(t,c):typeof c=="number"&&Yc(t,""+c):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(Qc.hasOwnProperty(a)?c!=null&&a==="onScroll"&&Zt("scroll",t):c!=null&&Qg(t,a,c,o))}switch(n){case"input":ld(t),zx(t,r,!1);break;case"textarea":ld(t),Hx(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Sa(r.value));break;case"select":t.multiple=!!r.multiple,a=r.value,a!=null?il(t,!!r.multiple,a,!1):r.defaultValue!=null&&il(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=vh)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return kr(e),null;case 6:if(t&&e.stateNode!=null)yj(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(ge(166));if(n=eo(ou.current),eo(mi.current),yd(e)){if(r=e.stateNode,n=e.memoizedProps,r[di]=e,(a=r.nodeValue!==n)&&(t=ys,t!==null))switch(t.tag){case 3:gd(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&gd(r.nodeValue,n,(t.mode&1)!==0)}a&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[di]=e,e.stateNode=r}return kr(e),null;case 13:if(en(cn),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(nn&&ms!==null&&e.mode&1&&!(e.flags&128))L1(),wl(),e.flags|=98560,a=!1;else if(a=yd(e),r!==null&&r.dehydrated!==null){if(t===null){if(!a)throw Error(ge(318));if(a=e.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(ge(317));a[di]=e}else wl(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;kr(e),a=!1}else qs!==null&&(rg(qs),qs=null),a=!0;if(!a)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||cn.current&1?Vn===0&&(Vn=3):Ay())),e.updateQueue!==null&&(e.flags|=4),kr(e),null);case 4:return _l(),Qm(t,e),t===null&&ru(e.stateNode.containerInfo),kr(e),null;case 10:return py(e.type._context),kr(e),null;case 17:return ss(e.type)&&xh(),kr(e),null;case 19:if(en(cn),a=e.memoizedState,a===null)return kr(e),null;if(r=(e.flags&128)!==0,o=a.rendering,o===null)if(r)cc(a,!1);else{if(Vn!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Ch(t),o!==null){for(e.flags|=128,cc(a,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)a=n,t=r,a.flags&=14680066,o=a.alternate,o===null?(a.childLanes=0,a.lanes=t,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=o.childLanes,a.lanes=o.lanes,a.child=o.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=o.memoizedProps,a.memoizedState=o.memoizedState,a.updateQueue=o.updateQueue,a.type=o.type,t=o.dependencies,a.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Jt(cn,cn.current&1|2),e.child}t=t.sibling}a.tail!==null&&En()>El&&(e.flags|=128,r=!0,cc(a,!1),e.lanes=4194304)}else{if(!r)if(t=Ch(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),cc(a,!0),a.tail===null&&a.tailMode==="hidden"&&!o.alternate&&!nn)return kr(e),null}else 2*En()-a.renderingStartTime>El&&n!==1073741824&&(e.flags|=128,r=!0,cc(a,!1),e.lanes=4194304);a.isBackwards?(o.sibling=e.child,e.child=o):(n=a.last,n!==null?n.sibling=o:e.child=o,a.last=o)}return a.tail!==null?(e=a.tail,a.rendering=e,a.tail=e.sibling,a.renderingStartTime=En(),e.sibling=null,n=cn.current,Jt(cn,r?n&1|2:n&1),e):(kr(e),null);case 22:case 23:return Iy(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?hs&1073741824&&(kr(e),e.subtreeFlags&6&&(e.flags|=8192)):kr(e),null;case 24:return null;case 25:return null}throw Error(ge(156,e.tag))}function OT(t,e){switch(uy(e),e.tag){case 1:return ss(e.type)&&xh(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return _l(),en(rs),en(Or),xy(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return vy(e),null;case 13:if(en(cn),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(ge(340));wl()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return en(cn),null;case 4:return _l(),null;case 10:return py(e.type._context),null;case 22:case 23:return Iy(),null;case 24:return null;default:return null}}var wd=!1,Nr=!1,MT=typeof WeakSet=="function"?WeakSet:Set,Oe=null;function tl(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){pn(t,e,r)}else n.current=null}function Ym(t,e,n){try{n()}catch(r){pn(t,e,r)}}var Dw=!1;function FT(t,e){if(Pm=mh,t=_1(),ly(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch{n=null;break e}var o=0,l=-1,c=-1,d=0,h=0,f=t,p=null;t:for(;;){for(var k;f!==n||s!==0&&f.nodeType!==3||(l=o+s),f!==a||r!==0&&f.nodeType!==3||(c=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(k=f.firstChild)!==null;)p=f,f=k;for(;;){if(f===t)break t;if(p===n&&++d===s&&(l=o),p===a&&++h===r&&(c=o),(k=f.nextSibling)!==null)break;f=p,p=f.parentNode}f=k}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Dm={focusedElem:t,selectionRange:n},mh=!1,Oe=e;Oe!==null;)if(e=Oe,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Oe=t;else for(;Oe!==null;){e=Oe;try{var S=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(S!==null){var T=S.memoizedProps,C=S.memoizedState,j=e.stateNode,y=j.getSnapshotBeforeUpdate(e.elementType===e.type?T:$s(e.type,T),C);j.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var v=e.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ge(163))}}catch(R){pn(e,e.return,R)}if(t=e.sibling,t!==null){t.return=e.return,Oe=t;break}Oe=e.return}return S=Dw,Dw=!1,S}function Pc(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var a=s.destroy;s.destroy=void 0,a!==void 0&&Ym(e,n,a)}s=s.next}while(s!==r)}}function yf(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Jm(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function vj(t){var e=t.alternate;e!==null&&(t.alternate=null,vj(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[di],delete e[iu],delete e[Mm],delete e[wT],delete e[bT])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function xj(t){return t.tag===5||t.tag===3||t.tag===4}function Lw(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||xj(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Xm(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=vh));else if(r!==4&&(t=t.child,t!==null))for(Xm(t,e,n),t=t.sibling;t!==null;)Xm(t,e,n),t=t.sibling}function Zm(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Zm(t,e,n),t=t.sibling;t!==null;)Zm(t,e,n),t=t.sibling}var fr=null,zs=!1;function Xi(t,e,n){for(n=n.child;n!==null;)wj(t,e,n),n=n.sibling}function wj(t,e,n){if(pi&&typeof pi.onCommitFiberUnmount=="function")try{pi.onCommitFiberUnmount(cf,n)}catch{}switch(n.tag){case 5:Nr||tl(n,e);case 6:var r=fr,s=zs;fr=null,Xi(t,e,n),fr=r,zs=s,fr!==null&&(zs?(t=fr,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):fr.removeChild(n.stateNode));break;case 18:fr!==null&&(zs?(t=fr,n=n.stateNode,t.nodeType===8?Sp(t.parentNode,n):t.nodeType===1&&Sp(t,n),eu(t)):Sp(fr,n.stateNode));break;case 4:r=fr,s=zs,fr=n.stateNode.containerInfo,zs=!0,Xi(t,e,n),fr=r,zs=s;break;case 0:case 11:case 14:case 15:if(!Nr&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var a=s,o=a.destroy;a=a.tag,o!==void 0&&(a&2||a&4)&&Ym(n,e,o),s=s.next}while(s!==r)}Xi(t,e,n);break;case 1:if(!Nr&&(tl(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){pn(n,e,l)}Xi(t,e,n);break;case 21:Xi(t,e,n);break;case 22:n.mode&1?(Nr=(r=Nr)||n.memoizedState!==null,Xi(t,e,n),Nr=r):Xi(t,e,n);break;default:Xi(t,e,n)}}function Ow(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new MT),e.forEach(function(r){var s=WT.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function Bs(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var a=t,o=e,l=o;e:for(;l!==null;){switch(l.tag){case 5:fr=l.stateNode,zs=!1;break e;case 3:fr=l.stateNode.containerInfo,zs=!0;break e;case 4:fr=l.stateNode.containerInfo,zs=!0;break e}l=l.return}if(fr===null)throw Error(ge(160));wj(a,o,s),fr=null,zs=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(d){pn(s,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)bj(e,t),e=e.sibling}function bj(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Bs(e,t),ii(t),r&4){try{Pc(3,t,t.return),yf(3,t)}catch(T){pn(t,t.return,T)}try{Pc(5,t,t.return)}catch(T){pn(t,t.return,T)}}break;case 1:Bs(e,t),ii(t),r&512&&n!==null&&tl(n,n.return);break;case 5:if(Bs(e,t),ii(t),r&512&&n!==null&&tl(n,n.return),t.flags&32){var s=t.stateNode;try{Yc(s,"")}catch(T){pn(t,t.return,T)}}if(r&4&&(s=t.stateNode,s!=null)){var a=t.memoizedProps,o=n!==null?n.memoizedProps:a,l=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{l==="input"&&a.type==="radio"&&a.name!=null&&z_(s,a),jm(l,o);var d=jm(l,a);for(o=0;o<c.length;o+=2){var h=c[o],f=c[o+1];h==="style"?K_(s,f):h==="dangerouslySetInnerHTML"?q_(s,f):h==="children"?Yc(s,f):Qg(s,h,f,d)}switch(l){case"input":vm(s,a);break;case"textarea":G_(s,a);break;case"select":var p=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!a.multiple;var k=a.value;k!=null?il(s,!!a.multiple,k,!1):p!==!!a.multiple&&(a.defaultValue!=null?il(s,!!a.multiple,a.defaultValue,!0):il(s,!!a.multiple,a.multiple?[]:"",!1))}s[iu]=a}catch(T){pn(t,t.return,T)}}break;case 6:if(Bs(e,t),ii(t),r&4){if(t.stateNode===null)throw Error(ge(162));s=t.stateNode,a=t.memoizedProps;try{s.nodeValue=a}catch(T){pn(t,t.return,T)}}break;case 3:if(Bs(e,t),ii(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{eu(e.containerInfo)}catch(T){pn(t,t.return,T)}break;case 4:Bs(e,t),ii(t);break;case 13:Bs(e,t),ii(t),s=t.child,s.flags&8192&&(a=s.memoizedState!==null,s.stateNode.isHidden=a,!a||s.alternate!==null&&s.alternate.memoizedState!==null||(Ny=En())),r&4&&Ow(t);break;case 22:if(h=n!==null&&n.memoizedState!==null,t.mode&1?(Nr=(d=Nr)||h,Bs(e,t),Nr=d):Bs(e,t),ii(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!h&&t.mode&1)for(Oe=t,h=t.child;h!==null;){for(f=Oe=h;Oe!==null;){switch(p=Oe,k=p.child,p.tag){case 0:case 11:case 14:case 15:Pc(4,p,p.return);break;case 1:tl(p,p.return);var S=p.stateNode;if(typeof S.componentWillUnmount=="function"){r=p,n=p.return;try{e=r,S.props=e.memoizedProps,S.state=e.memoizedState,S.componentWillUnmount()}catch(T){pn(r,n,T)}}break;case 5:tl(p,p.return);break;case 22:if(p.memoizedState!==null){Fw(f);continue}}k!==null?(k.return=p,Oe=k):Fw(f)}h=h.sibling}e:for(h=null,f=t;;){if(f.tag===5){if(h===null){h=f;try{s=f.stateNode,d?(a=s.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(l=f.stateNode,c=f.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=W_("display",o))}catch(T){pn(t,t.return,T)}}}else if(f.tag===6){if(h===null)try{f.stateNode.nodeValue=d?"":f.memoizedProps}catch(T){pn(t,t.return,T)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===t)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:Bs(e,t),ii(t),r&4&&Ow(t);break;case 21:break;default:Bs(e,t),ii(t)}}function ii(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(xj(n)){var r=n;break e}n=n.return}throw Error(ge(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Yc(s,""),r.flags&=-33);var a=Lw(t);Zm(t,a,s);break;case 3:case 4:var o=r.stateNode.containerInfo,l=Lw(t);Xm(t,l,o);break;default:throw Error(ge(161))}}catch(c){pn(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function VT(t,e,n){Oe=t,_j(t)}function _j(t,e,n){for(var r=(t.mode&1)!==0;Oe!==null;){var s=Oe,a=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||wd;if(!o){var l=s.alternate,c=l!==null&&l.memoizedState!==null||Nr;l=wd;var d=Nr;if(wd=o,(Nr=c)&&!d)for(Oe=s;Oe!==null;)o=Oe,c=o.child,o.tag===22&&o.memoizedState!==null?Vw(s):c!==null?(c.return=o,Oe=c):Vw(s);for(;a!==null;)Oe=a,_j(a),a=a.sibling;Oe=s,wd=l,Nr=d}Mw(t)}else s.subtreeFlags&8772&&a!==null?(a.return=s,Oe=a):Mw(t)}}function Mw(t){for(;Oe!==null;){var e=Oe;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Nr||yf(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Nr)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:$s(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=e.updateQueue;a!==null&&bw(e,a,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}bw(e,o,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var h=d.memoizedState;if(h!==null){var f=h.dehydrated;f!==null&&eu(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ge(163))}Nr||e.flags&512&&Jm(e)}catch(p){pn(e,e.return,p)}}if(e===t){Oe=null;break}if(n=e.sibling,n!==null){n.return=e.return,Oe=n;break}Oe=e.return}}function Fw(t){for(;Oe!==null;){var e=Oe;if(e===t){Oe=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Oe=n;break}Oe=e.return}}function Vw(t){for(;Oe!==null;){var e=Oe;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{yf(4,e)}catch(c){pn(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){pn(e,s,c)}}var a=e.return;try{Jm(e)}catch(c){pn(e,a,c)}break;case 5:var o=e.return;try{Jm(e)}catch(c){pn(e,o,c)}}}catch(c){pn(e,e.return,c)}if(e===t){Oe=null;break}var l=e.sibling;if(l!==null){l.return=e.return,Oe=l;break}Oe=e.return}}var UT=Math.ceil,Th=Ki.ReactCurrentDispatcher,Cy=Ki.ReactCurrentOwner,Ps=Ki.ReactCurrentBatchConfig,Nt=0,Xn=null,An=null,gr=0,hs=0,nl=Ma(0),Vn=0,du=null,yo=0,vf=0,Sy=0,Dc=null,Zr=null,Ny=0,El=1/0,Ti=null,Ih=!1,eg=null,va=null,bd=!1,ua=null,Ah=0,Lc=0,tg=null,qd=-1,Wd=0;function Hr(){return Nt&6?En():qd!==-1?qd:qd=En()}function xa(t){return t.mode&1?Nt&2&&gr!==0?gr&-gr:jT.transition!==null?(Wd===0&&(Wd=a1()),Wd):(t=$t,t!==0||(t=window.event,t=t===void 0?16:f1(t.type)),t):1}function Ys(t,e,n,r){if(50<Lc)throw Lc=0,tg=null,Error(ge(185));Au(t,n,r),(!(Nt&2)||t!==Xn)&&(t===Xn&&(!(Nt&2)&&(vf|=n),Vn===4&&ra(t,gr)),is(t,r),n===1&&Nt===0&&!(e.mode&1)&&(El=En()+500,pf&&Fa()))}function is(t,e){var n=t.callbackNode;jN(t,e);var r=ph(t,t===Xn?gr:0);if(r===0)n!==null&&Kx(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Kx(n),e===1)t.tag===0?_T(Uw.bind(null,t)):R1(Uw.bind(null,t)),vT(function(){!(Nt&6)&&Fa()}),n=null;else{switch(o1(r)){case 1:n=ey;break;case 4:n=s1;break;case 16:n=fh;break;case 536870912:n=i1;break;default:n=fh}n=Ij(n,jj.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function jj(t,e){if(qd=-1,Wd=0,Nt&6)throw Error(ge(327));var n=t.callbackNode;if(ul()&&t.callbackNode!==n)return null;var r=ph(t,t===Xn?gr:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=Rh(t,r);else{e=r;var s=Nt;Nt|=2;var a=kj();(Xn!==t||gr!==e)&&(Ti=null,El=En()+500,io(t,e));do try{zT();break}catch(l){Ej(t,l)}while(!0);fy(),Th.current=a,Nt=s,An!==null?e=0:(Xn=null,gr=0,e=Vn)}if(e!==0){if(e===2&&(s=Nm(t),s!==0&&(r=s,e=ng(t,s))),e===1)throw n=du,io(t,0),ra(t,r),is(t,En()),n;if(e===6)ra(t,r);else{if(s=t.current.alternate,!(r&30)&&!BT(s)&&(e=Rh(t,r),e===2&&(a=Nm(t),a!==0&&(r=a,e=ng(t,a))),e===1))throw n=du,io(t,0),ra(t,r),is(t,En()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(ge(345));case 2:Qa(t,Zr,Ti);break;case 3:if(ra(t,r),(r&130023424)===r&&(e=Ny+500-En(),10<e)){if(ph(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){Hr(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=Om(Qa.bind(null,t,Zr,Ti),e);break}Qa(t,Zr,Ti);break;case 4:if(ra(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var o=31-Qs(r);a=1<<o,o=e[o],o>s&&(s=o),r&=~a}if(r=s,r=En()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*UT(r/1960))-r,10<r){t.timeoutHandle=Om(Qa.bind(null,t,Zr,Ti),r);break}Qa(t,Zr,Ti);break;case 5:Qa(t,Zr,Ti);break;default:throw Error(ge(329))}}}return is(t,En()),t.callbackNode===n?jj.bind(null,t):null}function ng(t,e){var n=Dc;return t.current.memoizedState.isDehydrated&&(io(t,e).flags|=256),t=Rh(t,e),t!==2&&(e=Zr,Zr=n,e!==null&&rg(e)),t}function rg(t){Zr===null?Zr=t:Zr.push.apply(Zr,t)}function BT(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],a=s.getSnapshot;s=s.value;try{if(!Xs(a(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ra(t,e){for(e&=~Sy,e&=~vf,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Qs(e),r=1<<n;t[n]=-1,e&=~r}}function Uw(t){if(Nt&6)throw Error(ge(327));ul();var e=ph(t,0);if(!(e&1))return is(t,En()),null;var n=Rh(t,e);if(t.tag!==0&&n===2){var r=Nm(t);r!==0&&(e=r,n=ng(t,r))}if(n===1)throw n=du,io(t,0),ra(t,e),is(t,En()),n;if(n===6)throw Error(ge(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Qa(t,Zr,Ti),is(t,En()),null}function Ty(t,e){var n=Nt;Nt|=1;try{return t(e)}finally{Nt=n,Nt===0&&(El=En()+500,pf&&Fa())}}function vo(t){ua!==null&&ua.tag===0&&!(Nt&6)&&ul();var e=Nt;Nt|=1;var n=Ps.transition,r=$t;try{if(Ps.transition=null,$t=1,t)return t()}finally{$t=r,Ps.transition=n,Nt=e,!(Nt&6)&&Fa()}}function Iy(){hs=nl.current,en(nl)}function io(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,yT(n)),An!==null)for(n=An.return;n!==null;){var r=n;switch(uy(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&xh();break;case 3:_l(),en(rs),en(Or),xy();break;case 5:vy(r);break;case 4:_l();break;case 13:en(cn);break;case 19:en(cn);break;case 10:py(r.type._context);break;case 22:case 23:Iy()}n=n.return}if(Xn=t,An=t=wa(t.current,null),gr=hs=e,Vn=0,du=null,Sy=vf=yo=0,Zr=Dc=null,Za!==null){for(e=0;e<Za.length;e++)if(n=Za[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,a=n.pending;if(a!==null){var o=a.next;a.next=s,r.next=o}n.pending=r}Za=null}return t}function Ej(t,e){do{var n=An;try{if(fy(),zd.current=Nh,Sh){for(var r=un.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Sh=!1}if(go=0,Qn=Fn=un=null,Rc=!1,lu=0,Cy.current=null,n===null||n.return===null){Vn=1,du=e,An=null;break}e:{var a=t,o=n.return,l=n,c=e;if(e=gr,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,h=l,f=h.tag;if(!(h.mode&1)&&(f===0||f===11||f===15)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var k=Sw(o);if(k!==null){k.flags&=-257,Nw(k,o,l,a,e),k.mode&1&&Cw(a,d,e),e=k,c=d;var S=e.updateQueue;if(S===null){var T=new Set;T.add(c),e.updateQueue=T}else S.add(c);break e}else{if(!(e&1)){Cw(a,d,e),Ay();break e}c=Error(ge(426))}}else if(nn&&l.mode&1){var C=Sw(o);if(C!==null){!(C.flags&65536)&&(C.flags|=256),Nw(C,o,l,a,e),dy(jl(c,l));break e}}a=c=jl(c,l),Vn!==4&&(Vn=2),Dc===null?Dc=[a]:Dc.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,e&=-e,a.lanes|=e;var j=oj(a,c,e);ww(a,j);break e;case 1:l=c;var y=a.type,v=a.stateNode;if(!(a.flags&128)&&(typeof y.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(va===null||!va.has(v)))){a.flags|=65536,e&=-e,a.lanes|=e;var R=lj(a,l,e);ww(a,R);break e}}a=a.return}while(a!==null)}Sj(n)}catch(O){e=O,An===n&&n!==null&&(An=n=n.return);continue}break}while(!0)}function kj(){var t=Th.current;return Th.current=Nh,t===null?Nh:t}function Ay(){(Vn===0||Vn===3||Vn===2)&&(Vn=4),Xn===null||!(yo&268435455)&&!(vf&268435455)||ra(Xn,gr)}function Rh(t,e){var n=Nt;Nt|=2;var r=kj();(Xn!==t||gr!==e)&&(Ti=null,io(t,e));do try{$T();break}catch(s){Ej(t,s)}while(!0);if(fy(),Nt=n,Th.current=r,An!==null)throw Error(ge(261));return Xn=null,gr=0,Vn}function $T(){for(;An!==null;)Cj(An)}function zT(){for(;An!==null&&!pN();)Cj(An)}function Cj(t){var e=Tj(t.alternate,t,hs);t.memoizedProps=t.pendingProps,e===null?Sj(t):An=e,Cy.current=null}function Sj(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=OT(n,e),n!==null){n.flags&=32767,An=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Vn=6,An=null;return}}else if(n=LT(n,e,hs),n!==null){An=n;return}if(e=e.sibling,e!==null){An=e;return}An=e=t}while(e!==null);Vn===0&&(Vn=5)}function Qa(t,e,n){var r=$t,s=Ps.transition;try{Ps.transition=null,$t=1,GT(t,e,n,r)}finally{Ps.transition=s,$t=r}return null}function GT(t,e,n,r){do ul();while(ua!==null);if(Nt&6)throw Error(ge(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(ge(177));t.callbackNode=null,t.callbackPriority=0;var a=n.lanes|n.childLanes;if(EN(t,a),t===Xn&&(An=Xn=null,gr=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||bd||(bd=!0,Ij(fh,function(){return ul(),null})),a=(n.flags&15990)!==0,n.subtreeFlags&15990||a){a=Ps.transition,Ps.transition=null;var o=$t;$t=1;var l=Nt;Nt|=4,Cy.current=null,FT(t,n),bj(n,t),uT(Dm),mh=!!Pm,Dm=Pm=null,t.current=n,VT(n),mN(),Nt=l,$t=o,Ps.transition=a}else t.current=n;if(bd&&(bd=!1,ua=t,Ah=s),a=t.pendingLanes,a===0&&(va=null),vN(n.stateNode),is(t,En()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(Ih)throw Ih=!1,t=eg,eg=null,t;return Ah&1&&t.tag!==0&&ul(),a=t.pendingLanes,a&1?t===tg?Lc++:(Lc=0,tg=t):Lc=0,Fa(),null}function ul(){if(ua!==null){var t=o1(Ah),e=Ps.transition,n=$t;try{if(Ps.transition=null,$t=16>t?16:t,ua===null)var r=!1;else{if(t=ua,ua=null,Ah=0,Nt&6)throw Error(ge(331));var s=Nt;for(Nt|=4,Oe=t.current;Oe!==null;){var a=Oe,o=a.child;if(Oe.flags&16){var l=a.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(Oe=d;Oe!==null;){var h=Oe;switch(h.tag){case 0:case 11:case 15:Pc(8,h,a)}var f=h.child;if(f!==null)f.return=h,Oe=f;else for(;Oe!==null;){h=Oe;var p=h.sibling,k=h.return;if(vj(h),h===d){Oe=null;break}if(p!==null){p.return=k,Oe=p;break}Oe=k}}}var S=a.alternate;if(S!==null){var T=S.child;if(T!==null){S.child=null;do{var C=T.sibling;T.sibling=null,T=C}while(T!==null)}}Oe=a}}if(a.subtreeFlags&2064&&o!==null)o.return=a,Oe=o;else e:for(;Oe!==null;){if(a=Oe,a.flags&2048)switch(a.tag){case 0:case 11:case 15:Pc(9,a,a.return)}var j=a.sibling;if(j!==null){j.return=a.return,Oe=j;break e}Oe=a.return}}var y=t.current;for(Oe=y;Oe!==null;){o=Oe;var v=o.child;if(o.subtreeFlags&2064&&v!==null)v.return=o,Oe=v;else e:for(o=y;Oe!==null;){if(l=Oe,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:yf(9,l)}}catch(O){pn(l,l.return,O)}if(l===o){Oe=null;break e}var R=l.sibling;if(R!==null){R.return=l.return,Oe=R;break e}Oe=l.return}}if(Nt=s,Fa(),pi&&typeof pi.onPostCommitFiberRoot=="function")try{pi.onPostCommitFiberRoot(cf,t)}catch{}r=!0}return r}finally{$t=n,Ps.transition=e}}return!1}function Bw(t,e,n){e=jl(n,e),e=oj(t,e,1),t=ya(t,e,1),e=Hr(),t!==null&&(Au(t,1,e),is(t,e))}function pn(t,e,n){if(t.tag===3)Bw(t,t,n);else for(;e!==null;){if(e.tag===3){Bw(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(va===null||!va.has(r))){t=jl(n,t),t=lj(e,t,1),e=ya(e,t,1),t=Hr(),e!==null&&(Au(e,1,t),is(e,t));break}}e=e.return}}function HT(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Hr(),t.pingedLanes|=t.suspendedLanes&n,Xn===t&&(gr&n)===n&&(Vn===4||Vn===3&&(gr&130023424)===gr&&500>En()-Ny?io(t,0):Sy|=n),is(t,e)}function Nj(t,e){e===0&&(t.mode&1?(e=dd,dd<<=1,!(dd&130023424)&&(dd=4194304)):e=1);var n=Hr();t=Ui(t,e),t!==null&&(Au(t,e,n),is(t,n))}function qT(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Nj(t,n)}function WT(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(ge(314))}r!==null&&r.delete(e),Nj(t,n)}var Tj;Tj=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||rs.current)ts=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return ts=!1,DT(t,e,n);ts=!!(t.flags&131072)}else ts=!1,nn&&e.flags&1048576&&P1(e,_h,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Hd(t,e),t=e.pendingProps;var s=xl(e,Or.current);cl(e,n),s=by(null,e,r,t,s,n);var a=_y();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,ss(r)?(a=!0,wh(e)):a=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,gy(e),s.updater=gf,e.stateNode=s,s._reactInternals=e,zm(e,r,t,n),e=qm(null,e,r,!0,a,n)):(e.tag=0,nn&&a&&cy(e),zr(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Hd(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=QT(r),t=$s(r,t),s){case 0:e=Hm(null,e,r,t,n);break e;case 1:e=Aw(null,e,r,t,n);break e;case 11:e=Tw(null,e,r,t,n);break e;case 14:e=Iw(null,e,r,$s(r.type,t),n);break e}throw Error(ge(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:$s(r,s),Hm(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:$s(r,s),Aw(t,e,r,s,n);case 3:e:{if(hj(e),t===null)throw Error(ge(387));r=e.pendingProps,a=e.memoizedState,s=a.element,V1(t,e),kh(e,r,null,n);var o=e.memoizedState;if(r=o.element,a.isDehydrated)if(a={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=a,e.memoizedState=a,e.flags&256){s=jl(Error(ge(423)),e),e=Rw(t,e,r,n,s);break e}else if(r!==s){s=jl(Error(ge(424)),e),e=Rw(t,e,r,n,s);break e}else for(ms=ga(e.stateNode.containerInfo.firstChild),ys=e,nn=!0,qs=null,n=M1(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(wl(),r===s){e=Bi(t,e,n);break e}zr(t,e,r,n)}e=e.child}return e;case 5:return U1(e),t===null&&Um(e),r=e.type,s=e.pendingProps,a=t!==null?t.memoizedProps:null,o=s.children,Lm(r,s)?o=null:a!==null&&Lm(r,a)&&(e.flags|=32),dj(t,e),zr(t,e,o,n),e.child;case 6:return t===null&&Um(e),null;case 13:return fj(t,e,n);case 4:return yy(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=bl(e,null,r,n):zr(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:$s(r,s),Tw(t,e,r,s,n);case 7:return zr(t,e,e.pendingProps,n),e.child;case 8:return zr(t,e,e.pendingProps.children,n),e.child;case 12:return zr(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,a=e.memoizedProps,o=s.value,Jt(jh,r._currentValue),r._currentValue=o,a!==null)if(Xs(a.value,o)){if(a.children===s.children&&!rs.current){e=Bi(t,e,n);break e}}else for(a=e.child,a!==null&&(a.return=e);a!==null;){var l=a.dependencies;if(l!==null){o=a.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(a.tag===1){c=Li(-1,n&-n),c.tag=2;var d=a.updateQueue;if(d!==null){d=d.shared;var h=d.pending;h===null?c.next=c:(c.next=h.next,h.next=c),d.pending=c}}a.lanes|=n,c=a.alternate,c!==null&&(c.lanes|=n),Bm(a.return,n,e),l.lanes|=n;break}c=c.next}}else if(a.tag===10)o=a.type===e.type?null:a.child;else if(a.tag===18){if(o=a.return,o===null)throw Error(ge(341));o.lanes|=n,l=o.alternate,l!==null&&(l.lanes|=n),Bm(o,n,e),o=a.sibling}else o=a.child;if(o!==null)o.return=a;else for(o=a;o!==null;){if(o===e){o=null;break}if(a=o.sibling,a!==null){a.return=o.return,o=a;break}o=o.return}a=o}zr(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,cl(e,n),s=Ls(s),r=r(s),e.flags|=1,zr(t,e,r,n),e.child;case 14:return r=e.type,s=$s(r,e.pendingProps),s=$s(r.type,s),Iw(t,e,r,s,n);case 15:return cj(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:$s(r,s),Hd(t,e),e.tag=1,ss(r)?(t=!0,wh(e)):t=!1,cl(e,n),aj(e,r,s),zm(e,r,s,n),qm(null,e,r,!0,t,n);case 19:return pj(t,e,n);case 22:return uj(t,e,n)}throw Error(ge(156,e.tag))};function Ij(t,e){return r1(t,e)}function KT(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Rs(t,e,n,r){return new KT(t,e,n,r)}function Ry(t){return t=t.prototype,!(!t||!t.isReactComponent)}function QT(t){if(typeof t=="function")return Ry(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Jg)return 11;if(t===Xg)return 14}return 2}function wa(t,e){var n=t.alternate;return n===null?(n=Rs(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Kd(t,e,n,r,s,a){var o=2;if(r=t,typeof t=="function")Ry(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case qo:return ao(n.children,s,a,e);case Yg:o=8,s|=8;break;case fm:return t=Rs(12,n,e,s|2),t.elementType=fm,t.lanes=a,t;case pm:return t=Rs(13,n,e,s),t.elementType=pm,t.lanes=a,t;case mm:return t=Rs(19,n,e,s),t.elementType=mm,t.lanes=a,t;case U_:return xf(n,s,a,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case F_:o=10;break e;case V_:o=9;break e;case Jg:o=11;break e;case Xg:o=14;break e;case ea:o=16,r=null;break e}throw Error(ge(130,t==null?t:typeof t,""))}return e=Rs(o,n,e,s),e.elementType=t,e.type=r,e.lanes=a,e}function ao(t,e,n,r){return t=Rs(7,t,r,e),t.lanes=n,t}function xf(t,e,n,r){return t=Rs(22,t,r,e),t.elementType=U_,t.lanes=n,t.stateNode={isHidden:!1},t}function Lp(t,e,n){return t=Rs(6,t,null,e),t.lanes=n,t}function Op(t,e,n){return e=Rs(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function YT(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gp(0),this.expirationTimes=gp(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gp(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Py(t,e,n,r,s,a,o,l,c){return t=new YT(t,e,n,l,c),e===1?(e=1,a===!0&&(e|=8)):e=0,a=Rs(3,null,null,e),t.current=a,a.stateNode=t,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},gy(a),t}function JT(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ho,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function Aj(t){if(!t)return Na;t=t._reactInternals;e:{if(So(t)!==t||t.tag!==1)throw Error(ge(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(ss(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ge(171))}if(t.tag===1){var n=t.type;if(ss(n))return A1(t,n,e)}return e}function Rj(t,e,n,r,s,a,o,l,c){return t=Py(n,r,!0,t,s,a,o,l,c),t.context=Aj(null),n=t.current,r=Hr(),s=xa(n),a=Li(r,s),a.callback=e??null,ya(n,a,s),t.current.lanes=s,Au(t,s,r),is(t,r),t}function wf(t,e,n,r){var s=e.current,a=Hr(),o=xa(s);return n=Aj(n),e.context===null?e.context=n:e.pendingContext=n,e=Li(a,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=ya(s,e,o),t!==null&&(Ys(t,s,o,a),$d(t,s,o)),o}function Ph(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function $w(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Dy(t,e){$w(t,e),(t=t.alternate)&&$w(t,e)}function XT(){return null}var Pj=typeof reportError=="function"?reportError:function(t){console.error(t)};function Ly(t){this._internalRoot=t}bf.prototype.render=Ly.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(ge(409));wf(t,e,null,null)};bf.prototype.unmount=Ly.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;vo(function(){wf(null,t,null,null)}),e[Vi]=null}};function bf(t){this._internalRoot=t}bf.prototype.unstable_scheduleHydration=function(t){if(t){var e=u1();t={blockedOn:null,target:t,priority:e};for(var n=0;n<na.length&&e!==0&&e<na[n].priority;n++);na.splice(n,0,t),n===0&&h1(t)}};function Oy(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function _f(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function zw(){}function ZT(t,e,n,r,s){if(s){if(typeof r=="function"){var a=r;r=function(){var d=Ph(o);a.call(d)}}var o=Rj(e,r,t,0,null,!1,!1,"",zw);return t._reactRootContainer=o,t[Vi]=o.current,ru(t.nodeType===8?t.parentNode:t),vo(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var l=r;r=function(){var d=Ph(c);l.call(d)}}var c=Py(t,0,!1,null,null,!1,!1,"",zw);return t._reactRootContainer=c,t[Vi]=c.current,ru(t.nodeType===8?t.parentNode:t),vo(function(){wf(e,c,n,r)}),c}function jf(t,e,n,r,s){var a=n._reactRootContainer;if(a){var o=a;if(typeof s=="function"){var l=s;s=function(){var c=Ph(o);l.call(c)}}wf(e,o,t,s)}else o=ZT(n,e,t,s,r);return Ph(o)}l1=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=gc(e.pendingLanes);n!==0&&(ty(e,n|1),is(e,En()),!(Nt&6)&&(El=En()+500,Fa()))}break;case 13:vo(function(){var r=Ui(t,1);if(r!==null){var s=Hr();Ys(r,t,1,s)}}),Dy(t,1)}};ny=function(t){if(t.tag===13){var e=Ui(t,134217728);if(e!==null){var n=Hr();Ys(e,t,134217728,n)}Dy(t,134217728)}};c1=function(t){if(t.tag===13){var e=xa(t),n=Ui(t,e);if(n!==null){var r=Hr();Ys(n,t,e,r)}Dy(t,e)}};u1=function(){return $t};d1=function(t,e){var n=$t;try{return $t=t,e()}finally{$t=n}};km=function(t,e,n){switch(e){case"input":if(vm(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=ff(r);if(!s)throw Error(ge(90));$_(r),vm(r,s)}}}break;case"textarea":G_(t,n);break;case"select":e=n.value,e!=null&&il(t,!!n.multiple,e,!1)}};J_=Ty;X_=vo;var eI={usingClientEntryPoint:!1,Events:[Pu,Yo,ff,Q_,Y_,Ty]},uc={findFiberByHostInstance:Xa,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},tI={bundleType:uc.bundleType,version:uc.version,rendererPackageName:uc.rendererPackageName,rendererConfig:uc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ki.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=t1(t),t===null?null:t.stateNode},findFiberByHostInstance:uc.findFiberByHostInstance||XT,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var _d=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!_d.isDisabled&&_d.supportsFiber)try{cf=_d.inject(tI),pi=_d}catch{}}_s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eI;_s.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Oy(e))throw Error(ge(200));return JT(t,e,null,n)};_s.createRoot=function(t,e){if(!Oy(t))throw Error(ge(299));var n=!1,r="",s=Pj;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=Py(t,1,!1,null,null,n,!1,r,s),t[Vi]=e.current,ru(t.nodeType===8?t.parentNode:t),new Ly(e)};_s.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(ge(188)):(t=Object.keys(t).join(","),Error(ge(268,t)));return t=t1(e),t=t===null?null:t.stateNode,t};_s.flushSync=function(t){return vo(t)};_s.hydrate=function(t,e,n){if(!_f(e))throw Error(ge(200));return jf(null,t,e,!0,n)};_s.hydrateRoot=function(t,e,n){if(!Oy(t))throw Error(ge(405));var r=n!=null&&n.hydratedSources||null,s=!1,a="",o=Pj;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(a=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=Rj(e,null,t,1,n??null,s,!1,a,o),t[Vi]=e.current,ru(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new bf(e)};_s.render=function(t,e,n){if(!_f(e))throw Error(ge(200));return jf(null,t,e,!1,n)};_s.unmountComponentAtNode=function(t){if(!_f(t))throw Error(ge(40));return t._reactRootContainer?(vo(function(){jf(null,null,t,!1,function(){t._reactRootContainer=null,t[Vi]=null})}),!0):!1};_s.unstable_batchedUpdates=Ty;_s.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!_f(n))throw Error(ge(200));if(t==null||t._reactInternals===void 0)throw Error(ge(38));return jf(t,e,n,!1,r)};_s.version="18.3.1-next-f1338f8080-20240426";function Dj(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Dj)}catch(t){console.error(t)}}Dj(),D_.exports=_s;var nI=D_.exports,Gw=nI;dm.createRoot=Gw.createRoot,dm.hydrateRoot=Gw.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function hu(){return hu=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},hu.apply(this,arguments)}var da;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(da||(da={}));const Hw="popstate";function rI(t){t===void 0&&(t={});function e(r,s){let{pathname:a,search:o,hash:l}=r.location;return sg("",{pathname:a,search:o,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function n(r,s){return typeof s=="string"?s:Dh(s)}return iI(e,n,null,t)}function kn(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Lj(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function sI(){return Math.random().toString(36).substr(2,8)}function qw(t,e){return{usr:t.state,key:t.key,idx:e}}function sg(t,e,n,r){return n===void 0&&(n=null),hu({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?Bl(e):e,{state:n,key:e&&e.key||r||sI()})}function Dh(t){let{pathname:e="/",search:n="",hash:r=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Bl(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function iI(t,e,n,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:a=!1}=r,o=s.history,l=da.Pop,c=null,d=h();d==null&&(d=0,o.replaceState(hu({},o.state,{idx:d}),""));function h(){return(o.state||{idx:null}).idx}function f(){l=da.Pop;let C=h(),j=C==null?null:C-d;d=C,c&&c({action:l,location:T.location,delta:j})}function p(C,j){l=da.Push;let y=sg(T.location,C,j);d=h()+1;let v=qw(y,d),R=T.createHref(y);try{o.pushState(v,"",R)}catch(O){if(O instanceof DOMException&&O.name==="DataCloneError")throw O;s.location.assign(R)}a&&c&&c({action:l,location:T.location,delta:1})}function k(C,j){l=da.Replace;let y=sg(T.location,C,j);d=h();let v=qw(y,d),R=T.createHref(y);o.replaceState(v,"",R),a&&c&&c({action:l,location:T.location,delta:0})}function S(C){let j=s.location.origin!=="null"?s.location.origin:s.location.href,y=typeof C=="string"?C:Dh(C);return y=y.replace(/ $/,"%20"),kn(j,"No window.location.(origin|href) available to create URL for href: "+y),new URL(y,j)}let T={get action(){return l},get location(){return t(s,o)},listen(C){if(c)throw new Error("A history only accepts one active listener");return s.addEventListener(Hw,f),c=C,()=>{s.removeEventListener(Hw,f),c=null}},createHref(C){return e(s,C)},createURL:S,encodeLocation(C){let j=S(C);return{pathname:j.pathname,search:j.search,hash:j.hash}},push:p,replace:k,go(C){return o.go(C)}};return T}var Ww;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(Ww||(Ww={}));function aI(t,e,n){return n===void 0&&(n="/"),oI(t,e,n)}function oI(t,e,n,r){let s=typeof e=="string"?Bl(e):e,a=My(s.pathname||"/",n);if(a==null)return null;let o=Oj(t);lI(o);let l=null;for(let c=0;l==null&&c<o.length;++c){let d=wI(a);l=yI(o[c],d)}return l}function Oj(t,e,n,r){e===void 0&&(e=[]),n===void 0&&(n=[]),r===void 0&&(r="");let s=(a,o,l)=>{let c={relativePath:l===void 0?a.path||"":l,caseSensitive:a.caseSensitive===!0,childrenIndex:o,route:a};c.relativePath.startsWith("/")&&(kn(c.relativePath.startsWith(r),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(r.length));let d=ba([r,c.relativePath]),h=n.concat(c);a.children&&a.children.length>0&&(kn(a.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),Oj(a.children,e,h,d)),!(a.path==null&&!a.index)&&e.push({path:d,score:mI(d,a.index),routesMeta:h})};return t.forEach((a,o)=>{var l;if(a.path===""||!((l=a.path)!=null&&l.includes("?")))s(a,o);else for(let c of Mj(a.path))s(a,o,c)}),e}function Mj(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),a=n.replace(/\?$/,"");if(r.length===0)return s?[a,""]:[a];let o=Mj(r.join("/")),l=[];return l.push(...o.map(c=>c===""?a:[a,c].join("/"))),s&&l.push(...o),l.map(c=>t.startsWith("/")&&c===""?"/":c)}function lI(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:gI(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const cI=/^:[\w-]+$/,uI=3,dI=2,hI=1,fI=10,pI=-2,Kw=t=>t==="*";function mI(t,e){let n=t.split("/"),r=n.length;return n.some(Kw)&&(r+=pI),e&&(r+=dI),n.filter(s=>!Kw(s)).reduce((s,a)=>s+(cI.test(a)?uI:a===""?hI:fI),r)}function gI(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function yI(t,e,n){let{routesMeta:r}=t,s={},a="/",o=[];for(let l=0;l<r.length;++l){let c=r[l],d=l===r.length-1,h=a==="/"?e:e.slice(a.length)||"/",f=vI({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},h),p=c.route;if(!f)return null;Object.assign(s,f.params),o.push({params:s,pathname:ba([a,f.pathname]),pathnameBase:EI(ba([a,f.pathnameBase])),route:p}),f.pathnameBase!=="/"&&(a=ba([a,f.pathnameBase]))}return o}function vI(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=xI(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let a=s[0],o=a.replace(/(.)\/+$/,"$1"),l=s.slice(1);return{params:r.reduce((d,h,f)=>{let{paramName:p,isOptional:k}=h;if(p==="*"){let T=l[f]||"";o=a.slice(0,a.length-T.length).replace(/(.)\/+$/,"$1")}const S=l[f];return k&&!S?d[p]=void 0:d[p]=(S||"").replace(/%2F/g,"/"),d},{}),pathname:a,pathnameBase:o,pattern:t}}function xI(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),Lj(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,c)=>(r.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function wI(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Lj(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function My(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function bI(t,e){e===void 0&&(e="/");let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?Bl(t):t;return{pathname:n?n.startsWith("/")?n:_I(n,e):e,search:kI(r),hash:CI(s)}}function _I(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function Mp(t,e,n,r){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function jI(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function Fy(t,e){let n=jI(t);return e?n.map((r,s)=>s===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function Vy(t,e,n,r){r===void 0&&(r=!1);let s;typeof t=="string"?s=Bl(t):(s=hu({},t),kn(!s.pathname||!s.pathname.includes("?"),Mp("?","pathname","search",s)),kn(!s.pathname||!s.pathname.includes("#"),Mp("#","pathname","hash",s)),kn(!s.search||!s.search.includes("#"),Mp("#","search","hash",s)));let a=t===""||s.pathname==="",o=a?"/":s.pathname,l;if(o==null)l=n;else{let f=e.length-1;if(!r&&o.startsWith("..")){let p=o.split("/");for(;p[0]==="..";)p.shift(),f-=1;s.pathname=p.join("/")}l=f>=0?e[f]:"/"}let c=bI(s,l),d=o&&o!=="/"&&o.endsWith("/"),h=(a||o===".")&&n.endsWith("/");return!c.pathname.endsWith("/")&&(d||h)&&(c.pathname+="/"),c}const ba=t=>t.join("/").replace(/\/\/+/g,"/"),EI=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),kI=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,CI=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function SI(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const Fj=["post","put","patch","delete"];new Set(Fj);const NI=["get",...Fj];new Set(NI);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function fu(){return fu=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},fu.apply(this,arguments)}const Uy=m.createContext(null),TI=m.createContext(null),Va=m.createContext(null),Ef=m.createContext(null),Qi=m.createContext({outlet:null,matches:[],isDataRoute:!1}),Vj=m.createContext(null);function II(t,e){let{relative:n}=e===void 0?{}:e;$l()||kn(!1);let{basename:r,navigator:s}=m.useContext(Va),{hash:a,pathname:o,search:l}=Bj(t,{relative:n}),c=o;return r!=="/"&&(c=o==="/"?r:ba([r,o])),s.createHref({pathname:c,search:l,hash:a})}function $l(){return m.useContext(Ef)!=null}function Es(){return $l()||kn(!1),m.useContext(Ef).location}function Uj(t){m.useContext(Va).static||m.useLayoutEffect(t)}function ti(){let{isDataRoute:t}=m.useContext(Qi);return t?zI():AI()}function AI(){$l()||kn(!1);let t=m.useContext(Uy),{basename:e,future:n,navigator:r}=m.useContext(Va),{matches:s}=m.useContext(Qi),{pathname:a}=Es(),o=JSON.stringify(Fy(s,n.v7_relativeSplatPath)),l=m.useRef(!1);return Uj(()=>{l.current=!0}),m.useCallback(function(d,h){if(h===void 0&&(h={}),!l.current)return;if(typeof d=="number"){r.go(d);return}let f=Vy(d,JSON.parse(o),a,h.relative==="path");t==null&&e!=="/"&&(f.pathname=f.pathname==="/"?e:ba([e,f.pathname])),(h.replace?r.replace:r.push)(f,h.state,h)},[e,r,o,a,t])}function By(){let{matches:t}=m.useContext(Qi),e=t[t.length-1];return e?e.params:{}}function Bj(t,e){let{relative:n}=e===void 0?{}:e,{future:r}=m.useContext(Va),{matches:s}=m.useContext(Qi),{pathname:a}=Es(),o=JSON.stringify(Fy(s,r.v7_relativeSplatPath));return m.useMemo(()=>Vy(t,JSON.parse(o),a,n==="path"),[t,o,a,n])}function RI(t,e){return PI(t,e)}function PI(t,e,n,r){$l()||kn(!1);let{navigator:s}=m.useContext(Va),{matches:a}=m.useContext(Qi),o=a[a.length-1],l=o?o.params:{};o&&o.pathname;let c=o?o.pathnameBase:"/";o&&o.route;let d=Es(),h;if(e){var f;let C=typeof e=="string"?Bl(e):e;c==="/"||(f=C.pathname)!=null&&f.startsWith(c)||kn(!1),h=C}else h=d;let p=h.pathname||"/",k=p;if(c!=="/"){let C=c.replace(/^\//,"").split("/");k="/"+p.replace(/^\//,"").split("/").slice(C.length).join("/")}let S=aI(t,{pathname:k}),T=FI(S&&S.map(C=>Object.assign({},C,{params:Object.assign({},l,C.params),pathname:ba([c,s.encodeLocation?s.encodeLocation(C.pathname).pathname:C.pathname]),pathnameBase:C.pathnameBase==="/"?c:ba([c,s.encodeLocation?s.encodeLocation(C.pathnameBase).pathname:C.pathnameBase])})),a,n,r);return e&&T?m.createElement(Ef.Provider,{value:{location:fu({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:da.Pop}},T):T}function DI(){let t=$I(),e=SI(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return m.createElement(m.Fragment,null,m.createElement("h2",null,"Unexpected Application Error!"),m.createElement("h3",{style:{fontStyle:"italic"}},e),n?m.createElement("pre",{style:s},n):null,null)}const LI=m.createElement(DI,null);class OI extends m.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?m.createElement(Qi.Provider,{value:this.props.routeContext},m.createElement(Vj.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function MI(t){let{routeContext:e,match:n,children:r}=t,s=m.useContext(Uy);return s&&s.static&&s.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=n.route.id),m.createElement(Qi.Provider,{value:e},r)}function FI(t,e,n,r){var s;if(e===void 0&&(e=[]),n===void 0&&(n=null),r===void 0&&(r=null),t==null){var a;if(!n)return null;if(n.errors)t=n.matches;else if((a=r)!=null&&a.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,l=(s=n)==null?void 0:s.errors;if(l!=null){let h=o.findIndex(f=>f.route.id&&(l==null?void 0:l[f.route.id])!==void 0);h>=0||kn(!1),o=o.slice(0,Math.min(o.length,h+1))}let c=!1,d=-1;if(n&&r&&r.v7_partialHydration)for(let h=0;h<o.length;h++){let f=o[h];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(d=h),f.route.id){let{loaderData:p,errors:k}=n,S=f.route.loader&&p[f.route.id]===void 0&&(!k||k[f.route.id]===void 0);if(f.route.lazy||S){c=!0,d>=0?o=o.slice(0,d+1):o=[o[0]];break}}}return o.reduceRight((h,f,p)=>{let k,S=!1,T=null,C=null;n&&(k=l&&f.route.id?l[f.route.id]:void 0,T=f.route.errorElement||LI,c&&(d<0&&p===0?(GI("route-fallback"),S=!0,C=null):d===p&&(S=!0,C=f.route.hydrateFallbackElement||null)));let j=e.concat(o.slice(0,p+1)),y=()=>{let v;return k?v=T:S?v=C:f.route.Component?v=m.createElement(f.route.Component,null):f.route.element?v=f.route.element:v=h,m.createElement(MI,{match:f,routeContext:{outlet:h,matches:j,isDataRoute:n!=null},children:v})};return n&&(f.route.ErrorBoundary||f.route.errorElement||p===0)?m.createElement(OI,{location:n.location,revalidation:n.revalidation,component:T,error:k,children:y(),routeContext:{outlet:null,matches:j,isDataRoute:!0}}):y()},null)}var $j=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}($j||{}),zj=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(zj||{});function VI(t){let e=m.useContext(Uy);return e||kn(!1),e}function UI(t){let e=m.useContext(TI);return e||kn(!1),e}function BI(t){let e=m.useContext(Qi);return e||kn(!1),e}function Gj(t){let e=BI(),n=e.matches[e.matches.length-1];return n.route.id||kn(!1),n.route.id}function $I(){var t;let e=m.useContext(Vj),n=UI(),r=Gj();return e!==void 0?e:(t=n.errors)==null?void 0:t[r]}function zI(){let{router:t}=VI($j.UseNavigateStable),e=Gj(zj.UseNavigateStable),n=m.useRef(!1);return Uj(()=>{n.current=!0}),m.useCallback(function(s,a){a===void 0&&(a={}),n.current&&(typeof s=="number"?t.navigate(s):t.navigate(s,fu({fromRouteId:e},a)))},[t,e])}const Qw={};function GI(t,e,n){Qw[t]||(Qw[t]=!0)}function HI(t,e){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function ut(t){let{to:e,replace:n,state:r,relative:s}=t;$l()||kn(!1);let{future:a,static:o}=m.useContext(Va),{matches:l}=m.useContext(Qi),{pathname:c}=Es(),d=ti(),h=Vy(e,Fy(l,a.v7_relativeSplatPath),c,s==="path"),f=JSON.stringify(h);return m.useEffect(()=>d(JSON.parse(f),{replace:n,state:r,relative:s}),[d,f,s,n,r]),null}function dt(t){kn(!1)}function qI(t){let{basename:e="/",children:n=null,location:r,navigationType:s=da.Pop,navigator:a,static:o=!1,future:l}=t;$l()&&kn(!1);let c=e.replace(/^\/*/,"/"),d=m.useMemo(()=>({basename:c,navigator:a,static:o,future:fu({v7_relativeSplatPath:!1},l)}),[c,l,a,o]);typeof r=="string"&&(r=Bl(r));let{pathname:h="/",search:f="",hash:p="",state:k=null,key:S="default"}=r,T=m.useMemo(()=>{let C=My(h,c);return C==null?null:{location:{pathname:C,search:f,hash:p,state:k,key:S},navigationType:s}},[c,h,f,p,k,S,s]);return T==null?null:m.createElement(Va.Provider,{value:d},m.createElement(Ef.Provider,{children:n,value:T}))}function WI(t){let{children:e,location:n}=t;return RI(ig(e),n)}new Promise(()=>{});function ig(t,e){e===void 0&&(e=[]);let n=[];return m.Children.forEach(t,(r,s)=>{if(!m.isValidElement(r))return;let a=[...e,s];if(r.type===m.Fragment){n.push.apply(n,ig(r.props.children,a));return}r.type!==dt&&kn(!1),!r.props.index||!r.props.children||kn(!1);let o={id:r.props.id||a.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=ig(r.props.children,a)),n.push(o)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ag(){return ag=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},ag.apply(this,arguments)}function KI(t,e){if(t==null)return{};var n={},r=Object.keys(t),s,a;for(a=0;a<r.length;a++)s=r[a],!(e.indexOf(s)>=0)&&(n[s]=t[s]);return n}function QI(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function YI(t,e){return t.button===0&&(!e||e==="_self")&&!QI(t)}const JI=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],XI="6";try{window.__reactRouterVersion=XI}catch{}const ZI="startTransition",Yw=HS[ZI];function eA(t){let{basename:e,children:n,future:r,window:s}=t,a=m.useRef();a.current==null&&(a.current=rI({window:s,v5Compat:!0}));let o=a.current,[l,c]=m.useState({action:o.action,location:o.location}),{v7_startTransition:d}=r||{},h=m.useCallback(f=>{d&&Yw?Yw(()=>c(f)):c(f)},[c,d]);return m.useLayoutEffect(()=>o.listen(h),[o,h]),m.useEffect(()=>HI(r),[r]),m.createElement(qI,{basename:e,children:n,location:l.location,navigationType:l.action,navigator:o,future:r})}const tA=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",nA=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,$n=m.forwardRef(function(e,n){let{onClick:r,relative:s,reloadDocument:a,replace:o,state:l,target:c,to:d,preventScrollReset:h,viewTransition:f}=e,p=KI(e,JI),{basename:k}=m.useContext(Va),S,T=!1;if(typeof d=="string"&&nA.test(d)&&(S=d,tA))try{let v=new URL(window.location.href),R=d.startsWith("//")?new URL(v.protocol+d):new URL(d),O=My(R.pathname,k);R.origin===v.origin&&O!=null?d=O+R.search+R.hash:T=!0}catch{}let C=II(d,{relative:s}),j=rA(d,{replace:o,state:l,target:c,preventScrollReset:h,relative:s,viewTransition:f});function y(v){r&&r(v),v.defaultPrevented||j(v)}return m.createElement("a",ag({},p,{href:S||C,onClick:T||a?r:y,ref:n,target:c}))});var Jw;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(Jw||(Jw={}));var Xw;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(Xw||(Xw={}));function rA(t,e){let{target:n,replace:r,state:s,preventScrollReset:a,relative:o,viewTransition:l}=e===void 0?{}:e,c=ti(),d=Es(),h=Bj(t,{relative:o});return m.useCallback(f=>{if(YI(f,n)){f.preventDefault();let p=r!==void 0?r:Dh(d)===Dh(h);c(t,{replace:p,state:s,preventScrollReset:a,relative:o,viewTransition:l})}},[d,c,h,r,s,n,t,a,o,l])}const sA=()=>{};var Zw={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hj=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},iA=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const a=t[n++];e[r++]=String.fromCharCode((s&31)<<6|a&63)}else if(s>239&&s<365){const a=t[n++],o=t[n++],l=t[n++],c=((s&7)<<18|(a&63)<<12|(o&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const a=t[n++],o=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(a&63)<<6|o&63)}}return e.join("")},qj={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const a=t[s],o=s+1<t.length,l=o?t[s+1]:0,c=s+2<t.length,d=c?t[s+2]:0,h=a>>2,f=(a&3)<<4|l>>4;let p=(l&15)<<2|d>>6,k=d&63;c||(k=64,o||(p=64)),r.push(n[h],n[f],n[p],n[k])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Hj(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):iA(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const a=n[t.charAt(s++)],l=s<t.length?n[t.charAt(s)]:0;++s;const d=s<t.length?n[t.charAt(s)]:64;++s;const f=s<t.length?n[t.charAt(s)]:64;if(++s,a==null||l==null||d==null||f==null)throw new aA;const p=a<<2|l>>4;if(r.push(p),d!==64){const k=l<<4&240|d>>2;if(r.push(k),f!==64){const S=d<<6&192|f;r.push(S)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class aA extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const oA=function(t){const e=Hj(t);return qj.encodeByteArray(e,!0)},Lh=function(t){return oA(t).replace(/\./g,"")},Wj=function(t){try{return qj.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lA(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cA=()=>lA().__FIREBASE_DEFAULTS__,uA=()=>{if(typeof process>"u"||typeof Zw>"u")return;const t=Zw.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},dA=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Wj(t[1]);return e&&JSON.parse(e)},kf=()=>{try{return sA()||cA()||uA()||dA()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},Kj=t=>{var e,n;return(n=(e=kf())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},$y=t=>{const e=Kj(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},Qj=()=>{var t;return(t=kf())===null||t===void 0?void 0:t.config},Yj=t=>{var e;return(e=kf())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hA{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ua(t){return t.endsWith(".cloudworkstations.dev")}async function Cf(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jj(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,a=t.sub||t.user_id;if(!a)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:a,user_id:a,firebase:{sign_in_provider:"custom",identities:{}}},t);return[Lh(JSON.stringify(n)),Lh(JSON.stringify(o)),""].join(".")}const Oc={};function fA(){const t={prod:[],emulator:[]};for(const e of Object.keys(Oc))Oc[e]?t.emulator.push(e):t.prod.push(e);return t}function pA(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let eb=!1;function Ba(t,e){if(typeof window>"u"||typeof document>"u"||!Ua(window.location.host)||Oc[t]===e||Oc[t]||eb)return;Oc[t]=e;function n(p){return`__firebase__banner__${p}`}const r="__firebase__banner",a=fA().prod.length>0;function o(){const p=document.getElementById(r);p&&p.remove()}function l(p){p.style.display="flex",p.style.background="#7faaf0",p.style.position="fixed",p.style.bottom="5px",p.style.left="5px",p.style.padding=".5em",p.style.borderRadius="5px",p.style.alignItems="center"}function c(p,k){p.setAttribute("width","24"),p.setAttribute("id",k),p.setAttribute("height","24"),p.setAttribute("viewBox","0 0 24 24"),p.setAttribute("fill","none"),p.style.marginLeft="-6px"}function d(){const p=document.createElement("span");return p.style.cursor="pointer",p.style.marginLeft="16px",p.style.fontSize="24px",p.innerHTML=" &times;",p.onclick=()=>{eb=!0,o()},p}function h(p,k){p.setAttribute("id",k),p.innerText="Learn more",p.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",p.setAttribute("target","__blank"),p.style.paddingLeft="5px",p.style.textDecoration="underline"}function f(){const p=pA(r),k=n("text"),S=document.getElementById(k)||document.createElement("span"),T=n("learnmore"),C=document.getElementById(T)||document.createElement("a"),j=n("preprendIcon"),y=document.getElementById(j)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(p.created){const v=p.element;l(v),h(C,T);const R=d();c(y,j),v.append(y,S,C,R),document.body.appendChild(v)}a?(S.innerText="Preview backend disconnected.",y.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(y.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,S.innerText="Preview backend running in this workspace."),S.setAttribute("id",k)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",f):f()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mr(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function mA(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Mr())}function gA(){var t;const e=(t=kf())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function yA(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function vA(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function xA(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function wA(){const t=Mr();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function bA(){return!gA()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Xj(){try{return typeof indexedDB=="object"}catch{return!1}}function Zj(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var a;e(((a=s.error)===null||a===void 0?void 0:a.message)||"")}}catch(n){e(n)}})}function _A(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jA="FirebaseError";class Fs extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=jA,Object.setPrototypeOf(this,Fs.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,No.prototype.create)}}class No{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,a=this.errors[e],o=a?EA(a,r):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new Fs(s,l,r)}}function EA(t,e){return t.replace(kA,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const kA=/\{\$([^}]+)}/g;function CA(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Ta(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const a=t[s],o=e[s];if(tb(a)&&tb(o)){if(!Ta(a,o))return!1}else if(a!==o)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function tb(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zl(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function vc(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,a]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(a)}}),e}function xc(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function SA(t,e){const n=new NA(t,e);return n.subscribe.bind(n)}class NA{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");TA(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=Fp),s.error===void 0&&(s.error=Fp),s.complete===void 0&&(s.complete=Fp);const a=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),a}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function TA(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Fp(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ct(t){return t&&t._delegate?t._delegate:t}class ws{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ya="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IA{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new hA;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(a){if(s)return null;throw a}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(RA(e))try{this.getOrInitializeService({instanceIdentifier:Ya})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const a=this.getOrInitializeService({instanceIdentifier:s});r.resolve(a)}catch{}}}}clearInstance(e=Ya){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ya){return this.instances.has(e)}getOptions(e=Ya){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[a,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(a);r===l&&o.resolve(s)}return s}onInit(e,n){var r;const s=this.normalizeInstanceIdentifier(n),a=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;a.add(e),this.onInitCallbacks.set(s,a);const o=this.instances.get(s);return o&&e(o,s),()=>{a.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:AA(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Ya){return this.component?this.component.multipleInstances?e:Ya:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function AA(t){return t===Ya?void 0:t}function RA(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PA{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new IA(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var yt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(yt||(yt={}));const DA={debug:yt.DEBUG,verbose:yt.VERBOSE,info:yt.INFO,warn:yt.WARN,error:yt.ERROR,silent:yt.SILENT},LA=yt.INFO,OA={[yt.DEBUG]:"log",[yt.VERBOSE]:"log",[yt.INFO]:"info",[yt.WARN]:"warn",[yt.ERROR]:"error"},MA=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=OA[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class zy{constructor(e){this.name=e,this._logLevel=LA,this._logHandler=MA,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in yt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?DA[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,yt.DEBUG,...e),this._logHandler(this,yt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,yt.VERBOSE,...e),this._logHandler(this,yt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,yt.INFO,...e),this._logHandler(this,yt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,yt.WARN,...e),this._logHandler(this,yt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,yt.ERROR,...e),this._logHandler(this,yt.ERROR,...e)}}const FA=(t,e)=>e.some(n=>t instanceof n);let nb,rb;function VA(){return nb||(nb=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function UA(){return rb||(rb=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const eE=new WeakMap,og=new WeakMap,tE=new WeakMap,Vp=new WeakMap,Gy=new WeakMap;function BA(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",a),t.removeEventListener("error",o)},a=()=>{n(Oi(t.result)),s()},o=()=>{r(t.error),s()};t.addEventListener("success",a),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&eE.set(n,t)}).catch(()=>{}),Gy.set(e,t),e}function $A(t){if(og.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",a),t.removeEventListener("error",o),t.removeEventListener("abort",o)},a=()=>{n(),s()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",a),t.addEventListener("error",o),t.addEventListener("abort",o)});og.set(t,e)}let lg={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return og.get(t);if(e==="objectStoreNames")return t.objectStoreNames||tE.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Oi(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function zA(t){lg=t(lg)}function GA(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Up(this),e,...n);return tE.set(r,e.sort?e.sort():[e]),Oi(r)}:UA().includes(t)?function(...e){return t.apply(Up(this),e),Oi(eE.get(this))}:function(...e){return Oi(t.apply(Up(this),e))}}function HA(t){return typeof t=="function"?GA(t):(t instanceof IDBTransaction&&$A(t),FA(t,VA())?new Proxy(t,lg):t)}function Oi(t){if(t instanceof IDBRequest)return BA(t);if(Vp.has(t))return Vp.get(t);const e=HA(t);return e!==t&&(Vp.set(t,e),Gy.set(e,t)),e}const Up=t=>Gy.get(t);function Sf(t,e,{blocked:n,upgrade:r,blocking:s,terminated:a}={}){const o=indexedDB.open(t,e),l=Oi(o);return r&&o.addEventListener("upgradeneeded",c=>{r(Oi(o.result),c.oldVersion,c.newVersion,Oi(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),l.then(c=>{a&&c.addEventListener("close",()=>a()),s&&c.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}function Bp(t,{blocked:e}={}){const n=indexedDB.deleteDatabase(t);return e&&n.addEventListener("blocked",r=>e(r.oldVersion,r)),Oi(n).then(()=>{})}const qA=["get","getKey","getAll","getAllKeys","count"],WA=["put","add","delete","clear"],$p=new Map;function sb(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if($p.get(e))return $p.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=WA.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||qA.includes(n)))return;const a=async function(o,...l){const c=this.transaction(o,s?"readwrite":"readonly");let d=c.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[n](...l),s&&c.done]))[0]};return $p.set(e,a),a}zA(t=>({...t,get:(e,n,r)=>sb(e,n)||t.get(e,n,r),has:(e,n)=>!!sb(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KA{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(QA(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function QA(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const cg="@firebase/app",ib="0.12.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $i=new zy("@firebase/app"),YA="@firebase/app-compat",JA="@firebase/analytics-compat",XA="@firebase/analytics",ZA="@firebase/app-check-compat",e2="@firebase/app-check",t2="@firebase/auth",n2="@firebase/auth-compat",r2="@firebase/database",s2="@firebase/data-connect",i2="@firebase/database-compat",a2="@firebase/functions",o2="@firebase/functions-compat",l2="@firebase/installations",c2="@firebase/installations-compat",u2="@firebase/messaging",d2="@firebase/messaging-compat",h2="@firebase/performance",f2="@firebase/performance-compat",p2="@firebase/remote-config",m2="@firebase/remote-config-compat",g2="@firebase/storage",y2="@firebase/storage-compat",v2="@firebase/firestore",x2="@firebase/vertexai",w2="@firebase/firestore-compat",b2="firebase",_2="11.7.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ug="[DEFAULT]",j2={[cg]:"fire-core",[YA]:"fire-core-compat",[XA]:"fire-analytics",[JA]:"fire-analytics-compat",[e2]:"fire-app-check",[ZA]:"fire-app-check-compat",[t2]:"fire-auth",[n2]:"fire-auth-compat",[r2]:"fire-rtdb",[s2]:"fire-data-connect",[i2]:"fire-rtdb-compat",[a2]:"fire-fn",[o2]:"fire-fn-compat",[l2]:"fire-iid",[c2]:"fire-iid-compat",[u2]:"fire-fcm",[d2]:"fire-fcm-compat",[h2]:"fire-perf",[f2]:"fire-perf-compat",[p2]:"fire-rc",[m2]:"fire-rc-compat",[g2]:"fire-gcs",[y2]:"fire-gcs-compat",[v2]:"fire-fst",[w2]:"fire-fst-compat",[x2]:"fire-vertex","fire-js":"fire-js",[b2]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oh=new Map,E2=new Map,dg=new Map;function ab(t,e){try{t.container.addComponent(e)}catch(n){$i.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Ms(t){const e=t.name;if(dg.has(e))return $i.debug(`There were multiple attempts to register component ${e}.`),!1;dg.set(e,t);for(const n of Oh.values())ab(n,t);for(const n of E2.values())ab(n,t);return!0}function $a(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function Ir(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k2={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},_a=new No("app","Firebase",k2);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C2{constructor(e,n,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new ws("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw _a.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const To=_2;function nE(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r=Object.assign({name:ug,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw _a.create("bad-app-name",{appName:String(s)});if(n||(n=Qj()),!n)throw _a.create("no-options");const a=Oh.get(s);if(a){if(Ta(n,a.options)&&Ta(r,a.config))return a;throw _a.create("duplicate-app",{appName:s})}const o=new PA(s);for(const c of dg.values())o.addComponent(c);const l=new C2(n,r,o);return Oh.set(s,l),l}function Lu(t=ug){const e=Oh.get(t);if(!e&&t===ug&&Qj())return nE();if(!e)throw _a.create("no-app",{appName:t});return e}function Rr(t,e,n){var r;let s=(r=j2[t])!==null&&r!==void 0?r:t;n&&(s+=`-${n}`);const a=s.match(/\s|\//),o=e.match(/\s|\//);if(a||o){const l=[`Unable to register library "${s}" with version "${e}":`];a&&l.push(`library name "${s}" contains illegal characters (whitespace or "/")`),a&&o&&l.push("and"),o&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),$i.warn(l.join(" "));return}Ms(new ws(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S2="firebase-heartbeat-database",N2=1,pu="firebase-heartbeat-store";let zp=null;function rE(){return zp||(zp=Sf(S2,N2,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(pu)}catch(n){console.warn(n)}}}}).catch(t=>{throw _a.create("idb-open",{originalErrorMessage:t.message})})),zp}async function T2(t){try{const n=(await rE()).transaction(pu),r=await n.objectStore(pu).get(sE(t));return await n.done,r}catch(e){if(e instanceof Fs)$i.warn(e.message);else{const n=_a.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});$i.warn(n.message)}}}async function ob(t,e){try{const r=(await rE()).transaction(pu,"readwrite");await r.objectStore(pu).put(e,sE(t)),await r.done}catch(n){if(n instanceof Fs)$i.warn(n.message);else{const r=_a.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});$i.warn(r.message)}}}function sE(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I2=1024,A2=30;class R2{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new D2(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),a=lb();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===a||this._heartbeatsCache.heartbeats.some(o=>o.date===a))return;if(this._heartbeatsCache.heartbeats.push({date:a,agent:s}),this._heartbeatsCache.heartbeats.length>A2){const o=L2(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){$i.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=lb(),{heartbeatsToSend:r,unsentEntries:s}=P2(this._heartbeatsCache.heartbeats),a=Lh(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(n){return $i.warn(n),""}}}function lb(){return new Date().toISOString().substring(0,10)}function P2(t,e=I2){const n=[];let r=t.slice();for(const s of t){const a=n.find(o=>o.agent===s.agent);if(a){if(a.dates.push(s.date),cb(n)>e){a.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),cb(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class D2{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Xj()?Zj().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await T2(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return ob(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return ob(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function cb(t){return Lh(JSON.stringify({version:2,heartbeats:t})).length}function L2(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O2(t){Ms(new ws("platform-logger",e=>new KA(e),"PRIVATE")),Ms(new ws("heartbeat",e=>new R2(e),"PRIVATE")),Rr(cg,ib,t),Rr(cg,ib,"esm2017"),Rr("fire-js","")}O2("");function Hy(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n}function iE(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const M2=iE,aE=new No("auth","Firebase",iE());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mh=new zy("@firebase/auth");function F2(t,...e){Mh.logLevel<=yt.WARN&&Mh.warn(`Auth (${To}): ${t}`,...e)}function Qd(t,...e){Mh.logLevel<=yt.ERROR&&Mh.error(`Auth (${To}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bs(t,...e){throw qy(t,...e)}function vs(t,...e){return qy(t,...e)}function oE(t,e,n){const r=Object.assign(Object.assign({},M2()),{[e]:n});return new No("auth","Firebase",r).create(e,{appName:t.name})}function Js(t){return oE(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function qy(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return aE.create(t,...e)}function Te(t,e,...n){if(!t)throw qy(e,...n)}function hi(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Qd(e),new Error(e)}function zi(t,e){t||hi(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hg(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function lE(){return ub()==="http:"||ub()==="https:"}function ub(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V2(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(lE()||vA()||"connection"in navigator)?navigator.onLine:!0}function U2(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ou{constructor(e,n){this.shortDelay=e,this.longDelay=n,zi(n>e,"Short delay should be less than long delay!"),this.isMobile=mA()||xA()}get(){return V2()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wy(t,e){zi(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cE{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;hi("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;hi("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;hi("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B2={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $2=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],z2=new Ou(3e4,6e4);function Zn(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function er(t,e,n,r,s={}){return uE(t,s,async()=>{let a={},o={};r&&(e==="GET"?o=r:a={body:JSON.stringify(r)});const l=zl(Object.assign({key:t.config.apiKey},o)).slice(1),c=await t._getAdditionalHeaders();c["Content-Type"]="application/json",t.languageCode&&(c["X-Firebase-Locale"]=t.languageCode);const d=Object.assign({method:e,headers:c},a);return yA()||(d.referrerPolicy="no-referrer"),t.emulatorConfig&&Ua(t.emulatorConfig.host)&&(d.credentials="include"),cE.fetch()(await dE(t,t.config.apiHost,n,l),d)})}async function uE(t,e,n){t._canInitEmulator=!1;const r=Object.assign(Object.assign({},B2),e);try{const s=new H2(t),a=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const o=await a.json();if("needConfirmation"in o)throw wc(t,"account-exists-with-different-credential",o);if(a.ok&&!("errorMessage"in o))return o;{const l=a.ok?o.errorMessage:o.error.message,[c,d]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw wc(t,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw wc(t,"email-already-in-use",o);if(c==="USER_DISABLED")throw wc(t,"user-disabled",o);const h=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw oE(t,h,d);bs(t,h)}}catch(s){if(s instanceof Fs)throw s;bs(t,"network-request-failed",{message:String(s)})}}async function za(t,e,n,r,s={}){const a=await er(t,e,n,r,s);return"mfaPendingCredential"in a&&bs(t,"multi-factor-auth-required",{_serverResponse:a}),a}async function dE(t,e,n,r){const s=`${e}${n}?${r}`,a=t,o=a.config.emulator?Wy(t.config,s):`${t.config.apiScheme}://${s}`;return $2.includes(n)&&(await a._persistenceManagerAvailable,a._getPersistenceType()==="COOKIE")?a._getPersistence()._getFinalTarget(o).toString():o}function G2(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class H2{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(vs(this.auth,"network-request-failed")),z2.get())})}}function wc(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=vs(t,e,r);return s.customData._tokenResponse=n,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function db(t){return t!==void 0&&t.getResponse!==void 0}function hb(t){return t!==void 0&&t.enterprise!==void 0}class hE{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return G2(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function q2(t){return(await er(t,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function fE(t,e){return er(t,"GET","/v2/recaptchaConfig",Zn(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function W2(t,e){return er(t,"POST","/v1/accounts:delete",e)}async function Fh(t,e){return er(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mc(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function pE(t,e=!1){const n=ct(t),r=await n.getIdToken(e),s=Ky(r);Te(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const a=typeof s.firebase=="object"?s.firebase:void 0,o=a==null?void 0:a.sign_in_provider;return{claims:s,token:r,authTime:Mc(Gp(s.auth_time)),issuedAtTime:Mc(Gp(s.iat)),expirationTime:Mc(Gp(s.exp)),signInProvider:o||null,signInSecondFactor:(a==null?void 0:a.sign_in_second_factor)||null}}function Gp(t){return Number(t)*1e3}function Ky(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return Qd("JWT malformed, contained fewer than 3 sections"),null;try{const s=Wj(n);return s?JSON.parse(s):(Qd("Failed to decode base64 JWT payload"),null)}catch(s){return Qd("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function fb(t){const e=Ky(t);return Te(e,"internal-error"),Te(typeof e.exp<"u","internal-error"),Te(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gi(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Fs&&K2(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function K2({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q2{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fg{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Mc(this.lastLoginAt),this.creationTime=Mc(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vh(t){var e;const n=t.auth,r=await t.getIdToken(),s=await Gi(t,Fh(n,{idToken:r}));Te(s==null?void 0:s.users.length,n,"internal-error");const a=s.users[0];t._notifyReloadListener(a);const o=!((e=a.providerUserInfo)===null||e===void 0)&&e.length?mE(a.providerUserInfo):[],l=J2(t.providerData,o),c=t.isAnonymous,d=!(t.email&&a.passwordHash)&&!(l!=null&&l.length),h=c?d:!1,f={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:l,metadata:new fg(a.createdAt,a.lastLoginAt),isAnonymous:h};Object.assign(t,f)}async function Y2(t){const e=ct(t);await Vh(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function J2(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function mE(t){return t.map(e=>{var{providerId:n}=e,r=Hy(e,["providerId"]);return{providerId:n,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function X2(t,e){const n=await uE(t,{},async()=>{const r=zl({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:a}=t.config,o=await dE(t,s,"/v1/token",`key=${a}`),l=await t._getAdditionalHeaders();return l["Content-Type"]="application/x-www-form-urlencoded",cE.fetch()(o,{method:"POST",headers:l,body:r})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function Z2(t,e){return er(t,"POST","/v2/accounts:revokeToken",Zn(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Te(e.idToken,"internal-error"),Te(typeof e.idToken<"u","internal-error"),Te(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):fb(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Te(e.length!==0,"internal-error");const n=fb(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Te(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:a}=await X2(e,n);this.updateTokensAndExpiration(r,s,Number(a))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:a}=n,o=new dl;return r&&(Te(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(Te(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),a&&(Te(typeof a=="number","internal-error",{appName:e}),o.expirationTime=a),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new dl,this.toJSON())}_performRefresh(){return hi("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zi(t,e){Te(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Ws{constructor(e){var{uid:n,auth:r,stsTokenManager:s}=e,a=Hy(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Q2(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?[...a.providerData]:[],this.metadata=new fg(a.createdAt||void 0,a.lastLoginAt||void 0)}async getIdToken(e){const n=await Gi(this,this.stsTokenManager.getToken(this.auth,e));return Te(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return pE(this,e)}reload(){return Y2(this)}_assign(e){this!==e&&(Te(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new Ws(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){Te(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await Vh(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ir(this.auth.app))return Promise.reject(Js(this.auth));const e=await this.getIdToken();return await Gi(this,W2(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var r,s,a,o,l,c,d,h;const f=(r=n.displayName)!==null&&r!==void 0?r:void 0,p=(s=n.email)!==null&&s!==void 0?s:void 0,k=(a=n.phoneNumber)!==null&&a!==void 0?a:void 0,S=(o=n.photoURL)!==null&&o!==void 0?o:void 0,T=(l=n.tenantId)!==null&&l!==void 0?l:void 0,C=(c=n._redirectEventId)!==null&&c!==void 0?c:void 0,j=(d=n.createdAt)!==null&&d!==void 0?d:void 0,y=(h=n.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:v,emailVerified:R,isAnonymous:O,providerData:M,stsTokenManager:b}=n;Te(v&&b,e,"internal-error");const x=dl.fromJSON(this.name,b);Te(typeof v=="string",e,"internal-error"),Zi(f,e.name),Zi(p,e.name),Te(typeof R=="boolean",e,"internal-error"),Te(typeof O=="boolean",e,"internal-error"),Zi(k,e.name),Zi(S,e.name),Zi(T,e.name),Zi(C,e.name),Zi(j,e.name),Zi(y,e.name);const w=new Ws({uid:v,auth:e,email:p,emailVerified:R,displayName:f,isAnonymous:O,photoURL:S,phoneNumber:k,tenantId:T,stsTokenManager:x,createdAt:j,lastLoginAt:y});return M&&Array.isArray(M)&&(w.providerData=M.map(E=>Object.assign({},E))),C&&(w._redirectEventId=C),w}static async _fromIdTokenResponse(e,n,r=!1){const s=new dl;s.updateFromServerResponse(n);const a=new Ws({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Vh(a),a}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];Te(s.localId!==void 0,"internal-error");const a=s.providerUserInfo!==void 0?mE(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(a!=null&&a.length),l=new dl;l.updateFromIdToken(r);const c=new Ws({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:o}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new fg(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(a!=null&&a.length)};return Object.assign(c,d),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pb=new Map;function Di(t){zi(t instanceof Function,"Expected a class definition");let e=pb.get(t);return e?(zi(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,pb.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}gE.type="NONE";const mb=gE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yd(t,e,n){return`firebase:${t}:${e}:${n}`}class hl{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:a}=this.auth;this.fullUserKey=Yd(this.userKey,s.apiKey,a),this.fullPersistenceKey=Yd("persistence",s.apiKey,a),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await Fh(this.auth,{idToken:e}).catch(()=>{});return n?Ws._fromGetAccountInfoResponse(this.auth,n,e):null}return Ws._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new hl(Di(mb),e,r);const s=(await Promise.all(n.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let a=s[0]||Di(mb);const o=Yd(r,e.config.apiKey,e.name);let l=null;for(const d of n)try{const h=await d._get(o);if(h){let f;if(typeof h=="string"){const p=await Fh(e,{idToken:h}).catch(()=>{});if(!p)break;f=await Ws._fromGetAccountInfoResponse(e,p,h)}else f=Ws._fromJSON(e,h);d!==a&&(l=f),a=d;break}}catch{}const c=s.filter(d=>d._shouldAllowMigration);return!a._shouldAllowMigration||!c.length?new hl(a,e,r):(a=c[0],l&&await a._set(o,l.toJSON()),await Promise.all(n.map(async d=>{if(d!==a)try{await d._remove(o)}catch{}})),new hl(a,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gb(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(wE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(yE(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(_E(e))return"Blackberry";if(jE(e))return"Webos";if(vE(e))return"Safari";if((e.includes("chrome/")||xE(e))&&!e.includes("edge/"))return"Chrome";if(bE(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function yE(t=Mr()){return/firefox\//i.test(t)}function vE(t=Mr()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function xE(t=Mr()){return/crios\//i.test(t)}function wE(t=Mr()){return/iemobile/i.test(t)}function bE(t=Mr()){return/android/i.test(t)}function _E(t=Mr()){return/blackberry/i.test(t)}function jE(t=Mr()){return/webos/i.test(t)}function Qy(t=Mr()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function eR(t=Mr()){var e;return Qy(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function tR(){return wA()&&document.documentMode===10}function EE(t=Mr()){return Qy(t)||bE(t)||jE(t)||_E(t)||/windows phone/i.test(t)||wE(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kE(t,e=[]){let n;switch(t){case"Browser":n=gb(Mr());break;case"Worker":n=`${gb(Mr())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${To}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nR{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=a=>new Promise((o,l)=>{try{const c=e(a);o(c)}catch(c){l(c)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rR(t,e={}){return er(t,"GET","/v2/passwordPolicy",Zn(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sR=6;class iR{constructor(e){var n,r,s,a;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=o.minPasswordLength)!==null&&n!==void 0?n:sR,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(a=e.forceUpgradeOnSignin)!==null&&a!==void 0?a:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var n,r,s,a,o,l;const c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(n=c.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),c.isValid&&(c.isValid=(r=c.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),c.isValid&&(c.isValid=(s=c.containsLowercaseLetter)!==null&&s!==void 0?s:!0),c.isValid&&(c.isValid=(a=c.containsUppercaseLetter)!==null&&a!==void 0?a:!0),c.isValid&&(c.isValid=(o=c.containsNumericCharacter)!==null&&o!==void 0?o:!0),c.isValid&&(c.isValid=(l=c.containsNonAlphanumericCharacter)!==null&&l!==void 0?l:!0),c}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,a){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aR{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new yb(this),this.idTokenSubscription=new yb(this),this.beforeStateQueue=new nR(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=aE,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(a=>this._resolvePersistenceManagerAvailable=a)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=Di(n)),this._initializationPromise=this.queue(async()=>{var r,s,a;if(!this._deleted&&(this.persistenceManager=await hl.create(this,e),(r=this._resolvePersistenceManagerAvailable)===null||r===void 0||r.call(this),!this._deleted)){if(!((s=this._popupRedirectResolver)===null||s===void 0)&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((a=this.currentUser)===null||a===void 0?void 0:a.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await Fh(this,{idToken:e}),r=await Ws._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var n;if(Ir(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,a=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,l=s==null?void 0:s._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===l)&&(c!=null&&c.user)&&(s=c.user,a=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(a)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return Te(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Vh(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=U2()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Ir(this.app))return Promise.reject(Js(this));const n=e?ct(e):null;return n&&Te(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Te(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Ir(this.app)?Promise.reject(Js(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Ir(this.app)?Promise.reject(Js(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Di(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await rR(this),n=new iR(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new No("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await Z2(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&Di(e)||this._popupRedirectResolver;Te(n,this,"argument-error"),this.redirectPersistenceManager=await hl.create(this,[Di(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const a=typeof n=="function"?n:n.next.bind(n);let o=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(Te(l,this,"internal-error"),l.then(()=>{o||a(this.currentUser)}),typeof n=="function"){const c=e.addObserver(n,r,s);return()=>{o=!0,c()}}else{const c=e.addObserver(n);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Te(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=kE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(n["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(n["X-Firebase-AppCheck"]=s),n}async _getAppCheckToken(){var e;if(Ir(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const n=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return n!=null&&n.error&&F2(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function ks(t){return ct(t)}class yb{constructor(e){this.auth=e,this.observer=null,this.addObserver=SA(n=>this.observer=n)}get next(){return Te(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Mu={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function oR(t){Mu=t}function Yy(t){return Mu.loadJS(t)}function lR(){return Mu.recaptchaV2Script}function cR(){return Mu.recaptchaEnterpriseScript}function uR(){return Mu.gapiScript}function CE(t){return`__${t}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dR=500,hR=6e4,jd=1e12;class fR{constructor(e){this.auth=e,this.counter=jd,this._widgets=new Map}render(e,n){const r=this.counter;return this._widgets.set(r,new gR(e,this.auth.name,n||{})),this.counter++,r}reset(e){var n;const r=e||jd;(n=this._widgets.get(r))===null||n===void 0||n.delete(),this._widgets.delete(r)}getResponse(e){var n;const r=e||jd;return((n=this._widgets.get(r))===null||n===void 0?void 0:n.getResponse())||""}async execute(e){var n;const r=e||jd;return(n=this._widgets.get(r))===null||n===void 0||n.execute(),""}}class pR{constructor(){this.enterprise=new mR}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class mR{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class gR{constructor(e,n,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;Te(s,"argument-error",{appName:n}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=yR(50);const{callback:e,"expired-callback":n}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,n)try{n()}catch{}this.isVisible&&this.execute()},hR)},dR))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function yR(t){const e=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<t;r++)e.push(n.charAt(Math.floor(Math.random()*n.length)));return e.join("")}const vR="recaptcha-enterprise",Fc="NO_RECAPTCHA";class SE{constructor(e){this.type=vR,this.auth=ks(e)}async verify(e="verify",n=!1){async function r(a){if(!n){if(a.tenantId==null&&a._agentRecaptchaConfig!=null)return a._agentRecaptchaConfig.siteKey;if(a.tenantId!=null&&a._tenantRecaptchaConfigs[a.tenantId]!==void 0)return a._tenantRecaptchaConfigs[a.tenantId].siteKey}return new Promise(async(o,l)=>{fE(a,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new hE(c);return a.tenantId==null?a._agentRecaptchaConfig=d:a._tenantRecaptchaConfigs[a.tenantId]=d,o(d.siteKey)}}).catch(c=>{l(c)})})}function s(a,o,l){const c=window.grecaptcha;hb(c)?c.enterprise.ready(()=>{c.enterprise.execute(a,{action:e}).then(d=>{o(d)}).catch(()=>{o(Fc)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new pR().execute("siteKey",{action:"verify"}):new Promise((a,o)=>{r(this.auth).then(l=>{if(!n&&hb(window.grecaptcha))s(l,a,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=cR();c.length!==0&&(c+=l),Yy(c).then(()=>{s(l,a,o)}).catch(d=>{o(d)})}}).catch(l=>{o(l)})})}}async function dc(t,e,n,r=!1,s=!1){const a=new SE(t);let o;if(s)o=Fc;else try{o=await a.verify(n)}catch{o=await a.verify(n,!0)}const l=Object.assign({},e);if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const c=l.phoneEnrollmentInfo.phoneNumber,d=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:d,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const c=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return r?Object.assign(l,{captchaResp:o}):Object.assign(l,{captchaResponse:o}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function oo(t,e,n,r,s){var a,o;if(s==="EMAIL_PASSWORD_PROVIDER")if(!((a=t._getRecaptchaConfig())===null||a===void 0)&&a.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const l=await dc(t,e,n,n==="getOobCode");return r(t,l)}else return r(t,e).catch(async l=>{if(l.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const c=await dc(t,e,n,n==="getOobCode");return r(t,c)}else return Promise.reject(l)});else if(s==="PHONE_PROVIDER")if(!((o=t._getRecaptchaConfig())===null||o===void 0)&&o.isProviderEnabled("PHONE_PROVIDER")){const l=await dc(t,e,n);return r(t,l).catch(async c=>{var d;if(((d=t._getRecaptchaConfig())===null||d===void 0?void 0:d.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(c.code==="auth/missing-recaptcha-token"||c.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);const h=await dc(t,e,n,!1,!0);return r(t,h)}return Promise.reject(c)})}else{const l=await dc(t,e,n,!1,!0);return r(t,l)}else return Promise.reject(s+" provider is not supported.")}async function xR(t){const e=ks(t),n=await fE(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new hE(n);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isAnyProviderEnabled()&&new SE(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wR(t,e){const n=$a(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),a=n.getOptions();if(Ta(a,e??{}))return s;bs(s,"already-initialized")}return n.initialize({options:e})}function bR(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Di);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function _R(t,e,n){const r=ks(t);Te(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,a=NE(e),{host:o,port:l}=jR(e),c=l===null?"":`:${l}`,d={url:`${a}//${o}${c}/`},h=Object.freeze({host:o,port:l,protocol:a.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){Te(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Te(Ta(d,r.config.emulator)&&Ta(h,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=h,r.settings.appVerificationDisabledForTesting=!0,Ua(o)?(Ba("Auth",!0),Cf(`${a}//${o}${c}`)):ER()}function NE(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function jR(t){const e=NE(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const a=s[1];return{host:a,port:vb(r.substr(a.length+1))}}else{const[a,o]=r.split(":");return{host:a,port:vb(o)}}}function vb(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function ER(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nf{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return hi("not implemented")}_getIdTokenResponse(e){return hi("not implemented")}_linkToIdToken(e,n){return hi("not implemented")}_getReauthenticationResolver(e){return hi("not implemented")}}async function kR(t,e){return er(t,"POST","/v1/accounts:update",e)}async function CR(t,e){return er(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SR(t,e){return za(t,"POST","/v1/accounts:signInWithPassword",Zn(t,e))}async function TE(t,e){return er(t,"POST","/v1/accounts:sendOobCode",Zn(t,e))}async function NR(t,e){return TE(t,e)}async function TR(t,e){return TE(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IR(t,e){return za(t,"POST","/v1/accounts:signInWithEmailLink",Zn(t,e))}async function AR(t,e){return za(t,"POST","/v1/accounts:signInWithEmailLink",Zn(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mu extends Nf{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new mu(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new mu(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return oo(e,n,"signInWithPassword",SR,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return IR(e,{email:this._email,oobCode:this._password});default:bs(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return oo(e,r,"signUpPassword",CR,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return AR(e,{idToken:n,email:this._email,oobCode:this._password});default:bs(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fl(t,e){return za(t,"POST","/v1/accounts:signInWithIdp",Zn(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RR="http://localhost";class xo extends Nf{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new xo(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):bs("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=n,a=Hy(n,["providerId","signInMethod"]);if(!r||!s)return null;const o=new xo(r,s);return o.idToken=a.idToken||void 0,o.accessToken=a.accessToken||void 0,o.secret=a.secret,o.nonce=a.nonce,o.pendingToken=a.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return fl(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,fl(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,fl(e,n)}buildRequest(){const e={requestUri:RR,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=zl(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xb(t,e){return er(t,"POST","/v1/accounts:sendVerificationCode",Zn(t,e))}async function PR(t,e){return za(t,"POST","/v1/accounts:signInWithPhoneNumber",Zn(t,e))}async function DR(t,e){const n=await za(t,"POST","/v1/accounts:signInWithPhoneNumber",Zn(t,e));if(n.temporaryProof)throw wc(t,"account-exists-with-different-credential",n);return n}const LR={USER_NOT_FOUND:"user-not-found"};async function OR(t,e){const n=Object.assign(Object.assign({},e),{operation:"REAUTH"});return za(t,"POST","/v1/accounts:signInWithPhoneNumber",Zn(t,n),LR)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pl extends Nf{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,n){return new pl({verificationId:e,verificationCode:n})}static _fromTokenResponse(e,n){return new pl({phoneNumber:e,temporaryProof:n})}_getIdTokenResponse(e){return PR(e,this._makeVerificationRequest())}_linkToIdToken(e,n){return DR(e,Object.assign({idToken:n},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return OR(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:n,verificationId:r,verificationCode:s}=this.params;return e&&n?{temporaryProof:e,phoneNumber:n}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:n,verificationCode:r,phoneNumber:s,temporaryProof:a}=e;return!r&&!n&&!s&&!a?null:new pl({verificationId:n,verificationCode:r,phoneNumber:s,temporaryProof:a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MR(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function FR(t){const e=vc(xc(t)).link,n=e?vc(xc(e)).deep_link_id:null,r=vc(xc(t)).deep_link_id;return(r?vc(xc(r)).link:null)||r||n||e||t}class Jy{constructor(e){var n,r,s,a,o,l;const c=vc(xc(e)),d=(n=c.apiKey)!==null&&n!==void 0?n:null,h=(r=c.oobCode)!==null&&r!==void 0?r:null,f=MR((s=c.mode)!==null&&s!==void 0?s:null);Te(d&&h&&f,"argument-error"),this.apiKey=d,this.operation=f,this.code=h,this.continueUrl=(a=c.continueUrl)!==null&&a!==void 0?a:null,this.languageCode=(o=c.lang)!==null&&o!==void 0?o:null,this.tenantId=(l=c.tenantId)!==null&&l!==void 0?l:null}static parseLink(e){const n=FR(e);try{return new Jy(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gl{constructor(){this.providerId=Gl.PROVIDER_ID}static credential(e,n){return mu._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=Jy.parseLink(n);return Te(r,"argument-error"),mu._fromEmailAndCode(e,r.code,r.tenantId)}}Gl.PROVIDER_ID="password";Gl.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Gl.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IE{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fu extends IE{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sa extends Fu{constructor(){super("facebook.com")}static credential(e){return xo._fromParams({providerId:sa.PROVIDER_ID,signInMethod:sa.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return sa.credentialFromTaggedObject(e)}static credentialFromError(e){return sa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return sa.credential(e.oauthAccessToken)}catch{return null}}}sa.FACEBOOK_SIGN_IN_METHOD="facebook.com";sa.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ia extends Fu{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return xo._fromParams({providerId:ia.PROVIDER_ID,signInMethod:ia.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return ia.credentialFromTaggedObject(e)}static credentialFromError(e){return ia.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return ia.credential(n,r)}catch{return null}}}ia.GOOGLE_SIGN_IN_METHOD="google.com";ia.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa extends Fu{constructor(){super("github.com")}static credential(e){return xo._fromParams({providerId:aa.PROVIDER_ID,signInMethod:aa.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return aa.credentialFromTaggedObject(e)}static credentialFromError(e){return aa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return aa.credential(e.oauthAccessToken)}catch{return null}}}aa.GITHUB_SIGN_IN_METHOD="github.com";aa.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oa extends Fu{constructor(){super("twitter.com")}static credential(e,n){return xo._fromParams({providerId:oa.PROVIDER_ID,signInMethod:oa.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return oa.credentialFromTaggedObject(e)}static credentialFromError(e){return oa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return oa.credential(n,r)}catch{return null}}}oa.TWITTER_SIGN_IN_METHOD="twitter.com";oa.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AE(t,e){return za(t,"POST","/v1/accounts:signUp",Zn(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zs{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const a=await Ws._fromIdTokenResponse(e,r,s),o=wb(r);return new Zs({user:a,providerId:o,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=wb(r);return new Zs({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function wb(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function RE(t){var e;if(Ir(t.app))return Promise.reject(Js(t));const n=ks(t);if(await n._initializationPromise,!((e=n.currentUser)===null||e===void 0)&&e.isAnonymous)return new Zs({user:n.currentUser,providerId:null,operationType:"signIn"});const r=await AE(n,{returnSecureToken:!0}),s=await Zs._fromIdTokenResponse(n,"signIn",r,!0);return await n._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uh extends Fs{constructor(e,n,r,s){var a;super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Uh.prototype),this.customData={appName:e.name,tenantId:(a=e.tenantId)!==null&&a!==void 0?a:void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new Uh(e,n,r,s)}}function PE(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(a=>{throw a.code==="auth/multi-factor-auth-required"?Uh._fromErrorAndOperation(t,a,e,r):a})}async function VR(t,e,n=!1){const r=await Gi(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Zs._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UR(t,e,n=!1){const{auth:r}=t;if(Ir(r.app))return Promise.reject(Js(r));const s="reauthenticate";try{const a=await Gi(t,PE(r,s,e,t),n);Te(a.idToken,r,"internal-error");const o=Ky(a.idToken);Te(o,r,"internal-error");const{sub:l}=o;return Te(t.uid===l,r,"user-mismatch"),Zs._forOperation(t,s,a)}catch(a){throw(a==null?void 0:a.code)==="auth/user-not-found"&&bs(r,"user-mismatch"),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DE(t,e,n=!1){if(Ir(t.app))return Promise.reject(Js(t));const r="signIn",s=await PE(t,r,e),a=await Zs._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(a.user),a}async function BR(t,e){return DE(ks(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tf{constructor(e,n){this.factorId=e,this.uid=n.mfaEnrollmentId,this.enrollmentTime=new Date(n.enrolledAt).toUTCString(),this.displayName=n.displayName}static _fromServerResponse(e,n){return"phoneInfo"in n?Xy._fromServerResponse(e,n):"totpInfo"in n?Zy._fromServerResponse(e,n):bs(e,"internal-error")}}class Xy extends Tf{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,n){return new Xy(n)}}class Zy extends Tf{constructor(e){super("totp",e)}static _fromServerResponse(e,n){return new Zy(n)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LE(t){const e=ks(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function $R(t,e,n){const r=ks(t);await oo(r,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",TR,"EMAIL_PASSWORD_PROVIDER")}async function ev(t,e,n){if(Ir(t.app))return Promise.reject(Js(t));const r=ks(t),o=await oo(r,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",AE,"EMAIL_PASSWORD_PROVIDER").catch(c=>{throw c.code==="auth/password-does-not-meet-requirements"&&LE(t),c}),l=await Zs._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(l.user),l}function zR(t,e,n){return Ir(t.app)?Promise.reject(Js(t)):BR(ct(t),Gl.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&LE(t),r})}async function If(t,e){const n=ct(t),s={requestType:"VERIFY_EMAIL",idToken:await t.getIdToken()},{email:a}=await NR(n.auth,s);a!==t.email&&await t.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GR(t,e){return er(t,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HR(t,{displayName:e,photoURL:n}){if(e===void 0&&n===void 0)return;const r=ct(t),a={idToken:await r.getIdToken(),displayName:e,photoUrl:n,returnSecureToken:!0},o=await Gi(r,GR(r.auth,a));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const l=r.providerData.find(({providerId:c})=>c==="password");l&&(l.displayName=r.displayName,l.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function qR(t,e){const n=ct(t);return Ir(n.auth.app)?Promise.reject(Js(n.auth)):OE(n,e,null)}function WR(t,e){return OE(ct(t),null,e)}async function OE(t,e,n){const{auth:r}=t,a={idToken:await t.getIdToken(),returnSecureToken:!0};e&&(a.email=e),n&&(a.password=n);const o=await Gi(t,kR(r,a));await t._updateTokensIfNecessary(o,!0)}function ME(t,e,n,r){return ct(t).onIdTokenChanged(e,n,r)}function KR(t,e,n){return ct(t).beforeAuthStateChanged(e,n)}function QR(t,e,n,r){return ct(t).onAuthStateChanged(e,n,r)}function FE(t){return ct(t).signOut()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class to{constructor(e,n,r){this.type=e,this.credential=n,this.user=r}static _fromIdtoken(e,n){return new to("enroll",e,n)}static _fromMfaPendingCredential(e){return new to("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var n,r;if(e!=null&&e.multiFactorSession){if(!((n=e.multiFactorSession)===null||n===void 0)&&n.pendingCredential)return to._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return to._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tv{constructor(e,n,r){this.session=e,this.hints=n,this.signInResolver=r}static _fromError(e,n){const r=ks(e),s=n.customData._serverResponse,a=(s.mfaInfo||[]).map(l=>Tf._fromServerResponse(r,l));Te(s.mfaPendingCredential,r,"internal-error");const o=to._fromMfaPendingCredential(s.mfaPendingCredential);return new tv(o,a,async l=>{const c=await l._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const d=Object.assign(Object.assign({},s),{idToken:c.idToken,refreshToken:c.refreshToken});switch(n.operationType){case"signIn":const h=await Zs._fromIdTokenResponse(r,n.operationType,d);return await r._updateCurrentUser(h.user),h;case"reauthenticate":return Te(n.user,r,"internal-error"),Zs._forOperation(n.user,n.operationType,d);default:bs(r,"internal-error")}})}async resolveSignIn(e){const n=e;return this.signInResolver(n)}}function YR(t,e){var n;const r=ct(t),s=e;return Te(e.customData.operationType,r,"argument-error"),Te((n=s.customData._serverResponse)===null||n===void 0?void 0:n.mfaPendingCredential,r,"argument-error"),tv._fromError(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bb(t,e){return er(t,"POST","/v2/accounts/mfaEnrollment:start",Zn(t,e))}function JR(t,e){return er(t,"POST","/v2/accounts/mfaEnrollment:finalize",Zn(t,e))}function XR(t,e){return er(t,"POST","/v2/accounts/mfaEnrollment:withdraw",Zn(t,e))}class nv{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(n=>{n.mfaInfo&&(this.enrolledFactors=n.mfaInfo.map(r=>Tf._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new nv(e)}async getSession(){return to._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,n){const r=e,s=await this.getSession(),a=await Gi(this.user,r._process(this.user.auth,s,n));return await this.user._updateTokensIfNecessary(a),this.user.reload()}async unenroll(e){const n=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await Gi(this.user,XR(this.user.auth,{idToken:r,mfaEnrollmentId:n}));this.enrolledFactors=this.enrolledFactors.filter(({uid:a})=>a!==n),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const Hp=new WeakMap;function Ja(t){const e=ct(t);return Hp.has(e)||Hp.set(e,nv._fromUser(e)),Hp.get(e)}const Bh="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VE{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Bh,"1"),this.storage.removeItem(Bh),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZR=1e3,eP=10;class UE extends VE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=EE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,l,c)=>{this.notifyListeners(o,c)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!n&&this.localCache[r]===o||this.notifyListeners(r,o)},a=this.storage.getItem(r);tR()&&a!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,eP):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},ZR)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}UE.type="LOCAL";const tP=UE;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BE extends VE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}BE.type="SESSION";const $E=BE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nP(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Af{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new Af(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:a}=n.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(o).map(async d=>d(n.origin,a)),c=await nP(l);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:c})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Af.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rv(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rP{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let a,o;return new Promise((l,c)=>{const d=rv("",20);s.port1.start();const h=setTimeout(()=>{c(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const p=f;if(p.data.eventId===d)switch(p.data.status){case"ack":clearTimeout(h),a=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(a),l(p.data.response);break;default:clearTimeout(h),clearTimeout(a),c(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:d,data:n},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function In(){return window}function sP(t){In().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sv(){return typeof In().WorkerGlobalScope<"u"&&typeof In().importScripts=="function"}async function iP(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function aP(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function oP(){return sv()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zE="firebaseLocalStorageDb",lP=1,$h="firebaseLocalStorage",GE="fbase_key";class Vu{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Rf(t,e){return t.transaction([$h],e?"readwrite":"readonly").objectStore($h)}function cP(){const t=indexedDB.deleteDatabase(zE);return new Vu(t).toPromise()}function pg(){const t=indexedDB.open(zE,lP);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore($h,{keyPath:GE})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains($h)?e(r):(r.close(),await cP(),e(await pg()))})})}async function _b(t,e,n){const r=Rf(t,!0).put({[GE]:e,value:n});return new Vu(r).toPromise()}async function uP(t,e){const n=Rf(t,!1).get(e),r=await new Vu(n).toPromise();return r===void 0?null:r.value}function jb(t,e){const n=Rf(t,!0).delete(e);return new Vu(n).toPromise()}const dP=800,hP=3;class HE{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await pg(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>hP)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return sv()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Af._getInstance(oP()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await iP(),!this.activeServiceWorker)return;this.sender=new rP(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((n=r[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||aP()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await pg();return await _b(e,Bh,"1"),await jb(e,Bh),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>_b(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>uP(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>jb(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const a=Rf(s,!1).getAll();return new Vu(a).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:a}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(a)&&(this.notifyListeners(s,a),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),dP)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}HE.type="LOCAL";const fP=HE;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eb(t,e){return er(t,"POST","/v2/accounts/mfaSignIn:start",Zn(t,e))}function pP(t,e){return er(t,"POST","/v2/accounts/mfaSignIn:finalize",Zn(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qp=CE("rcb"),mP=new Ou(3e4,6e4);class gP{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=In().grecaptcha)===null||e===void 0)&&e.render)}load(e,n=""){return Te(yP(n),e,"argument-error"),this.shouldResolveImmediately(n)&&db(In().grecaptcha)?Promise.resolve(In().grecaptcha):new Promise((r,s)=>{const a=In().setTimeout(()=>{s(vs(e,"network-request-failed"))},mP.get());In()[qp]=()=>{In().clearTimeout(a),delete In()[qp];const l=In().grecaptcha;if(!l||!db(l)){s(vs(e,"internal-error"));return}const c=l.render;l.render=(d,h)=>{const f=c(d,h);return this.counter++,f},this.hostLanguage=n,r(l)};const o=`${lR()}?${zl({onload:qp,render:"explicit",hl:n})}`;Yy(o).catch(()=>{clearTimeout(a),s(vs(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var n;return!!(!((n=In().grecaptcha)===null||n===void 0)&&n.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function yP(t){return t.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(t)}class vP{async load(e){return new fR(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vc="recaptcha",xP={theme:"light",type:"image"};class qE{constructor(e,n,r=Object.assign({},xP)){this.parameters=r,this.type=Vc,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=ks(e),this.isInvisible=this.parameters.size==="invisible",Te(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof n=="string"?document.getElementById(n):n;Te(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new vP:new gP,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),n=this.getAssertedRecaptcha(),r=n.getResponse(e);return r||new Promise(s=>{const a=o=>{o&&(this.tokenChangeListeners.delete(a),s(o))};this.tokenChangeListeners.add(a),this.isInvisible&&n.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){Te(!this.parameters.sitekey,this.auth,"argument-error"),Te(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),Te(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return n=>{if(this.tokenChangeListeners.forEach(r=>r(n)),typeof e=="function")e(n);else if(typeof e=="string"){const r=In()[e];typeof r=="function"&&r(n)}}}assertNotDestroyed(){Te(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const n=document.createElement("div");e.appendChild(n),e=n}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){Te(lE()&&!sv(),this.auth,"internal-error"),await wP(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await q2(this.auth);Te(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return Te(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function wP(){let t=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}t=()=>e(),window.addEventListener("load",t)}).catch(e=>{throw t&&window.removeEventListener("load",t),e})}async function bP(t,e,n){var r;if(!t._getRecaptchaConfig())try{await xR(t)}catch{console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let s;if(typeof e=="string"?s={phoneNumber:e}:s=e,"session"in s){const a=s.session;if("phoneNumber"in s){Te(a.type==="enroll",t,"internal-error");const o={idToken:a.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"}};return(await oo(t,o,"mfaSmsEnrollment",async(h,f)=>{if(f.phoneEnrollmentInfo.captchaResponse===Fc){Te((n==null?void 0:n.type)===Vc,h,"argument-error");const p=await Wp(h,f,n);return bb(h,p)}return bb(h,f)},"PHONE_PROVIDER").catch(h=>Promise.reject(h))).phoneSessionInfo.sessionInfo}else{Te(a.type==="signin",t,"internal-error");const o=((r=s.multiFactorHint)===null||r===void 0?void 0:r.uid)||s.multiFactorUid;Te(o,t,"missing-multi-factor-info");const l={mfaPendingCredential:a.credential,mfaEnrollmentId:o,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}};return(await oo(t,l,"mfaSmsSignIn",async(f,p)=>{if(p.phoneSignInInfo.captchaResponse===Fc){Te((n==null?void 0:n.type)===Vc,f,"argument-error");const k=await Wp(f,p,n);return Eb(f,k)}return Eb(f,p)},"PHONE_PROVIDER").catch(f=>Promise.reject(f))).phoneResponseInfo.sessionInfo}}else{const a={phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"};return(await oo(t,a,"sendVerificationCode",async(d,h)=>{if(h.captchaResponse===Fc){Te((n==null?void 0:n.type)===Vc,d,"argument-error");const f=await Wp(d,h,n);return xb(d,f)}return xb(d,h)},"PHONE_PROVIDER").catch(d=>Promise.reject(d))).sessionInfo}}finally{n==null||n._reset()}}async function Wp(t,e,n){Te(n.type===Vc,t,"argument-error");const r=await n.verify();Te(typeof r=="string",t,"argument-error");const s=Object.assign({},e);if("phoneEnrollmentInfo"in s){const a=s.phoneEnrollmentInfo.phoneNumber,o=s.phoneEnrollmentInfo.captchaResponse,l=s.phoneEnrollmentInfo.clientType,c=s.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:a,recaptchaToken:r,captchaResponse:o,clientType:l,recaptchaVersion:c}}),s}else if("phoneSignInInfo"in s){const a=s.phoneSignInInfo.captchaResponse,o=s.phoneSignInInfo.clientType,l=s.phoneSignInInfo.recaptchaVersion;return Object.assign(s,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:a,clientType:o,recaptchaVersion:l}}),s}else return Object.assign(s,{recaptchaToken:r}),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gi{constructor(e){this.providerId=gi.PROVIDER_ID,this.auth=ks(e)}verifyPhoneNumber(e,n){return bP(this.auth,e,ct(n))}static credential(e,n){return pl._fromVerification(e,n)}static credentialFromResult(e){const n=e;return gi.credentialFromTaggedObject(n)}static credentialFromError(e){return gi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:n,temporaryProof:r}=e;return n&&r?pl._fromTokenResponse(n,r):null}}gi.PROVIDER_ID="phone";gi.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _P(t,e){return e?Di(e):(Te(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iv extends Nf{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return fl(e,this._buildIdpRequest())}_linkToIdToken(e,n){return fl(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return fl(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function jP(t){return DE(t.auth,new iv(t),t.bypassAuthState)}function EP(t){const{auth:e,user:n}=t;return Te(n,e,"internal-error"),UR(n,new iv(t),t.bypassAuthState)}async function kP(t){const{auth:e,user:n}=t;return Te(n,e,"internal-error"),VR(n,new iv(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WE{constructor(e,n,r,s,a=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=a,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:a,error:o,type:l}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:n,sessionId:r,tenantId:a||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return jP;case"linkViaPopup":case"linkViaRedirect":return kP;case"reauthViaPopup":case"reauthViaRedirect":return EP;default:bs(this.auth,"internal-error")}}resolve(e){zi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){zi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CP=new Ou(2e3,1e4);class rl extends WE{constructor(e,n,r,s,a){super(e,n,s,a),this.provider=r,this.authWindow=null,this.pollId=null,rl.currentPopupAction&&rl.currentPopupAction.cancel(),rl.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Te(e,this.auth,"internal-error"),e}async onExecution(){zi(this.filter.length===1,"Popup operations only handle one event");const e=rv();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(vs(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(vs(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,rl.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if(!((r=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(vs(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,CP.get())};e()}}rl.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SP="pendingRedirect",Jd=new Map;class NP extends WE{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=Jd.get(this.auth._key());if(!e){try{const r=await TP(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}Jd.set(this.auth._key(),e)}return this.bypassAuthState||Jd.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function TP(t,e){const n=RP(e),r=AP(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function IP(t,e){Jd.set(t._key(),e)}function AP(t){return Di(t._redirectPersistence)}function RP(t){return Yd(SP,t.config.apiKey,t.name)}async function PP(t,e,n=!1){if(Ir(t.app))return Promise.reject(Js(t));const r=ks(t),s=_P(r,e),o=await new NP(r,s,n).execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DP=10*60*1e3;class LP{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!OP(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!KE(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";n.onError(vs(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=DP&&this.cachedEventUids.clear(),this.cachedEventUids.has(kb(e))}saveEventToCache(e){this.cachedEventUids.add(kb(e)),this.lastProcessedEventTime=Date.now()}}function kb(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function KE({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function OP(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return KE(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MP(t,e={}){return er(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FP=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,VP=/^https?/;async function UP(t){if(t.config.emulator)return;const{authorizedDomains:e}=await MP(t);for(const n of e)try{if(BP(n))return}catch{}bs(t,"unauthorized-domain")}function BP(t){const e=hg(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===r}if(!VP.test(n))return!1;if(FP.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $P=new Ou(3e4,6e4);function Cb(){const t=In().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function zP(t){return new Promise((e,n)=>{var r,s,a;function o(){Cb(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Cb(),n(vs(t,"network-request-failed"))},timeout:$P.get()})}if(!((s=(r=In().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((a=In().gapi)===null||a===void 0)&&a.load)o();else{const l=CE("iframefcb");return In()[l]=()=>{gapi.load?o():n(vs(t,"network-request-failed"))},Yy(`${uR()}?onload=${l}`).catch(c=>n(c))}}).catch(e=>{throw Xd=null,e})}let Xd=null;function GP(t){return Xd=Xd||zP(t),Xd}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HP=new Ou(5e3,15e3),qP="__/auth/iframe",WP="emulator/auth/iframe",KP={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},QP=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function YP(t){const e=t.config;Te(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Wy(e,WP):`https://${t.config.authDomain}/${qP}`,r={apiKey:e.apiKey,appName:t.name,v:To},s=QP.get(t.config.apiHost);s&&(r.eid=s);const a=t._getFrameworks();return a.length&&(r.fw=a.join(",")),`${n}?${zl(r).slice(1)}`}async function JP(t){const e=await GP(t),n=In().gapi;return Te(n,t,"internal-error"),e.open({where:document.body,url:YP(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:KP,dontclear:!0},r=>new Promise(async(s,a)=>{await r.restyle({setHideOnLeave:!1});const o=vs(t,"network-request-failed"),l=In().setTimeout(()=>{a(o)},HP.get());function c(){In().clearTimeout(l),s(r)}r.ping(c).then(c,()=>{a(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XP={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},ZP=500,eD=600,tD="_blank",nD="http://localhost";class Sb{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function rD(t,e,n,r=ZP,s=eD){const a=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const c=Object.assign(Object.assign({},XP),{width:r.toString(),height:s.toString(),top:a,left:o}),d=Mr().toLowerCase();n&&(l=xE(d)?tD:n),yE(d)&&(e=e||nD,c.scrollbars="yes");const h=Object.entries(c).reduce((p,[k,S])=>`${p}${k}=${S},`,"");if(eR(d)&&l!=="_self")return sD(e||"",l),new Sb(null);const f=window.open(e||"",l,h);Te(f,t,"popup-blocked");try{f.focus()}catch{}return new Sb(f)}function sD(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iD="__/auth/handler",aD="emulator/auth/handler",oD=encodeURIComponent("fac");async function Nb(t,e,n,r,s,a){Te(t.config.authDomain,t,"auth-domain-config-required"),Te(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:To,eventId:s};if(e instanceof IE){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",CA(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries({}))o[h]=f}if(e instanceof Fu){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(o.scopes=h.join(","))}t.tenantId&&(o.tid=t.tenantId);const l=o;for(const h of Object.keys(l))l[h]===void 0&&delete l[h];const c=await t._getAppCheckToken(),d=c?`#${oD}=${encodeURIComponent(c)}`:"";return`${lD(t)}?${zl(l).slice(1)}${d}`}function lD({config:t}){return t.emulator?Wy(t,aD):`https://${t.authDomain}/${iD}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kp="webStorageSupport";class cD{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=$E,this._completeRedirectFn=PP,this._overrideRedirectResult=IP}async _openPopup(e,n,r,s){var a;zi((a=this.eventManagers[e._key()])===null||a===void 0?void 0:a.manager,"_initialize() not called before _openPopup()");const o=await Nb(e,n,r,hg(),s);return rD(e,o,rv())}async _openRedirect(e,n,r,s){await this._originValidation(e);const a=await Nb(e,n,r,hg(),s);return sP(a),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:a}=this.eventManagers[n];return s?Promise.resolve(s):(zi(a,"If manager is not set, promise should be"),a)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await JP(e),r=new LP(e);return n.register("authEvent",s=>(Te(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Kp,{type:Kp},s=>{var a;const o=(a=s==null?void 0:s[0])===null||a===void 0?void 0:a[Kp];o!==void 0&&n(!!o),bs(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=UP(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return EE()||vE()||Qy()}}const uD=cD;class dD{constructor(e){this.factorId=e}_process(e,n,r){switch(n.type){case"enroll":return this._finalizeEnroll(e,n.credential,r);case"signin":return this._finalizeSignIn(e,n.credential);default:return hi("unexpected MultiFactorSessionType")}}}class av extends dD{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new av(e)}_finalizeEnroll(e,n,r){return JR(e,{idToken:n,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,n){return pP(e,{mfaPendingCredential:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class ov{constructor(){}static assertion(e){return av._fromCredential(e)}}ov.FACTOR_ID="phone";var Tb="@firebase/auth",Ib="1.10.4";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hD{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Te(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fD(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function pD(t){Ms(new ws("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),a=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=r.options;Te(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:o,authDomain:l,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:kE(t)},d=new aR(r,s,a,c);return bR(d,n),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Ms(new ws("auth-internal",e=>{const n=ks(e.getProvider("auth").getImmediate());return(r=>new hD(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Rr(Tb,Ib,fD(t)),Rr(Tb,Ib,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mD=5*60,gD=Yj("authIdTokenMaxAge")||mD;let Ab=null;const yD=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>gD)return;const s=n==null?void 0:n.token;Ab!==s&&(Ab=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function vD(t=Lu()){const e=$a(t,"auth");if(e.isInitialized())return e.getImmediate();const n=wR(t,{popupRedirectResolver:uD,persistence:[fP,tP,$E]}),r=Yj("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const a=new URL(r,location.origin);if(location.origin===a.origin){const o=yD(a.toString());KR(n,o,()=>o(n.currentUser)),ME(n,l=>o(l))}}const s=Kj("auth");return s?_R(n,`http://${s}`):Ba("Auth",!1),n}function xD(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}oR({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const a=vs("internal-error");a.customData=s,n(a)},r.type="text/javascript",r.charset="UTF-8",xD().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});pD("Browser");var wD="firebase",bD="11.7.3";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Rr(wD,bD,"app");var Rb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ja,QE;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(b,x){function w(){}w.prototype=x.prototype,b.D=x.prototype,b.prototype=new w,b.prototype.constructor=b,b.C=function(E,N,D){for(var I=Array(arguments.length-2),pe=2;pe<arguments.length;pe++)I[pe-2]=arguments[pe];return x.prototype[N].apply(E,I)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,n),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(b,x,w){w||(w=0);var E=Array(16);if(typeof x=="string")for(var N=0;16>N;++N)E[N]=x.charCodeAt(w++)|x.charCodeAt(w++)<<8|x.charCodeAt(w++)<<16|x.charCodeAt(w++)<<24;else for(N=0;16>N;++N)E[N]=x[w++]|x[w++]<<8|x[w++]<<16|x[w++]<<24;x=b.g[0],w=b.g[1],N=b.g[2];var D=b.g[3],I=x+(D^w&(N^D))+E[0]+3614090360&4294967295;x=w+(I<<7&4294967295|I>>>25),I=D+(N^x&(w^N))+E[1]+3905402710&4294967295,D=x+(I<<12&4294967295|I>>>20),I=N+(w^D&(x^w))+E[2]+606105819&4294967295,N=D+(I<<17&4294967295|I>>>15),I=w+(x^N&(D^x))+E[3]+3250441966&4294967295,w=N+(I<<22&4294967295|I>>>10),I=x+(D^w&(N^D))+E[4]+4118548399&4294967295,x=w+(I<<7&4294967295|I>>>25),I=D+(N^x&(w^N))+E[5]+1200080426&4294967295,D=x+(I<<12&4294967295|I>>>20),I=N+(w^D&(x^w))+E[6]+2821735955&4294967295,N=D+(I<<17&4294967295|I>>>15),I=w+(x^N&(D^x))+E[7]+4249261313&4294967295,w=N+(I<<22&4294967295|I>>>10),I=x+(D^w&(N^D))+E[8]+1770035416&4294967295,x=w+(I<<7&4294967295|I>>>25),I=D+(N^x&(w^N))+E[9]+2336552879&4294967295,D=x+(I<<12&4294967295|I>>>20),I=N+(w^D&(x^w))+E[10]+4294925233&4294967295,N=D+(I<<17&4294967295|I>>>15),I=w+(x^N&(D^x))+E[11]+2304563134&4294967295,w=N+(I<<22&4294967295|I>>>10),I=x+(D^w&(N^D))+E[12]+1804603682&4294967295,x=w+(I<<7&4294967295|I>>>25),I=D+(N^x&(w^N))+E[13]+4254626195&4294967295,D=x+(I<<12&4294967295|I>>>20),I=N+(w^D&(x^w))+E[14]+2792965006&4294967295,N=D+(I<<17&4294967295|I>>>15),I=w+(x^N&(D^x))+E[15]+1236535329&4294967295,w=N+(I<<22&4294967295|I>>>10),I=x+(N^D&(w^N))+E[1]+4129170786&4294967295,x=w+(I<<5&4294967295|I>>>27),I=D+(w^N&(x^w))+E[6]+3225465664&4294967295,D=x+(I<<9&4294967295|I>>>23),I=N+(x^w&(D^x))+E[11]+643717713&4294967295,N=D+(I<<14&4294967295|I>>>18),I=w+(D^x&(N^D))+E[0]+3921069994&4294967295,w=N+(I<<20&4294967295|I>>>12),I=x+(N^D&(w^N))+E[5]+3593408605&4294967295,x=w+(I<<5&4294967295|I>>>27),I=D+(w^N&(x^w))+E[10]+38016083&4294967295,D=x+(I<<9&4294967295|I>>>23),I=N+(x^w&(D^x))+E[15]+3634488961&4294967295,N=D+(I<<14&4294967295|I>>>18),I=w+(D^x&(N^D))+E[4]+3889429448&4294967295,w=N+(I<<20&4294967295|I>>>12),I=x+(N^D&(w^N))+E[9]+568446438&4294967295,x=w+(I<<5&4294967295|I>>>27),I=D+(w^N&(x^w))+E[14]+3275163606&4294967295,D=x+(I<<9&4294967295|I>>>23),I=N+(x^w&(D^x))+E[3]+4107603335&4294967295,N=D+(I<<14&4294967295|I>>>18),I=w+(D^x&(N^D))+E[8]+1163531501&4294967295,w=N+(I<<20&4294967295|I>>>12),I=x+(N^D&(w^N))+E[13]+2850285829&4294967295,x=w+(I<<5&4294967295|I>>>27),I=D+(w^N&(x^w))+E[2]+4243563512&4294967295,D=x+(I<<9&4294967295|I>>>23),I=N+(x^w&(D^x))+E[7]+1735328473&4294967295,N=D+(I<<14&4294967295|I>>>18),I=w+(D^x&(N^D))+E[12]+2368359562&4294967295,w=N+(I<<20&4294967295|I>>>12),I=x+(w^N^D)+E[5]+4294588738&4294967295,x=w+(I<<4&4294967295|I>>>28),I=D+(x^w^N)+E[8]+2272392833&4294967295,D=x+(I<<11&4294967295|I>>>21),I=N+(D^x^w)+E[11]+1839030562&4294967295,N=D+(I<<16&4294967295|I>>>16),I=w+(N^D^x)+E[14]+4259657740&4294967295,w=N+(I<<23&4294967295|I>>>9),I=x+(w^N^D)+E[1]+2763975236&4294967295,x=w+(I<<4&4294967295|I>>>28),I=D+(x^w^N)+E[4]+1272893353&4294967295,D=x+(I<<11&4294967295|I>>>21),I=N+(D^x^w)+E[7]+4139469664&4294967295,N=D+(I<<16&4294967295|I>>>16),I=w+(N^D^x)+E[10]+3200236656&4294967295,w=N+(I<<23&4294967295|I>>>9),I=x+(w^N^D)+E[13]+681279174&4294967295,x=w+(I<<4&4294967295|I>>>28),I=D+(x^w^N)+E[0]+3936430074&4294967295,D=x+(I<<11&4294967295|I>>>21),I=N+(D^x^w)+E[3]+3572445317&4294967295,N=D+(I<<16&4294967295|I>>>16),I=w+(N^D^x)+E[6]+76029189&4294967295,w=N+(I<<23&4294967295|I>>>9),I=x+(w^N^D)+E[9]+3654602809&4294967295,x=w+(I<<4&4294967295|I>>>28),I=D+(x^w^N)+E[12]+3873151461&4294967295,D=x+(I<<11&4294967295|I>>>21),I=N+(D^x^w)+E[15]+530742520&4294967295,N=D+(I<<16&4294967295|I>>>16),I=w+(N^D^x)+E[2]+3299628645&4294967295,w=N+(I<<23&4294967295|I>>>9),I=x+(N^(w|~D))+E[0]+4096336452&4294967295,x=w+(I<<6&4294967295|I>>>26),I=D+(w^(x|~N))+E[7]+1126891415&4294967295,D=x+(I<<10&4294967295|I>>>22),I=N+(x^(D|~w))+E[14]+2878612391&4294967295,N=D+(I<<15&4294967295|I>>>17),I=w+(D^(N|~x))+E[5]+4237533241&4294967295,w=N+(I<<21&4294967295|I>>>11),I=x+(N^(w|~D))+E[12]+1700485571&4294967295,x=w+(I<<6&4294967295|I>>>26),I=D+(w^(x|~N))+E[3]+2399980690&4294967295,D=x+(I<<10&4294967295|I>>>22),I=N+(x^(D|~w))+E[10]+4293915773&4294967295,N=D+(I<<15&4294967295|I>>>17),I=w+(D^(N|~x))+E[1]+2240044497&4294967295,w=N+(I<<21&4294967295|I>>>11),I=x+(N^(w|~D))+E[8]+1873313359&4294967295,x=w+(I<<6&4294967295|I>>>26),I=D+(w^(x|~N))+E[15]+4264355552&4294967295,D=x+(I<<10&4294967295|I>>>22),I=N+(x^(D|~w))+E[6]+2734768916&4294967295,N=D+(I<<15&4294967295|I>>>17),I=w+(D^(N|~x))+E[13]+1309151649&4294967295,w=N+(I<<21&4294967295|I>>>11),I=x+(N^(w|~D))+E[4]+4149444226&4294967295,x=w+(I<<6&4294967295|I>>>26),I=D+(w^(x|~N))+E[11]+3174756917&4294967295,D=x+(I<<10&4294967295|I>>>22),I=N+(x^(D|~w))+E[2]+718787259&4294967295,N=D+(I<<15&4294967295|I>>>17),I=w+(D^(N|~x))+E[9]+3951481745&4294967295,b.g[0]=b.g[0]+x&4294967295,b.g[1]=b.g[1]+(N+(I<<21&4294967295|I>>>11))&4294967295,b.g[2]=b.g[2]+N&4294967295,b.g[3]=b.g[3]+D&4294967295}r.prototype.u=function(b,x){x===void 0&&(x=b.length);for(var w=x-this.blockSize,E=this.B,N=this.h,D=0;D<x;){if(N==0)for(;D<=w;)s(this,b,D),D+=this.blockSize;if(typeof b=="string"){for(;D<x;)if(E[N++]=b.charCodeAt(D++),N==this.blockSize){s(this,E),N=0;break}}else for(;D<x;)if(E[N++]=b[D++],N==this.blockSize){s(this,E),N=0;break}}this.h=N,this.o+=x},r.prototype.v=function(){var b=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);b[0]=128;for(var x=1;x<b.length-8;++x)b[x]=0;var w=8*this.o;for(x=b.length-8;x<b.length;++x)b[x]=w&255,w/=256;for(this.u(b),b=Array(16),x=w=0;4>x;++x)for(var E=0;32>E;E+=8)b[w++]=this.g[x]>>>E&255;return b};function a(b,x){var w=l;return Object.prototype.hasOwnProperty.call(w,b)?w[b]:w[b]=x(b)}function o(b,x){this.h=x;for(var w=[],E=!0,N=b.length-1;0<=N;N--){var D=b[N]|0;E&&D==x||(w[N]=D,E=!1)}this.g=w}var l={};function c(b){return-128<=b&&128>b?a(b,function(x){return new o([x|0],0>x?-1:0)}):new o([b|0],0>b?-1:0)}function d(b){if(isNaN(b)||!isFinite(b))return f;if(0>b)return C(d(-b));for(var x=[],w=1,E=0;b>=w;E++)x[E]=b/w|0,w*=4294967296;return new o(x,0)}function h(b,x){if(b.length==0)throw Error("number format error: empty string");if(x=x||10,2>x||36<x)throw Error("radix out of range: "+x);if(b.charAt(0)=="-")return C(h(b.substring(1),x));if(0<=b.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=d(Math.pow(x,8)),E=f,N=0;N<b.length;N+=8){var D=Math.min(8,b.length-N),I=parseInt(b.substring(N,N+D),x);8>D?(D=d(Math.pow(x,D)),E=E.j(D).add(d(I))):(E=E.j(w),E=E.add(d(I)))}return E}var f=c(0),p=c(1),k=c(16777216);t=o.prototype,t.m=function(){if(T(this))return-C(this).m();for(var b=0,x=1,w=0;w<this.g.length;w++){var E=this.i(w);b+=(0<=E?E:4294967296+E)*x,x*=4294967296}return b},t.toString=function(b){if(b=b||10,2>b||36<b)throw Error("radix out of range: "+b);if(S(this))return"0";if(T(this))return"-"+C(this).toString(b);for(var x=d(Math.pow(b,6)),w=this,E="";;){var N=R(w,x).g;w=j(w,N.j(x));var D=((0<w.g.length?w.g[0]:w.h)>>>0).toString(b);if(w=N,S(w))return D+E;for(;6>D.length;)D="0"+D;E=D+E}},t.i=function(b){return 0>b?0:b<this.g.length?this.g[b]:this.h};function S(b){if(b.h!=0)return!1;for(var x=0;x<b.g.length;x++)if(b.g[x]!=0)return!1;return!0}function T(b){return b.h==-1}t.l=function(b){return b=j(this,b),T(b)?-1:S(b)?0:1};function C(b){for(var x=b.g.length,w=[],E=0;E<x;E++)w[E]=~b.g[E];return new o(w,~b.h).add(p)}t.abs=function(){return T(this)?C(this):this},t.add=function(b){for(var x=Math.max(this.g.length,b.g.length),w=[],E=0,N=0;N<=x;N++){var D=E+(this.i(N)&65535)+(b.i(N)&65535),I=(D>>>16)+(this.i(N)>>>16)+(b.i(N)>>>16);E=I>>>16,D&=65535,I&=65535,w[N]=I<<16|D}return new o(w,w[w.length-1]&-2147483648?-1:0)};function j(b,x){return b.add(C(x))}t.j=function(b){if(S(this)||S(b))return f;if(T(this))return T(b)?C(this).j(C(b)):C(C(this).j(b));if(T(b))return C(this.j(C(b)));if(0>this.l(k)&&0>b.l(k))return d(this.m()*b.m());for(var x=this.g.length+b.g.length,w=[],E=0;E<2*x;E++)w[E]=0;for(E=0;E<this.g.length;E++)for(var N=0;N<b.g.length;N++){var D=this.i(E)>>>16,I=this.i(E)&65535,pe=b.i(N)>>>16,Xe=b.i(N)&65535;w[2*E+2*N]+=I*Xe,y(w,2*E+2*N),w[2*E+2*N+1]+=D*Xe,y(w,2*E+2*N+1),w[2*E+2*N+1]+=I*pe,y(w,2*E+2*N+1),w[2*E+2*N+2]+=D*pe,y(w,2*E+2*N+2)}for(E=0;E<x;E++)w[E]=w[2*E+1]<<16|w[2*E];for(E=x;E<2*x;E++)w[E]=0;return new o(w,0)};function y(b,x){for(;(b[x]&65535)!=b[x];)b[x+1]+=b[x]>>>16,b[x]&=65535,x++}function v(b,x){this.g=b,this.h=x}function R(b,x){if(S(x))throw Error("division by zero");if(S(b))return new v(f,f);if(T(b))return x=R(C(b),x),new v(C(x.g),C(x.h));if(T(x))return x=R(b,C(x)),new v(C(x.g),x.h);if(30<b.g.length){if(T(b)||T(x))throw Error("slowDivide_ only works with positive integers.");for(var w=p,E=x;0>=E.l(b);)w=O(w),E=O(E);var N=M(w,1),D=M(E,1);for(E=M(E,2),w=M(w,2);!S(E);){var I=D.add(E);0>=I.l(b)&&(N=N.add(w),D=I),E=M(E,1),w=M(w,1)}return x=j(b,N.j(x)),new v(N,x)}for(N=f;0<=b.l(x);){for(w=Math.max(1,Math.floor(b.m()/x.m())),E=Math.ceil(Math.log(w)/Math.LN2),E=48>=E?1:Math.pow(2,E-48),D=d(w),I=D.j(x);T(I)||0<I.l(b);)w-=E,D=d(w),I=D.j(x);S(D)&&(D=p),N=N.add(D),b=j(b,I)}return new v(N,b)}t.A=function(b){return R(this,b).h},t.and=function(b){for(var x=Math.max(this.g.length,b.g.length),w=[],E=0;E<x;E++)w[E]=this.i(E)&b.i(E);return new o(w,this.h&b.h)},t.or=function(b){for(var x=Math.max(this.g.length,b.g.length),w=[],E=0;E<x;E++)w[E]=this.i(E)|b.i(E);return new o(w,this.h|b.h)},t.xor=function(b){for(var x=Math.max(this.g.length,b.g.length),w=[],E=0;E<x;E++)w[E]=this.i(E)^b.i(E);return new o(w,this.h^b.h)};function O(b){for(var x=b.g.length+1,w=[],E=0;E<x;E++)w[E]=b.i(E)<<1|b.i(E-1)>>>31;return new o(w,b.h)}function M(b,x){var w=x>>5;x%=32;for(var E=b.g.length-w,N=[],D=0;D<E;D++)N[D]=0<x?b.i(D+w)>>>x|b.i(D+w+1)<<32-x:b.i(D+w);return new o(N,b.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,QE=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=d,o.fromString=h,ja=o}).apply(typeof Rb<"u"?Rb:typeof self<"u"?self:typeof window<"u"?window:{});var Ed=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var YE,bc,JE,Zd,mg,XE,ZE,ek;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,g,_){return u==Array.prototype||u==Object.prototype||(u[g]=_.value),u};function n(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ed=="object"&&Ed];for(var g=0;g<u.length;++g){var _=u[g];if(_&&_.Math==Math)return _}throw Error("Cannot find global object")}var r=n(this);function s(u,g){if(g)e:{var _=r;u=u.split(".");for(var P=0;P<u.length-1;P++){var Q=u[P];if(!(Q in _))break e;_=_[Q]}u=u[u.length-1],P=_[u],g=g(P),g!=P&&g!=null&&e(_,u,{configurable:!0,writable:!0,value:g})}}function a(u,g){u instanceof String&&(u+="");var _=0,P=!1,Q={next:function(){if(!P&&_<u.length){var ee=_++;return{value:g(ee,u[ee]),done:!1}}return P=!0,{done:!0,value:void 0}}};return Q[Symbol.iterator]=function(){return Q},Q}s("Array.prototype.values",function(u){return u||function(){return a(this,function(g,_){return _})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},l=this||self;function c(u){var g=typeof u;return g=g!="object"?g:u?Array.isArray(u)?"array":g:"null",g=="array"||g=="object"&&typeof u.length=="number"}function d(u){var g=typeof u;return g=="object"&&u!=null||g=="function"}function h(u,g,_){return u.call.apply(u.bind,arguments)}function f(u,g,_){if(!u)throw Error();if(2<arguments.length){var P=Array.prototype.slice.call(arguments,2);return function(){var Q=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Q,P),u.apply(g,Q)}}return function(){return u.apply(g,arguments)}}function p(u,g,_){return p=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,p.apply(null,arguments)}function k(u,g){var _=Array.prototype.slice.call(arguments,1);return function(){var P=_.slice();return P.push.apply(P,arguments),u.apply(this,P)}}function S(u,g){function _(){}_.prototype=g.prototype,u.aa=g.prototype,u.prototype=new _,u.prototype.constructor=u,u.Qb=function(P,Q,ee){for(var _e=Array(arguments.length-2),Kt=2;Kt<arguments.length;Kt++)_e[Kt-2]=arguments[Kt];return g.prototype[Q].apply(P,_e)}}function T(u){const g=u.length;if(0<g){const _=Array(g);for(let P=0;P<g;P++)_[P]=u[P];return _}return[]}function C(u,g){for(let _=1;_<arguments.length;_++){const P=arguments[_];if(c(P)){const Q=u.length||0,ee=P.length||0;u.length=Q+ee;for(let _e=0;_e<ee;_e++)u[Q+_e]=P[_e]}else u.push(P)}}class j{constructor(g,_){this.i=g,this.j=_,this.h=0,this.g=null}get(){let g;return 0<this.h?(this.h--,g=this.g,this.g=g.next,g.next=null):g=this.i(),g}}function y(u){return/^[\s\xa0]*$/.test(u)}function v(){var u=l.navigator;return u&&(u=u.userAgent)?u:""}function R(u){return R[" "](u),u}R[" "]=function(){};var O=v().indexOf("Gecko")!=-1&&!(v().toLowerCase().indexOf("webkit")!=-1&&v().indexOf("Edge")==-1)&&!(v().indexOf("Trident")!=-1||v().indexOf("MSIE")!=-1)&&v().indexOf("Edge")==-1;function M(u,g,_){for(const P in u)g.call(_,u[P],P,u)}function b(u,g){for(const _ in u)g.call(void 0,u[_],_,u)}function x(u){const g={};for(const _ in u)g[_]=u[_];return g}const w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(u,g){let _,P;for(let Q=1;Q<arguments.length;Q++){P=arguments[Q];for(_ in P)u[_]=P[_];for(let ee=0;ee<w.length;ee++)_=w[ee],Object.prototype.hasOwnProperty.call(P,_)&&(u[_]=P[_])}}function N(u){var g=1;u=u.split(":");const _=[];for(;0<g&&u.length;)_.push(u.shift()),g--;return u.length&&_.push(u.join(":")),_}function D(u){l.setTimeout(()=>{throw u},0)}function I(){var u=z;let g=null;return u.g&&(g=u.g,u.g=u.g.next,u.g||(u.h=null),g.next=null),g}class pe{constructor(){this.h=this.g=null}add(g,_){const P=Xe.get();P.set(g,_),this.h?this.h.next=P:this.g=P,this.h=P}}var Xe=new j(()=>new Ae,u=>u.reset());class Ae{constructor(){this.next=this.g=this.h=null}set(g,_){this.h=g,this.g=_,this.next=null}reset(){this.next=this.g=this.h=null}}let J,K=!1,z=new pe,Y=()=>{const u=l.Promise.resolve(void 0);J=()=>{u.then(V)}};var V=()=>{for(var u;u=I();){try{u.h.call(u.g)}catch(_){D(_)}var g=Xe;g.j(u),100>g.h&&(g.h++,u.next=g.g,g.g=u)}K=!1};function q(){this.s=this.s,this.C=this.C}q.prototype.s=!1,q.prototype.ma=function(){this.s||(this.s=!0,this.N())},q.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ae(u,g){this.type=u,this.g=this.target=g,this.defaultPrevented=!1}ae.prototype.h=function(){this.defaultPrevented=!0};var Ee=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var u=!1,g=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const _=()=>{};l.addEventListener("test",_,g),l.removeEventListener("test",_,g)}catch{}return u}();function L(u,g){if(ae.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var _=this.type=u.type,P=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=g,g=u.relatedTarget){if(O){e:{try{R(g.nodeName);var Q=!0;break e}catch{}Q=!1}Q||(g=null)}}else _=="mouseover"?g=u.fromElement:_=="mouseout"&&(g=u.toElement);this.relatedTarget=g,P?(this.clientX=P.clientX!==void 0?P.clientX:P.pageX,this.clientY=P.clientY!==void 0?P.clientY:P.pageY,this.screenX=P.screenX||0,this.screenY=P.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:B[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&L.aa.h.call(this)}}S(L,ae);var B={2:"touch",3:"pen",4:"mouse"};L.prototype.h=function(){L.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var G="closure_listenable_"+(1e6*Math.random()|0),ne=0;function de(u,g,_,P,Q){this.listener=u,this.proxy=null,this.src=g,this.type=_,this.capture=!!P,this.ha=Q,this.key=++ne,this.da=this.fa=!1}function Qe(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function nt(u){this.src=u,this.g={},this.h=0}nt.prototype.add=function(u,g,_,P,Q){var ee=u.toString();u=this.g[ee],u||(u=this.g[ee]=[],this.h++);var _e=je(u,g,P,Q);return-1<_e?(g=u[_e],_||(g.fa=!1)):(g=new de(g,this.src,ee,!!P,Q),g.fa=_,u.push(g)),g};function te(u,g){var _=g.type;if(_ in u.g){var P=u.g[_],Q=Array.prototype.indexOf.call(P,g,void 0),ee;(ee=0<=Q)&&Array.prototype.splice.call(P,Q,1),ee&&(Qe(g),u.g[_].length==0&&(delete u.g[_],u.h--))}}function je(u,g,_,P){for(var Q=0;Q<u.length;++Q){var ee=u[Q];if(!ee.da&&ee.listener==g&&ee.capture==!!_&&ee.ha==P)return Q}return-1}var Le="closure_lm_"+(1e6*Math.random()|0),mt={};function Ct(u,g,_,P,Q){if(Array.isArray(g)){for(var ee=0;ee<g.length;ee++)Ct(u,g[ee],_,P,Q);return null}return _=Vr(_),u&&u[G]?u.K(g,_,d(P)?!!P.capture:!1,Q):ze(u,g,_,!1,P,Q)}function ze(u,g,_,P,Q,ee){if(!g)throw Error("Invalid event type");var _e=d(Q)?!!Q.capture:!!Q,Kt=xr(u);if(Kt||(u[Le]=Kt=new nt(u)),_=Kt.add(g,_,P,_e,ee),_.proxy)return _;if(P=it(),_.proxy=P,P.src=u,P.listener=_,u.addEventListener)Ee||(Q=_e),Q===void 0&&(Q=!1),u.addEventListener(g.toString(),P,Q);else if(u.attachEvent)u.attachEvent(Xt(g.toString()),P);else if(u.addListener&&u.removeListener)u.addListener(P);else throw Error("addEventListener and attachEvent are unavailable.");return _}function it(){function u(_){return g.call(u.src,u.listener,_)}const g=Cn;return u}function jt(u,g,_,P,Q){if(Array.isArray(g))for(var ee=0;ee<g.length;ee++)jt(u,g[ee],_,P,Q);else P=d(P)?!!P.capture:!!P,_=Vr(_),u&&u[G]?(u=u.i,g=String(g).toString(),g in u.g&&(ee=u.g[g],_=je(ee,_,P,Q),-1<_&&(Qe(ee[_]),Array.prototype.splice.call(ee,_,1),ee.length==0&&(delete u.g[g],u.h--)))):u&&(u=xr(u))&&(g=u.g[g.toString()],u=-1,g&&(u=je(g,_,P,Q)),(_=-1<u?g[u]:null)&&Lt(_))}function Lt(u){if(typeof u!="number"&&u&&!u.da){var g=u.src;if(g&&g[G])te(g.i,u);else{var _=u.type,P=u.proxy;g.removeEventListener?g.removeEventListener(_,P,u.capture):g.detachEvent?g.detachEvent(Xt(_),P):g.addListener&&g.removeListener&&g.removeListener(P),(_=xr(g))?(te(_,u),_.h==0&&(_.src=null,g[Le]=null)):Qe(u)}}}function Xt(u){return u in mt?mt[u]:mt[u]="on"+u}function Cn(u,g){if(u.da)u=!0;else{g=new L(g,this);var _=u.listener,P=u.ha||u.src;u.fa&&Lt(u),u=_.call(P,g)}return u}function xr(u){return u=u[Le],u instanceof nt?u:null}var zn="__closure_events_fn_"+(1e9*Math.random()>>>0);function Vr(u){return typeof u=="function"?u:(u[zn]||(u[zn]=function(g){return u.handleEvent(g)}),u[zn])}function tn(){q.call(this),this.i=new nt(this),this.M=this,this.F=null}S(tn,q),tn.prototype[G]=!0,tn.prototype.removeEventListener=function(u,g,_,P){jt(this,u,g,_,P)};function xn(u,g){var _,P=u.F;if(P)for(_=[];P;P=P.F)_.push(P);if(u=u.M,P=g.type||g,typeof g=="string")g=new ae(g,u);else if(g instanceof ae)g.target=g.target||u;else{var Q=g;g=new ae(P,u),E(g,Q)}if(Q=!0,_)for(var ee=_.length-1;0<=ee;ee--){var _e=g.g=_[ee];Q=as(_e,P,!0,g)&&Q}if(_e=g.g=u,Q=as(_e,P,!0,g)&&Q,Q=as(_e,P,!1,g)&&Q,_)for(ee=0;ee<_.length;ee++)_e=g.g=_[ee],Q=as(_e,P,!1,g)&&Q}tn.prototype.N=function(){if(tn.aa.N.call(this),this.i){var u=this.i,g;for(g in u.g){for(var _=u.g[g],P=0;P<_.length;P++)Qe(_[P]);delete u.g[g],u.h--}}this.F=null},tn.prototype.K=function(u,g,_,P){return this.i.add(String(u),g,!1,_,P)},tn.prototype.L=function(u,g,_,P){return this.i.add(String(u),g,!0,_,P)};function as(u,g,_,P){if(g=u.i.g[String(g)],!g)return!0;g=g.concat();for(var Q=!0,ee=0;ee<g.length;++ee){var _e=g[ee];if(_e&&!_e.da&&_e.capture==_){var Kt=_e.listener,hr=_e.ha||_e.src;_e.fa&&te(u.i,_e),Q=Kt.call(hr,P)!==!1&&Q}}return Q&&!P.defaultPrevented}function tr(u,g,_){if(typeof u=="function")_&&(u=p(u,_));else if(u&&typeof u.handleEvent=="function")u=p(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(g)?-1:l.setTimeout(u,g||0)}function Ur(u){u.g=tr(()=>{u.g=null,u.i&&(u.i=!1,Ur(u))},u.l);const g=u.h;u.h=null,u.m.apply(null,g)}class ri extends q{constructor(g,_){super(),this.m=g,this.l=_,this.h=null,this.i=!1,this.g=null}j(g){this.h=arguments,this.g?this.i=!0:Ur(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function St(u){q.call(this),this.h=u,this.g={}}S(St,q);var ji=[];function qe(u){M(u.g,function(g,_){this.g.hasOwnProperty(_)&&Lt(g)},u),u.g={}}St.prototype.N=function(){St.aa.N.call(this),qe(this)},St.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var wn=l.JSON.stringify,Gn=l.JSON.parse,Dn=class{stringify(u){return l.JSON.stringify(u,void 0)}parse(u){return l.JSON.parse(u,void 0)}};function Hn(){}Hn.prototype.h=null;function Ei(u){return u.h||(u.h=u.i())}function Cs(){}var nr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function os(){ae.call(this,"d")}S(os,ae);function ls(){ae.call(this,"c")}S(ls,ae);var Br={},$=null;function Z(){return $=$||new tn}Br.La="serverreachability";function X(u){ae.call(this,Br.La,u)}S(X,ae);function oe(u){const g=Z();xn(g,new X(g))}Br.STAT_EVENT="statevent";function ye(u,g){ae.call(this,Br.STAT_EVENT,u),this.stat=g}S(ye,ae);function Re(u){const g=Z();xn(g,new ye(g,u))}Br.Ma="timingevent";function me(u,g){ae.call(this,Br.Ma,u),this.size=g}S(me,ae);function We(u,g){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){u()},g)}function Rt(){this.g=!0}Rt.prototype.xa=function(){this.g=!1};function Pt(u,g,_,P,Q,ee){u.info(function(){if(u.g)if(ee)for(var _e="",Kt=ee.split("&"),hr=0;hr<Kt.length;hr++){var It=Kt[hr].split("=");if(1<It.length){var _r=It[0];It=It[1];var jr=_r.split("_");_e=2<=jr.length&&jr[1]=="type"?_e+(_r+"="+It+"&"):_e+(_r+"=redacted&")}}else _e=null;else _e=ee;return"XMLHTTP REQ ("+P+") [attempt "+Q+"]: "+g+`
`+_+`
`+_e})}function wr(u,g,_,P,Q,ee,_e){u.info(function(){return"XMLHTTP RESP ("+P+") [ attempt "+Q+"]: "+g+`
`+_+`
`+ee+" "+_e})}function Ln(u,g,_,P){u.info(function(){return"XMLHTTP TEXT ("+g+"): "+Qr(u,_)+(P?" "+P:"")})}function rr(u,g){u.info(function(){return"TIMEOUT: "+g})}Rt.prototype.info=function(){};function Qr(u,g){if(!u.g)return g;if(!g)return null;try{var _=JSON.parse(g);if(_){for(u=0;u<_.length;u++)if(Array.isArray(_[u])){var P=_[u];if(!(2>P.length)){var Q=P[1];if(Array.isArray(Q)&&!(1>Q.length)){var ee=Q[0];if(ee!="noop"&&ee!="stop"&&ee!="close")for(var _e=1;_e<Q.length;_e++)Q[_e]=""}}}}return wn(_)}catch{return g}}var sr={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Yr={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},xt;function qn(){}S(qn,Hn),qn.prototype.g=function(){return new XMLHttpRequest},qn.prototype.i=function(){return{}},xt=new qn;function On(u,g,_,P){this.j=u,this.i=g,this.l=_,this.R=P||1,this.U=new St(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Jr}function Jr(){this.i=null,this.g="",this.h=!1}var bn={},Ss={};function Be(u,g,_){u.L=1,u.v=lt(re(g)),u.m=_,u.P=!0,Ue(u,null)}function Ue(u,g){u.F=Date.now(),Ze(u),u.A=re(u.v);var _=u.A,P=u.R;Array.isArray(P)||(P=[String(P)]),ke(_.i,"t",P),u.C=0,_=u.j.J,u.h=new Jr,u.g=Rx(u.j,_?g:null,!u.m),0<u.O&&(u.M=new ri(p(u.Y,u,u.g),u.O)),g=u.U,_=u.g,P=u.ca;var Q="readystatechange";Array.isArray(Q)||(Q&&(ji[0]=Q.toString()),Q=ji);for(var ee=0;ee<Q.length;ee++){var _e=Ct(_,Q[ee],P||g.handleEvent,!1,g.h||g);if(!_e)break;g.g[_e.key]=_e}g=u.H?x(u.H):{},u.m?(u.u||(u.u="POST"),g["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,g)):(u.u="GET",u.g.ea(u.A,u.u,null,g)),oe(),Pt(u.i,u.u,u.A,u.l,u.R,u.m)}On.prototype.ca=function(u){u=u.target;const g=this.M;g&&Nn(u)==3?g.j():this.Y(u)},On.prototype.Y=function(u){try{if(u==this.g)e:{const jr=Nn(this.g);var g=this.g.Ba();const Fo=this.g.Z();if(!(3>jr)&&(jr!=3||this.g&&(this.h.h||this.g.oa()||Lo(this.g)))){this.J||jr!=4||g==7||(g==8||0>=Fo?oe(3):oe(2)),Dt(this);var _=this.g.Z();this.X=_;t:if(st(this)){var P=Lo(this.g);u="";var Q=P.length,ee=Nn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){fn(this),an(this);var _e="";break t}this.h.i=new l.TextDecoder}for(g=0;g<Q;g++)this.h.h=!0,u+=this.h.i.decode(P[g],{stream:!(ee&&g==Q-1)});P.length=0,this.h.g+=u,this.C=0,_e=this.h.g}else _e=this.g.oa();if(this.o=_==200,wr(this.i,this.u,this.A,this.l,this.R,jr,_),this.o){if(this.T&&!this.K){t:{if(this.g){var Kt,hr=this.g;if((Kt=hr.g?hr.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!y(Kt)){var It=Kt;break t}}It=null}if(_=It)Ln(this.i,this.l,_,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ir(this,_);else{this.o=!1,this.s=3,Re(12),fn(this),an(this);break e}}if(this.P){_=!0;let Us;for(;!this.J&&this.C<_e.length;)if(Us=Ve(this,_e),Us==Ss){jr==4&&(this.s=4,Re(14),_=!1),Ln(this.i,this.l,null,"[Incomplete Response]");break}else if(Us==bn){this.s=4,Re(15),Ln(this.i,this.l,_e,"[Invalid Chunk]"),_=!1;break}else Ln(this.i,this.l,Us,null),ir(this,Us);if(st(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),jr!=4||_e.length!=0||this.h.h||(this.s=1,Re(16),_=!1),this.o=this.o&&_,!_)Ln(this.i,this.l,_e,"[Invalid Chunked Response]"),fn(this),an(this);else if(0<_e.length&&!this.W){this.W=!0;var _r=this.j;_r.g==this&&_r.ba&&!_r.M&&(_r.j.info("Great, no buffering proxy detected. Bytes received: "+_e.length),cp(_r),_r.M=!0,Re(11))}}else Ln(this.i,this.l,_e,null),ir(this,_e);jr==4&&fn(this),this.o&&!this.J&&(jr==4?Nx(this.j,this):(this.o=!1,Ze(this)))}else Oo(this.g),_==400&&0<_e.indexOf("Unknown SID")?(this.s=3,Re(12)):(this.s=0,Re(13)),fn(this),an(this)}}}catch{}finally{}};function st(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function Ve(u,g){var _=u.C,P=g.indexOf(`
`,_);return P==-1?Ss:(_=Number(g.substring(_,P)),isNaN(_)?bn:(P+=1,P+_>g.length?Ss:(g=g.slice(P,P+_),u.C=P+_,g)))}On.prototype.cancel=function(){this.J=!0,fn(this)};function Ze(u){u.S=Date.now()+u.I,Et(u,u.I)}function Et(u,g){if(u.B!=null)throw Error("WatchDog timer not null");u.B=We(p(u.ba,u),g)}function Dt(u){u.B&&(l.clearTimeout(u.B),u.B=null)}On.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(rr(this.i,this.A),this.L!=2&&(oe(),Re(17)),fn(this),this.s=2,an(this)):Et(this,this.S-u)};function an(u){u.j.G==0||u.J||Nx(u.j,u)}function fn(u){Dt(u);var g=u.M;g&&typeof g.ma=="function"&&g.ma(),u.M=null,qe(u.U),u.g&&(g=u.g,u.g=null,g.abort(),g.ma())}function ir(u,g){try{var _=u.j;if(_.G!=0&&(_.g==u||Se(_.h,u))){if(!u.K&&Se(_.h,u)&&_.G==3){try{var P=_.Da.g.parse(g)}catch{P=null}if(Array.isArray(P)&&P.length==3){var Q=P;if(Q[0]==0){e:if(!_.u){if(_.g)if(_.g.F+3e3<u.F)rd(_),td(_);else break e;lp(_),Re(18)}}else _.za=Q[1],0<_.za-_.T&&37500>Q[2]&&_.F&&_.v==0&&!_.C&&(_.C=We(p(_.Za,_),6e3));if(1>=wt(_.h)&&_.ca){try{_.ca()}catch{}_.ca=void 0}}else Wa(_,11)}else if((u.K||_.g==u)&&rd(_),!y(g))for(Q=_.Da.g.parse(g),g=0;g<Q.length;g++){let It=Q[g];if(_.T=It[0],It=It[1],_.G==2)if(It[0]=="c"){_.K=It[1],_.ia=It[2];const _r=It[3];_r!=null&&(_.la=_r,_.j.info("VER="+_.la));const jr=It[4];jr!=null&&(_.Aa=jr,_.j.info("SVER="+_.Aa));const Fo=It[5];Fo!=null&&typeof Fo=="number"&&0<Fo&&(P=1.5*Fo,_.L=P,_.j.info("backChannelRequestTimeoutMs_="+P)),P=_;const Us=u.g;if(Us){const id=Us.g?Us.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(id){var ee=P.h;ee.g||id.indexOf("spdy")==-1&&id.indexOf("quic")==-1&&id.indexOf("h2")==-1||(ee.j=ee.l,ee.g=new Set,ee.h&&(Qt(ee,ee.h),ee.h=null))}if(P.D){const up=Us.g?Us.g.getResponseHeader("X-HTTP-Session-Id"):null;up&&(P.ya=up,xe(P.I,P.D,up))}}_.G=3,_.l&&_.l.ua(),_.ba&&(_.R=Date.now()-u.F,_.j.info("Handshake RTT: "+_.R+"ms")),P=_;var _e=u;if(P.qa=Ax(P,P.J?P.ia:null,P.W),_e.K){on(P.h,_e);var Kt=_e,hr=P.L;hr&&(Kt.I=hr),Kt.B&&(Dt(Kt),Ze(Kt)),P.g=_e}else Cx(P);0<_.i.length&&nd(_)}else It[0]!="stop"&&It[0]!="close"||Wa(_,7);else _.G==3&&(It[0]=="stop"||It[0]=="close"?It[0]=="stop"?Wa(_,7):op(_):It[0]!="noop"&&_.l&&_.l.ta(It),_.v=0)}}oe(4)}catch{}}var _n=class{constructor(u,g){this.g=u,this.map=g}};function ar(u){this.l=u||10,l.PerformanceNavigationTiming?(u=l.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ce(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function wt(u){return u.h?1:u.g?u.g.size:0}function Se(u,g){return u.h?u.h==g:u.g?u.g.has(g):!1}function Qt(u,g){u.g?u.g.add(g):u.h=g}function on(u,g){u.h&&u.h==g?u.h=null:u.g&&u.g.has(g)&&u.g.delete(g)}ar.prototype.cancel=function(){if(this.i=Ot(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function Ot(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let g=u.i;for(const _ of u.g.values())g=g.concat(_.D);return g}return T(u.i)}function Wn(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(c(u)){for(var g=[],_=u.length,P=0;P<_;P++)g.push(u[P]);return g}g=[],_=0;for(P in u)g[_++]=u[P];return g}function or(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(c(u)||typeof u=="string"){var g=[];u=u.length;for(var _=0;_<u;_++)g.push(_);return g}g=[],_=0;for(const P in u)g[_++]=P;return g}}}function Bt(u,g){if(u.forEach&&typeof u.forEach=="function")u.forEach(g,void 0);else if(c(u)||typeof u=="string")Array.prototype.forEach.call(u,g,void 0);else for(var _=or(u),P=Wn(u),Q=P.length,ee=0;ee<Q;ee++)g.call(void 0,P[ee],_&&_[ee],u)}var A=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function H(u,g){if(u){u=u.split("&");for(var _=0;_<u.length;_++){var P=u[_].indexOf("="),Q=null;if(0<=P){var ee=u[_].substring(0,P);Q=u[_].substring(P+1)}else ee=u[_];g(ee,Q?decodeURIComponent(Q.replace(/\+/g," ")):"")}}}function U(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof U){this.h=u.h,se(this,u.j),this.o=u.o,this.g=u.g,ve(this,u.s),this.l=u.l;var g=u.i,_=new W;_.i=g.i,g.g&&(_.g=new Map(g.g),_.h=g.h),we(this,_),this.m=u.m}else u&&(g=String(u).match(A))?(this.h=!1,se(this,g[1]||"",!0),this.o=Tt(g[2]||""),this.g=Tt(g[3]||"",!0),ve(this,g[4]),this.l=Tt(g[5]||"",!0),we(this,g[6]||"",!0),this.m=Tt(g[7]||"")):(this.h=!1,this.i=new W(null,this.h))}U.prototype.toString=function(){var u=[],g=this.j;g&&u.push(ft(g,Sn,!0),":");var _=this.g;return(_||g=="file")&&(u.push("//"),(g=this.o)&&u.push(ft(g,Sn,!0),"@"),u.push(encodeURIComponent(String(_)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),_=this.s,_!=null&&u.push(":",String(_))),(_=this.l)&&(this.g&&_.charAt(0)!="/"&&u.push("/"),u.push(ft(_,_.charAt(0)=="/"?cr:lr,!0))),(_=this.i.toString())&&u.push("?",_),(_=this.m)&&u.push("#",ft(_,ki)),u.join("")};function re(u){return new U(u)}function se(u,g,_){u.j=_?Tt(g,!0):g,u.j&&(u.j=u.j.replace(/:$/,""))}function ve(u,g){if(g){if(g=Number(g),isNaN(g)||0>g)throw Error("Bad port number "+g);u.s=g}else u.s=null}function we(u,g,_){g instanceof W?(u.i=g,at(u.i,u.h)):(_||(g=ft(g,Do)),u.i=new W(g,u.h))}function xe(u,g,_){u.i.set(g,_)}function lt(u){return xe(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function Tt(u,g){return u?g?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function ft(u,g,_){return typeof u=="string"?(u=encodeURI(u).replace(g,zt),_&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function zt(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var Sn=/[#\/\?@]/g,lr=/[#\?:]/g,cr=/[#\?]/g,Do=/[#\?@]/g,ki=/#/g;function W(u,g){this.h=this.g=null,this.i=u||null,this.j=!!g}function he(u){u.g||(u.g=new Map,u.h=0,u.i&&H(u.i,function(g,_){u.add(decodeURIComponent(g.replace(/\+/g," ")),_)}))}t=W.prototype,t.add=function(u,g){he(this),this.i=null,u=De(this,u);var _=this.g.get(u);return _||this.g.set(u,_=[]),_.push(g),this.h+=1,this};function le(u,g){he(u),g=De(u,g),u.g.has(g)&&(u.i=null,u.h-=u.g.get(g).length,u.g.delete(g))}function Me(u,g){return he(u),g=De(u,g),u.g.has(g)}t.forEach=function(u,g){he(this),this.g.forEach(function(_,P){_.forEach(function(Q){u.call(g,Q,P,this)},this)},this)},t.na=function(){he(this);const u=Array.from(this.g.values()),g=Array.from(this.g.keys()),_=[];for(let P=0;P<g.length;P++){const Q=u[P];for(let ee=0;ee<Q.length;ee++)_.push(g[P])}return _},t.V=function(u){he(this);let g=[];if(typeof u=="string")Me(this,u)&&(g=g.concat(this.g.get(De(this,u))));else{u=Array.from(this.g.values());for(let _=0;_<u.length;_++)g=g.concat(u[_])}return g},t.set=function(u,g){return he(this),this.i=null,u=De(this,u),Me(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[g]),this.h+=1,this},t.get=function(u,g){return u?(u=this.V(u),0<u.length?String(u[0]):g):g};function ke(u,g,_){le(u,g),0<_.length&&(u.i=null,u.g.set(De(u,g),T(_)),u.h+=_.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],g=Array.from(this.g.keys());for(var _=0;_<g.length;_++){var P=g[_];const ee=encodeURIComponent(String(P)),_e=this.V(P);for(P=0;P<_e.length;P++){var Q=ee;_e[P]!==""&&(Q+="="+encodeURIComponent(String(_e[P]))),u.push(Q)}}return this.i=u.join("&")};function De(u,g){return g=String(g),u.j&&(g=g.toLowerCase()),g}function at(u,g){g&&!u.j&&(he(u),u.i=null,u.g.forEach(function(_,P){var Q=P.toLowerCase();P!=Q&&(le(this,P),ke(this,Q,_))},u)),u.j=g}function ot(u,g){const _=new Rt;if(l.Image){const P=new Image;P.onload=k(gt,_,"TestLoadImage: loaded",!0,g,P),P.onerror=k(gt,_,"TestLoadImage: error",!1,g,P),P.onabort=k(gt,_,"TestLoadImage: abort",!1,g,P),P.ontimeout=k(gt,_,"TestLoadImage: timeout",!1,g,P),l.setTimeout(function(){P.ontimeout&&P.ontimeout()},1e4),P.src=u}else g(!1)}function Gt(u,g){const _=new Rt,P=new AbortController,Q=setTimeout(()=>{P.abort(),gt(_,"TestPingServer: timeout",!1,g)},1e4);fetch(u,{signal:P.signal}).then(ee=>{clearTimeout(Q),ee.ok?gt(_,"TestPingServer: ok",!0,g):gt(_,"TestPingServer: server error",!1,g)}).catch(()=>{clearTimeout(Q),gt(_,"TestPingServer: error",!1,g)})}function gt(u,g,_,P,Q){try{Q&&(Q.onload=null,Q.onerror=null,Q.onabort=null,Q.ontimeout=null),P(_)}catch{}}function Ns(){this.g=new Dn}function qa(u,g,_){const P=_||"";try{Bt(u,function(Q,ee){let _e=Q;d(Q)&&(_e=wn(Q)),g.push(P+ee+"="+encodeURIComponent(_e))})}catch(Q){throw g.push(P+"type="+encodeURIComponent("_badmap")),Q}}function Ts(u){this.l=u.Ub||null,this.j=u.eb||!1}S(Ts,Hn),Ts.prototype.g=function(){return new si(this.l,this.j)},Ts.prototype.i=function(u){return function(){return u}}({});function si(u,g){tn.call(this),this.D=u,this.o=g,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}S(si,tn),t=si.prototype,t.open=function(u,g){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=g,this.readyState=1,us(this)},t.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const g={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(g.body=u),(this.D||l).fetch(new Request(this.A,g)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,cs(this)),this.readyState=0},t.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,us(this)),this.g&&(this.readyState=3,us(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Ci(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function Ci(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}t.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var g=u.value?u.value:new Uint8Array(0);(g=this.v.decode(g,{stream:!u.done}))&&(this.response=this.responseText+=g)}u.done?cs(this):us(this),this.readyState==3&&Ci(this)}},t.Ra=function(u){this.g&&(this.response=this.responseText=u,cs(this))},t.Qa=function(u){this.g&&(this.response=u,cs(this))},t.ga=function(){this.g&&cs(this)};function cs(u){u.readyState=4,u.l=null,u.j=null,u.v=null,us(u)}t.setRequestHeader=function(u,g){this.u.append(u,g)},t.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],g=this.h.entries();for(var _=g.next();!_.done;)_=_.value,u.push(_[0]+": "+_[1]),_=g.next();return u.join(`\r
`)};function us(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(si.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function Si(u){let g="";return M(u,function(_,P){g+=P,g+=":",g+=_,g+=`\r
`}),g}function Vs(u,g,_){e:{for(P in _){var P=!1;break e}P=!0}P||(_=Si(_),typeof u=="string"?_!=null&&encodeURIComponent(String(_)):xe(u,g,_))}function Ht(u){tn.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}S(Ht,tn);var Ji=/^https?$/i,ur=["POST","PUT"];t=Ht.prototype,t.Ha=function(u){this.J=u},t.ea=function(u,g,_,P){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);g=g?g.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():xt.g(),this.v=this.o?Ei(this.o):Ei(xt),this.g.onreadystatechange=p(this.Ea,this);try{this.B=!0,this.g.open(g,String(u),!0),this.B=!1}catch(ee){et(this,ee);return}if(u=_||"",_=new Map(this.headers),P)if(Object.getPrototypeOf(P)===Object.prototype)for(var Q in P)_.set(Q,P[Q]);else if(typeof P.keys=="function"&&typeof P.get=="function")for(const ee of P.keys())_.set(ee,P.get(ee));else throw Error("Unknown input type for opt_headers: "+String(P));P=Array.from(_.keys()).find(ee=>ee.toLowerCase()=="content-type"),Q=l.FormData&&u instanceof l.FormData,!(0<=Array.prototype.indexOf.call(ur,g,void 0))||P||Q||_.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ee,_e]of _)this.g.setRequestHeader(ee,_e);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{br(this),this.u=!0,this.g.send(u),this.u=!1}catch(ee){et(this,ee)}};function et(u,g){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=g,u.m=5,Wt(u),dr(u)}function Wt(u){u.A||(u.A=!0,xn(u,"complete"),xn(u,"error"))}t.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,xn(this,"complete"),xn(this,"abort"),dr(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),dr(this,!0)),Ht.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?Mn(this):this.bb())},t.bb=function(){Mn(this)};function Mn(u){if(u.h&&typeof o<"u"&&(!u.v[1]||Nn(u)!=4||u.Z()!=2)){if(u.u&&Nn(u)==4)tr(u.Ea,0,u);else if(xn(u,"readystatechange"),Nn(u)==4){u.h=!1;try{const _e=u.Z();e:switch(_e){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var g=!0;break e;default:g=!1}var _;if(!(_=g)){var P;if(P=_e===0){var Q=String(u.D).match(A)[1]||null;!Q&&l.self&&l.self.location&&(Q=l.self.location.protocol.slice(0,-1)),P=!Ji.test(Q?Q.toLowerCase():"")}_=P}if(_)xn(u,"complete"),xn(u,"success");else{u.m=6;try{var ee=2<Nn(u)?u.g.statusText:""}catch{ee=""}u.l=ee+" ["+u.Z()+"]",Wt(u)}}finally{dr(u)}}}}function dr(u,g){if(u.g){br(u);const _=u.g,P=u.v[0]?()=>{}:null;u.g=null,u.v=null,g||xn(u,"ready");try{_.onreadystatechange=P}catch{}}}function br(u){u.I&&(l.clearTimeout(u.I),u.I=null)}t.isActive=function(){return!!this.g};function Nn(u){return u.g?u.g.readyState:0}t.Z=function(){try{return 2<Nn(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(u){if(this.g){var g=this.g.responseText;return u&&g.indexOf(u)==0&&(g=g.substring(u.length)),Gn(g)}};function Lo(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function Oo(u){const g={};u=(u.g&&2<=Nn(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let P=0;P<u.length;P++){if(y(u[P]))continue;var _=N(u[P]);const Q=_[0];if(_=_[1],typeof _!="string")continue;_=_.trim();const ee=g[Q]||[];g[Q]=ee,ee.push(_)}b(g,function(P){return P.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function tc(u,g,_){return _&&_.internalChannelParams&&_.internalChannelParams[u]||g}function _x(u){this.Aa=0,this.i=[],this.j=new Rt,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=tc("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=tc("baseRetryDelayMs",5e3,u),this.cb=tc("retryDelaySeedMs",1e4,u),this.Wa=tc("forwardChannelMaxRetries",2,u),this.wa=tc("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new ar(u&&u.concurrentRequestLimit),this.Da=new Ns,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=_x.prototype,t.la=8,t.G=1,t.connect=function(u,g,_,P){Re(0),this.W=u,this.H=g||{},_&&P!==void 0&&(this.H.OSID=_,this.H.OAID=P),this.F=this.X,this.I=Ax(this,null,this.W),nd(this)};function op(u){if(jx(u),u.G==3){var g=u.U++,_=re(u.I);if(xe(_,"SID",u.K),xe(_,"RID",g),xe(_,"TYPE","terminate"),nc(u,_),g=new On(u,u.j,g),g.L=2,g.v=lt(re(_)),_=!1,l.navigator&&l.navigator.sendBeacon)try{_=l.navigator.sendBeacon(g.v.toString(),"")}catch{}!_&&l.Image&&(new Image().src=g.v,_=!0),_||(g.g=Rx(g.j,null),g.g.ea(g.v)),g.F=Date.now(),Ze(g)}Ix(u)}function td(u){u.g&&(cp(u),u.g.cancel(),u.g=null)}function jx(u){td(u),u.u&&(l.clearTimeout(u.u),u.u=null),rd(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&l.clearTimeout(u.s),u.s=null)}function nd(u){if(!Ce(u.h)&&!u.s){u.s=!0;var g=u.Ga;J||Y(),K||(J(),K=!0),z.add(g,u),u.B=0}}function SS(u,g){return wt(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=g.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=We(p(u.Ga,u,g),Tx(u,u.B)),u.B++,!0)}t.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const Q=new On(this,this.j,u);let ee=this.o;if(this.S&&(ee?(ee=x(ee),E(ee,this.S)):ee=this.S),this.m!==null||this.O||(Q.H=ee,ee=null),this.P)e:{for(var g=0,_=0;_<this.i.length;_++){t:{var P=this.i[_];if("__data__"in P.map&&(P=P.map.__data__,typeof P=="string")){P=P.length;break t}P=void 0}if(P===void 0)break;if(g+=P,4096<g){g=_;break e}if(g===4096||_===this.i.length-1){g=_+1;break e}}g=1e3}else g=1e3;g=kx(this,Q,g),_=re(this.I),xe(_,"RID",u),xe(_,"CVER",22),this.D&&xe(_,"X-HTTP-Session-Id",this.D),nc(this,_),ee&&(this.O?g="headers="+encodeURIComponent(String(Si(ee)))+"&"+g:this.m&&Vs(_,this.m,ee)),Qt(this.h,Q),this.Ua&&xe(_,"TYPE","init"),this.P?(xe(_,"$req",g),xe(_,"SID","null"),Q.T=!0,Be(Q,_,null)):Be(Q,_,g),this.G=2}}else this.G==3&&(u?Ex(this,u):this.i.length==0||Ce(this.h)||Ex(this))};function Ex(u,g){var _;g?_=g.l:_=u.U++;const P=re(u.I);xe(P,"SID",u.K),xe(P,"RID",_),xe(P,"AID",u.T),nc(u,P),u.m&&u.o&&Vs(P,u.m,u.o),_=new On(u,u.j,_,u.B+1),u.m===null&&(_.H=u.o),g&&(u.i=g.D.concat(u.i)),g=kx(u,_,1e3),_.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),Qt(u.h,_),Be(_,P,g)}function nc(u,g){u.H&&M(u.H,function(_,P){xe(g,P,_)}),u.l&&Bt({},function(_,P){xe(g,P,_)})}function kx(u,g,_){_=Math.min(u.i.length,_);var P=u.l?p(u.l.Na,u.l,u):null;e:{var Q=u.i;let ee=-1;for(;;){const _e=["count="+_];ee==-1?0<_?(ee=Q[0].g,_e.push("ofs="+ee)):ee=0:_e.push("ofs="+ee);let Kt=!0;for(let hr=0;hr<_;hr++){let It=Q[hr].g;const _r=Q[hr].map;if(It-=ee,0>It)ee=Math.max(0,Q[hr].g-100),Kt=!1;else try{qa(_r,_e,"req"+It+"_")}catch{P&&P(_r)}}if(Kt){P=_e.join("&");break e}}}return u=u.i.splice(0,_),g.D=u,P}function Cx(u){if(!u.g&&!u.u){u.Y=1;var g=u.Fa;J||Y(),K||(J(),K=!0),z.add(g,u),u.v=0}}function lp(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=We(p(u.Fa,u),Tx(u,u.v)),u.v++,!0)}t.Fa=function(){if(this.u=null,Sx(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=We(p(this.ab,this),u)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Re(10),td(this),Sx(this))};function cp(u){u.A!=null&&(l.clearTimeout(u.A),u.A=null)}function Sx(u){u.g=new On(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var g=re(u.qa);xe(g,"RID","rpc"),xe(g,"SID",u.K),xe(g,"AID",u.T),xe(g,"CI",u.F?"0":"1"),!u.F&&u.ja&&xe(g,"TO",u.ja),xe(g,"TYPE","xmlhttp"),nc(u,g),u.m&&u.o&&Vs(g,u.m,u.o),u.L&&(u.g.I=u.L);var _=u.g;u=u.ia,_.L=1,_.v=lt(re(g)),_.m=null,_.P=!0,Ue(_,u)}t.Za=function(){this.C!=null&&(this.C=null,td(this),lp(this),Re(19))};function rd(u){u.C!=null&&(l.clearTimeout(u.C),u.C=null)}function Nx(u,g){var _=null;if(u.g==g){rd(u),cp(u),u.g=null;var P=2}else if(Se(u.h,g))_=g.D,on(u.h,g),P=1;else return;if(u.G!=0){if(g.o)if(P==1){_=g.m?g.m.length:0,g=Date.now()-g.F;var Q=u.B;P=Z(),xn(P,new me(P,_)),nd(u)}else Cx(u);else if(Q=g.s,Q==3||Q==0&&0<g.X||!(P==1&&SS(u,g)||P==2&&lp(u)))switch(_&&0<_.length&&(g=u.h,g.i=g.i.concat(_)),Q){case 1:Wa(u,5);break;case 4:Wa(u,10);break;case 3:Wa(u,6);break;default:Wa(u,2)}}}function Tx(u,g){let _=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(_*=2),_*g}function Wa(u,g){if(u.j.info("Error code "+g),g==2){var _=p(u.fb,u),P=u.Xa;const Q=!P;P=new U(P||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||se(P,"https"),lt(P),Q?ot(P.toString(),_):Gt(P.toString(),_)}else Re(2);u.G=0,u.l&&u.l.sa(g),Ix(u),jx(u)}t.fb=function(u){u?(this.j.info("Successfully pinged google.com"),Re(2)):(this.j.info("Failed to ping google.com"),Re(1))};function Ix(u){if(u.G=0,u.ka=[],u.l){const g=Ot(u.h);(g.length!=0||u.i.length!=0)&&(C(u.ka,g),C(u.ka,u.i),u.h.i.length=0,T(u.i),u.i.length=0),u.l.ra()}}function Ax(u,g,_){var P=_ instanceof U?re(_):new U(_);if(P.g!="")g&&(P.g=g+"."+P.g),ve(P,P.s);else{var Q=l.location;P=Q.protocol,g=g?g+"."+Q.hostname:Q.hostname,Q=+Q.port;var ee=new U(null);P&&se(ee,P),g&&(ee.g=g),Q&&ve(ee,Q),_&&(ee.l=_),P=ee}return _=u.D,g=u.ya,_&&g&&xe(P,_,g),xe(P,"VER",u.la),nc(u,P),P}function Rx(u,g,_){if(g&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return g=u.Ca&&!u.pa?new Ht(new Ts({eb:_})):new Ht(u.pa),g.Ha(u.J),g}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Px(){}t=Px.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function sd(){}sd.prototype.g=function(u,g){return new ds(u,g)};function ds(u,g){tn.call(this),this.g=new _x(g),this.l=u,this.h=g&&g.messageUrlParams||null,u=g&&g.messageHeaders||null,g&&g.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=g&&g.initMessageHeaders||null,g&&g.messageContentType&&(u?u["X-WebChannel-Content-Type"]=g.messageContentType:u={"X-WebChannel-Content-Type":g.messageContentType}),g&&g.va&&(u?u["X-WebChannel-Client-Profile"]=g.va:u={"X-WebChannel-Client-Profile":g.va}),this.g.S=u,(u=g&&g.Sb)&&!y(u)&&(this.g.m=u),this.v=g&&g.supportsCrossDomainXhr||!1,this.u=g&&g.sendRawJson||!1,(g=g&&g.httpSessionIdParam)&&!y(g)&&(this.g.D=g,u=this.h,u!==null&&g in u&&(u=this.h,g in u&&delete u[g])),this.j=new Mo(this)}S(ds,tn),ds.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},ds.prototype.close=function(){op(this.g)},ds.prototype.o=function(u){var g=this.g;if(typeof u=="string"){var _={};_.__data__=u,u=_}else this.u&&(_={},_.__data__=wn(u),u=_);g.i.push(new _n(g.Ya++,u)),g.G==3&&nd(g)},ds.prototype.N=function(){this.g.l=null,delete this.j,op(this.g),delete this.g,ds.aa.N.call(this)};function Dx(u){os.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var g=u.__sm__;if(g){e:{for(const _ in g){u=_;break e}u=void 0}(this.i=u)&&(u=this.i,g=g!==null&&u in g?g[u]:void 0),this.data=g}else this.data=u}S(Dx,os);function Lx(){ls.call(this),this.status=1}S(Lx,ls);function Mo(u){this.g=u}S(Mo,Px),Mo.prototype.ua=function(){xn(this.g,"a")},Mo.prototype.ta=function(u){xn(this.g,new Dx(u))},Mo.prototype.sa=function(u){xn(this.g,new Lx)},Mo.prototype.ra=function(){xn(this.g,"b")},sd.prototype.createWebChannel=sd.prototype.g,ds.prototype.send=ds.prototype.o,ds.prototype.open=ds.prototype.m,ds.prototype.close=ds.prototype.close,ek=function(){return new sd},ZE=function(){return Z()},XE=Br,mg={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},sr.NO_ERROR=0,sr.TIMEOUT=8,sr.HTTP_ERROR=6,Zd=sr,Yr.COMPLETE="complete",JE=Yr,Cs.EventType=nr,nr.OPEN="a",nr.CLOSE="b",nr.ERROR="c",nr.MESSAGE="d",tn.prototype.listen=tn.prototype.K,bc=Cs,Ht.prototype.listenOnce=Ht.prototype.L,Ht.prototype.getLastError=Ht.prototype.Ka,Ht.prototype.getLastErrorCode=Ht.prototype.Ba,Ht.prototype.getStatus=Ht.prototype.Z,Ht.prototype.getResponseJson=Ht.prototype.Oa,Ht.prototype.getResponseText=Ht.prototype.oa,Ht.prototype.send=Ht.prototype.ea,Ht.prototype.setWithCredentials=Ht.prototype.Ha,YE=Ht}).apply(typeof Ed<"u"?Ed:typeof self<"u"?self:typeof window<"u"?window:{});const Pb="@firebase/firestore",Db="4.7.14";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sr{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Sr.UNAUTHENTICATED=new Sr(null),Sr.GOOGLE_CREDENTIALS=new Sr("google-credentials-uid"),Sr.FIRST_PARTY=new Sr("first-party-uid"),Sr.MOCK_USER=new Sr("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Hl="11.7.3";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wo=new zy("@firebase/firestore");function Bo(){return wo.logLevel}function Pe(t,...e){if(wo.logLevel<=yt.DEBUG){const n=e.map(lv);wo.debug(`Firestore (${Hl}): ${t}`,...n)}}function Hi(t,...e){if(wo.logLevel<=yt.ERROR){const n=e.map(lv);wo.error(`Firestore (${Hl}): ${t}`,...n)}}function kl(t,...e){if(wo.logLevel<=yt.WARN){const n=e.map(lv);wo.warn(`Firestore (${Hl}): ${t}`,...n)}}function lv(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ke(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,tk(t,r,n)}function tk(t,e,n){let r=`FIRESTORE (${Hl}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw Hi(r),new Error(r)}function Ut(t,e,n,r){let s="Unexpected state";typeof n=="string"?s=n:r=n,t||tk(e,s,r)}function rt(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ce={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ie extends Fs{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mi{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nk{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class _D{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(Sr.UNAUTHENTICATED))}shutdown(){}}class jD{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class ED{constructor(e){this.t=e,this.currentUser=Sr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){Ut(this.o===void 0,42304);let r=this.i;const s=c=>this.i!==r?(r=this.i,n(c)):Promise.resolve();let a=new Mi;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new Mi,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const c=a;e.enqueueRetryable(async()=>{await c.promise,await s(this.currentUser)})},l=c=>{Pe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(c=>l(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?l(c):(Pe("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new Mi)}},0),o()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(Pe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Ut(typeof r.accessToken=="string",31837,{l:r}),new nk(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Ut(e===null||typeof e=="string",2055,{h:e}),new Sr(e)}}class kD{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=Sr.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class CD{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new kD(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable(()=>n(Sr.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Lb{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class SD{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Ir(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){Ut(this.o===void 0,3512);const r=a=>{a.error!=null&&Pe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${a.error.message}`);const o=a.token!==this.m;return this.m=a.token,Pe("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(a.token):Promise.resolve()};this.o=a=>{e.enqueueRetryable(()=>r(a))};const s=a=>{Pe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=a,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(a=>s(a)),setTimeout(()=>{if(!this.appCheck){const a=this.V.getImmediate({optional:!0});a?s(a):Pe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Lb(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(Ut(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new Lb(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ND(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rk(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sk{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=ND(40);for(let a=0;a<s.length;++a)r.length<20&&s[a]<n&&(r+=e.charAt(s[a]%62))}return r}}function ht(t,e){return t<e?-1:t>e?1:0}function gg(t,e){let n=0;for(;n<t.length&&n<e.length;){const r=t.codePointAt(n),s=e.codePointAt(n);if(r!==s){if(r<128&&s<128)return ht(r,s);{const a=rk(),o=TD(a.encode(Ob(t,n)),a.encode(Ob(e,n)));return o!==0?o:ht(r,s)}}n+=r>65535?2:1}return ht(t.length,e.length)}function Ob(t,e){return t.codePointAt(e)>65535?t.substring(e,e+2):t.substring(e,e+1)}function TD(t,e){for(let n=0;n<t.length&&n<e.length;++n)if(t[n]!==e[n])return ht(t[n],e[n]);return ht(t.length,e.length)}function Cl(t,e,n){return t.length===e.length&&t.every((r,s)=>n(r,e[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mb=-62135596800,Fb=1e6;class sn{static now(){return sn.fromMillis(Date.now())}static fromDate(e){return sn.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*Fb);return new sn(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new Ie(ce.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Ie(ce.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<Mb)throw new Ie(ce.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Ie(ce.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Fb}_compareTo(e){return this.seconds===e.seconds?ht(this.nanoseconds,e.nanoseconds):ht(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-Mb;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tt{static fromTimestamp(e){return new tt(e)}static min(){return new tt(new sn(0,0))}static max(){return new tt(new sn(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vb="__name__";class li{constructor(e,n,r){n===void 0?n=0:n>e.length&&Ke(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&Ke(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return li.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof li?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let s=0;s<r;s++){const a=li.compareSegments(e.get(s),n.get(s));if(a!==0)return a}return ht(e.length,n.length)}static compareSegments(e,n){const r=li.isNumericId(e),s=li.isNumericId(n);return r&&!s?-1:!r&&s?1:r&&s?li.extractNumericId(e).compare(li.extractNumericId(n)):gg(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return ja.fromString(e.substring(4,e.length-2))}}class Yt extends li{construct(e,n,r){return new Yt(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new Ie(ce.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(s=>s.length>0))}return new Yt(n)}static emptyPath(){return new Yt([])}}const ID=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class mr extends li{construct(e,n,r){return new mr(e,n,r)}static isValidIdentifier(e){return ID.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),mr.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Vb}static keyField(){return new mr([Vb])}static fromServerFormat(e){const n=[];let r="",s=0;const a=()=>{if(r.length===0)throw new Ie(ce.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let o=!1;for(;s<e.length;){const l=e[s];if(l==="\\"){if(s+1===e.length)throw new Ie(ce.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new Ie(ce.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,s+=2}else l==="`"?(o=!o,s++):l!=="."||o?(r+=l,s++):(a(),s++)}if(a(),o)throw new Ie(ce.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new mr(n)}static emptyPath(){return new mr([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $e{constructor(e){this.path=e}static fromPath(e){return new $e(Yt.fromString(e))}static fromName(e){return new $e(Yt.fromString(e).popFirst(5))}static empty(){return new $e(Yt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Yt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Yt.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new $e(new Yt(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gu=-1;function AD(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=tt.fromTimestamp(r===1e9?new sn(n+1,0):new sn(n,r));return new Ia(s,$e.empty(),e)}function RD(t){return new Ia(t.readTime,t.key,gu)}class Ia{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new Ia(tt.min(),$e.empty(),gu)}static max(){return new Ia(tt.max(),$e.empty(),gu)}}function PD(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=$e.comparator(t.documentKey,e.documentKey),n!==0?n:ht(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DD="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class LD{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ql(t){if(t.code!==ce.FAILED_PRECONDITION||t.message!==DD)throw t;Pe("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ue{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Ke(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new ue((r,s)=>{this.nextCallback=a=>{this.wrapSuccess(e,a).next(r,s)},this.catchCallback=a=>{this.wrapFailure(n,a).next(r,s)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof ue?n:ue.resolve(n)}catch(n){return ue.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):ue.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):ue.reject(n)}static resolve(e){return new ue((n,r)=>{n(e)})}static reject(e){return new ue((n,r)=>{r(e)})}static waitFor(e){return new ue((n,r)=>{let s=0,a=0,o=!1;e.forEach(l=>{++s,l.next(()=>{++a,o&&a===s&&n()},c=>r(c))}),o=!0,a===s&&n()})}static or(e){let n=ue.resolve(!1);for(const r of e)n=n.next(s=>s?ue.resolve(s):r());return n}static forEach(e,n){const r=[];return e.forEach((s,a)=>{r.push(n.call(this,s,a))}),this.waitFor(r)}static mapArray(e,n){return new ue((r,s)=>{const a=e.length,o=new Array(a);let l=0;for(let c=0;c<a;c++){const d=c;n(e[d]).next(h=>{o[d]=h,++l,l===a&&r(o)},h=>s(h))}})}static doWhile(e,n){return new ue((r,s)=>{const a=()=>{e()===!0?n().next(()=>{a()},s):r()};a()})}}function OD(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function Wl(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pf{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ue(r),this.ce=r=>n.writeSequenceNumber(r))}ue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ce&&this.ce(e),e}}Pf.le=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cv=-1;function Df(t){return t==null}function zh(t){return t===0&&1/t==-1/0}function MD(t){return typeof t=="number"&&Number.isInteger(t)&&!zh(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ik="";function FD(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Ub(e)),e=VD(t.get(n),e);return Ub(e)}function VD(t,e){let n=e;const r=t.length;for(let s=0;s<r;s++){const a=t.charAt(s);switch(a){case"\0":n+="";break;case ik:n+="";break;default:n+=a}}return n}function Ub(t){return t+ik+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bb(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ga(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ak(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hn{constructor(e,n){this.comparator=e,this.root=n||pr.EMPTY}insert(e,n){return new hn(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,pr.BLACK,null,null))}remove(e){return new hn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,pr.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return n+r.left.size;s<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new kd(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new kd(this.root,e,this.comparator,!1)}getReverseIterator(){return new kd(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new kd(this.root,e,this.comparator,!0)}}class kd{constructor(e,n,r,s){this.isReverse=s,this.nodeStack=[];let a=1;for(;!e.isEmpty();)if(a=n?r(e.key,n):1,n&&s&&(a*=-1),a<0)e=this.isReverse?e.left:e.right;else{if(a===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class pr{constructor(e,n,r,s,a){this.key=e,this.value=n,this.color=r??pr.RED,this.left=s??pr.EMPTY,this.right=a??pr.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,s,a){return new pr(e??this.key,n??this.value,r??this.color,s??this.left,a??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const a=r(e,s.key);return s=a<0?s.copy(null,null,null,s.left.insert(e,n,r),null):a===0?s.copy(null,n,null,null,null):s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return pr.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,s=this;if(n(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),n(e,s.key)===0){if(s.right.isEmpty())return pr.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,pr.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,pr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ke(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Ke(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Ke(27949);return e+(this.isRed()?0:1)}}pr.EMPTY=null,pr.RED=!0,pr.BLACK=!1;pr.EMPTY=new class{constructor(){this.size=0}get key(){throw Ke(57766)}get value(){throw Ke(16141)}get color(){throw Ke(16727)}get left(){throw Ke(29726)}get right(){throw Ke(36894)}copy(e,n,r,s,a){return this}insert(e,n,r){return new pr(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bn{constructor(e){this.comparator=e,this.data=new hn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;n(s.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new $b(this.data.getIterator())}getIteratorFrom(e){return new $b(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof Bn)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const s=n.getNext().key,a=r.getNext().key;if(this.comparator(s,a)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new Bn(this.comparator);return n.data=e,n}}class $b{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gs{constructor(e){this.fields=e,e.sort(mr.comparator)}static empty(){return new gs([])}unionWith(e){let n=new Bn(mr.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new gs(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Cl(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ok extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vr{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(s){try{return atob(s)}catch(a){throw typeof DOMException<"u"&&a instanceof DOMException?new ok("Invalid base64 string: "+a):a}}(e);return new vr(n)}static fromUint8Array(e){const n=function(s){let a="";for(let o=0;o<s.length;++o)a+=String.fromCharCode(s[o]);return a}(e);return new vr(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ht(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}vr.EMPTY_BYTE_STRING=new vr("");const UD=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Aa(t){if(Ut(!!t,39018),typeof t=="string"){let e=0;const n=UD.exec(t);if(Ut(!!n,46558,{timestamp:t}),n[1]){let s=n[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:jn(t.seconds),nanos:jn(t.nanos)}}function jn(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Ra(t){return typeof t=="string"?vr.fromBase64String(t):vr.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lk="server_timestamp",ck="__type__",uk="__previous_value__",dk="__local_write_time__";function uv(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{})[ck])===null||n===void 0?void 0:n.stringValue)===lk}function Lf(t){const e=t.mapValue.fields[uk];return uv(e)?Lf(e):e}function yu(t){const e=Aa(t.mapValue.fields[dk].timestampValue);return new sn(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BD{constructor(e,n,r,s,a,o,l,c,d,h){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=s,this.ssl=a,this.forceLongPolling=o,this.autoDetectLongPolling=l,this.longPollingOptions=c,this.useFetchStreams=d,this.isUsingEmulator=h}}const Gh="(default)";class vu{constructor(e,n){this.projectId=e,this.database=n||Gh}static empty(){return new vu("","")}get isDefaultDatabase(){return this.database===Gh}isEqual(e){return e instanceof vu&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hk="__type__",$D="__max__",Cd={mapValue:{}},fk="__vector__",Hh="value";function Pa(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?uv(t)?4:GD(t)?9007199254740991:zD(t)?10:11:Ke(28295,{value:t})}function wi(t,e){if(t===e)return!0;const n=Pa(t);if(n!==Pa(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return yu(t).isEqual(yu(e));case 3:return function(s,a){if(typeof s.timestampValue=="string"&&typeof a.timestampValue=="string"&&s.timestampValue.length===a.timestampValue.length)return s.timestampValue===a.timestampValue;const o=Aa(s.timestampValue),l=Aa(a.timestampValue);return o.seconds===l.seconds&&o.nanos===l.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(s,a){return Ra(s.bytesValue).isEqual(Ra(a.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(s,a){return jn(s.geoPointValue.latitude)===jn(a.geoPointValue.latitude)&&jn(s.geoPointValue.longitude)===jn(a.geoPointValue.longitude)}(t,e);case 2:return function(s,a){if("integerValue"in s&&"integerValue"in a)return jn(s.integerValue)===jn(a.integerValue);if("doubleValue"in s&&"doubleValue"in a){const o=jn(s.doubleValue),l=jn(a.doubleValue);return o===l?zh(o)===zh(l):isNaN(o)&&isNaN(l)}return!1}(t,e);case 9:return Cl(t.arrayValue.values||[],e.arrayValue.values||[],wi);case 10:case 11:return function(s,a){const o=s.mapValue.fields||{},l=a.mapValue.fields||{};if(Bb(o)!==Bb(l))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(l[c]===void 0||!wi(o[c],l[c])))return!1;return!0}(t,e);default:return Ke(52216,{left:t})}}function xu(t,e){return(t.values||[]).find(n=>wi(n,e))!==void 0}function Sl(t,e){if(t===e)return 0;const n=Pa(t),r=Pa(e);if(n!==r)return ht(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return ht(t.booleanValue,e.booleanValue);case 2:return function(a,o){const l=jn(a.integerValue||a.doubleValue),c=jn(o.integerValue||o.doubleValue);return l<c?-1:l>c?1:l===c?0:isNaN(l)?isNaN(c)?0:-1:1}(t,e);case 3:return zb(t.timestampValue,e.timestampValue);case 4:return zb(yu(t),yu(e));case 5:return gg(t.stringValue,e.stringValue);case 6:return function(a,o){const l=Ra(a),c=Ra(o);return l.compareTo(c)}(t.bytesValue,e.bytesValue);case 7:return function(a,o){const l=a.split("/"),c=o.split("/");for(let d=0;d<l.length&&d<c.length;d++){const h=ht(l[d],c[d]);if(h!==0)return h}return ht(l.length,c.length)}(t.referenceValue,e.referenceValue);case 8:return function(a,o){const l=ht(jn(a.latitude),jn(o.latitude));return l!==0?l:ht(jn(a.longitude),jn(o.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return Gb(t.arrayValue,e.arrayValue);case 10:return function(a,o){var l,c,d,h;const f=a.fields||{},p=o.fields||{},k=(l=f[Hh])===null||l===void 0?void 0:l.arrayValue,S=(c=p[Hh])===null||c===void 0?void 0:c.arrayValue,T=ht(((d=k==null?void 0:k.values)===null||d===void 0?void 0:d.length)||0,((h=S==null?void 0:S.values)===null||h===void 0?void 0:h.length)||0);return T!==0?T:Gb(k,S)}(t.mapValue,e.mapValue);case 11:return function(a,o){if(a===Cd.mapValue&&o===Cd.mapValue)return 0;if(a===Cd.mapValue)return 1;if(o===Cd.mapValue)return-1;const l=a.fields||{},c=Object.keys(l),d=o.fields||{},h=Object.keys(d);c.sort(),h.sort();for(let f=0;f<c.length&&f<h.length;++f){const p=gg(c[f],h[f]);if(p!==0)return p;const k=Sl(l[c[f]],d[h[f]]);if(k!==0)return k}return ht(c.length,h.length)}(t.mapValue,e.mapValue);default:throw Ke(23264,{Pe:n})}}function zb(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return ht(t,e);const n=Aa(t),r=Aa(e),s=ht(n.seconds,r.seconds);return s!==0?s:ht(n.nanos,r.nanos)}function Gb(t,e){const n=t.values||[],r=e.values||[];for(let s=0;s<n.length&&s<r.length;++s){const a=Sl(n[s],r[s]);if(a)return a}return ht(n.length,r.length)}function Nl(t){return yg(t)}function yg(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=Aa(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return Ra(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return $e.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",s=!0;for(const a of n.values||[])s?s=!1:r+=",",r+=yg(a);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let s="{",a=!0;for(const o of r)a?a=!1:s+=",",s+=`${o}:${yg(n.fields[o])}`;return s+"}"}(t.mapValue):Ke(61005,{value:t})}function eh(t){switch(Pa(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Lf(t);return e?16+eh(e):16;case 5:return 2*t.stringValue.length;case 6:return Ra(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,a)=>s+eh(a),0)}(t.arrayValue);case 10:case 11:return function(r){let s=0;return Ga(r.fields,(a,o)=>{s+=a.length+eh(o)}),s}(t.mapValue);default:throw Ke(13486,{value:t})}}function Hb(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function vg(t){return!!t&&"integerValue"in t}function dv(t){return!!t&&"arrayValue"in t}function qb(t){return!!t&&"nullValue"in t}function Wb(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function th(t){return!!t&&"mapValue"in t}function zD(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{})[hk])===null||n===void 0?void 0:n.stringValue)===fk}function Uc(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Ga(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=Uc(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Uc(t.arrayValue.values[n]);return e}return Object.assign({},t)}function GD(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===$D}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class es{constructor(e){this.value=e}static empty(){return new es({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!th(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Uc(n)}setAll(e){let n=mr.emptyPath(),r={},s=[];e.forEach((o,l)=>{if(!n.isImmediateParentOf(l)){const c=this.getFieldsMap(n);this.applyChanges(c,r,s),r={},s=[],n=l.popLast()}o?r[l.lastSegment()]=Uc(o):s.push(l.lastSegment())});const a=this.getFieldsMap(n);this.applyChanges(a,r,s)}delete(e){const n=this.field(e.popLast());th(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return wi(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=n.mapValue.fields[e.get(r)];th(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=s),n=s}return n.mapValue.fields}applyChanges(e,n,r){Ga(n,(s,a)=>e[s]=a);for(const s of r)delete e[s]}clone(){return new es(Uc(this.value))}}function pk(t){const e=[];return Ga(t.fields,(n,r)=>{const s=new mr([n]);if(th(r)){const a=pk(r.mapValue).fields;if(a.length===0)e.push(s);else for(const o of a)e.push(s.child(o))}else e.push(s)}),new gs(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tr{constructor(e,n,r,s,a,o,l){this.key=e,this.documentType=n,this.version=r,this.readTime=s,this.createTime=a,this.data=o,this.documentState=l}static newInvalidDocument(e){return new Tr(e,0,tt.min(),tt.min(),tt.min(),es.empty(),0)}static newFoundDocument(e,n,r,s){return new Tr(e,1,n,tt.min(),r,s,0)}static newNoDocument(e,n){return new Tr(e,2,n,tt.min(),tt.min(),es.empty(),0)}static newUnknownDocument(e,n){return new Tr(e,3,n,tt.min(),tt.min(),es.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(tt.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=es.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=es.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=tt.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Tr&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Tr(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qh{constructor(e,n){this.position=e,this.inclusive=n}}function Kb(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const a=e[s],o=t.position[s];if(a.field.isKeyField()?r=$e.comparator($e.fromName(o.referenceValue),n.key):r=Sl(o,n.data.field(a.field)),a.dir==="desc"&&(r*=-1),r!==0)break}return r}function Qb(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!wi(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wu{constructor(e,n="asc"){this.field=e,this.dir=n}}function HD(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mk{}class Rn extends mk{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new WD(e,n,r):n==="array-contains"?new YD(e,r):n==="in"?new JD(e,r):n==="not-in"?new XD(e,r):n==="array-contains-any"?new ZD(e,r):new Rn(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new KD(e,r):new QD(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(Sl(n,this.value)):n!==null&&Pa(this.value)===Pa(n)&&this.matchesComparison(Sl(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ke(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ei extends mk{constructor(e,n){super(),this.filters=e,this.op=n,this.Te=null}static create(e,n){return new ei(e,n)}matches(e){return gk(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.Te!==null||(this.Te=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function gk(t){return t.op==="and"}function yk(t){return qD(t)&&gk(t)}function qD(t){for(const e of t.filters)if(e instanceof ei)return!1;return!0}function xg(t){if(t instanceof Rn)return t.field.canonicalString()+t.op.toString()+Nl(t.value);if(yk(t))return t.filters.map(e=>xg(e)).join(",");{const e=t.filters.map(n=>xg(n)).join(",");return`${t.op}(${e})`}}function vk(t,e){return t instanceof Rn?function(r,s){return s instanceof Rn&&r.op===s.op&&r.field.isEqual(s.field)&&wi(r.value,s.value)}(t,e):t instanceof ei?function(r,s){return s instanceof ei&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((a,o,l)=>a&&vk(o,s.filters[l]),!0):!1}(t,e):void Ke(19439)}function xk(t){return t instanceof Rn?function(n){return`${n.field.canonicalString()} ${n.op} ${Nl(n.value)}`}(t):t instanceof ei?function(n){return n.op.toString()+" {"+n.getFilters().map(xk).join(" ,")+"}"}(t):"Filter"}class WD extends Rn{constructor(e,n,r){super(e,n,r),this.key=$e.fromName(r.referenceValue)}matches(e){const n=$e.comparator(e.key,this.key);return this.matchesComparison(n)}}class KD extends Rn{constructor(e,n){super(e,"in",n),this.keys=wk("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class QD extends Rn{constructor(e,n){super(e,"not-in",n),this.keys=wk("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function wk(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>$e.fromName(r.referenceValue))}class YD extends Rn{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return dv(n)&&xu(n.arrayValue,this.value)}}class JD extends Rn{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&xu(this.value.arrayValue,n)}}class XD extends Rn{constructor(e,n){super(e,"not-in",n)}matches(e){if(xu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!xu(this.value.arrayValue,n)}}class ZD extends Rn{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!dv(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>xu(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eL{constructor(e,n=null,r=[],s=[],a=null,o=null,l=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=s,this.limit=a,this.startAt=o,this.endAt=l,this.Ie=null}}function Yb(t,e=null,n=[],r=[],s=null,a=null,o=null){return new eL(t,e,n,r,s,a,o)}function hv(t){const e=rt(t);if(e.Ie===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>xg(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(a){return a.field.canonicalString()+a.dir}(r)).join(","),Df(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>Nl(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>Nl(r)).join(",")),e.Ie=n}return e.Ie}function fv(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!HD(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!vk(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Qb(t.startAt,e.startAt)&&Qb(t.endAt,e.endAt)}function wg(t){return $e.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Io{constructor(e,n=null,r=[],s=[],a=null,o="F",l=null,c=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=s,this.limit=a,this.limitType=o,this.startAt=l,this.endAt=c,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function tL(t,e,n,r,s,a,o,l){return new Io(t,e,n,r,s,a,o,l)}function Of(t){return new Io(t)}function Jb(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function bk(t){return t.collectionGroup!==null}function Bc(t){const e=rt(t);if(e.Ee===null){e.Ee=[];const n=new Set;for(const a of e.explicitOrderBy)e.Ee.push(a),n.add(a.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let l=new Bn(mr.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(d=>{d.isInequality()&&(l=l.add(d.field))})}),l})(e).forEach(a=>{n.has(a.canonicalString())||a.isKeyField()||e.Ee.push(new wu(a,r))}),n.has(mr.keyField().canonicalString())||e.Ee.push(new wu(mr.keyField(),r))}return e.Ee}function yi(t){const e=rt(t);return e.de||(e.de=nL(e,Bc(t))),e.de}function nL(t,e){if(t.limitType==="F")return Yb(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(s=>{const a=s.dir==="desc"?"asc":"desc";return new wu(s.field,a)});const n=t.endAt?new qh(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new qh(t.startAt.position,t.startAt.inclusive):null;return Yb(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function bg(t,e){const n=t.filters.concat([e]);return new Io(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Wh(t,e,n){return new Io(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Mf(t,e){return fv(yi(t),yi(e))&&t.limitType===e.limitType}function _k(t){return`${hv(yi(t))}|lt:${t.limitType}`}function $o(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(s=>xk(s)).join(", ")}]`),Df(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(s=>Nl(s)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(s=>Nl(s)).join(",")),`Target(${r})`}(yi(t))}; limitType=${t.limitType})`}function Ff(t,e){return e.isFoundDocument()&&function(r,s){const a=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(a):$e.isDocumentKey(r.path)?r.path.isEqual(a):r.path.isImmediateParentOf(a)}(t,e)&&function(r,s){for(const a of Bc(r))if(!a.field.isKeyField()&&s.data.field(a.field)===null)return!1;return!0}(t,e)&&function(r,s){for(const a of r.filters)if(!a.matches(s))return!1;return!0}(t,e)&&function(r,s){return!(r.startAt&&!function(o,l,c){const d=Kb(o,l,c);return o.inclusive?d<=0:d<0}(r.startAt,Bc(r),s)||r.endAt&&!function(o,l,c){const d=Kb(o,l,c);return o.inclusive?d>=0:d>0}(r.endAt,Bc(r),s))}(t,e)}function rL(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function jk(t){return(e,n)=>{let r=!1;for(const s of Bc(t)){const a=sL(s,e,n);if(a!==0)return a;r=r||s.field.isKeyField()}return 0}}function sL(t,e,n){const r=t.field.isKeyField()?$e.comparator(e.key,n.key):function(a,o,l){const c=o.data.field(a),d=l.data.field(a);return c!==null&&d!==null?Sl(c,d):Ke(42886)}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Ke(19790,{direction:t.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ao{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[s,a]of r)if(this.equalsFn(s,e))return a}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let a=0;a<s.length;a++)if(this.equalsFn(s[a][0],e))return void(s[a]=[e,n]);s.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[n]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Ga(this.inner,(n,r)=>{for(const[s,a]of r)e(s,a)})}isEmpty(){return ak(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iL=new hn($e.comparator);function qi(){return iL}const Ek=new hn($e.comparator);function _c(...t){let e=Ek;for(const n of t)e=e.insert(n.key,n);return e}function kk(t){let e=Ek;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function no(){return $c()}function Ck(){return $c()}function $c(){return new Ao(t=>t.toString(),(t,e)=>t.isEqual(e))}const aL=new hn($e.comparator),oL=new Bn($e.comparator);function vt(...t){let e=oL;for(const n of t)e=e.add(n);return e}const lL=new Bn(ht);function cL(){return lL}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pv(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:zh(e)?"-0":e}}function Sk(t){return{integerValue:""+t}}function Nk(t,e){return MD(e)?Sk(e):pv(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vf{constructor(){this._=void 0}}function uL(t,e,n){return t instanceof bu?function(s,a){const o={fields:{[ck]:{stringValue:lk},[dk]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return a&&uv(a)&&(a=Lf(a)),a&&(o.fields[uk]=a),{mapValue:o}}(n,e):t instanceof Tl?Ik(t,e):t instanceof _u?Ak(t,e):function(s,a){const o=Tk(s,a),l=Xb(o)+Xb(s.Re);return vg(o)&&vg(s.Re)?Sk(l):pv(s.serializer,l)}(t,e)}function dL(t,e,n){return t instanceof Tl?Ik(t,e):t instanceof _u?Ak(t,e):n}function Tk(t,e){return t instanceof ju?function(r){return vg(r)||function(a){return!!a&&"doubleValue"in a}(r)}(e)?e:{integerValue:0}:null}class bu extends Vf{}class Tl extends Vf{constructor(e){super(),this.elements=e}}function Ik(t,e){const n=Rk(e);for(const r of t.elements)n.some(s=>wi(s,r))||n.push(r);return{arrayValue:{values:n}}}class _u extends Vf{constructor(e){super(),this.elements=e}}function Ak(t,e){let n=Rk(e);for(const r of t.elements)n=n.filter(s=>!wi(s,r));return{arrayValue:{values:n}}}class ju extends Vf{constructor(e,n){super(),this.serializer=e,this.Re=n}}function Xb(t){return jn(t.integerValue||t.doubleValue)}function Rk(t){return dv(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mv{constructor(e,n){this.field=e,this.transform=n}}function hL(t,e){return t.field.isEqual(e.field)&&function(r,s){return r instanceof Tl&&s instanceof Tl||r instanceof _u&&s instanceof _u?Cl(r.elements,s.elements,wi):r instanceof ju&&s instanceof ju?wi(r.Re,s.Re):r instanceof bu&&s instanceof bu}(t.transform,e.transform)}class fL{constructor(e,n){this.version=e,this.transformResults=n}}class qr{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new qr}static exists(e){return new qr(void 0,e)}static updateTime(e){return new qr(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function nh(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Uf{}function Pk(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new Bf(t.key,qr.none()):new Uu(t.key,t.data,qr.none());{const n=t.data,r=es.empty();let s=new Bn(mr.comparator);for(let a of e.fields)if(!s.has(a)){let o=n.field(a);o===null&&a.length>1&&(a=a.popLast(),o=n.field(a)),o===null?r.delete(a):r.set(a,o),s=s.add(a)}return new Ha(t.key,r,new gs(s.toArray()),qr.none())}}function pL(t,e,n){t instanceof Uu?function(s,a,o){const l=s.value.clone(),c=e0(s.fieldTransforms,a,o.transformResults);l.setAll(c),a.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(t,e,n):t instanceof Ha?function(s,a,o){if(!nh(s.precondition,a))return void a.convertToUnknownDocument(o.version);const l=e0(s.fieldTransforms,a,o.transformResults),c=a.data;c.setAll(Dk(s)),c.setAll(l),a.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(t,e,n):function(s,a,o){a.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,n)}function zc(t,e,n,r){return t instanceof Uu?function(a,o,l,c){if(!nh(a.precondition,o))return l;const d=a.value.clone(),h=t0(a.fieldTransforms,c,o);return d.setAll(h),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),null}(t,e,n,r):t instanceof Ha?function(a,o,l,c){if(!nh(a.precondition,o))return l;const d=t0(a.fieldTransforms,c,o),h=o.data;return h.setAll(Dk(a)),h.setAll(d),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),l===null?null:l.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map(f=>f.field))}(t,e,n,r):function(a,o,l){return nh(a.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):l}(t,e,n)}function mL(t,e){let n=null;for(const r of t.fieldTransforms){const s=e.data.field(r.field),a=Tk(r.transform,s||null);a!=null&&(n===null&&(n=es.empty()),n.set(r.field,a))}return n||null}function Zb(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Cl(r,s,(a,o)=>hL(a,o))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Uu extends Uf{constructor(e,n,r,s=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Ha extends Uf{constructor(e,n,r,s,a=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=s,this.fieldTransforms=a,this.type=1}getFieldMask(){return this.fieldMask}}function Dk(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function e0(t,e,n){const r=new Map;Ut(t.length===n.length,32656,{Ve:n.length,me:t.length});for(let s=0;s<n.length;s++){const a=t[s],o=a.transform,l=e.data.field(a.field);r.set(a.field,dL(o,l,n[s]))}return r}function t0(t,e,n){const r=new Map;for(const s of t){const a=s.transform,o=n.data.field(s.field);r.set(s.field,uL(a,o,e))}return r}class Bf extends Uf{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class gL extends Uf{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yL{constructor(e,n,r,s){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let s=0;s<this.mutations.length;s++){const a=this.mutations[s];a.key.isEqual(e.key)&&pL(a,e,r[s])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=zc(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=zc(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=Ck();return this.mutations.forEach(s=>{const a=e.get(s.key),o=a.overlayedDocument;let l=this.applyToLocalView(o,a.mutatedFields);l=n.has(s.key)?null:l;const c=Pk(o,l);c!==null&&r.set(s.key,c),o.isValidDocument()||o.convertToNoDocument(tt.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),vt())}isEqual(e){return this.batchId===e.batchId&&Cl(this.mutations,e.mutations,(n,r)=>Zb(n,r))&&Cl(this.baseMutations,e.baseMutations,(n,r)=>Zb(n,r))}}class gv{constructor(e,n,r,s){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=s}static from(e,n,r){Ut(e.mutations.length===r.length,58842,{fe:e.mutations.length,ge:r.length});let s=function(){return aL}();const a=e.mutations;for(let o=0;o<a.length;o++)s=s.insert(a[o].key,r[o].version);return new gv(e,n,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vL{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xL{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Tn,kt;function wL(t){switch(t){case ce.OK:return Ke(64938);case ce.CANCELLED:case ce.UNKNOWN:case ce.DEADLINE_EXCEEDED:case ce.RESOURCE_EXHAUSTED:case ce.INTERNAL:case ce.UNAVAILABLE:case ce.UNAUTHENTICATED:return!1;case ce.INVALID_ARGUMENT:case ce.NOT_FOUND:case ce.ALREADY_EXISTS:case ce.PERMISSION_DENIED:case ce.FAILED_PRECONDITION:case ce.ABORTED:case ce.OUT_OF_RANGE:case ce.UNIMPLEMENTED:case ce.DATA_LOSS:return!0;default:return Ke(15467,{code:t})}}function Lk(t){if(t===void 0)return Hi("GRPC error has no .code"),ce.UNKNOWN;switch(t){case Tn.OK:return ce.OK;case Tn.CANCELLED:return ce.CANCELLED;case Tn.UNKNOWN:return ce.UNKNOWN;case Tn.DEADLINE_EXCEEDED:return ce.DEADLINE_EXCEEDED;case Tn.RESOURCE_EXHAUSTED:return ce.RESOURCE_EXHAUSTED;case Tn.INTERNAL:return ce.INTERNAL;case Tn.UNAVAILABLE:return ce.UNAVAILABLE;case Tn.UNAUTHENTICATED:return ce.UNAUTHENTICATED;case Tn.INVALID_ARGUMENT:return ce.INVALID_ARGUMENT;case Tn.NOT_FOUND:return ce.NOT_FOUND;case Tn.ALREADY_EXISTS:return ce.ALREADY_EXISTS;case Tn.PERMISSION_DENIED:return ce.PERMISSION_DENIED;case Tn.FAILED_PRECONDITION:return ce.FAILED_PRECONDITION;case Tn.ABORTED:return ce.ABORTED;case Tn.OUT_OF_RANGE:return ce.OUT_OF_RANGE;case Tn.UNIMPLEMENTED:return ce.UNIMPLEMENTED;case Tn.DATA_LOSS:return ce.DATA_LOSS;default:return Ke(39323,{code:t})}}(kt=Tn||(Tn={}))[kt.OK=0]="OK",kt[kt.CANCELLED=1]="CANCELLED",kt[kt.UNKNOWN=2]="UNKNOWN",kt[kt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",kt[kt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",kt[kt.NOT_FOUND=5]="NOT_FOUND",kt[kt.ALREADY_EXISTS=6]="ALREADY_EXISTS",kt[kt.PERMISSION_DENIED=7]="PERMISSION_DENIED",kt[kt.UNAUTHENTICATED=16]="UNAUTHENTICATED",kt[kt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",kt[kt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",kt[kt.ABORTED=10]="ABORTED",kt[kt.OUT_OF_RANGE=11]="OUT_OF_RANGE",kt[kt.UNIMPLEMENTED=12]="UNIMPLEMENTED",kt[kt.INTERNAL=13]="INTERNAL",kt[kt.UNAVAILABLE=14]="UNAVAILABLE",kt[kt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bL=new ja([4294967295,4294967295],0);function n0(t){const e=rk().encode(t),n=new QE;return n.update(e),new Uint8Array(n.digest())}function r0(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),a=e.getUint32(12,!0);return[new ja([n,r],0),new ja([s,a],0)]}class yv{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new jc(`Invalid padding: ${n}`);if(r<0)throw new jc(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new jc(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new jc(`Invalid padding when bitmap length is 0: ${n}`);this.pe=8*e.length-n,this.ye=ja.fromNumber(this.pe)}we(e,n,r){let s=e.add(n.multiply(ja.fromNumber(r)));return s.compare(bL)===1&&(s=new ja([s.getBits(0),s.getBits(1)],0)),s.modulo(this.ye).toNumber()}be(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.pe===0)return!1;const n=n0(e),[r,s]=r0(n);for(let a=0;a<this.hashCount;a++){const o=this.we(r,s,a);if(!this.be(o))return!1}return!0}static create(e,n,r){const s=e%8==0?0:8-e%8,a=new Uint8Array(Math.ceil(e/8)),o=new yv(a,s,n);return r.forEach(l=>o.insert(l)),o}insert(e){if(this.pe===0)return;const n=n0(e),[r,s]=r0(n);for(let a=0;a<this.hashCount;a++){const o=this.we(r,s,a);this.Se(o)}}Se(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class jc extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $f{constructor(e,n,r,s,a){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=a}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const s=new Map;return s.set(e,Bu.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new $f(tt.min(),s,new hn(ht),qi(),vt())}}class Bu{constructor(e,n,r,s,a){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=a}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new Bu(r,n,vt(),vt(),vt())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rh{constructor(e,n,r,s){this.De=e,this.removedTargetIds=n,this.key=r,this.ve=s}}class Ok{constructor(e,n){this.targetId=e,this.Ce=n}}class Mk{constructor(e,n,r=vr.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=s}}class s0{constructor(){this.Fe=0,this.Me=i0(),this.xe=vr.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return this.Fe!==0}get Le(){return this.Ne}ke(e){e.approximateByteSize()>0&&(this.Ne=!0,this.xe=e)}qe(){let e=vt(),n=vt(),r=vt();return this.Me.forEach((s,a)=>{switch(a){case 0:e=e.add(s);break;case 2:n=n.add(s);break;case 1:r=r.add(s);break;default:Ke(38017,{changeType:a})}}),new Bu(this.xe,this.Oe,e,n,r)}Qe(){this.Ne=!1,this.Me=i0()}$e(e,n){this.Ne=!0,this.Me=this.Me.insert(e,n)}Ue(e){this.Ne=!0,this.Me=this.Me.remove(e)}Ke(){this.Fe+=1}We(){this.Fe-=1,Ut(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}}class _L{constructor(e){this.ze=e,this.je=new Map,this.He=qi(),this.Je=Sd(),this.Ye=Sd(),this.Ze=new hn(ht)}Xe(e){for(const n of e.De)e.ve&&e.ve.isFoundDocument()?this.et(n,e.ve):this.tt(n,e.key,e.ve);for(const n of e.removedTargetIds)this.tt(n,e.key,e.ve)}nt(e){this.forEachTarget(e,n=>{const r=this.rt(n);switch(e.state){case 0:this.it(n)&&r.ke(e.resumeToken);break;case 1:r.We(),r.Be||r.Qe(),r.ke(e.resumeToken);break;case 2:r.We(),r.Be||this.removeTarget(n);break;case 3:this.it(n)&&(r.Ge(),r.ke(e.resumeToken));break;case 4:this.it(n)&&(this.st(n),r.ke(e.resumeToken));break;default:Ke(56790,{state:e.state})}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.je.forEach((r,s)=>{this.it(s)&&n(s)})}ot(e){const n=e.targetId,r=e.Ce.count,s=this._t(n);if(s){const a=s.target;if(wg(a))if(r===0){const o=new $e(a.path);this.tt(n,o,Tr.newNoDocument(o,tt.min()))}else Ut(r===1,20013,{expectedCount:r});else{const o=this.ut(n);if(o!==r){const l=this.ct(e),c=l?this.lt(l,e,o):1;if(c!==0){this.st(n);const d=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(n,d)}}}}}ct(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:a=0}=n;let o,l;try{o=Ra(r).toUint8Array()}catch(c){if(c instanceof ok)return kl("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{l=new yv(o,s,a)}catch(c){return kl(c instanceof jc?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return l.pe===0?null:l}lt(e,n,r){return n.Ce.count===r-this.Tt(e,n.targetId)?0:2}Tt(e,n){const r=this.ze.getRemoteKeysForTarget(n);let s=0;return r.forEach(a=>{const o=this.ze.Pt(),l=`projects/${o.projectId}/databases/${o.database}/documents/${a.path.canonicalString()}`;e.mightContain(l)||(this.tt(n,a,null),s++)}),s}It(e){const n=new Map;this.je.forEach((a,o)=>{const l=this._t(o);if(l){if(a.current&&wg(l.target)){const c=new $e(l.target.path);this.Et(c).has(o)||this.dt(o,c)||this.tt(o,c,Tr.newNoDocument(c,e))}a.Le&&(n.set(o,a.qe()),a.Qe())}});let r=vt();this.Ye.forEach((a,o)=>{let l=!0;o.forEachWhile(c=>{const d=this._t(c);return!d||d.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(a))}),this.He.forEach((a,o)=>o.setReadTime(e));const s=new $f(e,n,this.Ze,this.He,r);return this.He=qi(),this.Je=Sd(),this.Ye=Sd(),this.Ze=new hn(ht),s}et(e,n){if(!this.it(e))return;const r=this.dt(e,n.key)?2:0;this.rt(e).$e(n.key,r),this.He=this.He.insert(n.key,n),this.Je=this.Je.insert(n.key,this.Et(n.key).add(e)),this.Ye=this.Ye.insert(n.key,this.At(n.key).add(e))}tt(e,n,r){if(!this.it(e))return;const s=this.rt(e);this.dt(e,n)?s.$e(n,1):s.Ue(n),this.Ye=this.Ye.insert(n,this.At(n).delete(e)),this.Ye=this.Ye.insert(n,this.At(n).add(e)),r&&(this.He=this.He.insert(n,r))}removeTarget(e){this.je.delete(e)}ut(e){const n=this.rt(e).qe();return this.ze.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ke(e){this.rt(e).Ke()}rt(e){let n=this.je.get(e);return n||(n=new s0,this.je.set(e,n)),n}At(e){let n=this.Ye.get(e);return n||(n=new Bn(ht),this.Ye=this.Ye.insert(e,n)),n}Et(e){let n=this.Je.get(e);return n||(n=new Bn(ht),this.Je=this.Je.insert(e,n)),n}it(e){const n=this._t(e)!==null;return n||Pe("WatchChangeAggregator","Detected inactive target",e),n}_t(e){const n=this.je.get(e);return n&&n.Be?null:this.ze.Rt(e)}st(e){this.je.set(e,new s0),this.ze.getRemoteKeysForTarget(e).forEach(n=>{this.tt(e,n,null)})}dt(e,n){return this.ze.getRemoteKeysForTarget(e).has(n)}}function Sd(){return new hn($e.comparator)}function i0(){return new hn($e.comparator)}const jL={asc:"ASCENDING",desc:"DESCENDING"},EL={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},kL={and:"AND",or:"OR"};class CL{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function _g(t,e){return t.useProto3Json||Df(e)?e:{value:e}}function Kh(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Fk(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function SL(t,e){return Kh(t,e.toTimestamp())}function vi(t){return Ut(!!t,49232),tt.fromTimestamp(function(n){const r=Aa(n);return new sn(r.seconds,r.nanos)}(t))}function vv(t,e){return jg(t,e).canonicalString()}function jg(t,e){const n=function(s){return new Yt(["projects",s.projectId,"databases",s.database])}(t).child("documents");return e===void 0?n:n.child(e)}function Vk(t){const e=Yt.fromString(t);return Ut(Gk(e),10190,{key:e.toString()}),e}function Eg(t,e){return vv(t.databaseId,e.path)}function Qp(t,e){const n=Vk(e);if(n.get(1)!==t.databaseId.projectId)throw new Ie(ce.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Ie(ce.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new $e(Bk(n))}function Uk(t,e){return vv(t.databaseId,e)}function NL(t){const e=Vk(t);return e.length===4?Yt.emptyPath():Bk(e)}function kg(t){return new Yt(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Bk(t){return Ut(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function a0(t,e,n){return{name:Eg(t,e),fields:n.value.mapValue.fields}}function TL(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:Ke(39313,{state:d})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],a=function(d,h){return d.useProto3Json?(Ut(h===void 0||typeof h=="string",58123),vr.fromBase64String(h||"")):(Ut(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),vr.fromUint8Array(h||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,l=o&&function(d){const h=d.code===void 0?ce.UNKNOWN:Lk(d.code);return new Ie(h,d.message||"")}(o);n=new Mk(r,s,a,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Qp(t,r.document.name),a=vi(r.document.updateTime),o=r.document.createTime?vi(r.document.createTime):tt.min(),l=new es({mapValue:{fields:r.document.fields}}),c=Tr.newFoundDocument(s,a,o,l),d=r.targetIds||[],h=r.removedTargetIds||[];n=new rh(d,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Qp(t,r.document),a=r.readTime?vi(r.readTime):tt.min(),o=Tr.newNoDocument(s,a),l=r.removedTargetIds||[];n=new rh([],l,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Qp(t,r.document),a=r.removedTargetIds||[];n=new rh([],a,s,null)}else{if(!("filter"in e))return Ke(11601,{Vt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:a}=r,o=new xL(s,a),l=r.targetId;n=new Ok(l,o)}}return n}function IL(t,e){let n;if(e instanceof Uu)n={update:a0(t,e.key,e.value)};else if(e instanceof Bf)n={delete:Eg(t,e.key)};else if(e instanceof Ha)n={update:a0(t,e.key,e.data),updateMask:VL(e.fieldMask)};else{if(!(e instanceof gL))return Ke(16599,{ft:e.type});n={verify:Eg(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(a,o){const l=o.transform;if(l instanceof bu)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof Tl)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof _u)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof ju)return{fieldPath:o.field.canonicalString(),increment:l.Re};throw Ke(20930,{transform:o.transform})}(0,r))),e.precondition.isNone||(n.currentDocument=function(s,a){return a.updateTime!==void 0?{updateTime:SL(s,a.updateTime)}:a.exists!==void 0?{exists:a.exists}:Ke(27497)}(t,e.precondition)),n}function AL(t,e){return t&&t.length>0?(Ut(e!==void 0,14353),t.map(n=>function(s,a){let o=s.updateTime?vi(s.updateTime):vi(a);return o.isEqual(tt.min())&&(o=vi(a)),new fL(o,s.transformResults||[])}(n,e))):[]}function RL(t,e){return{documents:[Uk(t,e.path)]}}function PL(t,e){const n={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Uk(t,s);const a=function(d){if(d.length!==0)return zk(ei.create(d,"and"))}(e.filters);a&&(n.structuredQuery.where=a);const o=function(d){if(d.length!==0)return d.map(h=>function(p){return{field:zo(p.field),direction:OL(p.dir)}}(h))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const l=_g(t,e.limit);return l!==null&&(n.structuredQuery.limit=l),e.startAt&&(n.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{gt:n,parent:s}}function DL(t){let e=NL(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){Ut(r===1,65062);const h=n.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let a=[];n.where&&(a=function(f){const p=$k(f);return p instanceof ei&&yk(p)?p.getFilters():[p]}(n.where));let o=[];n.orderBy&&(o=function(f){return f.map(p=>function(S){return new wu(Go(S.field),function(C){switch(C){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(S.direction))}(p))}(n.orderBy));let l=null;n.limit&&(l=function(f){let p;return p=typeof f=="object"?f.value:f,Df(p)?null:p}(n.limit));let c=null;n.startAt&&(c=function(f){const p=!!f.before,k=f.values||[];return new qh(k,p)}(n.startAt));let d=null;return n.endAt&&(d=function(f){const p=!f.before,k=f.values||[];return new qh(k,p)}(n.endAt)),tL(e,s,o,a,l,"F",c,d)}function LL(t,e){const n=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ke(28987,{purpose:s})}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function $k(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=Go(n.unaryFilter.field);return Rn.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Go(n.unaryFilter.field);return Rn.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const a=Go(n.unaryFilter.field);return Rn.create(a,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Go(n.unaryFilter.field);return Rn.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ke(61313);default:return Ke(60726)}}(t):t.fieldFilter!==void 0?function(n){return Rn.create(Go(n.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Ke(58110);default:return Ke(50506)}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return ei.create(n.compositeFilter.filters.map(r=>$k(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Ke(1026)}}(n.compositeFilter.op))}(t):Ke(30097,{filter:t})}function OL(t){return jL[t]}function ML(t){return EL[t]}function FL(t){return kL[t]}function zo(t){return{fieldPath:t.canonicalString()}}function Go(t){return mr.fromServerFormat(t.fieldPath)}function zk(t){return t instanceof Rn?function(n){if(n.op==="=="){if(Wb(n.value))return{unaryFilter:{field:zo(n.field),op:"IS_NAN"}};if(qb(n.value))return{unaryFilter:{field:zo(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(Wb(n.value))return{unaryFilter:{field:zo(n.field),op:"IS_NOT_NAN"}};if(qb(n.value))return{unaryFilter:{field:zo(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:zo(n.field),op:ML(n.op),value:n.value}}}(t):t instanceof ei?function(n){const r=n.getFilters().map(s=>zk(s));return r.length===1?r[0]:{compositeFilter:{op:FL(n.op),filters:r}}}(t):Ke(54877,{filter:t})}function VL(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function Gk(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ha{constructor(e,n,r,s,a=tt.min(),o=tt.min(),l=vr.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=l,this.expectedCount=c}withSequenceNumber(e){return new ha(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new ha(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ha(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ha(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UL{constructor(e){this.wt=e}}function BL(t){const e=DL({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Wh(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $L{constructor(){this.yn=new zL}addToCollectionParentIndex(e,n){return this.yn.add(n),ue.resolve()}getCollectionParents(e,n){return ue.resolve(this.yn.getEntries(n))}addFieldIndex(e,n){return ue.resolve()}deleteFieldIndex(e,n){return ue.resolve()}deleteAllFieldIndexes(e){return ue.resolve()}createTargetIndexes(e,n){return ue.resolve()}getDocumentsMatchingTarget(e,n){return ue.resolve(null)}getIndexType(e,n){return ue.resolve(0)}getFieldIndexes(e,n){return ue.resolve([])}getNextCollectionGroupToUpdate(e){return ue.resolve(null)}getMinOffset(e,n){return ue.resolve(Ia.min())}getMinOffsetFromCollectionGroup(e,n){return ue.resolve(Ia.min())}updateCollectionGroup(e,n,r){return ue.resolve()}updateIndexEntries(e,n){return ue.resolve()}}class zL{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n]||new Bn(Yt.comparator),a=!s.has(r);return this.index[n]=s.add(r),a}has(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Bn(Yt.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o0={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Hk=41943040;class Xr{static withCacheSize(e){return new Xr(e,Xr.DEFAULT_COLLECTION_PERCENTILE,Xr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Xr.DEFAULT_COLLECTION_PERCENTILE=10,Xr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Xr.DEFAULT=new Xr(Hk,Xr.DEFAULT_COLLECTION_PERCENTILE,Xr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Xr.DISABLED=new Xr(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Il{constructor(e){this.nr=e}next(){return this.nr+=2,this.nr}static rr(){return new Il(0)}static ir(){return new Il(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l0="LruGarbageCollector",GL=1048576;function c0([t,e],[n,r]){const s=ht(t,n);return s===0?ht(e,r):s}class HL{constructor(e){this.cr=e,this.buffer=new Bn(c0),this.lr=0}hr(){return++this.lr}Pr(e){const n=[e,this.hr()];if(this.buffer.size<this.cr)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();c0(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class qL{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Tr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ir(6e4)}stop(){this.Tr&&(this.Tr.cancel(),this.Tr=null)}get started(){return this.Tr!==null}Ir(e){Pe(l0,`Garbage collection scheduled in ${e}ms`),this.Tr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Tr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){Wl(n)?Pe(l0,"Ignoring IndexedDB error during garbage collection: ",n):await ql(n)}await this.Ir(3e5)})}}class WL{constructor(e,n){this.Er=e,this.params=n}calculateTargetCount(e,n){return this.Er.dr(e).next(r=>Math.floor(n/100*r))}nthSequenceNumber(e,n){if(n===0)return ue.resolve(Pf.le);const r=new HL(n);return this.Er.forEachTarget(e,s=>r.Pr(s.sequenceNumber)).next(()=>this.Er.Ar(e,s=>r.Pr(s))).next(()=>r.maxValue)}removeTargets(e,n,r){return this.Er.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.Er.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(Pe("LruGarbageCollector","Garbage collection skipped; disabled"),ue.resolve(o0)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(Pe("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),o0):this.Rr(e,n))}getCacheSize(e){return this.Er.getCacheSize(e)}Rr(e,n){let r,s,a,o,l,c,d;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(Pe("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,l=Date.now(),this.removeTargets(e,r,n))).next(f=>(a=f,c=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(d=Date.now(),Bo()<=yt.DEBUG&&Pe("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${s} in `+(l-o)+`ms
	Removed ${a} targets in `+(c-l)+`ms
	Removed ${f} documents in `+(d-c)+`ms
Total Duration: ${d-h}ms`),ue.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:a,documentsRemoved:f})))}}function KL(t,e){return new WL(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QL{constructor(){this.changes=new Ao(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Tr.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?ue.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YL{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JL{constructor(e,n,r,s){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,n))).next(s=>(r!==null&&zc(r.mutation,s,gs.empty(),sn.now()),s))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,vt()).next(()=>r))}getLocalViewOfDocuments(e,n,r=vt()){const s=no();return this.populateOverlays(e,s,n).next(()=>this.computeViews(e,n,s,r).next(a=>{let o=_c();return a.forEach((l,c)=>{o=o.insert(l,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){const r=no();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,vt()))}populateOverlays(e,n,r){const s=[];return r.forEach(a=>{n.has(a)||s.push(a)}),this.documentOverlayCache.getOverlays(e,s).next(a=>{a.forEach((o,l)=>{n.set(o,l)})})}computeViews(e,n,r,s){let a=qi();const o=$c(),l=function(){return $c()}();return n.forEach((c,d)=>{const h=r.get(d.key);s.has(d.key)&&(h===void 0||h.mutation instanceof Ha)?a=a.insert(d.key,d):h!==void 0?(o.set(d.key,h.mutation.getFieldMask()),zc(h.mutation,d,h.mutation.getFieldMask(),sn.now())):o.set(d.key,gs.empty())}),this.recalculateAndSaveOverlays(e,a).next(c=>(c.forEach((d,h)=>o.set(d,h)),n.forEach((d,h)=>{var f;return l.set(d,new YL(h,(f=o.get(d))!==null&&f!==void 0?f:null))}),l))}recalculateAndSaveOverlays(e,n){const r=$c();let s=new hn((o,l)=>o-l),a=vt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(const l of o)l.keys().forEach(c=>{const d=n.get(c);if(d===null)return;let h=r.get(c)||gs.empty();h=l.applyToLocalView(d,h),r.set(c,h);const f=(s.get(l.batchId)||vt()).add(c);s=s.insert(l.batchId,f)})}).next(()=>{const o=[],l=s.getReverseIterator();for(;l.hasNext();){const c=l.getNext(),d=c.key,h=c.value,f=Ck();h.forEach(p=>{if(!a.has(p)){const k=Pk(n.get(p),r.get(p));k!==null&&f.set(p,k),a=a.add(p)}}),o.push(this.documentOverlayCache.saveOverlays(e,d,f))}return ue.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,s){return function(o){return $e.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):bk(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,s):this.getDocumentsMatchingCollectionQuery(e,n,r,s)}getNextDocuments(e,n,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,s).next(a=>{const o=s-a.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,s-a.size):ue.resolve(no());let l=gu,c=a;return o.next(d=>ue.forEach(d,(h,f)=>(l<f.largestBatchId&&(l=f.largestBatchId),a.get(h)?ue.resolve():this.remoteDocumentCache.getEntry(e,h).next(p=>{c=c.insert(h,p)}))).next(()=>this.populateOverlays(e,d,a)).next(()=>this.computeViews(e,c,d,vt())).next(h=>({batchId:l,changes:kk(h)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new $e(n)).next(r=>{let s=_c();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,n,r,s){const a=n.collectionGroup;let o=_c();return this.indexManager.getCollectionParents(e,a).next(l=>ue.forEach(l,c=>{const d=function(f,p){return new Io(p,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(n,c.child(a));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next(h=>{h.forEach((f,p)=>{o=o.insert(f,p)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,n,r,s){let a;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(o=>(a=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,a,s))).next(o=>{a.forEach((c,d)=>{const h=d.getKey();o.get(h)===null&&(o=o.insert(h,Tr.newInvalidDocument(h)))});let l=_c();return o.forEach((c,d)=>{const h=a.get(c);h!==void 0&&zc(h.mutation,d,gs.empty(),sn.now()),Ff(n,d)&&(l=l.insert(c,d))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XL{constructor(e){this.serializer=e,this.Fr=new Map,this.Mr=new Map}getBundleMetadata(e,n){return ue.resolve(this.Fr.get(n))}saveBundleMetadata(e,n){return this.Fr.set(n.id,function(s){return{id:s.id,version:s.version,createTime:vi(s.createTime)}}(n)),ue.resolve()}getNamedQuery(e,n){return ue.resolve(this.Mr.get(n))}saveNamedQuery(e,n){return this.Mr.set(n.name,function(s){return{name:s.name,query:BL(s.bundledQuery),readTime:vi(s.readTime)}}(n)),ue.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZL{constructor(){this.overlays=new hn($e.comparator),this.Or=new Map}getOverlay(e,n){return ue.resolve(this.overlays.get(n))}getOverlays(e,n){const r=no();return ue.forEach(n,s=>this.getOverlay(e,s).next(a=>{a!==null&&r.set(s,a)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((s,a)=>{this.St(e,n,a)}),ue.resolve()}removeOverlaysForBatchId(e,n,r){const s=this.Or.get(r);return s!==void 0&&(s.forEach(a=>this.overlays=this.overlays.remove(a)),this.Or.delete(r)),ue.resolve()}getOverlaysForCollection(e,n,r){const s=no(),a=n.length+1,o=new $e(n.child("")),l=this.overlays.getIteratorFrom(o);for(;l.hasNext();){const c=l.getNext().value,d=c.getKey();if(!n.isPrefixOf(d.path))break;d.path.length===a&&c.largestBatchId>r&&s.set(c.getKey(),c)}return ue.resolve(s)}getOverlaysForCollectionGroup(e,n,r,s){let a=new hn((d,h)=>d-h);const o=this.overlays.getIterator();for(;o.hasNext();){const d=o.getNext().value;if(d.getKey().getCollectionGroup()===n&&d.largestBatchId>r){let h=a.get(d.largestBatchId);h===null&&(h=no(),a=a.insert(d.largestBatchId,h)),h.set(d.getKey(),d)}}const l=no(),c=a.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((d,h)=>l.set(d,h)),!(l.size()>=s)););return ue.resolve(l)}St(e,n,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Or.get(s.largestBatchId).delete(r.key);this.Or.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new vL(n,r));let a=this.Or.get(n);a===void 0&&(a=vt(),this.Or.set(n,a)),this.Or.set(n,a.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eO{constructor(){this.sessionToken=vr.EMPTY_BYTE_STRING}getSessionToken(e){return ue.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,ue.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xv{constructor(){this.Nr=new Bn(Kn.Br),this.Lr=new Bn(Kn.kr)}isEmpty(){return this.Nr.isEmpty()}addReference(e,n){const r=new Kn(e,n);this.Nr=this.Nr.add(r),this.Lr=this.Lr.add(r)}qr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.Qr(new Kn(e,n))}$r(e,n){e.forEach(r=>this.removeReference(r,n))}Ur(e){const n=new $e(new Yt([])),r=new Kn(n,e),s=new Kn(n,e+1),a=[];return this.Lr.forEachInRange([r,s],o=>{this.Qr(o),a.push(o.key)}),a}Kr(){this.Nr.forEach(e=>this.Qr(e))}Qr(e){this.Nr=this.Nr.delete(e),this.Lr=this.Lr.delete(e)}Wr(e){const n=new $e(new Yt([])),r=new Kn(n,e),s=new Kn(n,e+1);let a=vt();return this.Lr.forEachInRange([r,s],o=>{a=a.add(o.key)}),a}containsKey(e){const n=new Kn(e,0),r=this.Nr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class Kn{constructor(e,n){this.key=e,this.Gr=n}static Br(e,n){return $e.comparator(e.key,n.key)||ht(e.Gr,n.Gr)}static kr(e,n){return ht(e.Gr,n.Gr)||$e.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tO{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.Jn=1,this.zr=new Bn(Kn.Br)}checkEmpty(e){return ue.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,s){const a=this.Jn;this.Jn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new yL(a,n,r,s);this.mutationQueue.push(o);for(const l of s)this.zr=this.zr.add(new Kn(l.key,a)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return ue.resolve(o)}lookupMutationBatch(e,n){return ue.resolve(this.jr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=this.Hr(r),a=s<0?0:s;return ue.resolve(this.mutationQueue.length>a?this.mutationQueue[a]:null)}getHighestUnacknowledgedBatchId(){return ue.resolve(this.mutationQueue.length===0?cv:this.Jn-1)}getAllMutationBatches(e){return ue.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new Kn(n,0),s=new Kn(n,Number.POSITIVE_INFINITY),a=[];return this.zr.forEachInRange([r,s],o=>{const l=this.jr(o.Gr);a.push(l)}),ue.resolve(a)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new Bn(ht);return n.forEach(s=>{const a=new Kn(s,0),o=new Kn(s,Number.POSITIVE_INFINITY);this.zr.forEachInRange([a,o],l=>{r=r.add(l.Gr)})}),ue.resolve(this.Jr(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1;let a=r;$e.isDocumentKey(a)||(a=a.child(""));const o=new Kn(new $e(a),0);let l=new Bn(ht);return this.zr.forEachWhile(c=>{const d=c.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(l=l.add(c.Gr)),!0)},o),ue.resolve(this.Jr(l))}Jr(e){const n=[];return e.forEach(r=>{const s=this.jr(r);s!==null&&n.push(s)}),n}removeMutationBatch(e,n){Ut(this.Yr(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.zr;return ue.forEach(n.mutations,s=>{const a=new Kn(s.key,n.batchId);return r=r.delete(a),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.zr=r})}Xn(e){}containsKey(e,n){const r=new Kn(n,0),s=this.zr.firstAfterOrEqual(r);return ue.resolve(n.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,ue.resolve()}Yr(e,n){return this.Hr(e)}Hr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}jr(e){const n=this.Hr(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nO{constructor(e){this.Zr=e,this.docs=function(){return new hn($e.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,s=this.docs.get(r),a=s?s.size:0,o=this.Zr(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:o}),this.size+=o-a,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return ue.resolve(r?r.document.mutableCopy():Tr.newInvalidDocument(n))}getEntries(e,n){let r=qi();return n.forEach(s=>{const a=this.docs.get(s);r=r.insert(s,a?a.document.mutableCopy():Tr.newInvalidDocument(s))}),ue.resolve(r)}getDocumentsMatchingQuery(e,n,r,s){let a=qi();const o=n.path,l=new $e(o.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(l);for(;c.hasNext();){const{key:d,value:{document:h}}=c.getNext();if(!o.isPrefixOf(d.path))break;d.path.length>o.length+1||PD(RD(h),r)<=0||(s.has(h.key)||Ff(n,h))&&(a=a.insert(h.key,h.mutableCopy()))}return ue.resolve(a)}getAllFromCollectionGroup(e,n,r,s){Ke(9500)}Xr(e,n){return ue.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new rO(this)}getSize(e){return ue.resolve(this.size)}}class rO extends QL{constructor(e){super(),this.vr=e}applyChanges(e){const n=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?n.push(this.vr.addEntry(e,s)):this.vr.removeEntry(r)}),ue.waitFor(n)}getFromCache(e,n){return this.vr.getEntry(e,n)}getAllFromCache(e,n){return this.vr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sO{constructor(e){this.persistence=e,this.ei=new Ao(n=>hv(n),fv),this.lastRemoteSnapshotVersion=tt.min(),this.highestTargetId=0,this.ti=0,this.ni=new xv,this.targetCount=0,this.ri=Il.rr()}forEachTarget(e,n){return this.ei.forEach((r,s)=>n(s)),ue.resolve()}getLastRemoteSnapshotVersion(e){return ue.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ue.resolve(this.ti)}allocateTargetId(e){return this.highestTargetId=this.ri.next(),ue.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.ti&&(this.ti=n),ue.resolve()}ar(e){this.ei.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ri=new Il(n),this.highestTargetId=n),e.sequenceNumber>this.ti&&(this.ti=e.sequenceNumber)}addTargetData(e,n){return this.ar(n),this.targetCount+=1,ue.resolve()}updateTargetData(e,n){return this.ar(n),ue.resolve()}removeTargetData(e,n){return this.ei.delete(n.target),this.ni.Ur(n.targetId),this.targetCount-=1,ue.resolve()}removeTargets(e,n,r){let s=0;const a=[];return this.ei.forEach((o,l)=>{l.sequenceNumber<=n&&r.get(l.targetId)===null&&(this.ei.delete(o),a.push(this.removeMatchingKeysForTargetId(e,l.targetId)),s++)}),ue.waitFor(a).next(()=>s)}getTargetCount(e){return ue.resolve(this.targetCount)}getTargetData(e,n){const r=this.ei.get(n)||null;return ue.resolve(r)}addMatchingKeys(e,n,r){return this.ni.qr(n,r),ue.resolve()}removeMatchingKeys(e,n,r){this.ni.$r(n,r);const s=this.persistence.referenceDelegate,a=[];return s&&n.forEach(o=>{a.push(s.markPotentiallyOrphaned(e,o))}),ue.waitFor(a)}removeMatchingKeysForTargetId(e,n){return this.ni.Ur(n),ue.resolve()}getMatchingKeysForTargetId(e,n){const r=this.ni.Wr(n);return ue.resolve(r)}containsKey(e,n){return ue.resolve(this.ni.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qk{constructor(e,n){this.ii={},this.overlays={},this.si=new Pf(0),this.oi=!1,this.oi=!0,this._i=new eO,this.referenceDelegate=e(this),this.ai=new sO(this),this.indexManager=new $L,this.remoteDocumentCache=function(s){return new nO(s)}(r=>this.referenceDelegate.ui(r)),this.serializer=new UL(n),this.ci=new XL(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.oi=!1,Promise.resolve()}get started(){return this.oi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new ZL,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.ii[e.toKey()];return r||(r=new tO(n,this.referenceDelegate),this.ii[e.toKey()]=r),r}getGlobalsCache(){return this._i}getTargetCache(){return this.ai}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.ci}runTransaction(e,n,r){Pe("MemoryPersistence","Starting transaction:",e);const s=new iO(this.si.next());return this.referenceDelegate.li(),r(s).next(a=>this.referenceDelegate.hi(s).next(()=>a)).toPromise().then(a=>(s.raiseOnCommittedEvent(),a))}Pi(e,n){return ue.or(Object.values(this.ii).map(r=>()=>r.containsKey(e,n)))}}class iO extends LD{constructor(e){super(),this.currentSequenceNumber=e}}class wv{constructor(e){this.persistence=e,this.Ti=new xv,this.Ii=null}static Ei(e){return new wv(e)}get di(){if(this.Ii)return this.Ii;throw Ke(60996)}addReference(e,n,r){return this.Ti.addReference(r,n),this.di.delete(r.toString()),ue.resolve()}removeReference(e,n,r){return this.Ti.removeReference(r,n),this.di.add(r.toString()),ue.resolve()}markPotentiallyOrphaned(e,n){return this.di.add(n.toString()),ue.resolve()}removeTarget(e,n){this.Ti.Ur(n.targetId).forEach(s=>this.di.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(s=>{s.forEach(a=>this.di.add(a.toString()))}).next(()=>r.removeTargetData(e,n))}li(){this.Ii=new Set}hi(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ue.forEach(this.di,r=>{const s=$e.fromPath(r);return this.Ai(e,s).next(a=>{a||n.removeEntry(s,tt.min())})}).next(()=>(this.Ii=null,n.apply(e)))}updateLimboDocument(e,n){return this.Ai(e,n).next(r=>{r?this.di.delete(n.toString()):this.di.add(n.toString())})}ui(e){return 0}Ai(e,n){return ue.or([()=>ue.resolve(this.Ti.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Pi(e,n)])}}class Qh{constructor(e,n){this.persistence=e,this.Ri=new Ao(r=>FD(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=KL(this,n)}static Ei(e,n){return new Qh(e,n)}li(){}hi(e){return ue.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}dr(e){const n=this.Vr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>n.next(s=>r+s))}Vr(e){let n=0;return this.Ar(e,r=>{n++}).next(()=>n)}Ar(e,n){return ue.forEach(this.Ri,(r,s)=>this.gr(e,r,s).next(a=>a?ue.resolve():n(s)))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const s=this.persistence.getRemoteDocumentCache(),a=s.newChangeBuffer();return s.Xr(e,o=>this.gr(e,o,n).next(l=>{l||(r++,a.removeEntry(o,tt.min()))})).next(()=>a.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,n){return this.Ri.set(n,e.currentSequenceNumber),ue.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.Ri.set(r,e.currentSequenceNumber),ue.resolve()}removeReference(e,n,r){return this.Ri.set(r,e.currentSequenceNumber),ue.resolve()}updateLimboDocument(e,n){return this.Ri.set(n,e.currentSequenceNumber),ue.resolve()}ui(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=eh(e.data.value)),n}gr(e,n,r){return ue.or([()=>this.persistence.Pi(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const s=this.Ri.get(n);return ue.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bv{constructor(e,n,r,s){this.targetId=e,this.fromCache=n,this.ls=r,this.hs=s}static Ps(e,n){let r=vt(),s=vt();for(const a of n.docChanges)switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:s=s.add(a.doc.key)}return new bv(e,n.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aO{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oO{constructor(){this.Ts=!1,this.Is=!1,this.Es=100,this.ds=function(){return bA()?8:OD(Mr())>0?6:4}()}initialize(e,n){this.As=e,this.indexManager=n,this.Ts=!0}getDocumentsMatchingQuery(e,n,r,s){const a={result:null};return this.Rs(e,n).next(o=>{a.result=o}).next(()=>{if(!a.result)return this.Vs(e,n,s,r).next(o=>{a.result=o})}).next(()=>{if(a.result)return;const o=new aO;return this.fs(e,n,o).next(l=>{if(a.result=l,this.Is)return this.gs(e,n,o,l.size)})}).next(()=>a.result)}gs(e,n,r,s){return r.documentReadCount<this.Es?(Bo()<=yt.DEBUG&&Pe("QueryEngine","SDK will not create cache indexes for query:",$o(n),"since it only creates cache indexes for collection contains","more than or equal to",this.Es,"documents"),ue.resolve()):(Bo()<=yt.DEBUG&&Pe("QueryEngine","Query:",$o(n),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.ds*s?(Bo()<=yt.DEBUG&&Pe("QueryEngine","The SDK decides to create cache indexes for query:",$o(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,yi(n))):ue.resolve())}Rs(e,n){if(Jb(n))return ue.resolve(null);let r=yi(n);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(n.limit!==null&&s===1&&(n=Wh(n,null,"F"),r=yi(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(a=>{const o=vt(...a);return this.As.getDocuments(e,o).next(l=>this.indexManager.getMinOffset(e,r).next(c=>{const d=this.ps(n,l);return this.ys(n,d,o,c.readTime)?this.Rs(e,Wh(n,null,"F")):this.ws(e,d,n,c)}))})))}Vs(e,n,r,s){return Jb(n)||s.isEqual(tt.min())?ue.resolve(null):this.As.getDocuments(e,r).next(a=>{const o=this.ps(n,a);return this.ys(n,o,r,s)?ue.resolve(null):(Bo()<=yt.DEBUG&&Pe("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),$o(n)),this.ws(e,o,n,AD(s,gu)).next(l=>l))})}ps(e,n){let r=new Bn(jk(e));return n.forEach((s,a)=>{Ff(e,a)&&(r=r.add(a))}),r}ys(e,n,r,s){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const a=e.limitType==="F"?n.last():n.first();return!!a&&(a.hasPendingWrites||a.version.compareTo(s)>0)}fs(e,n,r){return Bo()<=yt.DEBUG&&Pe("QueryEngine","Using full collection scan to execute query:",$o(n)),this.As.getDocumentsMatchingQuery(e,n,Ia.min(),r)}ws(e,n,r,s){return this.As.getDocumentsMatchingQuery(e,r,s).next(a=>(n.forEach(o=>{a=a.insert(o.key,o)}),a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _v="LocalStore",lO=3e8;class cO{constructor(e,n,r,s){this.persistence=e,this.bs=n,this.serializer=s,this.Ss=new hn(ht),this.Ds=new Ao(a=>hv(a),fv),this.vs=new Map,this.Cs=e.getRemoteDocumentCache(),this.ai=e.getTargetCache(),this.ci=e.getBundleCache(),this.Fs(r)}Fs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new JL(this.Cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Cs.setIndexManager(this.indexManager),this.bs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.Ss))}}function uO(t,e,n,r){return new cO(t,e,n,r)}async function Wk(t,e){const n=rt(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let s;return n.mutationQueue.getAllMutationBatches(r).next(a=>(s=a,n.Fs(e),n.mutationQueue.getAllMutationBatches(r))).next(a=>{const o=[],l=[];let c=vt();for(const d of s){o.push(d.batchId);for(const h of d.mutations)c=c.add(h.key)}for(const d of a){l.push(d.batchId);for(const h of d.mutations)c=c.add(h.key)}return n.localDocuments.getDocuments(r,c).next(d=>({Ms:d,removedBatchIds:o,addedBatchIds:l}))})})}function dO(t,e){const n=rt(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),a=n.Cs.newChangeBuffer({trackRemovals:!0});return function(l,c,d,h){const f=d.batch,p=f.keys();let k=ue.resolve();return p.forEach(S=>{k=k.next(()=>h.getEntry(c,S)).next(T=>{const C=d.docVersions.get(S);Ut(C!==null,48541),T.version.compareTo(C)<0&&(f.applyToRemoteDocument(T,d),T.isValidDocument()&&(T.setReadTime(d.commitVersion),h.addEntry(T)))})}),k.next(()=>l.mutationQueue.removeMutationBatch(c,f))}(n,r,e,a).next(()=>a.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let c=vt();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(c=c.add(l.batch.mutations[d].key));return c}(e))).next(()=>n.localDocuments.getDocuments(r,s))})}function Kk(t){const e=rt(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.ai.getLastRemoteSnapshotVersion(n))}function hO(t,e){const n=rt(t),r=e.snapshotVersion;let s=n.Ss;return n.persistence.runTransaction("Apply remote event","readwrite-primary",a=>{const o=n.Cs.newChangeBuffer({trackRemovals:!0});s=n.Ss;const l=[];e.targetChanges.forEach((h,f)=>{const p=s.get(f);if(!p)return;l.push(n.ai.removeMatchingKeys(a,h.removedDocuments,f).next(()=>n.ai.addMatchingKeys(a,h.addedDocuments,f)));let k=p.withSequenceNumber(a.currentSequenceNumber);e.targetMismatches.get(f)!==null?k=k.withResumeToken(vr.EMPTY_BYTE_STRING,tt.min()).withLastLimboFreeSnapshotVersion(tt.min()):h.resumeToken.approximateByteSize()>0&&(k=k.withResumeToken(h.resumeToken,r)),s=s.insert(f,k),function(T,C,j){return T.resumeToken.approximateByteSize()===0||C.snapshotVersion.toMicroseconds()-T.snapshotVersion.toMicroseconds()>=lO?!0:j.addedDocuments.size+j.modifiedDocuments.size+j.removedDocuments.size>0}(p,k,h)&&l.push(n.ai.updateTargetData(a,k))});let c=qi(),d=vt();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&l.push(n.persistence.referenceDelegate.updateLimboDocument(a,h))}),l.push(fO(a,o,e.documentUpdates).next(h=>{c=h.xs,d=h.Os})),!r.isEqual(tt.min())){const h=n.ai.getLastRemoteSnapshotVersion(a).next(f=>n.ai.setTargetsMetadata(a,a.currentSequenceNumber,r));l.push(h)}return ue.waitFor(l).next(()=>o.apply(a)).next(()=>n.localDocuments.getLocalViewOfDocuments(a,c,d)).next(()=>c)}).then(a=>(n.Ss=s,a))}function fO(t,e,n){let r=vt(),s=vt();return n.forEach(a=>r=r.add(a)),e.getEntries(t,r).next(a=>{let o=qi();return n.forEach((l,c)=>{const d=a.get(l);c.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(l)),c.isNoDocument()&&c.version.isEqual(tt.min())?(e.removeEntry(l,c.readTime),o=o.insert(l,c)):!d.isValidDocument()||c.version.compareTo(d.version)>0||c.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(c),o=o.insert(l,c)):Pe(_v,"Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",c.version)}),{xs:o,Os:s}})}function pO(t,e){const n=rt(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=cv),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function mO(t,e){const n=rt(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return n.ai.getTargetData(r,e).next(a=>a?(s=a,ue.resolve(s)):n.ai.allocateTargetId(r).next(o=>(s=new ha(e,o,"TargetPurposeListen",r.currentSequenceNumber),n.ai.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=n.Ss.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Ss=n.Ss.insert(r.targetId,r),n.Ds.set(e,r.targetId)),r})}async function Cg(t,e,n){const r=rt(t),s=r.Ss.get(e),a=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",a,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Wl(o))throw o;Pe(_v,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ss=r.Ss.remove(e),r.Ds.delete(s.target)}function u0(t,e,n){const r=rt(t);let s=tt.min(),a=vt();return r.persistence.runTransaction("Execute query","readwrite",o=>function(c,d,h){const f=rt(c),p=f.Ds.get(h);return p!==void 0?ue.resolve(f.Ss.get(p)):f.ai.getTargetData(d,h)}(r,o,yi(e)).next(l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.ai.getMatchingKeysForTargetId(o,l.targetId).next(c=>{a=c})}).next(()=>r.bs.getDocumentsMatchingQuery(o,e,n?s:tt.min(),n?a:vt())).next(l=>(gO(r,rL(e),l),{documents:l,Ns:a})))}function gO(t,e,n){let r=t.vs.get(e)||tt.min();n.forEach((s,a)=>{a.readTime.compareTo(r)>0&&(r=a.readTime)}),t.vs.set(e,r)}class d0{constructor(){this.activeTargetIds=cL()}$s(e){this.activeTargetIds=this.activeTargetIds.add(e)}Us(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Qs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class yO{constructor(){this.So=new d0,this.Do={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.So.$s(e),this.Do[e]||"not-current"}updateQueryState(e,n,r){this.Do[e]=n}removeLocalQueryTarget(e){this.So.Us(e)}isLocalQueryTarget(e){return this.So.activeTargetIds.has(e)}clearQueryState(e){delete this.Do[e]}getAllActiveQueryTargets(){return this.So.activeTargetIds}isActiveQueryTarget(e){return this.So.activeTargetIds.has(e)}start(){return this.So=new d0,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vO{vo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h0="ConnectivityMonitor";class f0{constructor(){this.Co=()=>this.Fo(),this.Mo=()=>this.xo(),this.Oo=[],this.No()}vo(e){this.Oo.push(e)}shutdown(){window.removeEventListener("online",this.Co),window.removeEventListener("offline",this.Mo)}No(){window.addEventListener("online",this.Co),window.addEventListener("offline",this.Mo)}Fo(){Pe(h0,"Network connectivity changed: AVAILABLE");for(const e of this.Oo)e(0)}xo(){Pe(h0,"Network connectivity changed: UNAVAILABLE");for(const e of this.Oo)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Nd=null;function Sg(){return Nd===null?Nd=function(){return 268435456+Math.round(2147483648*Math.random())}():Nd++,"0x"+Nd.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yp="RestConnection",xO={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class wO{get Bo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Lo=n+"://"+e.host,this.ko=`projects/${r}/databases/${s}`,this.qo=this.databaseId.database===Gh?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Qo(e,n,r,s,a){const o=Sg(),l=this.$o(e,n.toUriEncodedString());Pe(Yp,`Sending RPC '${e}' ${o}:`,l,r);const c={"google-cloud-resource-prefix":this.ko,"x-goog-request-params":this.qo};this.Uo(c,s,a);const{host:d}=new URL(l),h=Ua(d);return this.Ko(e,l,c,r,h).then(f=>(Pe(Yp,`Received RPC '${e}' ${o}: `,f),f),f=>{throw kl(Yp,`RPC '${e}' ${o} failed with error: `,f,"url: ",l,"request:",r),f})}Wo(e,n,r,s,a,o){return this.Qo(e,n,r,s,a)}Uo(e,n,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Hl}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,a)=>e[a]=s),r&&r.headers.forEach((s,a)=>e[a]=s)}$o(e,n){const r=xO[e];return`${this.Lo}/v1/${n}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bO{constructor(e){this.Go=e.Go,this.zo=e.zo}jo(e){this.Ho=e}Jo(e){this.Yo=e}Zo(e){this.Xo=e}onMessage(e){this.e_=e}close(){this.zo()}send(e){this.Go(e)}t_(){this.Ho()}n_(){this.Yo()}r_(e){this.Xo(e)}i_(e){this.e_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cr="WebChannelConnection";class _O extends wO{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ko(e,n,r,s,a){const o=Sg();return new Promise((l,c)=>{const d=new YE;d.setWithCredentials(!0),d.listenOnce(JE.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case Zd.NO_ERROR:const f=d.getResponseJson();Pe(Cr,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(f)),l(f);break;case Zd.TIMEOUT:Pe(Cr,`RPC '${e}' ${o} timed out`),c(new Ie(ce.DEADLINE_EXCEEDED,"Request time out"));break;case Zd.HTTP_ERROR:const p=d.getStatus();if(Pe(Cr,`RPC '${e}' ${o} failed with status:`,p,"response text:",d.getResponseText()),p>0){let k=d.getResponseJson();Array.isArray(k)&&(k=k[0]);const S=k==null?void 0:k.error;if(S&&S.status&&S.message){const T=function(j){const y=j.toLowerCase().replace(/_/g,"-");return Object.values(ce).indexOf(y)>=0?y:ce.UNKNOWN}(S.status);c(new Ie(T,S.message))}else c(new Ie(ce.UNKNOWN,"Server responded with status "+d.getStatus()))}else c(new Ie(ce.UNAVAILABLE,"Connection failed."));break;default:Ke(9055,{s_:e,streamId:o,o_:d.getLastErrorCode(),__:d.getLastError()})}}finally{Pe(Cr,`RPC '${e}' ${o} completed.`)}});const h=JSON.stringify(s);Pe(Cr,`RPC '${e}' ${o} sending request:`,s),d.send(n,"POST",h,r,15)})}a_(e,n,r){const s=Sg(),a=[this.Lo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=ek(),l=ZE(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(c.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Uo(c.initMessageHeaders,n,r),c.encodeInitMessageHeaders=!0;const h=a.join("");Pe(Cr,`Creating RPC '${e}' stream ${s}: ${h}`,c);const f=o.createWebChannel(h,c);let p=!1,k=!1;const S=new bO({Go:C=>{k?Pe(Cr,`Not sending because RPC '${e}' stream ${s} is closed:`,C):(p||(Pe(Cr,`Opening RPC '${e}' stream ${s} transport.`),f.open(),p=!0),Pe(Cr,`RPC '${e}' stream ${s} sending:`,C),f.send(C))},zo:()=>f.close()}),T=(C,j,y)=>{C.listen(j,v=>{try{y(v)}catch(R){setTimeout(()=>{throw R},0)}})};return T(f,bc.EventType.OPEN,()=>{k||(Pe(Cr,`RPC '${e}' stream ${s} transport opened.`),S.t_())}),T(f,bc.EventType.CLOSE,()=>{k||(k=!0,Pe(Cr,`RPC '${e}' stream ${s} transport closed`),S.r_())}),T(f,bc.EventType.ERROR,C=>{k||(k=!0,kl(Cr,`RPC '${e}' stream ${s} transport errored. Name:`,C.name,"Message:",C.message),S.r_(new Ie(ce.UNAVAILABLE,"The operation could not be completed")))}),T(f,bc.EventType.MESSAGE,C=>{var j;if(!k){const y=C.data[0];Ut(!!y,16349);const v=y,R=(v==null?void 0:v.error)||((j=v[0])===null||j===void 0?void 0:j.error);if(R){Pe(Cr,`RPC '${e}' stream ${s} received error:`,R);const O=R.status;let M=function(w){const E=Tn[w];if(E!==void 0)return Lk(E)}(O),b=R.message;M===void 0&&(M=ce.INTERNAL,b="Unknown error status: "+O+" with message "+R.message),k=!0,S.r_(new Ie(M,b)),f.close()}else Pe(Cr,`RPC '${e}' stream ${s} received:`,y),S.i_(y)}}),T(l,XE.STAT_EVENT,C=>{C.stat===mg.PROXY?Pe(Cr,`RPC '${e}' stream ${s} detected buffering proxy`):C.stat===mg.NOPROXY&&Pe(Cr,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{S.n_()},0),S}}function Jp(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zf(t){return new CL(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qk{constructor(e,n,r=1e3,s=1.5,a=6e4){this.bi=e,this.timerId=n,this.u_=r,this.c_=s,this.l_=a,this.h_=0,this.P_=null,this.T_=Date.now(),this.reset()}reset(){this.h_=0}I_(){this.h_=this.l_}E_(e){this.cancel();const n=Math.floor(this.h_+this.d_()),r=Math.max(0,Date.now()-this.T_),s=Math.max(0,n-r);s>0&&Pe("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.h_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.P_=this.bi.enqueueAfterDelay(this.timerId,s,()=>(this.T_=Date.now(),e())),this.h_*=this.c_,this.h_<this.u_&&(this.h_=this.u_),this.h_>this.l_&&(this.h_=this.l_)}A_(){this.P_!==null&&(this.P_.skipDelay(),this.P_=null)}cancel(){this.P_!==null&&(this.P_.cancel(),this.P_=null)}d_(){return(Math.random()-.5)*this.h_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p0="PersistentStream";class Yk{constructor(e,n,r,s,a,o,l,c){this.bi=e,this.R_=r,this.V_=s,this.connection=a,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=l,this.listener=c,this.state=0,this.m_=0,this.f_=null,this.g_=null,this.stream=null,this.p_=0,this.y_=new Qk(e,n)}w_(){return this.state===1||this.state===5||this.b_()}b_(){return this.state===2||this.state===3}start(){this.p_=0,this.state!==4?this.auth():this.S_()}async stop(){this.w_()&&await this.close(0)}D_(){this.state=0,this.y_.reset()}v_(){this.b_()&&this.f_===null&&(this.f_=this.bi.enqueueAfterDelay(this.R_,6e4,()=>this.C_()))}F_(e){this.M_(),this.stream.send(e)}async C_(){if(this.b_())return this.close(0)}M_(){this.f_&&(this.f_.cancel(),this.f_=null)}x_(){this.g_&&(this.g_.cancel(),this.g_=null)}async close(e,n){this.M_(),this.x_(),this.y_.cancel(),this.m_++,e!==4?this.y_.reset():n&&n.code===ce.RESOURCE_EXHAUSTED?(Hi(n.toString()),Hi("Using maximum backoff delay to prevent overloading the backend."),this.y_.I_()):n&&n.code===ce.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.O_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Zo(n)}O_(){}auth(){this.state=1;const e=this.N_(this.m_),n=this.m_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.m_===n&&this.B_(r,s)},r=>{e(()=>{const s=new Ie(ce.UNKNOWN,"Fetching auth token failed: "+r.message);return this.L_(s)})})}B_(e,n){const r=this.N_(this.m_);this.stream=this.k_(e,n),this.stream.jo(()=>{r(()=>this.listener.jo())}),this.stream.Jo(()=>{r(()=>(this.state=2,this.g_=this.bi.enqueueAfterDelay(this.V_,1e4,()=>(this.b_()&&(this.state=3),Promise.resolve())),this.listener.Jo()))}),this.stream.Zo(s=>{r(()=>this.L_(s))}),this.stream.onMessage(s=>{r(()=>++this.p_==1?this.q_(s):this.onNext(s))})}S_(){this.state=5,this.y_.E_(async()=>{this.state=0,this.start()})}L_(e){return Pe(p0,`close with error: ${e}`),this.stream=null,this.close(4,e)}N_(e){return n=>{this.bi.enqueueAndForget(()=>this.m_===e?n():(Pe(p0,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class jO extends Yk{constructor(e,n,r,s,a,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,s,o),this.serializer=a}k_(e,n){return this.connection.a_("Listen",e,n)}q_(e){return this.onNext(e)}onNext(e){this.y_.reset();const n=TL(this.serializer,e),r=function(a){if(!("targetChange"in a))return tt.min();const o=a.targetChange;return o.targetIds&&o.targetIds.length?tt.min():o.readTime?vi(o.readTime):tt.min()}(e);return this.listener.Q_(n,r)}U_(e){const n={};n.database=kg(this.serializer),n.addTarget=function(a,o){let l;const c=o.target;if(l=wg(c)?{documents:RL(a,c)}:{query:PL(a,c).gt},l.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){l.resumeToken=Fk(a,o.resumeToken);const d=_g(a,o.expectedCount);d!==null&&(l.expectedCount=d)}else if(o.snapshotVersion.compareTo(tt.min())>0){l.readTime=Kh(a,o.snapshotVersion.toTimestamp());const d=_g(a,o.expectedCount);d!==null&&(l.expectedCount=d)}return l}(this.serializer,e);const r=LL(this.serializer,e);r&&(n.labels=r),this.F_(n)}K_(e){const n={};n.database=kg(this.serializer),n.removeTarget=e,this.F_(n)}}class EO extends Yk{constructor(e,n,r,s,a,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,s,o),this.serializer=a}get W_(){return this.p_>0}start(){this.lastStreamToken=void 0,super.start()}O_(){this.W_&&this.G_([])}k_(e,n){return this.connection.a_("Write",e,n)}q_(e){return Ut(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Ut(!e.writeResults||e.writeResults.length===0,55816),this.listener.z_()}onNext(e){Ut(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.y_.reset();const n=AL(e.writeResults,e.commitTime),r=vi(e.commitTime);return this.listener.j_(r,n)}H_(){const e={};e.database=kg(this.serializer),this.F_(e)}G_(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>IL(this.serializer,r))};this.F_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kO{}class CO extends kO{constructor(e,n,r,s){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=s,this.J_=!1}Y_(){if(this.J_)throw new Ie(ce.FAILED_PRECONDITION,"The client has already been terminated.")}Qo(e,n,r,s){return this.Y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,o])=>this.connection.Qo(e,jg(n,r),s,a,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===ce.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new Ie(ce.UNKNOWN,a.toString())})}Wo(e,n,r,s,a){return this.Y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,l])=>this.connection.Wo(e,jg(n,r),s,o,l,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===ce.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Ie(ce.UNKNOWN,o.toString())})}terminate(){this.J_=!0,this.connection.terminate()}}class SO{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.Z_=0,this.X_=null,this.ea=!0}ta(){this.Z_===0&&(this.na("Unknown"),this.X_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.X_=null,this.ra("Backend didn't respond within 10 seconds."),this.na("Offline"),Promise.resolve())))}ia(e){this.state==="Online"?this.na("Unknown"):(this.Z_++,this.Z_>=1&&(this.sa(),this.ra(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.na("Offline")))}set(e){this.sa(),this.Z_=0,e==="Online"&&(this.ea=!1),this.na(e)}na(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ra(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ea?(Hi(n),this.ea=!1):Pe("OnlineStateTracker",n)}sa(){this.X_!==null&&(this.X_.cancel(),this.X_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bo="RemoteStore";class NO{constructor(e,n,r,s,a){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.oa=[],this._a=new Map,this.aa=new Set,this.ua=[],this.ca=a,this.ca.vo(o=>{r.enqueueAndForget(async()=>{Ro(this)&&(Pe(bo,"Restarting streams for network reachability change."),await async function(c){const d=rt(c);d.aa.add(4),await $u(d),d.la.set("Unknown"),d.aa.delete(4),await Gf(d)}(this))})}),this.la=new SO(r,s)}}async function Gf(t){if(Ro(t))for(const e of t.ua)await e(!0)}async function $u(t){for(const e of t.ua)await e(!1)}function Jk(t,e){const n=rt(t);n._a.has(e.targetId)||(n._a.set(e.targetId,e),Cv(n)?kv(n):Kl(n).b_()&&Ev(n,e))}function jv(t,e){const n=rt(t),r=Kl(n);n._a.delete(e),r.b_()&&Xk(n,e),n._a.size===0&&(r.b_()?r.v_():Ro(n)&&n.la.set("Unknown"))}function Ev(t,e){if(t.ha.Ke(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(tt.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Kl(t).U_(e)}function Xk(t,e){t.ha.Ke(e),Kl(t).K_(e)}function kv(t){t.ha=new _L({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Rt:e=>t._a.get(e)||null,Pt:()=>t.datastore.serializer.databaseId}),Kl(t).start(),t.la.ta()}function Cv(t){return Ro(t)&&!Kl(t).w_()&&t._a.size>0}function Ro(t){return rt(t).aa.size===0}function Zk(t){t.ha=void 0}async function TO(t){t.la.set("Online")}async function IO(t){t._a.forEach((e,n)=>{Ev(t,e)})}async function AO(t,e){Zk(t),Cv(t)?(t.la.ia(e),kv(t)):t.la.set("Unknown")}async function RO(t,e,n){if(t.la.set("Online"),e instanceof Mk&&e.state===2&&e.cause)try{await async function(s,a){const o=a.cause;for(const l of a.targetIds)s._a.has(l)&&(await s.remoteSyncer.rejectListen(l,o),s._a.delete(l),s.ha.removeTarget(l))}(t,e)}catch(r){Pe(bo,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Yh(t,r)}else if(e instanceof rh?t.ha.Xe(e):e instanceof Ok?t.ha.ot(e):t.ha.nt(e),!n.isEqual(tt.min()))try{const r=await Kk(t.localStore);n.compareTo(r)>=0&&await function(a,o){const l=a.ha.It(o);return l.targetChanges.forEach((c,d)=>{if(c.resumeToken.approximateByteSize()>0){const h=a._a.get(d);h&&a._a.set(d,h.withResumeToken(c.resumeToken,o))}}),l.targetMismatches.forEach((c,d)=>{const h=a._a.get(c);if(!h)return;a._a.set(c,h.withResumeToken(vr.EMPTY_BYTE_STRING,h.snapshotVersion)),Xk(a,c);const f=new ha(h.target,c,d,h.sequenceNumber);Ev(a,f)}),a.remoteSyncer.applyRemoteEvent(l)}(t,n)}catch(r){Pe(bo,"Failed to raise snapshot:",r),await Yh(t,r)}}async function Yh(t,e,n){if(!Wl(e))throw e;t.aa.add(1),await $u(t),t.la.set("Offline"),n||(n=()=>Kk(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{Pe(bo,"Retrying IndexedDB access"),await n(),t.aa.delete(1),await Gf(t)})}function eC(t,e){return e().catch(n=>Yh(t,n,e))}async function Hf(t){const e=rt(t),n=Da(e);let r=e.oa.length>0?e.oa[e.oa.length-1].batchId:cv;for(;PO(e);)try{const s=await pO(e.localStore,r);if(s===null){e.oa.length===0&&n.v_();break}r=s.batchId,DO(e,s)}catch(s){await Yh(e,s)}tC(e)&&nC(e)}function PO(t){return Ro(t)&&t.oa.length<10}function DO(t,e){t.oa.push(e);const n=Da(t);n.b_()&&n.W_&&n.G_(e.mutations)}function tC(t){return Ro(t)&&!Da(t).w_()&&t.oa.length>0}function nC(t){Da(t).start()}async function LO(t){Da(t).H_()}async function OO(t){const e=Da(t);for(const n of t.oa)e.G_(n.mutations)}async function MO(t,e,n){const r=t.oa.shift(),s=gv.from(r,e,n);await eC(t,()=>t.remoteSyncer.applySuccessfulWrite(s)),await Hf(t)}async function FO(t,e){e&&Da(t).W_&&await async function(r,s){if(function(o){return wL(o)&&o!==ce.ABORTED}(s.code)){const a=r.oa.shift();Da(r).D_(),await eC(r,()=>r.remoteSyncer.rejectFailedWrite(a.batchId,s)),await Hf(r)}}(t,e),tC(t)&&nC(t)}async function m0(t,e){const n=rt(t);n.asyncQueue.verifyOperationInProgress(),Pe(bo,"RemoteStore received new credentials");const r=Ro(n);n.aa.add(3),await $u(n),r&&n.la.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.aa.delete(3),await Gf(n)}async function VO(t,e){const n=rt(t);e?(n.aa.delete(2),await Gf(n)):e||(n.aa.add(2),await $u(n),n.la.set("Unknown"))}function Kl(t){return t.Pa||(t.Pa=function(n,r,s){const a=rt(n);return a.Y_(),new jO(r,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,s)}(t.datastore,t.asyncQueue,{jo:TO.bind(null,t),Jo:IO.bind(null,t),Zo:AO.bind(null,t),Q_:RO.bind(null,t)}),t.ua.push(async e=>{e?(t.Pa.D_(),Cv(t)?kv(t):t.la.set("Unknown")):(await t.Pa.stop(),Zk(t))})),t.Pa}function Da(t){return t.Ta||(t.Ta=function(n,r,s){const a=rt(n);return a.Y_(),new EO(r,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,s)}(t.datastore,t.asyncQueue,{jo:()=>Promise.resolve(),Jo:LO.bind(null,t),Zo:FO.bind(null,t),z_:OO.bind(null,t),j_:MO.bind(null,t)}),t.ua.push(async e=>{e?(t.Ta.D_(),await Hf(t)):(await t.Ta.stop(),t.oa.length>0&&(Pe(bo,`Stopping write stream with ${t.oa.length} pending writes`),t.oa=[]))})),t.Ta}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sv{constructor(e,n,r,s,a){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=s,this.removalCallback=a,this.deferred=new Mi,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,s,a){const o=Date.now()+r,l=new Sv(e,n,o,s,a);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Ie(ce.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Nv(t,e){if(Hi("AsyncQueue",`${e}: ${t}`),Wl(t))return new Ie(ce.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ml{static emptySet(e){return new ml(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||$e.comparator(n.key,r.key):(n,r)=>$e.comparator(n.key,r.key),this.keyedMap=_c(),this.sortedSet=new hn(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof ml)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const s=n.getNext().key,a=r.getNext().key;if(!s.isEqual(a))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new ml;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g0{constructor(){this.Ia=new hn($e.comparator)}track(e){const n=e.doc.key,r=this.Ia.get(n);r?e.type!==0&&r.type===3?this.Ia=this.Ia.insert(n,e):e.type===3&&r.type!==1?this.Ia=this.Ia.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.Ia=this.Ia.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.Ia=this.Ia.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.Ia=this.Ia.remove(n):e.type===1&&r.type===2?this.Ia=this.Ia.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.Ia=this.Ia.insert(n,{type:2,doc:e.doc}):Ke(63341,{Vt:e,Ea:r}):this.Ia=this.Ia.insert(n,e)}da(){const e=[];return this.Ia.inorderTraversal((n,r)=>{e.push(r)}),e}}class Al{constructor(e,n,r,s,a,o,l,c,d){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=a,this.fromCache=o,this.syncStateChanged=l,this.excludesMetadataChanges=c,this.hasCachedResults=d}static fromInitialDocuments(e,n,r,s,a){const o=[];return n.forEach(l=>{o.push({type:0,doc:l})}),new Al(e,n,ml.emptySet(n),o,r,s,!0,!1,a)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Mf(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(n[s].type!==r[s].type||!n[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UO{constructor(){this.Aa=void 0,this.Ra=[]}Va(){return this.Ra.some(e=>e.ma())}}class BO{constructor(){this.queries=y0(),this.onlineState="Unknown",this.fa=new Set}terminate(){(function(n,r){const s=rt(n),a=s.queries;s.queries=y0(),a.forEach((o,l)=>{for(const c of l.Ra)c.onError(r)})})(this,new Ie(ce.ABORTED,"Firestore shutting down"))}}function y0(){return new Ao(t=>_k(t),Mf)}async function Tv(t,e){const n=rt(t);let r=3;const s=e.query;let a=n.queries.get(s);a?!a.Va()&&e.ma()&&(r=2):(a=new UO,r=e.ma()?0:1);try{switch(r){case 0:a.Aa=await n.onListen(s,!0);break;case 1:a.Aa=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(o){const l=Nv(o,`Initialization of query '${$o(e.query)}' failed`);return void e.onError(l)}n.queries.set(s,a),a.Ra.push(e),e.ga(n.onlineState),a.Aa&&e.pa(a.Aa)&&Av(n)}async function Iv(t,e){const n=rt(t),r=e.query;let s=3;const a=n.queries.get(r);if(a){const o=a.Ra.indexOf(e);o>=0&&(a.Ra.splice(o,1),a.Ra.length===0?s=e.ma()?0:1:!a.Va()&&e.ma()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function $O(t,e){const n=rt(t);let r=!1;for(const s of e){const a=s.query,o=n.queries.get(a);if(o){for(const l of o.Ra)l.pa(s)&&(r=!0);o.Aa=s}}r&&Av(n)}function zO(t,e,n){const r=rt(t),s=r.queries.get(e);if(s)for(const a of s.Ra)a.onError(n);r.queries.delete(e)}function Av(t){t.fa.forEach(e=>{e.next()})}var Ng,v0;(v0=Ng||(Ng={})).ya="default",v0.Cache="cache";class Rv{constructor(e,n,r){this.query=e,this.wa=n,this.ba=!1,this.Sa=null,this.onlineState="Unknown",this.options=r||{}}pa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Al(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.ba?this.Da(e)&&(this.wa.next(e),n=!0):this.va(e,this.onlineState)&&(this.Ca(e),n=!0),this.Sa=e,n}onError(e){this.wa.error(e)}ga(e){this.onlineState=e;let n=!1;return this.Sa&&!this.ba&&this.va(this.Sa,e)&&(this.Ca(this.Sa),n=!0),n}va(e,n){if(!e.fromCache||!this.ma())return!0;const r=n!=="Offline";return(!this.options.Fa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Da(e){if(e.docChanges.length>0)return!0;const n=this.Sa&&this.Sa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}Ca(e){e=Al.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ba=!0,this.wa.next(e)}ma(){return this.options.source!==Ng.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rC{constructor(e){this.key=e}}class sC{constructor(e){this.key=e}}class GO{constructor(e,n){this.query=e,this.qa=n,this.Qa=null,this.hasCachedResults=!1,this.current=!1,this.$a=vt(),this.mutatedKeys=vt(),this.Ua=jk(e),this.Ka=new ml(this.Ua)}get Wa(){return this.qa}Ga(e,n){const r=n?n.za:new g0,s=n?n.Ka:this.Ka;let a=n?n.mutatedKeys:this.mutatedKeys,o=s,l=!1;const c=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,f)=>{const p=s.get(h),k=Ff(this.query,f)?f:null,S=!!p&&this.mutatedKeys.has(p.key),T=!!k&&(k.hasLocalMutations||this.mutatedKeys.has(k.key)&&k.hasCommittedMutations);let C=!1;p&&k?p.data.isEqual(k.data)?S!==T&&(r.track({type:3,doc:k}),C=!0):this.ja(p,k)||(r.track({type:2,doc:k}),C=!0,(c&&this.Ua(k,c)>0||d&&this.Ua(k,d)<0)&&(l=!0)):!p&&k?(r.track({type:0,doc:k}),C=!0):p&&!k&&(r.track({type:1,doc:p}),C=!0,(c||d)&&(l=!0)),C&&(k?(o=o.add(k),a=T?a.add(h):a.delete(h)):(o=o.delete(h),a=a.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),a=a.delete(h.key),r.track({type:1,doc:h})}return{Ka:o,za:r,ys:l,mutatedKeys:a}}ja(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,s){const a=this.Ka;this.Ka=e.Ka,this.mutatedKeys=e.mutatedKeys;const o=e.za.da();o.sort((h,f)=>function(k,S){const T=C=>{switch(C){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ke(20277,{Vt:C})}};return T(k)-T(S)}(h.type,f.type)||this.Ua(h.doc,f.doc)),this.Ha(r),s=s!=null&&s;const l=n&&!s?this.Ja():[],c=this.$a.size===0&&this.current&&!s?1:0,d=c!==this.Qa;return this.Qa=c,o.length!==0||d?{snapshot:new Al(this.query,e.Ka,a,o,e.mutatedKeys,c===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),Ya:l}:{Ya:l}}ga(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ka:this.Ka,za:new g0,mutatedKeys:this.mutatedKeys,ys:!1},!1)):{Ya:[]}}Za(e){return!this.qa.has(e)&&!!this.Ka.has(e)&&!this.Ka.get(e).hasLocalMutations}Ha(e){e&&(e.addedDocuments.forEach(n=>this.qa=this.qa.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.qa=this.qa.delete(n)),this.current=e.current)}Ja(){if(!this.current)return[];const e=this.$a;this.$a=vt(),this.Ka.forEach(r=>{this.Za(r.key)&&(this.$a=this.$a.add(r.key))});const n=[];return e.forEach(r=>{this.$a.has(r)||n.push(new sC(r))}),this.$a.forEach(r=>{e.has(r)||n.push(new rC(r))}),n}Xa(e){this.qa=e.Ns,this.$a=vt();const n=this.Ga(e.documents);return this.applyChanges(n,!0)}eu(){return Al.fromInitialDocuments(this.query,this.Ka,this.mutatedKeys,this.Qa===0,this.hasCachedResults)}}const Pv="SyncEngine";class HO{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class qO{constructor(e){this.key=e,this.tu=!1}}class WO{constructor(e,n,r,s,a,o){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=s,this.currentUser=a,this.maxConcurrentLimboResolutions=o,this.nu={},this.ru=new Ao(l=>_k(l),Mf),this.iu=new Map,this.su=new Set,this.ou=new hn($e.comparator),this._u=new Map,this.au=new xv,this.uu={},this.cu=new Map,this.lu=Il.ir(),this.onlineState="Unknown",this.hu=void 0}get isPrimaryClient(){return this.hu===!0}}async function KO(t,e,n=!0){const r=uC(t);let s;const a=r.ru.get(e);return a?(r.sharedClientState.addLocalQueryTarget(a.targetId),s=a.view.eu()):s=await iC(r,e,n,!0),s}async function QO(t,e){const n=uC(t);await iC(n,e,!0,!1)}async function iC(t,e,n,r){const s=await mO(t.localStore,yi(e)),a=s.targetId,o=t.sharedClientState.addLocalQueryTarget(a,n);let l;return r&&(l=await YO(t,e,a,o==="current",s.resumeToken)),t.isPrimaryClient&&n&&Jk(t.remoteStore,s),l}async function YO(t,e,n,r,s){t.Pu=(f,p,k)=>async function(T,C,j,y){let v=C.view.Ga(j);v.ys&&(v=await u0(T.localStore,C.query,!1).then(({documents:b})=>C.view.Ga(b,v)));const R=y&&y.targetChanges.get(C.targetId),O=y&&y.targetMismatches.get(C.targetId)!=null,M=C.view.applyChanges(v,T.isPrimaryClient,R,O);return w0(T,C.targetId,M.Ya),M.snapshot}(t,f,p,k);const a=await u0(t.localStore,e,!0),o=new GO(e,a.Ns),l=o.Ga(a.documents),c=Bu.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",s),d=o.applyChanges(l,t.isPrimaryClient,c);w0(t,n,d.Ya);const h=new HO(e,n,o);return t.ru.set(e,h),t.iu.has(n)?t.iu.get(n).push(e):t.iu.set(n,[e]),d.snapshot}async function JO(t,e,n){const r=rt(t),s=r.ru.get(e),a=r.iu.get(s.targetId);if(a.length>1)return r.iu.set(s.targetId,a.filter(o=>!Mf(o,e))),void r.ru.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Cg(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),n&&jv(r.remoteStore,s.targetId),Tg(r,s.targetId)}).catch(ql)):(Tg(r,s.targetId),await Cg(r.localStore,s.targetId,!0))}async function XO(t,e){const n=rt(t),r=n.ru.get(e),s=n.iu.get(r.targetId);n.isPrimaryClient&&s.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),jv(n.remoteStore,r.targetId))}async function ZO(t,e,n){const r=a4(t);try{const s=await function(o,l){const c=rt(o),d=sn.now(),h=l.reduce((k,S)=>k.add(S.key),vt());let f,p;return c.persistence.runTransaction("Locally write mutations","readwrite",k=>{let S=qi(),T=vt();return c.Cs.getEntries(k,h).next(C=>{S=C,S.forEach((j,y)=>{y.isValidDocument()||(T=T.add(j))})}).next(()=>c.localDocuments.getOverlayedDocuments(k,S)).next(C=>{f=C;const j=[];for(const y of l){const v=mL(y,f.get(y.key).overlayedDocument);v!=null&&j.push(new Ha(y.key,v,pk(v.value.mapValue),qr.exists(!0)))}return c.mutationQueue.addMutationBatch(k,d,j,l)}).next(C=>{p=C;const j=C.applyToLocalDocumentSet(f,T);return c.documentOverlayCache.saveOverlays(k,C.batchId,j)})}).then(()=>({batchId:p.batchId,changes:kk(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,l,c){let d=o.uu[o.currentUser.toKey()];d||(d=new hn(ht)),d=d.insert(l,c),o.uu[o.currentUser.toKey()]=d}(r,s.batchId,n),await zu(r,s.changes),await Hf(r.remoteStore)}catch(s){const a=Nv(s,"Failed to persist write");n.reject(a)}}async function aC(t,e){const n=rt(t);try{const r=await hO(n.localStore,e);e.targetChanges.forEach((s,a)=>{const o=n._u.get(a);o&&(Ut(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?o.tu=!0:s.modifiedDocuments.size>0?Ut(o.tu,14607):s.removedDocuments.size>0&&(Ut(o.tu,42227),o.tu=!1))}),await zu(n,r,e)}catch(r){await ql(r)}}function x0(t,e,n){const r=rt(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const s=[];r.ru.forEach((a,o)=>{const l=o.view.ga(e);l.snapshot&&s.push(l.snapshot)}),function(o,l){const c=rt(o);c.onlineState=l;let d=!1;c.queries.forEach((h,f)=>{for(const p of f.Ra)p.ga(l)&&(d=!0)}),d&&Av(c)}(r.eventManager,e),s.length&&r.nu.Q_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function e4(t,e,n){const r=rt(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r._u.get(e),a=s&&s.key;if(a){let o=new hn($e.comparator);o=o.insert(a,Tr.newNoDocument(a,tt.min()));const l=vt().add(a),c=new $f(tt.min(),new Map,new hn(ht),o,l);await aC(r,c),r.ou=r.ou.remove(a),r._u.delete(e),Dv(r)}else await Cg(r.localStore,e,!1).then(()=>Tg(r,e,n)).catch(ql)}async function t4(t,e){const n=rt(t),r=e.batch.batchId;try{const s=await dO(n.localStore,e);lC(n,r,null),oC(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await zu(n,s)}catch(s){await ql(s)}}async function n4(t,e,n){const r=rt(t);try{const s=await function(o,l){const c=rt(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let h;return c.mutationQueue.lookupMutationBatch(d,l).next(f=>(Ut(f!==null,37113),h=f.keys(),c.mutationQueue.removeMutationBatch(d,f))).next(()=>c.mutationQueue.performConsistencyCheck(d)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(d,h,l)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,h)).next(()=>c.localDocuments.getDocuments(d,h))})}(r.localStore,e);lC(r,e,n),oC(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await zu(r,s)}catch(s){await ql(s)}}function oC(t,e){(t.cu.get(e)||[]).forEach(n=>{n.resolve()}),t.cu.delete(e)}function lC(t,e,n){const r=rt(t);let s=r.uu[r.currentUser.toKey()];if(s){const a=s.get(e);a&&(n?a.reject(n):a.resolve(),s=s.remove(e)),r.uu[r.currentUser.toKey()]=s}}function Tg(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.iu.get(e))t.ru.delete(r),n&&t.nu.Tu(r,n);t.iu.delete(e),t.isPrimaryClient&&t.au.Ur(e).forEach(r=>{t.au.containsKey(r)||cC(t,r)})}function cC(t,e){t.su.delete(e.path.canonicalString());const n=t.ou.get(e);n!==null&&(jv(t.remoteStore,n),t.ou=t.ou.remove(e),t._u.delete(n),Dv(t))}function w0(t,e,n){for(const r of n)r instanceof rC?(t.au.addReference(r.key,e),r4(t,r)):r instanceof sC?(Pe(Pv,"Document no longer in limbo: "+r.key),t.au.removeReference(r.key,e),t.au.containsKey(r.key)||cC(t,r.key)):Ke(19791,{Iu:r})}function r4(t,e){const n=e.key,r=n.path.canonicalString();t.ou.get(n)||t.su.has(r)||(Pe(Pv,"New document in limbo: "+n),t.su.add(r),Dv(t))}function Dv(t){for(;t.su.size>0&&t.ou.size<t.maxConcurrentLimboResolutions;){const e=t.su.values().next().value;t.su.delete(e);const n=new $e(Yt.fromString(e)),r=t.lu.next();t._u.set(r,new qO(n)),t.ou=t.ou.insert(n,r),Jk(t.remoteStore,new ha(yi(Of(n.path)),r,"TargetPurposeLimboResolution",Pf.le))}}async function zu(t,e,n){const r=rt(t),s=[],a=[],o=[];r.ru.isEmpty()||(r.ru.forEach((l,c)=>{o.push(r.Pu(c,e,n).then(d=>{var h;if((d||n)&&r.isPrimaryClient){const f=d?!d.fromCache:(h=n==null?void 0:n.targetChanges.get(c.targetId))===null||h===void 0?void 0:h.current;r.sharedClientState.updateQueryState(c.targetId,f?"current":"not-current")}if(d){s.push(d);const f=bv.Ps(c.targetId,d);a.push(f)}}))}),await Promise.all(o),r.nu.Q_(s),await async function(c,d){const h=rt(c);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>ue.forEach(d,p=>ue.forEach(p.ls,k=>h.persistence.referenceDelegate.addReference(f,p.targetId,k)).next(()=>ue.forEach(p.hs,k=>h.persistence.referenceDelegate.removeReference(f,p.targetId,k)))))}catch(f){if(!Wl(f))throw f;Pe(_v,"Failed to update sequence numbers: "+f)}for(const f of d){const p=f.targetId;if(!f.fromCache){const k=h.Ss.get(p),S=k.snapshotVersion,T=k.withLastLimboFreeSnapshotVersion(S);h.Ss=h.Ss.insert(p,T)}}}(r.localStore,a))}async function s4(t,e){const n=rt(t);if(!n.currentUser.isEqual(e)){Pe(Pv,"User change. New user:",e.toKey());const r=await Wk(n.localStore,e);n.currentUser=e,function(a,o){a.cu.forEach(l=>{l.forEach(c=>{c.reject(new Ie(ce.CANCELLED,o))})}),a.cu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await zu(n,r.Ms)}}function i4(t,e){const n=rt(t),r=n._u.get(e);if(r&&r.tu)return vt().add(r.key);{let s=vt();const a=n.iu.get(e);if(!a)return s;for(const o of a){const l=n.ru.get(o);s=s.unionWith(l.view.Wa)}return s}}function uC(t){const e=rt(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=aC.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=i4.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=e4.bind(null,e),e.nu.Q_=$O.bind(null,e.eventManager),e.nu.Tu=zO.bind(null,e.eventManager),e}function a4(t){const e=rt(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=t4.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=n4.bind(null,e),e}class Jh{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=zf(e.databaseInfo.databaseId),this.sharedClientState=this.Au(e),this.persistence=this.Ru(e),await this.persistence.start(),this.localStore=this.Vu(e),this.gcScheduler=this.mu(e,this.localStore),this.indexBackfillerScheduler=this.fu(e,this.localStore)}mu(e,n){return null}fu(e,n){return null}Vu(e){return uO(this.persistence,new oO,e.initialUser,this.serializer)}Ru(e){return new qk(wv.Ei,this.serializer)}Au(e){return new yO}async terminate(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Jh.provider={build:()=>new Jh};class o4 extends Jh{constructor(e){super(),this.cacheSizeBytes=e}mu(e,n){Ut(this.persistence.referenceDelegate instanceof Qh,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new qL(r,e.asyncQueue,n)}Ru(e){const n=this.cacheSizeBytes!==void 0?Xr.withCacheSize(this.cacheSizeBytes):Xr.DEFAULT;return new qk(r=>Qh.Ei(r,n),this.serializer)}}class Ig{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>x0(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=s4.bind(null,this.syncEngine),await VO(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new BO}()}createDatastore(e){const n=zf(e.databaseInfo.databaseId),r=function(a){return new _O(a)}(e.databaseInfo);return function(a,o,l,c){return new CO(a,o,l,c)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,s,a,o,l){return new NO(r,s,a,o,l)}(this.localStore,this.datastore,e.asyncQueue,n=>x0(this.syncEngine,n,0),function(){return f0.C()?new f0:new vO}())}createSyncEngine(e,n){return function(s,a,o,l,c,d,h){const f=new WO(s,a,o,l,c,d);return h&&(f.hu=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(s){const a=rt(s);Pe(bo,"RemoteStore shutting down."),a.aa.add(5),await $u(a),a.ca.shutdown(),a.la.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()}}Ig.provider={build:()=>new Ig};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lv{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.pu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.pu(this.observer.error,e):Hi("Uncaught Error in snapshot listener:",e.toString()))}yu(){this.muted=!0}pu(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const La="FirestoreClient";class l4{constructor(e,n,r,s,a){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=s,this.user=Sr.UNAUTHENTICATED,this.clientId=sk.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=a,this.authCredentials.start(r,async o=>{Pe(La,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(Pe(La,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Mi;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=Nv(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Xp(t,e){t.asyncQueue.verifyOperationInProgress(),Pe(La,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async s=>{r.isEqual(s)||(await Wk(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function b0(t,e){t.asyncQueue.verifyOperationInProgress();const n=await c4(t);Pe(La,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>m0(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,s)=>m0(e.remoteStore,s)),t._onlineComponents=e}async function c4(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Pe(La,"Using user provided OfflineComponentProvider");try{await Xp(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(s){return s.name==="FirebaseError"?s.code===ce.FAILED_PRECONDITION||s.code===ce.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(n))throw n;kl("Error using user provided cache. Falling back to memory cache: "+n),await Xp(t,new Jh)}}else Pe(La,"Using default OfflineComponentProvider"),await Xp(t,new o4(void 0));return t._offlineComponents}async function dC(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Pe(La,"Using user provided OnlineComponentProvider"),await b0(t,t._uninitializedComponentsProvider._online)):(Pe(La,"Using default OnlineComponentProvider"),await b0(t,new Ig))),t._onlineComponents}function u4(t){return dC(t).then(e=>e.syncEngine)}async function Xh(t){const e=await dC(t),n=e.eventManager;return n.onListen=KO.bind(null,e.syncEngine),n.onUnlisten=JO.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=QO.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=XO.bind(null,e.syncEngine),n}function d4(t,e,n={}){const r=new Mi;return t.asyncQueue.enqueueAndForget(async()=>function(a,o,l,c,d){const h=new Lv({next:p=>{h.yu(),o.enqueueAndForget(()=>Iv(a,f));const k=p.docs.has(l);!k&&p.fromCache?d.reject(new Ie(ce.UNAVAILABLE,"Failed to get document because the client is offline.")):k&&p.fromCache&&c&&c.source==="server"?d.reject(new Ie(ce.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(p)},error:p=>d.reject(p)}),f=new Rv(Of(l.path),h,{includeMetadataChanges:!0,Fa:!0});return Tv(a,f)}(await Xh(t),t.asyncQueue,e,n,r)),r.promise}function h4(t,e,n={}){const r=new Mi;return t.asyncQueue.enqueueAndForget(async()=>function(a,o,l,c,d){const h=new Lv({next:p=>{h.yu(),o.enqueueAndForget(()=>Iv(a,f)),p.fromCache&&c.source==="server"?d.reject(new Ie(ce.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(p)},error:p=>d.reject(p)}),f=new Rv(l,h,{includeMetadataChanges:!0,Fa:!0});return Tv(a,f)}(await Xh(t),t.asyncQueue,e,n,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hC(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _0=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ov(t,e,n){if(!n)throw new Ie(ce.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function f4(t,e,n,r){if(e===!0&&r===!0)throw new Ie(ce.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function j0(t){if(!$e.isDocumentKey(t))throw new Ie(ce.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function E0(t){if($e.isDocumentKey(t))throw new Ie(ce.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function qf(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Ke(12329,{type:typeof t})}function Pr(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Ie(ce.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=qf(t);throw new Ie(ce.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function p4(t,e){if(e<=0)throw new Ie(ce.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fC="firestore.googleapis.com",k0=!0;class C0{constructor(e){var n,r;if(e.host===void 0){if(e.ssl!==void 0)throw new Ie(ce.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=fC,this.ssl=k0}else this.host=e.host,this.ssl=(n=e.ssl)!==null&&n!==void 0?n:k0;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Hk;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<GL)throw new Ie(ce.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}f4("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=hC((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(a){if(a.timeoutSeconds!==void 0){if(isNaN(a.timeoutSeconds))throw new Ie(ce.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (must not be NaN)`);if(a.timeoutSeconds<5)throw new Ie(ce.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (minimum allowed value is 5)`);if(a.timeoutSeconds>30)throw new Ie(ce.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Gu{constructor(e,n,r,s){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new C0({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Ie(ce.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Ie(ce.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new C0(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new _D;switch(r.type){case"firstParty":return new CD(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Ie(ce.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,Ba("Firestore",this._settings.isUsingEmulator),this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=_0.get(n);r&&(Pe("ComponentProvider","Removing Datastore"),_0.delete(n),r.terminate())}(this),Promise.resolve()}}function m4(t,e,n,r={}){var s;t=Pr(t,Gu);const a=Ua(e),o=t._getSettings(),l=Object.assign(Object.assign({},o),{emulatorOptions:t._getEmulatorOptions()}),c=`${e}:${n}`;o.host!==fC&&o.host!==c&&kl("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const d=Object.assign(Object.assign({},o),{host:c,ssl:a,emulatorOptions:r});if(!Ta(d,l)&&(t._setSettings(d),a&&(Cf(`https://${c}`),Ba("Firestore",!0)),r.mockUserToken)){let h,f;if(typeof r.mockUserToken=="string")h=r.mockUserToken,f=Sr.MOCK_USER;else{h=Jj(r.mockUserToken,(s=t._app)===null||s===void 0?void 0:s.options.projectId);const p=r.mockUserToken.sub||r.mockUserToken.user_id;if(!p)throw new Ie(ce.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new Sr(p)}t._authCredentials=new jD(new nk(h,f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _i{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new _i(this.firestore,e,this._query)}}class Dr{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ea(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Dr(this.firestore,e,this._key)}}class Ea extends _i{constructor(e,n,r){super(e,n,Of(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Dr(this.firestore,null,new $e(e))}withConverter(e){return new Ea(this.firestore,e,this._path)}}function fe(t,e,...n){if(t=ct(t),Ov("collection","path",e),t instanceof Gu){const r=Yt.fromString(e,...n);return E0(r),new Ea(t,null,r)}{if(!(t instanceof Dr||t instanceof Ea))throw new Ie(ce.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Yt.fromString(e,...n));return E0(r),new Ea(t.firestore,null,r)}}function g4(t,e){if(t=Pr(t,Gu),Ov("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Ie(ce.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new _i(t,null,function(r){return new Io(Yt.emptyPath(),r)}(e))}function ie(t,e,...n){if(t=ct(t),arguments.length===1&&(e=sk.newId()),Ov("doc","path",e),t instanceof Gu){const r=Yt.fromString(e,...n);return j0(r),new Dr(t,null,new $e(r))}{if(!(t instanceof Dr||t instanceof Ea))throw new Ie(ce.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Yt.fromString(e,...n));return j0(r),new Dr(t.firestore,t instanceof Ea?t.converter:null,new $e(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S0="AsyncQueue";class N0{constructor(e=Promise.resolve()){this.Qu=[],this.$u=!1,this.Uu=[],this.Ku=null,this.Wu=!1,this.Gu=!1,this.zu=[],this.y_=new Qk(this,"async_queue_retry"),this.ju=()=>{const r=Jp();r&&Pe(S0,"Visibility state changed to "+r.visibilityState),this.y_.A_()},this.Hu=e;const n=Jp();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this.ju)}get isShuttingDown(){return this.$u}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Ju(),this.Yu(e)}enterRestrictedMode(e){if(!this.$u){this.$u=!0,this.Gu=e||!1;const n=Jp();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.ju)}}enqueue(e){if(this.Ju(),this.$u)return new Promise(()=>{});const n=new Mi;return this.Yu(()=>this.$u&&this.Gu?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Qu.push(e),this.Zu()))}async Zu(){if(this.Qu.length!==0){try{await this.Qu[0](),this.Qu.shift(),this.y_.reset()}catch(e){if(!Wl(e))throw e;Pe(S0,"Operation failed with retryable error: "+e)}this.Qu.length>0&&this.y_.E_(()=>this.Zu())}}Yu(e){const n=this.Hu.then(()=>(this.Wu=!0,e().catch(r=>{throw this.Ku=r,this.Wu=!1,Hi("INTERNAL UNHANDLED ERROR: ",T0(r)),r}).then(r=>(this.Wu=!1,r))));return this.Hu=n,n}enqueueAfterDelay(e,n,r){this.Ju(),this.zu.indexOf(e)>-1&&(n=0);const s=Sv.createAndSchedule(this,e,n,r,a=>this.Xu(a));return this.Uu.push(s),s}Ju(){this.Ku&&Ke(47125,{ec:T0(this.Ku)})}verifyOperationInProgress(){}async tc(){let e;do e=this.Hu,await e;while(e!==this.Hu)}nc(e){for(const n of this.Uu)if(n.timerId===e)return!0;return!1}rc(e){return this.tc().then(()=>{this.Uu.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.Uu)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.tc()})}sc(e){this.zu.push(e)}Xu(e){const n=this.Uu.indexOf(e);this.Uu.splice(n,1)}}function T0(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I0(t){return function(n,r){if(typeof n!="object"||n===null)return!1;const s=n;for(const a of r)if(a in s&&typeof s[a]=="function")return!0;return!1}(t,["next","error","complete"])}class bi extends Gu{constructor(e,n,r,s){super(e,n,r,s),this.type="firestore",this._queue=new N0,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new N0(e),this._firestoreClient=void 0,await e}}}function y4(t,e){const n=typeof t=="object"?t:Lu(),r=typeof t=="string"?t:Gh,s=$a(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const a=$y("firestore");a&&m4(s,...a)}return s}function Hu(t){if(t._terminated)throw new Ie(ce.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||v4(t),t._firestoreClient}function v4(t){var e,n,r;const s=t._freezeSettings(),a=function(l,c,d,h){return new BD(l,c,d,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,hC(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,s);t._componentsProvider||!((n=s.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(t._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),t._firestoreClient=new l4(t._authCredentials,t._appCheckCredentials,t._queue,a,t._componentsProvider&&function(l){const c=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(c),_online:c}}(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rl{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Rl(vr.fromBase64String(e))}catch(n){throw new Ie(ce.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Rl(vr.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qu{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new Ie(ce.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new mr(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ql{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mv{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new Ie(ce.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new Ie(ce.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ht(this._lat,e._lat)||ht(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fv{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let a=0;a<r.length;++a)if(r[a]!==s[a])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x4=/^__.*__$/;class w4{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Ha(e,this.data,this.fieldMask,n,this.fieldTransforms):new Uu(e,this.data,n,this.fieldTransforms)}}class pC{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Ha(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function mC(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ke(40011,{oc:t})}}class Wf{constructor(e,n,r,s,a,o){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=s,a===void 0&&this._c(),this.fieldTransforms=a||[],this.fieldMask=o||[]}get path(){return this.settings.path}get oc(){return this.settings.oc}ac(e){return new Wf(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}uc(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.ac({path:r,cc:!1});return s.lc(e),s}hc(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.ac({path:r,cc:!1});return s._c(),s}Pc(e){return this.ac({path:void 0,cc:!0})}Tc(e){return Zh(e,this.settings.methodName,this.settings.Ic||!1,this.path,this.settings.Ec)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}_c(){if(this.path)for(let e=0;e<this.path.length;e++)this.lc(this.path.get(e))}lc(e){if(e.length===0)throw this.Tc("Document fields must not be empty");if(mC(this.oc)&&x4.test(e))throw this.Tc('Document fields cannot begin and end with "__"')}}class b4{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||zf(e)}dc(e,n,r,s=!1){return new Wf({oc:e,methodName:n,Ec:r,path:mr.emptyPath(),cc:!1,Ic:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Wu(t){const e=t._freezeSettings(),n=zf(t._databaseId);return new b4(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Vv(t,e,n,r,s,a={}){const o=t.dc(a.merge||a.mergeFields?2:0,e,n,s);zv("Data must be an object, but it was:",o,r);const l=vC(r,o);let c,d;if(a.merge)c=new gs(o.fieldMask),d=o.fieldTransforms;else if(a.mergeFields){const h=[];for(const f of a.mergeFields){const p=Ag(e,f,n);if(!o.contains(p))throw new Ie(ce.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);wC(h,p)||h.push(p)}c=new gs(h),d=o.fieldTransforms.filter(f=>c.covers(f.field))}else c=null,d=o.fieldTransforms;return new w4(new es(l),c,d)}class Kf extends Ql{_toFieldTransform(e){if(e.oc!==2)throw e.oc===1?e.Tc(`${this._methodName}() can only appear at the top level of your update data`):e.Tc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Kf}}function _4(t,e,n){return new Wf({oc:3,Ec:e.settings.Ec,methodName:t._methodName,cc:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Uv extends Ql{_toFieldTransform(e){return new mv(e.path,new bu)}isEqual(e){return e instanceof Uv}}class Bv extends Ql{constructor(e,n){super(e),this.Ac=n}_toFieldTransform(e){const n=_4(this,e,!0),r=this.Ac.map(a=>Yl(a,n)),s=new Tl(r);return new mv(e.path,s)}isEqual(e){return e instanceof Bv&&Ta(this.Ac,e.Ac)}}class $v extends Ql{constructor(e,n){super(e),this.Rc=n}_toFieldTransform(e){const n=new ju(e.serializer,Nk(e.serializer,this.Rc));return new mv(e.path,n)}isEqual(e){return e instanceof $v&&this.Rc===e.Rc}}function gC(t,e,n,r){const s=t.dc(1,e,n);zv("Data must be an object, but it was:",s,r);const a=[],o=es.empty();Ga(r,(c,d)=>{const h=Gv(e,c,n);d=ct(d);const f=s.hc(h);if(d instanceof Kf)a.push(h);else{const p=Yl(d,f);p!=null&&(a.push(h),o.set(h,p))}});const l=new gs(a);return new pC(o,l,s.fieldTransforms)}function yC(t,e,n,r,s,a){const o=t.dc(1,e,n),l=[Ag(e,r,n)],c=[s];if(a.length%2!=0)throw new Ie(ce.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<a.length;p+=2)l.push(Ag(e,a[p])),c.push(a[p+1]);const d=[],h=es.empty();for(let p=l.length-1;p>=0;--p)if(!wC(d,l[p])){const k=l[p];let S=c[p];S=ct(S);const T=o.hc(k);if(S instanceof Kf)d.push(k);else{const C=Yl(S,T);C!=null&&(d.push(k),h.set(k,C))}}const f=new gs(d);return new pC(h,f,o.fieldTransforms)}function j4(t,e,n,r=!1){return Yl(n,t.dc(r?4:3,e))}function Yl(t,e){if(xC(t=ct(t)))return zv("Unsupported field value:",e,t),vC(t,e);if(t instanceof Ql)return function(r,s){if(!mC(s.oc))throw s.Tc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Tc(`${r._methodName}() is not currently supported inside arrays`);const a=r._toFieldTransform(s);a&&s.fieldTransforms.push(a)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.cc&&e.oc!==4)throw e.Tc("Nested arrays are not supported");return function(r,s){const a=[];let o=0;for(const l of r){let c=Yl(l,s.Pc(o));c==null&&(c={nullValue:"NULL_VALUE"}),a.push(c),o++}return{arrayValue:{values:a}}}(t,e)}return function(r,s){if((r=ct(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Nk(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const a=sn.fromDate(r);return{timestampValue:Kh(s.serializer,a)}}if(r instanceof sn){const a=new sn(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Kh(s.serializer,a)}}if(r instanceof Mv)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Rl)return{bytesValue:Fk(s.serializer,r._byteString)};if(r instanceof Dr){const a=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(a))throw s.Tc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${a.projectId}/${a.database}`);return{referenceValue:vv(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Fv)return function(o,l){return{mapValue:{fields:{[hk]:{stringValue:fk},[Hh]:{arrayValue:{values:o.toArray().map(d=>{if(typeof d!="number")throw l.Tc("VectorValues must only contain numeric values.");return pv(l.serializer,d)})}}}}}}(r,s);throw s.Tc(`Unsupported field value: ${qf(r)}`)}(t,e)}function vC(t,e){const n={};return ak(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ga(t,(r,s)=>{const a=Yl(s,e.uc(r));a!=null&&(n[r]=a)}),{mapValue:{fields:n}}}function xC(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof sn||t instanceof Mv||t instanceof Rl||t instanceof Dr||t instanceof Ql||t instanceof Fv)}function zv(t,e,n){if(!xC(n)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(n)){const r=qf(n);throw r==="an object"?e.Tc(t+" a custom object"):e.Tc(t+" "+r)}}function Ag(t,e,n){if((e=ct(e))instanceof qu)return e._internalPath;if(typeof e=="string")return Gv(t,e);throw Zh("Field path arguments must be of type string or ",t,!1,void 0,n)}const E4=new RegExp("[~\\*/\\[\\]]");function Gv(t,e,n){if(e.search(E4)>=0)throw Zh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new qu(...e.split("."))._internalPath}catch{throw Zh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Zh(t,e,n,r,s){const a=r&&!r.isEmpty(),o=s!==void 0;let l=`Function ${e}() called with invalid data`;n&&(l+=" (via `toFirestore()`)"),l+=". ";let c="";return(a||o)&&(c+=" (found",a&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new Ie(ce.INVALID_ARGUMENT,l+t+c)}function wC(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bC{constructor(e,n,r,s,a){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=s,this._converter=a}get id(){return this._key.path.lastSegment()}get ref(){return new Dr(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new k4(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(Qf("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class k4 extends bC{data(){return super.data()}}function Qf(t,e){return typeof e=="string"?Gv(t,e):e instanceof qu?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _C(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Ie(ce.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Hv{}class qv extends Hv{}function Ye(t,e,...n){let r=[];e instanceof Hv&&r.push(e),r=r.concat(n),function(a){const o=a.filter(c=>c instanceof Wv).length,l=a.filter(c=>c instanceof Yf).length;if(o>1||o>0&&l>0)throw new Ie(ce.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)t=s._apply(t);return t}class Yf extends qv{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new Yf(e,n,r)}_apply(e){const n=this._parse(e);return jC(e._query,n),new _i(e.firestore,e.converter,bg(e._query,n))}_parse(e){const n=Wu(e.firestore);return function(a,o,l,c,d,h,f){let p;if(d.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new Ie(ce.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){R0(f,h);const S=[];for(const T of f)S.push(A0(c,a,T));p={arrayValue:{values:S}}}else p=A0(c,a,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||R0(f,h),p=j4(l,o,f,h==="in"||h==="not-in");return Rn.create(d,h,p)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function Je(t,e,n){const r=e,s=Qf("where",t);return Yf._create(s,r,n)}class Wv extends Hv{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new Wv(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:ei.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(s,a){let o=s;const l=a.getFlattenedFilters();for(const c of l)jC(o,c),o=bg(o,c)}(e._query,n),new _i(e.firestore,e.converter,bg(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Kv extends qv{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new Kv(e,n)}_apply(e){const n=function(s,a,o){if(s.startAt!==null)throw new Ie(ce.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new Ie(ce.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new wu(a,o)}(e._query,this._field,this._direction);return new _i(e.firestore,e.converter,function(s,a){const o=s.explicitOrderBy.concat([a]);return new Io(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,n))}}function lo(t,e="asc"){const n=e,r=Qf("orderBy",t);return Kv._create(r,n)}class Qv extends qv{constructor(e,n,r){super(),this.type=e,this._limit=n,this._limitType=r}static _create(e,n,r){return new Qv(e,n,r)}_apply(e){return new _i(e.firestore,e.converter,Wh(e._query,this._limit,this._limitType))}}function Rg(t){return p4("limit",t),Qv._create("limit",t,"F")}function A0(t,e,n){if(typeof(n=ct(n))=="string"){if(n==="")throw new Ie(ce.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!bk(e)&&n.indexOf("/")!==-1)throw new Ie(ce.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Yt.fromString(n));if(!$e.isDocumentKey(r))throw new Ie(ce.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Hb(t,new $e(r))}if(n instanceof Dr)return Hb(t,n._key);throw new Ie(ce.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${qf(n)}.`)}function R0(t,e){if(!Array.isArray(t)||t.length===0)throw new Ie(ce.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function jC(t,e){const n=function(s,a){for(const o of s)for(const l of o.getFlattenedFilters())if(a.indexOf(l.op)>=0)return l.op;return null}(t.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new Ie(ce.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Ie(ce.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class C4{convertValue(e,n="none"){switch(Pa(e)){case 0:return null;case 1:return e.booleanValue;case 2:return jn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Ra(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Ke(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Ga(e,(s,a)=>{r[s]=this.convertValue(a,n)}),r}convertVectorValue(e){var n,r,s;const a=(s=(r=(n=e.fields)===null||n===void 0?void 0:n[Hh].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>jn(o.doubleValue));return new Fv(a)}convertGeoPoint(e){return new Mv(jn(e.latitude),jn(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=Lf(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(yu(e));default:return null}}convertTimestamp(e){const n=Aa(e);return new sn(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Yt.fromString(e);Ut(Gk(r),9688,{name:e});const s=new vu(r.get(1),r.get(3)),a=new $e(r.popFirst(5));return s.isEqual(n)||Hi(`Document ${a} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yv(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ec{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class EC extends bC{constructor(e,n,r,s,a,o){super(e,n,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=a}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new sh(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(Qf("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}}class sh extends EC{data(e={}){return super.data(e)}}class kC{constructor(e,n,r,s){this._firestore=e,this._userDataWriter=n,this._snapshot=s,this.metadata=new Ec(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new sh(this._firestore,this._userDataWriter,r.key,r,new Ec(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new Ie(ce.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(s,a){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(l=>{const c=new sh(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Ec(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(l=>a||l.type!==3).map(l=>{const c=new sh(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Ec(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,h=-1;return l.type!==0&&(d=o.indexOf(l.doc.key),o=o.delete(l.doc.key)),l.type!==1&&(o=o.add(l.doc),h=o.indexOf(l.doc.key)),{type:S4(l.type),doc:c,oldIndex:d,newIndex:h}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function S4(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ke(61501,{type:t})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gn(t){t=Pr(t,Dr);const e=Pr(t.firestore,bi);return d4(Hu(e),t._key).then(n=>CC(e,t,n))}class Jv extends C4{constructor(e){super(),this.firestore=e}convertBytes(e){return new Rl(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Dr(this.firestore,null,n)}}function Ne(t){t=Pr(t,_i);const e=Pr(t.firestore,bi),n=Hu(e),r=new Jv(e);return _C(t._query),h4(n,t._query).then(s=>new kC(e,r,t,s))}function Jn(t,e,n){t=Pr(t,Dr);const r=Pr(t.firestore,bi),s=Yv(t.converter,e,n);return Ku(r,[Vv(Wu(r),"setDoc",t._key,s,t.converter!==null,n).toMutation(t._key,qr.none())])}function He(t,e,n,...r){t=Pr(t,Dr);const s=Pr(t.firestore,bi),a=Wu(s);let o;return o=typeof(e=ct(e))=="string"||e instanceof qu?yC(a,"updateDoc",t._key,e,n,r):gC(a,"updateDoc",t._key,e),Ku(s,[o.toMutation(t._key,qr.exists(!0))])}function mn(t){return Ku(Pr(t.firestore,bi),[new Bf(t._key,qr.none())])}function rn(t,e){const n=Pr(t.firestore,bi),r=ie(t),s=Yv(t.converter,e);return Ku(n,[Vv(Wu(t.firestore),"addDoc",r._key,s,t.converter!==null,{}).toMutation(r._key,qr.exists(!1))]).then(()=>r)}function ps(t,...e){var n,r,s;t=ct(t);let a={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||I0(e[o])||(a=e[o],o++);const l={includeMetadataChanges:a.includeMetadataChanges,source:a.source};if(I0(e[o])){const f=e[o];e[o]=(n=f.next)===null||n===void 0?void 0:n.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let c,d,h;if(t instanceof Dr)d=Pr(t.firestore,bi),h=Of(t._key.path),c={next:f=>{e[o]&&e[o](CC(d,t,f))},error:e[o+1],complete:e[o+2]};else{const f=Pr(t,_i);d=Pr(f.firestore,bi),h=f._query;const p=new Jv(d);c={next:k=>{e[o]&&e[o](new kC(d,p,f,k))},error:e[o+1],complete:e[o+2]},_C(t._query)}return function(p,k,S,T){const C=new Lv(T),j=new Rv(k,C,S);return p.asyncQueue.enqueueAndForget(async()=>Tv(await Xh(p),j)),()=>{C.yu(),p.asyncQueue.enqueueAndForget(async()=>Iv(await Xh(p),j))}}(Hu(d),h,l,c)}function Ku(t,e){return function(r,s){const a=new Mi;return r.asyncQueue.enqueueAndForget(async()=>ZO(await u4(r),s,a)),a.promise}(Hu(t),e)}function CC(t,e,n){const r=n.docs.get(e._key),s=new Jv(t);return new EC(t,s,e._key,r,new Ec(n.hasPendingWrites,n.fromCache),e.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N4{constructor(e,n){this._firestore=e,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=Wu(e)}set(e,n,r){this._verifyNotCommitted();const s=Zp(e,this._firestore),a=Yv(s.converter,n,r),o=Vv(this._dataReader,"WriteBatch.set",s._key,a,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,qr.none())),this}update(e,n,r,...s){this._verifyNotCommitted();const a=Zp(e,this._firestore);let o;return o=typeof(n=ct(n))=="string"||n instanceof qu?yC(this._dataReader,"WriteBatch.update",a._key,n,r,s):gC(this._dataReader,"WriteBatch.update",a._key,n),this._mutations.push(o.toMutation(a._key,qr.exists(!0))),this}delete(e){this._verifyNotCommitted();const n=Zp(e,this._firestore);return this._mutations=this._mutations.concat(new Bf(n._key,qr.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Ie(ce.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Zp(t,e){if((t=ct(t)).firestore!==e)throw new Ie(ce.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function Mt(){return new Uv("serverTimestamp")}function Pg(...t){return new Bv("arrayUnion",t)}function Td(t){return new $v("increment",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Id(t){return Hu(t=Pr(t,bi)),new N4(t,e=>Ku(t,e))}(function(e,n=!0){(function(s){Hl=s})(To),Ms(new ws("firestore",(r,{instanceIdentifier:s,options:a})=>{const o=r.getProvider("app").getImmediate(),l=new bi(new ED(r.getProvider("auth-internal")),new SD(o,r.getProvider("app-check-internal")),function(d,h){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new Ie(ce.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new vu(d.options.projectId,h)}(o,s),o);return a=Object.assign({useFetchStreams:n},a),l._setSettings(a),l},"PUBLIC").setMultipleInstances(!0)),Rr(Pb,Db,e),Rr(Pb,Db,"esm2017")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SC="firebasestorage.googleapis.com",NC="storageBucket",T4=2*60*1e3,I4=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vn extends Fs{constructor(e,n,r=0){super(em(e),`Firebase Storage: ${n} (${em(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,vn.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return em(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var yn;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(yn||(yn={}));function em(t){return"storage/"+t}function Xv(){const t="An unknown error occurred, please check the error payload for server response.";return new vn(yn.UNKNOWN,t)}function A4(t){return new vn(yn.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function R4(t){return new vn(yn.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function P4(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new vn(yn.UNAUTHENTICATED,t)}function D4(){return new vn(yn.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function L4(t){return new vn(yn.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function O4(){return new vn(yn.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function M4(){return new vn(yn.CANCELED,"User canceled the upload/download.")}function F4(t){return new vn(yn.INVALID_URL,"Invalid URL '"+t+"'.")}function V4(t){return new vn(yn.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function U4(){return new vn(yn.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+NC+"' property when initializing the app?")}function B4(){return new vn(yn.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function $4(){return new vn(yn.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function z4(t){return new vn(yn.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Dg(t){return new vn(yn.INVALID_ARGUMENT,t)}function TC(){return new vn(yn.APP_DELETED,"The Firebase app was deleted.")}function G4(t){return new vn(yn.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Gc(t,e){return new vn(yn.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function hc(t){throw new vn(yn.INTERNAL_ERROR,"Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gr{constructor(e,n){this.bucket=e,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,n){let r;try{r=Gr.makeFromUrl(e,n)}catch{return new Gr(e,"")}if(r.path==="")return r;throw V4(e)}static makeFromUrl(e,n){let r=null;const s="([A-Za-z0-9.\\-_]+)";function a(R){R.path.charAt(R.path.length-1)==="/"&&(R.path_=R.path_.slice(0,-1))}const o="(/(.*))?$",l=new RegExp("^gs://"+s+o,"i"),c={bucket:1,path:3};function d(R){R.path_=decodeURIComponent(R.path)}const h="v[A-Za-z0-9_]+",f=n.replace(/[.]/g,"\\."),p="(/([^?#]*).*)?$",k=new RegExp(`^https?://${f}/${h}/b/${s}/o${p}`,"i"),S={bucket:1,path:3},T=n===SC?"(?:storage.googleapis.com|storage.cloud.google.com)":n,C="([^?#]*)",j=new RegExp(`^https?://${T}/${s}/${C}`,"i"),v=[{regex:l,indices:c,postModify:a},{regex:k,indices:S,postModify:d},{regex:j,indices:{bucket:1,path:2},postModify:d}];for(let R=0;R<v.length;R++){const O=v[R],M=O.regex.exec(e);if(M){const b=M[O.indices.bucket];let x=M[O.indices.path];x||(x=""),r=new Gr(b,x),O.postModify(r);break}}if(r==null)throw F4(e);return r}}class H4{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q4(t,e,n){let r=1,s=null,a=null,o=!1,l=0;function c(){return l===2}let d=!1;function h(...C){d||(d=!0,e.apply(null,C))}function f(C){s=setTimeout(()=>{s=null,t(k,c())},C)}function p(){a&&clearTimeout(a)}function k(C,...j){if(d){p();return}if(C){p(),h.call(null,C,...j);return}if(c()||o){p(),h.call(null,C,...j);return}r<64&&(r*=2);let v;l===1?(l=2,v=0):v=(r+Math.random())*1e3,f(v)}let S=!1;function T(C){S||(S=!0,p(),!d&&(s!==null?(C||(l=2),clearTimeout(s),f(0)):C||(l=1)))}return f(0),a=setTimeout(()=>{o=!0,T(!0)},n),T}function W4(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K4(t){return t!==void 0}function Q4(t){return typeof t=="object"&&!Array.isArray(t)}function Zv(t){return typeof t=="string"||t instanceof String}function P0(t){return ex()&&t instanceof Blob}function ex(){return typeof Blob<"u"}function Lg(t,e,n,r){if(r<e)throw Dg(`Invalid value for '${t}'. Expected ${e} or greater.`);if(r>n)throw Dg(`Invalid value for '${t}'. Expected ${n} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qu(t,e,n){let r=e;return n==null&&(r=`https://${e}`),`${n}://${r}/v0${t}`}function IC(t){const e=encodeURIComponent;let n="?";for(const r in t)if(t.hasOwnProperty(r)){const s=e(r)+"="+e(t[r]);n=n+s+"&"}return n=n.slice(0,-1),n}var co;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(co||(co={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y4(t,e){const n=t>=500&&t<600,s=[408,429].indexOf(t)!==-1,a=e.indexOf(t)!==-1;return n||s||a}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J4{constructor(e,n,r,s,a,o,l,c,d,h,f,p=!0,k=!1){this.url_=e,this.method_=n,this.headers_=r,this.body_=s,this.successCodes_=a,this.additionalRetryCodes_=o,this.callback_=l,this.errorCallback_=c,this.timeout_=d,this.progressCallback_=h,this.connectionFactory_=f,this.retry=p,this.isUsingEmulator=k,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((S,T)=>{this.resolve_=S,this.reject_=T,this.start_()})}start_(){const e=(r,s)=>{if(s){r(!1,new Ad(!1,null,!0));return}const a=this.connectionFactory_();this.pendingConnection_=a;const o=l=>{const c=l.loaded,d=l.lengthComputable?l.total:-1;this.progressCallback_!==null&&this.progressCallback_(c,d)};this.progressCallback_!==null&&a.addUploadProgressListener(o),a.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&a.removeUploadProgressListener(o),this.pendingConnection_=null;const l=a.getErrorCode()===co.NO_ERROR,c=a.getStatus();if(!l||Y4(c,this.additionalRetryCodes_)&&this.retry){const h=a.getErrorCode()===co.ABORT;r(!1,new Ad(!1,null,h));return}const d=this.successCodes_.indexOf(c)!==-1;r(!0,new Ad(d,a))})},n=(r,s)=>{const a=this.resolve_,o=this.reject_,l=s.connection;if(s.wasSuccessCode)try{const c=this.callback_(l,l.getResponse());K4(c)?a(c):a()}catch(c){o(c)}else if(l!==null){const c=Xv();c.serverResponse=l.getErrorText(),this.errorCallback_?o(this.errorCallback_(l,c)):o(c)}else if(s.canceled){const c=this.appDelete_?TC():M4();o(c)}else{const c=O4();o(c)}};this.canceled_?n(!1,new Ad(!1,null,!0)):this.backoffId_=q4(e,n,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&W4(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Ad{constructor(e,n,r){this.wasSuccessCode=e,this.connection=n,this.canceled=!!r}}function X4(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function Z4(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function eM(t,e){e&&(t["X-Firebase-GMPID"]=e)}function tM(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function nM(t,e,n,r,s,a,o=!0,l=!1){const c=IC(t.urlParams),d=t.url+c,h=Object.assign({},t.headers);return eM(h,e),X4(h,n),Z4(h,a),tM(h,r),new J4(d,t.method,h,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,s,o,l)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rM(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function sM(...t){const e=rM();if(e!==void 0){const n=new e;for(let r=0;r<t.length;r++)n.append(t[r]);return n.getBlob()}else{if(ex())return new Blob(t);throw new vn(yn.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function iM(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aM(t){if(typeof atob>"u")throw z4("base-64");return atob(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fi={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class tm{constructor(e,n){this.data=e,this.contentType=n||null}}function oM(t,e){switch(t){case fi.RAW:return new tm(AC(e));case fi.BASE64:case fi.BASE64URL:return new tm(RC(t,e));case fi.DATA_URL:return new tm(cM(e),uM(e))}throw Xv()}function AC(t){const e=[];for(let n=0;n<t.length;n++){let r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(n<t.length-1&&(t.charCodeAt(n+1)&64512)===56320))e.push(239,191,189);else{const a=r,o=t.charCodeAt(++n);r=65536|(a&1023)<<10|o&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function lM(t){let e;try{e=decodeURIComponent(t)}catch{throw Gc(fi.DATA_URL,"Malformed data URL.")}return AC(e)}function RC(t,e){switch(t){case fi.BASE64:{const s=e.indexOf("-")!==-1,a=e.indexOf("_")!==-1;if(s||a)throw Gc(t,"Invalid character '"+(s?"-":"_")+"' found: is it base64url encoded?");break}case fi.BASE64URL:{const s=e.indexOf("+")!==-1,a=e.indexOf("/")!==-1;if(s||a)throw Gc(t,"Invalid character '"+(s?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=aM(e)}catch(s){throw s.message.includes("polyfill")?s:Gc(t,"Invalid character found")}const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}class PC{constructor(e){this.base64=!1,this.contentType=null;const n=e.match(/^data:([^,]+)?,/);if(n===null)throw Gc(fi.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=n[1]||null;r!=null&&(this.base64=dM(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function cM(t){const e=new PC(t);return e.base64?RC(fi.BASE64,e.rest):lM(e.rest)}function uM(t){return new PC(t).contentType}function dM(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class la{constructor(e,n){let r=0,s="";P0(e)?(this.data_=e,r=e.size,s=e.type):e instanceof ArrayBuffer?(n?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(n?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=s}size(){return this.size_}type(){return this.type_}slice(e,n){if(P0(this.data_)){const r=this.data_,s=iM(r,e,n);return s===null?null:new la(s)}else{const r=new Uint8Array(this.data_.buffer,e,n-e);return new la(r,!0)}}static getBlob(...e){if(ex()){const n=e.map(r=>r instanceof la?r.data_:r);return new la(sM.apply(null,n))}else{const n=e.map(o=>Zv(o)?oM(fi.RAW,o).data:o.data_);let r=0;n.forEach(o=>{r+=o.byteLength});const s=new Uint8Array(r);let a=0;return n.forEach(o=>{for(let l=0;l<o.length;l++)s[a++]=o[l]}),new la(s,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tx(t){let e;try{e=JSON.parse(t)}catch{return null}return Q4(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hM(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function fM(t,e){const n=e.split("/").filter(r=>r.length>0).join("/");return t.length===0?n:t+"/"+n}function DC(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pM(t,e){return e}class $r{constructor(e,n,r,s){this.server=e,this.local=n||e,this.writable=!!r,this.xform=s||pM}}let Rd=null;function mM(t){return!Zv(t)||t.length<2?t:DC(t)}function LC(){if(Rd)return Rd;const t=[];t.push(new $r("bucket")),t.push(new $r("generation")),t.push(new $r("metageneration")),t.push(new $r("name","fullPath",!0));function e(a,o){return mM(o)}const n=new $r("name");n.xform=e,t.push(n);function r(a,o){return o!==void 0?Number(o):o}const s=new $r("size");return s.xform=r,t.push(s),t.push(new $r("timeCreated")),t.push(new $r("updated")),t.push(new $r("md5Hash",null,!0)),t.push(new $r("cacheControl",null,!0)),t.push(new $r("contentDisposition",null,!0)),t.push(new $r("contentEncoding",null,!0)),t.push(new $r("contentLanguage",null,!0)),t.push(new $r("contentType",null,!0)),t.push(new $r("metadata","customMetadata",!0)),Rd=t,Rd}function gM(t,e){function n(){const r=t.bucket,s=t.fullPath,a=new Gr(r,s);return e._makeStorageReference(a)}Object.defineProperty(t,"ref",{get:n})}function yM(t,e,n){const r={};r.type="file";const s=n.length;for(let a=0;a<s;a++){const o=n[a];r[o.local]=o.xform(r,e[o.server])}return gM(r,t),r}function OC(t,e,n){const r=tx(e);return r===null?null:yM(t,r,n)}function vM(t,e,n,r){const s=tx(e);if(s===null||!Zv(s.downloadTokens))return null;const a=s.downloadTokens;if(a.length===0)return null;const o=encodeURIComponent;return a.split(",").map(d=>{const h=t.bucket,f=t.fullPath,p="/b/"+o(h)+"/o/"+o(f),k=Qu(p,n,r),S=IC({alt:"media",token:d});return k+S})[0]}function xM(t,e){const n={},r=e.length;for(let s=0;s<r;s++){const a=e[s];a.writable&&(n[a.server]=t[a.local])}return JSON.stringify(n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D0="prefixes",L0="items";function wM(t,e,n){const r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n[D0])for(const s of n[D0]){const a=s.replace(/\/$/,""),o=t._makeStorageReference(new Gr(e,a));r.prefixes.push(o)}if(n[L0])for(const s of n[L0]){const a=t._makeStorageReference(new Gr(e,s.name));r.items.push(a)}return r}function bM(t,e,n){const r=tx(n);return r===null?null:wM(t,e,r)}class Jf{constructor(e,n,r,s){this.url=e,this.method=n,this.handler=r,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nx(t){if(!t)throw Xv()}function _M(t,e){function n(r,s){const a=OC(t,s,e);return nx(a!==null),a}return n}function jM(t,e){function n(r,s){const a=bM(t,e,s);return nx(a!==null),a}return n}function EM(t,e){function n(r,s){const a=OC(t,s,e);return nx(a!==null),vM(a,s,t.host,t._protocol)}return n}function rx(t){function e(n,r){let s;return n.getStatus()===401?n.getErrorText().includes("Firebase App Check token is invalid")?s=D4():s=P4():n.getStatus()===402?s=R4(t.bucket):n.getStatus()===403?s=L4(t.path):s=r,s.status=n.getStatus(),s.serverResponse=r.serverResponse,s}return e}function MC(t){const e=rx(t);function n(r,s){let a=e(r,s);return r.getStatus()===404&&(a=A4(t.path)),a.serverResponse=s.serverResponse,a}return n}function kM(t,e,n,r,s){const a={};e.isRoot?a.prefix="":a.prefix=e.path+"/",n.length>0&&(a.delimiter=n),r&&(a.pageToken=r),s&&(a.maxResults=s);const o=e.bucketOnlyServerUrl(),l=Qu(o,t.host,t._protocol),c="GET",d=t.maxOperationRetryTime,h=new Jf(l,c,jM(t,e.bucket),d);return h.urlParams=a,h.errorHandler=rx(e),h}function CM(t,e,n){const r=e.fullServerUrl(),s=Qu(r,t.host,t._protocol),a="GET",o=t.maxOperationRetryTime,l=new Jf(s,a,EM(t,n),o);return l.errorHandler=MC(e),l}function SM(t,e){const n=e.fullServerUrl(),r=Qu(n,t.host,t._protocol),s="DELETE",a=t.maxOperationRetryTime;function o(c,d){}const l=new Jf(r,s,o,a);return l.successCodes=[200,204],l.errorHandler=MC(e),l}function NM(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}function TM(t,e,n){const r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=NM(null,e)),r}function IM(t,e,n,r,s){const a=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function l(){let v="";for(let R=0;R<2;R++)v=v+Math.random().toString().slice(2);return v}const c=l();o["Content-Type"]="multipart/related; boundary="+c;const d=TM(e,r,s),h=xM(d,n),f="--"+c+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+h+`\r
--`+c+`\r
Content-Type: `+d.contentType+`\r
\r
`,p=`\r
--`+c+"--",k=la.getBlob(f,r,p);if(k===null)throw B4();const S={name:d.fullPath},T=Qu(a,t.host,t._protocol),C="POST",j=t.maxUploadRetryTime,y=new Jf(T,C,_M(t,n),j);return y.urlParams=S,y.headers=o,y.body=k.uploadData(),y.errorHandler=rx(e),y}class AM{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=co.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=co.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=co.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,n,r,s,a){if(this.sent_)throw hc("cannot .send() more than once");if(Ua(e)&&r&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(n,e,!0),a!==void 0)for(const o in a)a.hasOwnProperty(o)&&this.xhr_.setRequestHeader(o,a[o].toString());return s!==void 0?this.xhr_.send(s):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw hc("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw hc("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw hc("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw hc("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class RM extends AM{initXhr(){this.xhr_.responseType="text"}}function Xf(){return new RM}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _o{constructor(e,n){this._service=e,n instanceof Gr?this._location=n:this._location=Gr.makeFromUrl(n,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,n){return new _o(e,n)}get root(){const e=new Gr(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return DC(this._location.path)}get storage(){return this._service}get parent(){const e=hM(this._location.path);if(e===null)return null;const n=new Gr(this._location.bucket,e);return new _o(this._service,n)}_throwIfRoot(e){if(this._location.path==="")throw G4(e)}}function PM(t,e,n){t._throwIfRoot("uploadBytes");const r=IM(t.storage,t._location,LC(),new la(e,!0),n);return t.storage.makeRequestWithTokens(r,Xf).then(s=>({metadata:s,ref:t}))}function DM(t){const e={prefixes:[],items:[]};return FC(t,e).then(()=>e)}async function FC(t,e,n){const s=await LM(t,{pageToken:n});e.prefixes.push(...s.prefixes),e.items.push(...s.items),s.nextPageToken!=null&&await FC(t,e,s.nextPageToken)}function LM(t,e){e!=null&&typeof e.maxResults=="number"&&Lg("options.maxResults",1,1e3,e.maxResults);const n=e||{},r=kM(t.storage,t._location,"/",n.pageToken,n.maxResults);return t.storage.makeRequestWithTokens(r,Xf)}function OM(t){t._throwIfRoot("getDownloadURL");const e=CM(t.storage,t._location,LC());return t.storage.makeRequestWithTokens(e,Xf).then(n=>{if(n===null)throw $4();return n})}function MM(t){t._throwIfRoot("deleteObject");const e=SM(t.storage,t._location);return t.storage.makeRequestWithTokens(e,Xf)}function FM(t,e){const n=fM(t._location.path,e),r=new Gr(t._location.bucket,n);return new _o(t.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VM(t){return/^[A-Za-z]+:\/\//.test(t)}function UM(t,e){return new _o(t,e)}function VC(t,e){if(t instanceof sx){const n=t;if(n._bucket==null)throw U4();const r=new _o(n,n._bucket);return e!=null?VC(r,e):r}else return e!==void 0?FM(t,e):t}function BM(t,e){if(e&&VM(e)){if(t instanceof sx)return UM(t,e);throw Dg("To use ref(service, url), the first argument must be a Storage instance.")}else return VC(t,e)}function O0(t,e){const n=e==null?void 0:e[NC];return n==null?null:Gr.makeFromBucketSpec(n,t)}function $M(t,e,n,r={}){t.host=`${e}:${n}`;const s=Ua(e);s&&(Cf(`https://${t.host}`),Ba("Storage",!0)),t._isUsingEmulator=!0,t._protocol=s?"https":"http";const{mockUserToken:a}=r;a&&(t._overrideAuthToken=typeof a=="string"?a:Jj(a,t.app.options.projectId))}class sx{constructor(e,n,r,s,a,o=!1){this.app=e,this._authProvider=n,this._appCheckProvider=r,this._url=s,this._firebaseVersion=a,this._isUsingEmulator=o,this._bucket=null,this._host=SC,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=T4,this._maxUploadRetryTime=I4,this._requests=new Set,s!=null?this._bucket=Gr.makeFromBucketSpec(s,this._host):this._bucket=O0(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Gr.makeFromBucketSpec(this._url,e):this._bucket=O0(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Lg("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Lg("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const n=await e.getToken();if(n!==null)return n.accessToken}return null}async _getAppCheckToken(){if(Ir(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new _o(this,e)}_makeRequest(e,n,r,s,a=!0){if(this._deleted)return new H4(TC());{const o=nM(e,this._appId,r,s,n,this._firebaseVersion,a,this._isUsingEmulator);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,n){const[r,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,n,r,s).getPromise()}}const M0="@firebase/storage",F0="0.13.10";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UC="storage";function Jl(t,e,n){return t=ct(t),PM(t,e,n)}function zM(t){return t=ct(t),DM(t)}function Xl(t){return t=ct(t),OM(t)}function ih(t){return t=ct(t),MM(t)}function xi(t,e){return t=ct(t),BM(t,e)}function Po(t=Lu(),e){t=ct(t),Ba("Storage",!1);const r=$a(t,UC).getImmediate({identifier:e}),s=$y("storage");return s&&GM(r,...s),r}function GM(t,e,n,r={}){$M(t,e,n,r)}function HM(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),s=t.getProvider("app-check-internal");return new sx(n,r,s,e,To)}function qM(){Ms(new ws(UC,HM,"PUBLIC").setMultipleInstances(!0)),Rr(M0,F0,""),Rr(M0,F0,"esm2017")}qM();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WM="type.googleapis.com/google.protobuf.Int64Value",KM="type.googleapis.com/google.protobuf.UInt64Value";function BC(t,e){const n={};for(const r in t)t.hasOwnProperty(r)&&(n[r]=e(t[r]));return n}function ef(t){if(t==null)return null;if(t instanceof Number&&(t=t.valueOf()),typeof t=="number"&&isFinite(t)||t===!0||t===!1||Object.prototype.toString.call(t)==="[object String]")return t;if(t instanceof Date)return t.toISOString();if(Array.isArray(t))return t.map(e=>ef(e));if(typeof t=="function"||typeof t=="object")return BC(t,e=>ef(e));throw new Error("Data cannot be encoded in JSON: "+t)}function Pl(t){if(t==null)return t;if(t["@type"])switch(t["@type"]){case WM:case KM:{const e=Number(t.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+t);return e}default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(e=>Pl(e)):typeof t=="function"||typeof t=="object"?BC(t,e=>Pl(e)):t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ix="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V0={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ns extends Fs{constructor(e,n,r){super(`${ix}/${e}`,n||""),this.details=r,Object.setPrototypeOf(this,ns.prototype)}}function QM(t){if(t>=200&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function tf(t,e){let n=QM(t),r=n,s;try{const a=e&&e.error;if(a){const o=a.status;if(typeof o=="string"){if(!V0[o])return new ns("internal","internal");n=V0[o],r=o}const l=a.message;typeof l=="string"&&(r=l),s=a.details,s!==void 0&&(s=Pl(s))}}catch{}return n==="ok"?null:new ns(n,r,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YM{constructor(e,n,r,s){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,Ir(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=n.getImmediate({optional:!0}),this.messaging=r.getImmediate({optional:!0}),this.auth||n.get().then(a=>this.auth=a,()=>{}),this.messaging||r.get().then(a=>this.messaging=a,()=>{}),this.appCheck||s==null||s.get().then(a=>this.appCheck=a,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return e==null?void 0:e.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const n=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return n.error?null:n.token}return null}async getContext(e){const n=await this.getAuthToken(),r=await this.getMessagingToken(),s=await this.getAppCheckToken(e);return{authToken:n,messagingToken:r,appCheckToken:s}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Og="us-central1",JM=/^data: (.*?)(?:\n|$)/;function XM(t){let e=null;return{promise:new Promise((n,r)=>{e=setTimeout(()=>{r(new ns("deadline-exceeded","deadline-exceeded"))},t)}),cancel:()=>{e&&clearTimeout(e)}}}class ZM{constructor(e,n,r,s,a=Og,o=(...l)=>fetch(...l)){this.app=e,this.fetchImpl=o,this.emulatorOrigin=null,this.contextProvider=new YM(e,n,r,s),this.cancelAllRequests=new Promise(l=>{this.deleteService=()=>Promise.resolve(l())});try{const l=new URL(a);this.customDomain=l.origin+(l.pathname==="/"?"":l.pathname),this.region=Og}catch{this.customDomain=null,this.region=a}}_delete(){return this.deleteService()}_url(e){const n=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${n}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${n}.cloudfunctions.net/${e}`}}function eF(t,e,n){const r=Ua(e);t.emulatorOrigin=`http${r?"s":""}://${e}:${n}`,r&&(Cf(t.emulatorOrigin),Ba("Functions",!0))}function tF(t,e,n){const r=s=>rF(t,e,s,n||{});return r.stream=(s,a)=>iF(t,e,s,a),r}async function nF(t,e,n,r){n["Content-Type"]="application/json";let s;try{s=await r(t,{method:"POST",body:JSON.stringify(e),headers:n})}catch{return{status:0,json:null}}let a=null;try{a=await s.json()}catch{}return{status:s.status,json:a}}async function $C(t,e){const n={},r=await t.contextProvider.getContext(e.limitedUseAppCheckTokens);return r.authToken&&(n.Authorization="Bearer "+r.authToken),r.messagingToken&&(n["Firebase-Instance-ID-Token"]=r.messagingToken),r.appCheckToken!==null&&(n["X-Firebase-AppCheck"]=r.appCheckToken),n}function rF(t,e,n,r){const s=t._url(e);return sF(t,s,n,r)}async function sF(t,e,n,r){n=ef(n);const s={data:n},a=await $C(t,r),o=r.timeout||7e4,l=XM(o),c=await Promise.race([nF(e,s,a,t.fetchImpl),l.promise,t.cancelAllRequests]);if(l.cancel(),!c)throw new ns("cancelled","Firebase Functions instance was deleted.");const d=tf(c.status,c.json);if(d)throw d;if(!c.json)throw new ns("internal","Response is not valid JSON object.");let h=c.json.data;if(typeof h>"u"&&(h=c.json.result),typeof h>"u")throw new ns("internal","Response is missing data field.");return{data:Pl(h)}}function iF(t,e,n,r){const s=t._url(e);return aF(t,s,n,r||{})}async function aF(t,e,n,r){var s;n=ef(n);const a={data:n},o=await $C(t,r);o["Content-Type"]="application/json",o.Accept="text/event-stream";let l;try{l=await t.fetchImpl(e,{method:"POST",body:JSON.stringify(a),headers:o,signal:r==null?void 0:r.signal})}catch(k){if(k instanceof Error&&k.name==="AbortError"){const T=new ns("cancelled","Request was cancelled.");return{data:Promise.reject(T),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(T)}}}}}}const S=tf(0,null);return{data:Promise.reject(S),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(S)}}}}}}let c,d;const h=new Promise((k,S)=>{c=k,d=S});(s=r==null?void 0:r.signal)===null||s===void 0||s.addEventListener("abort",()=>{const k=new ns("cancelled","Request was cancelled.");d(k)});const f=l.body.getReader(),p=oF(f,c,d,r==null?void 0:r.signal);return{stream:{[Symbol.asyncIterator](){const k=p.getReader();return{async next(){const{value:S,done:T}=await k.read();return{value:S,done:T}},async return(){return await k.cancel(),{done:!0,value:void 0}}}}},data:h}}function oF(t,e,n,r){const s=(o,l)=>{const c=o.match(JM);if(!c)return;const d=c[1];try{const h=JSON.parse(d);if("result"in h){e(Pl(h.result));return}if("message"in h){l.enqueue(Pl(h.message));return}if("error"in h){const f=tf(0,h);l.error(f),n(f);return}}catch(h){if(h instanceof ns){l.error(h),n(h);return}}},a=new TextDecoder;return new ReadableStream({start(o){let l="";return c();async function c(){if(r!=null&&r.aborted){const d=new ns("cancelled","Request was cancelled");return o.error(d),n(d),Promise.resolve()}try{const{value:d,done:h}=await t.read();if(h){l.trim()&&s(l.trim(),o),o.close();return}if(r!=null&&r.aborted){const p=new ns("cancelled","Request was cancelled");o.error(p),n(p),await t.cancel();return}l+=a.decode(d,{stream:!0});const f=l.split(`
`);l=f.pop()||"";for(const p of f)p.trim()&&s(p.trim(),o);return c()}catch(d){const h=d instanceof ns?d:tf(0,null);o.error(h),n(h)}}},cancel(){return t.cancel()}})}const U0="@firebase/functions",B0="0.12.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lF="auth-internal",cF="app-check-internal",uF="messaging-internal";function dF(t){const e=(n,{instanceIdentifier:r})=>{const s=n.getProvider("app").getImmediate(),a=n.getProvider(lF),o=n.getProvider(uF),l=n.getProvider(cF);return new ZM(s,a,o,l,r)};Ms(new ws(ix,e,"PUBLIC").setMultipleInstances(!0)),Rr(U0,B0,t),Rr(U0,B0,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hF(t=Lu(),e=Og){Ba("Functions",!1);const r=$a(ct(t),ix).getImmediate({identifier:e}),s=$y("functions");return s&&fF(r,...s),r}function fF(t,e,n){eF(ct(t),e,n)}function gl(t,e,n){return tF(ct(t),e,n)}dF();const zC="@firebase/installations",ax="0.6.16";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GC=1e4,HC=`w:${ax}`,qC="FIS_v2",pF="https://firebaseinstallations.googleapis.com/v1",mF=60*60*1e3,gF="installations",yF="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vF={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},jo=new No(gF,yF,vF);function WC(t){return t instanceof Fs&&t.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KC({projectId:t}){return`${pF}/projects/${t}/installations`}function QC(t){return{token:t.token,requestStatus:2,expiresIn:wF(t.expiresIn),creationTime:Date.now()}}async function YC(t,e){const r=(await e.json()).error;return jo.create("request-failed",{requestName:t,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function JC({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function xF(t,{refreshToken:e}){const n=JC(t);return n.append("Authorization",bF(e)),n}async function XC(t){const e=await t();return e.status>=500&&e.status<600?t():e}function wF(t){return Number(t.replace("s","000"))}function bF(t){return`${qC} ${t}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _F({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const r=KC(t),s=JC(t),a=e.getImmediate({optional:!0});if(a){const d=await a.getHeartbeatsHeader();d&&s.append("x-firebase-client",d)}const o={fid:n,authVersion:qC,appId:t.appId,sdkVersion:HC},l={method:"POST",headers:s,body:JSON.stringify(o)},c=await XC(()=>fetch(r,l));if(c.ok){const d=await c.json();return{fid:d.fid||n,registrationStatus:2,refreshToken:d.refreshToken,authToken:QC(d.authToken)}}else throw await YC("Create Installation",c)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZC(t){return new Promise(e=>{setTimeout(e,t)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jF(t){return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EF=/^[cdef][\w-]{21}$/,Mg="";function kF(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const n=CF(t);return EF.test(n)?n:Mg}catch{return Mg}}function CF(t){return jF(t).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zf(t){return`${t.appName}!${t.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eS=new Map;function tS(t,e){const n=Zf(t);nS(n,e),SF(n,e)}function nS(t,e){const n=eS.get(t);if(n)for(const r of n)r(e)}function SF(t,e){const n=NF();n&&n.postMessage({key:t,fid:e}),TF()}let ro=null;function NF(){return!ro&&"BroadcastChannel"in self&&(ro=new BroadcastChannel("[Firebase] FID Change"),ro.onmessage=t=>{nS(t.data.key,t.data.fid)}),ro}function TF(){eS.size===0&&ro&&(ro.close(),ro=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IF="firebase-installations-database",AF=1,Eo="firebase-installations-store";let nm=null;function ox(){return nm||(nm=Sf(IF,AF,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(Eo)}}})),nm}async function nf(t,e){const n=Zf(t),s=(await ox()).transaction(Eo,"readwrite"),a=s.objectStore(Eo),o=await a.get(n);return await a.put(e,n),await s.done,(!o||o.fid!==e.fid)&&tS(t,e.fid),e}async function rS(t){const e=Zf(t),r=(await ox()).transaction(Eo,"readwrite");await r.objectStore(Eo).delete(e),await r.done}async function ep(t,e){const n=Zf(t),s=(await ox()).transaction(Eo,"readwrite"),a=s.objectStore(Eo),o=await a.get(n),l=e(o);return l===void 0?await a.delete(n):await a.put(l,n),await s.done,l&&(!o||o.fid!==l.fid)&&tS(t,l.fid),l}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lx(t){let e;const n=await ep(t.appConfig,r=>{const s=RF(r),a=PF(t,s);return e=a.registrationPromise,a.installationEntry});return n.fid===Mg?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}function RF(t){const e=t||{fid:kF(),registrationStatus:0};return sS(e)}function PF(t,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(jo.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=DF(t,n);return{installationEntry:n,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:LF(t)}:{installationEntry:e}}async function DF(t,e){try{const n=await _F(t,e);return nf(t.appConfig,n)}catch(n){throw WC(n)&&n.customData.serverCode===409?await rS(t.appConfig):await nf(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}async function LF(t){let e=await $0(t.appConfig);for(;e.registrationStatus===1;)await ZC(100),e=await $0(t.appConfig);if(e.registrationStatus===0){const{installationEntry:n,registrationPromise:r}=await lx(t);return r||n}return e}function $0(t){return ep(t,e=>{if(!e)throw jo.create("installation-not-found");return sS(e)})}function sS(t){return OF(t)?{fid:t.fid,registrationStatus:0}:t}function OF(t){return t.registrationStatus===1&&t.registrationTime+GC<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MF({appConfig:t,heartbeatServiceProvider:e},n){const r=FF(t,n),s=xF(t,n),a=e.getImmediate({optional:!0});if(a){const d=await a.getHeartbeatsHeader();d&&s.append("x-firebase-client",d)}const o={installation:{sdkVersion:HC,appId:t.appId}},l={method:"POST",headers:s,body:JSON.stringify(o)},c=await XC(()=>fetch(r,l));if(c.ok){const d=await c.json();return QC(d)}else throw await YC("Generate Auth Token",c)}function FF(t,{fid:e}){return`${KC(t)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cx(t,e=!1){let n;const r=await ep(t.appConfig,a=>{if(!iS(a))throw jo.create("not-registered");const o=a.authToken;if(!e&&BF(o))return a;if(o.requestStatus===1)return n=VF(t,e),a;{if(!navigator.onLine)throw jo.create("app-offline");const l=zF(a);return n=UF(t,l),l}});return n?await n:r.authToken}async function VF(t,e){let n=await z0(t.appConfig);for(;n.authToken.requestStatus===1;)await ZC(100),n=await z0(t.appConfig);const r=n.authToken;return r.requestStatus===0?cx(t,e):r}function z0(t){return ep(t,e=>{if(!iS(e))throw jo.create("not-registered");const n=e.authToken;return GF(n)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function UF(t,e){try{const n=await MF(t,e),r=Object.assign(Object.assign({},e),{authToken:n});return await nf(t.appConfig,r),n}catch(n){if(WC(n)&&(n.customData.serverCode===401||n.customData.serverCode===404))await rS(t.appConfig);else{const r=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await nf(t.appConfig,r)}throw n}}function iS(t){return t!==void 0&&t.registrationStatus===2}function BF(t){return t.requestStatus===2&&!$F(t)}function $F(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+mF}function zF(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}function GF(t){return t.requestStatus===1&&t.requestTime+GC<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HF(t){const e=t,{installationEntry:n,registrationPromise:r}=await lx(e);return r?r.catch(console.error):cx(e).catch(console.error),n.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qF(t,e=!1){const n=t;return await WF(n),(await cx(n,e)).token}async function WF(t){const{registrationPromise:e}=await lx(t);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KF(t){if(!t||!t.options)throw rm("App Configuration");if(!t.name)throw rm("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw rm(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}function rm(t){return jo.create("missing-app-config-values",{valueName:t})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aS="installations",QF="installations-internal",YF=t=>{const e=t.getProvider("app").getImmediate(),n=KF(e),r=$a(e,"heartbeat");return{app:e,appConfig:n,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},JF=t=>{const e=t.getProvider("app").getImmediate(),n=$a(e,aS).getImmediate();return{getId:()=>HF(n),getToken:s=>qF(n,s)}};function XF(){Ms(new ws(aS,YF,"PUBLIC")),Ms(new ws(QF,JF,"PRIVATE"))}XF();Rr(zC,ax);Rr(zC,ax,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZF="/firebase-messaging-sw.js",eV="/firebase-cloud-messaging-push-scope",oS="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",tV="https://fcmregistrations.googleapis.com/v1",lS="google.c.a.c_id",nV="google.c.a.c_l",rV="google.c.a.ts",sV="google.c.a.e",G0=1e4;var H0;(function(t){t[t.DATA_MESSAGE=1]="DATA_MESSAGE",t[t.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"})(H0||(H0={}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */var Eu;(function(t){t.PUSH_RECEIVED="push-received",t.NOTIFICATION_CLICKED="notification-clicked"})(Eu||(Eu={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ii(t){const e=new Uint8Array(t);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function iV(t){const e="=".repeat((4-t.length%4)%4),n=(t+e).replace(/\-/g,"+").replace(/_/g,"/"),r=atob(n),s=new Uint8Array(r.length);for(let a=0;a<r.length;++a)s[a]=r.charCodeAt(a);return s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sm="fcm_token_details_db",aV=5,q0="fcm_token_object_Store";async function oV(t){if("databases"in indexedDB&&!(await indexedDB.databases()).map(a=>a.name).includes(sm))return null;let e=null;return(await Sf(sm,aV,{upgrade:async(r,s,a,o)=>{var l;if(s<2||!r.objectStoreNames.contains(q0))return;const c=o.objectStore(q0),d=await c.index("fcmSenderId").get(t);if(await c.clear(),!!d){if(s===2){const h=d;if(!h.auth||!h.p256dh||!h.endpoint)return;e={token:h.fcmToken,createTime:(l=h.createTime)!==null&&l!==void 0?l:Date.now(),subscriptionOptions:{auth:h.auth,p256dh:h.p256dh,endpoint:h.endpoint,swScope:h.swScope,vapidKey:typeof h.vapidKey=="string"?h.vapidKey:Ii(h.vapidKey)}}}else if(s===3){const h=d;e={token:h.fcmToken,createTime:h.createTime,subscriptionOptions:{auth:Ii(h.auth),p256dh:Ii(h.p256dh),endpoint:h.endpoint,swScope:h.swScope,vapidKey:Ii(h.vapidKey)}}}else if(s===4){const h=d;e={token:h.fcmToken,createTime:h.createTime,subscriptionOptions:{auth:Ii(h.auth),p256dh:Ii(h.p256dh),endpoint:h.endpoint,swScope:h.swScope,vapidKey:Ii(h.vapidKey)}}}}}})).close(),await Bp(sm),await Bp("fcm_vapid_details_db"),await Bp("undefined"),lV(e)?e:null}function lV(t){if(!t||!t.subscriptionOptions)return!1;const{subscriptionOptions:e}=t;return typeof t.createTime=="number"&&t.createTime>0&&typeof t.token=="string"&&t.token.length>0&&typeof e.auth=="string"&&e.auth.length>0&&typeof e.p256dh=="string"&&e.p256dh.length>0&&typeof e.endpoint=="string"&&e.endpoint.length>0&&typeof e.swScope=="string"&&e.swScope.length>0&&typeof e.vapidKey=="string"&&e.vapidKey.length>0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cV="firebase-messaging-database",uV=1,ku="firebase-messaging-store";let im=null;function cS(){return im||(im=Sf(cV,uV,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(ku)}}})),im}async function dV(t){const e=uS(t),r=await(await cS()).transaction(ku).objectStore(ku).get(e);if(r)return r;{const s=await oV(t.appConfig.senderId);if(s)return await ux(t,s),s}}async function ux(t,e){const n=uS(t),s=(await cS()).transaction(ku,"readwrite");return await s.objectStore(ku).put(e,n),await s.done,e}function uS({appConfig:t}){return t.appId}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hV={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},Lr=new No("messaging","Messaging",hV);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fV(t,e){const n=await hx(t),r=dS(e),s={method:"POST",headers:n,body:JSON.stringify(r)};let a;try{a=await(await fetch(dx(t.appConfig),s)).json()}catch(o){throw Lr.create("token-subscribe-failed",{errorInfo:o==null?void 0:o.toString()})}if(a.error){const o=a.error.message;throw Lr.create("token-subscribe-failed",{errorInfo:o})}if(!a.token)throw Lr.create("token-subscribe-no-token");return a.token}async function pV(t,e){const n=await hx(t),r=dS(e.subscriptionOptions),s={method:"PATCH",headers:n,body:JSON.stringify(r)};let a;try{a=await(await fetch(`${dx(t.appConfig)}/${e.token}`,s)).json()}catch(o){throw Lr.create("token-update-failed",{errorInfo:o==null?void 0:o.toString()})}if(a.error){const o=a.error.message;throw Lr.create("token-update-failed",{errorInfo:o})}if(!a.token)throw Lr.create("token-update-no-token");return a.token}async function mV(t,e){const r={method:"DELETE",headers:await hx(t)};try{const a=await(await fetch(`${dx(t.appConfig)}/${e}`,r)).json();if(a.error){const o=a.error.message;throw Lr.create("token-unsubscribe-failed",{errorInfo:o})}}catch(s){throw Lr.create("token-unsubscribe-failed",{errorInfo:s==null?void 0:s.toString()})}}function dx({projectId:t}){return`${tV}/projects/${t}/registrations`}async function hx({appConfig:t,installations:e}){const n=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t.apiKey,"x-goog-firebase-installations-auth":`FIS ${n}`})}function dS({p256dh:t,auth:e,endpoint:n,vapidKey:r}){const s={web:{endpoint:n,auth:e,p256dh:t}};return r!==oS&&(s.web.applicationPubKey=r),s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gV=7*24*60*60*1e3;async function yV(t){const e=await xV(t.swRegistration,t.vapidKey),n={vapidKey:t.vapidKey,swScope:t.swRegistration.scope,endpoint:e.endpoint,auth:Ii(e.getKey("auth")),p256dh:Ii(e.getKey("p256dh"))},r=await dV(t.firebaseDependencies);if(r){if(wV(r.subscriptionOptions,n))return Date.now()>=r.createTime+gV?vV(t,{token:r.token,createTime:Date.now(),subscriptionOptions:n}):r.token;try{await mV(t.firebaseDependencies,r.token)}catch(s){console.warn(s)}return W0(t.firebaseDependencies,n)}else return W0(t.firebaseDependencies,n)}async function vV(t,e){try{const n=await pV(t.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:n,createTime:Date.now()});return await ux(t.firebaseDependencies,r),n}catch(n){throw n}}async function W0(t,e){const r={token:await fV(t,e),createTime:Date.now(),subscriptionOptions:e};return await ux(t,r),r.token}async function xV(t,e){const n=await t.pushManager.getSubscription();return n||t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:iV(e)})}function wV(t,e){const n=e.vapidKey===t.vapidKey,r=e.endpoint===t.endpoint,s=e.auth===t.auth,a=e.p256dh===t.p256dh;return n&&r&&s&&a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K0(t){const e={from:t.from,collapseKey:t.collapse_key,messageId:t.fcmMessageId};return bV(e,t),_V(e,t),jV(e,t),e}function bV(t,e){if(!e.notification)return;t.notification={};const n=e.notification.title;n&&(t.notification.title=n);const r=e.notification.body;r&&(t.notification.body=r);const s=e.notification.image;s&&(t.notification.image=s);const a=e.notification.icon;a&&(t.notification.icon=a)}function _V(t,e){e.data&&(t.data=e.data)}function jV(t,e){var n,r,s,a,o;if(!e.fcmOptions&&!(!((n=e.notification)===null||n===void 0)&&n.click_action))return;t.fcmOptions={};const l=(s=(r=e.fcmOptions)===null||r===void 0?void 0:r.link)!==null&&s!==void 0?s:(a=e.notification)===null||a===void 0?void 0:a.click_action;l&&(t.fcmOptions.link=l);const c=(o=e.fcmOptions)===null||o===void 0?void 0:o.analytics_label;c&&(t.fcmOptions.analyticsLabel=c)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EV(t){return typeof t=="object"&&!!t&&lS in t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kV(t){if(!t||!t.options)throw am("App Configuration Object");if(!t.name)throw am("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:n}=t;for(const r of e)if(!n[r])throw am(r);return{appName:t.name,projectId:n.projectId,apiKey:n.apiKey,appId:n.appId,senderId:n.messagingSenderId}}function am(t){return Lr.create("missing-app-config-values",{valueName:t})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CV{constructor(e,n,r){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const s=kV(e);this.firebaseDependencies={app:e,appConfig:s,installations:n,analyticsProvider:r}}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SV(t){try{t.swRegistration=await navigator.serviceWorker.register(ZF,{scope:eV}),t.swRegistration.update().catch(()=>{}),await NV(t.swRegistration)}catch(e){throw Lr.create("failed-service-worker-registration",{browserErrorMessage:e==null?void 0:e.message})}}async function NV(t){return new Promise((e,n)=>{const r=setTimeout(()=>n(new Error(`Service worker not registered after ${G0} ms`)),G0),s=t.installing||t.waiting;t.active?(clearTimeout(r),e()):s?s.onstatechange=a=>{var o;((o=a.target)===null||o===void 0?void 0:o.state)==="activated"&&(s.onstatechange=null,clearTimeout(r),e())}:(clearTimeout(r),n(new Error("No incoming service worker found.")))})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TV(t,e){if(!e&&!t.swRegistration&&await SV(t),!(!e&&t.swRegistration)){if(!(e instanceof ServiceWorkerRegistration))throw Lr.create("invalid-sw-registration");t.swRegistration=e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IV(t,e){e?t.vapidKey=e:t.vapidKey||(t.vapidKey=oS)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hS(t,e){if(!navigator)throw Lr.create("only-available-in-window");if(Notification.permission==="default"&&await Notification.requestPermission(),Notification.permission!=="granted")throw Lr.create("permission-blocked");return await IV(t,e==null?void 0:e.vapidKey),await TV(t,e==null?void 0:e.serviceWorkerRegistration),yV(t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AV(t,e,n){const r=RV(e);(await t.firebaseDependencies.analyticsProvider.get()).logEvent(r,{message_id:n[lS],message_name:n[nV],message_time:n[rV],message_device_time:Math.floor(Date.now()/1e3)})}function RV(t){switch(t){case Eu.NOTIFICATION_CLICKED:return"notification_open";case Eu.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function PV(t,e){const n=e.data;if(!n.isFirebaseMessaging)return;t.onMessageHandler&&n.messageType===Eu.PUSH_RECEIVED&&(typeof t.onMessageHandler=="function"?t.onMessageHandler(K0(n)):t.onMessageHandler.next(K0(n)));const r=n.data;EV(r)&&r[sV]==="1"&&await AV(t,n.messageType,r)}const Q0="@firebase/messaging",Y0="0.12.20";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DV=t=>{const e=new CV(t.getProvider("app").getImmediate(),t.getProvider("installations-internal").getImmediate(),t.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",n=>PV(e,n)),e},LV=t=>{const e=t.getProvider("messaging").getImmediate();return{getToken:r=>hS(e,r)}};function OV(){Ms(new ws("messaging",DV,"PUBLIC")),Ms(new ws("messaging-internal",LV,"PRIVATE")),Rr(Q0,Y0),Rr(Q0,Y0,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MV(){try{await Zj()}catch{return!1}return typeof window<"u"&&Xj()&&_A()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FV(t,e){if(!navigator)throw Lr.create("only-available-in-window");return t.onMessageHandler=e,()=>{t.onMessageHandler=null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VV(t=Lu()){return MV().then(e=>{if(!e)throw Lr.create("unsupported-browser")},e=>{throw Lr.create("indexed-db-unsupported")}),$a(ct(t),"messaging").getImmediate()}async function UV(t,e){return t=ct(t),hS(t,e)}function BV(t,e){return t=ct(t),FV(t,e)}OV();const $V={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_FIREBASE_API_KEY:"AIzaSyDZ7h9KXAwIvzqFf9gMrMBOJvkMxSMjjRw",VITE_FIREBASE_APP_ID:"1:198332728326:web:d7eec9d577fb30fa916f87",VITE_FIREBASE_AUTH_DOMAIN:"tak-campfire.firebaseapp.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"198332728326",VITE_FIREBASE_PROJECT_ID:"tak-campfire",VITE_FIREBASE_STORAGE_BUCKET:"tak-campfire-main",VITE_FIREBASE_VAPID_KEY:"BHVn4o8nW7nriA-hnKA_wGXtVnL5xy5-M-iE9bKQfLXDVnKMRb06pT7JT9CqOQFbPdiAVk1IHYg_XD4GFMEzwQ4"},zV=["VITE_FIREBASE_API_KEY","VITE_FIREBASE_AUTH_DOMAIN","VITE_FIREBASE_PROJECT_ID","VITE_FIREBASE_STORAGE_BUCKET","VITE_FIREBASE_MESSAGING_SENDER_ID","VITE_FIREBASE_APP_ID"],J0=zV.filter(t=>!$V[t]);if(J0.length){const t=`Missing Firebase environment variables: ${J0.join(", ")}`;throw console.warn(t),new Error(t)}const GV={apiKey:"AIzaSyDZ7h9KXAwIvzqFf9gMrMBOJvkMxSMjjRw",authDomain:"tak-campfire.firebaseapp.com",projectId:"tak-campfire",storageBucket:"tak-campfire-main",messagingSenderId:"198332728326",appId:"1:198332728326:web:d7eec9d577fb30fa916f87"},ni=nE(GV),Fe=vD(ni),F=y4(ni),ah=Po(ni),yl=hF(ni),X0=VV(ni),Z0=(t,e)=>e||null,Hc=t=>!t||/^data:/i.test(t)?null:t,e_=t=>/^https?:\/\//i.test(t||""),Pn=({pngUrl:t,webpUrl:e,alt:n="",loading:r="lazy",cacheKey:s,...a})=>{const o=Z0(s,t),l=e||(t?t.replace(/\.png$/,".webp"):void 0),c=l?Z0(`${s||l}-webp`,l):null,d=Hc(e_(o)?o:t),h=Hc(e_(c)?c:null);return h?i.jsxs("picture",{children:[i.jsx("source",{srcSet:h,type:"image/webp"}),i.jsx("img",{src:d,alt:n,loading:r,decoding:"async",...a})]}):i.jsx("img",{src:d,alt:n,loading:r,decoding:"async",...a})};function uo(...t){}const Dl=getComputedStyle(document.documentElement).getPropertyValue("--accent-color").trim()||"#ea580c",HV=(t,e=1)=>{let n=t.replace("#","");n.length===3&&(n=n.split("").map(l=>l+l).join(""));const r=parseInt(n,16),s=r>>16&255,a=r>>8&255,o=r&255;return`rgba(${s}, ${a}, ${o}, ${e})`},ho=t=>{document.documentElement.style.setProperty("--accent-color",t),document.documentElement.style.setProperty("--accent-color-10",HV(t,.1))},qV=t=>{if(!t)return;let e=document.querySelector('link[rel="icon"]');e||(e=document.createElement("link"),e.rel="icon",document.head.appendChild(e)),e.type="image/png",e.href=t};let Fg=null;try{Fg=localStorage.getItem("accentColor")}catch{Fg=null}const Uo={logoUrl:"",iconUrl:"",campfireLogoUrl:"",accentColor:Fg||Dl},tp=(t=!0)=>{const[e,n]=m.useState(Uo),[r,s]=m.useState(!0);return m.useEffect(()=>{(async()=>{try{const l=await gn(ie(F,"settings","site"));if(l.exists()){const c=l.data();n({...Uo,...c});const d=c.accentColor||Uo.accentColor;if(t){ho(d);try{localStorage.setItem("accentColor",d)}catch{}}}else if(await Jn(ie(F,"settings","site"),Uo),t){ho(Uo.accentColor);try{localStorage.setItem("accentColor",Uo.accentColor)}catch{}}}catch(l){console.error("Failed to fetch site settings",l)}finally{s(!1)}})()},[]),m.useEffect(()=>{if(e.accentColor&&t){ho(e.accentColor);try{localStorage.setItem("accentColor",e.accentColor)}catch{}}},[e.accentColor]),m.useEffect(()=>{e.iconUrl&&qV(e.iconUrl)},[e.iconUrl]),{settings:e,loading:r,saveSettings:async o=>{if(await Jn(ie(F,"settings","site"),o,{merge:!0}),n(l=>({...l,...o})),o.accentColor)try{localStorage.setItem("accentColor",o.accentColor)}catch{}}}},Gs="https://firebasestorage.googleapis.com/v0/b/tak-campfire-main/o/StudioTak%2Flogo_new.webp?alt=media&token=1f08d552-6c85-444d-ac4f-1e895e97e5bd",WV=({onLogin:t})=>{const[e,n]=m.useState(""),[r,s]=m.useState(""),[a,o]=m.useState(""),[l,c]=m.useState(null),[d,h]=m.useState(""),[f,p]=m.useState(""),[k,S]=m.useState(!1),[T,C]=m.useState(!1),[j,y]=m.useState(!1),[v,R]=m.useState(!1),{settings:O}=tp(!1),M=async E=>{E.preventDefault(),o(""),y(!1),R(!1),S(!0);try{await zR(Fe,e,r),uo("Sign-in successful"),t&&t()}catch(N){if(N.code==="auth/multi-factor-auth-required")try{const D=YR(Fe,N),I={multiFactorHint:D.hints[0],session:D.session},pe=new qE(Fe,"recaptcha-container",{size:"invisible"}),Ae=await new gi(Fe).verifyPhoneNumber(I,pe);h(Ae),c(D)}catch(D){o(D.message)}else N.code==="auth/wrong-password"?(o("Incorrect password"),y(!0)):o(N.message)}finally{S(!1)}},b=async E=>{if(E.preventDefault(),!!l){o(""),C(!0);try{const N=gi.credential(d,f),D=ov.assertion(N);await l.resolveSignIn(D),uo("MFA sign-in successful"),t&&t()}catch(N){o(N.message)}finally{C(!1)}}},x=async()=>{o("");try{await $R(Fe,e),R(!0)}catch(E){o(E.message)}},w=O.campfireLogoUrl||O.logoUrl||Gs;return i.jsxs("div",{className:"flex flex-col justify-center items-center min-h-screen bg-gray-100 dark:bg-[var(--dark-bg)]",children:[i.jsx(Pn,{pngUrl:w,alt:"Campfire logo",loading:"eager",cacheKey:w,className:"mb-4 max-h-16 w-auto"}),l?i.jsxs("form",{onSubmit:b,className:"bg-white dark:bg-[var(--dark-sidebar-bg)] p-6 rounded shadow-md w-80",children:[i.jsx("h1",{className:"text-2xl mb-4 text-center",children:"Verify Code"}),i.jsx("label",{className:"block mb-2 text-sm font-medium",children:"SMS Code"}),i.jsx("input",{type:"text",value:f,onChange:E=>p(E.target.value),className:"w-full p-2 border rounded mb-4",required:!0}),a&&i.jsx("p",{className:"text-red-500 text-sm mb-2",children:a}),i.jsx("button",{type:"submit",className:"w-full btn-primary",disabled:T,children:T?"Verifying...":"Verify"})]}):i.jsxs("form",{onSubmit:M,className:"bg-white dark:bg-[var(--dark-sidebar-bg)] p-6 rounded shadow-md w-80",children:[i.jsx("h1",{className:"text-2xl mb-4 text-center",children:"Login"}),i.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Email"}),i.jsx("input",{type:"email",value:e,onChange:E=>n(E.target.value),className:"w-full p-2 border rounded mb-4",required:!0}),i.jsx("label",{className:"block mb-2 text-sm font-medium",children:"Password"}),i.jsx("input",{type:"password",value:r,onChange:E=>s(E.target.value),className:"w-full p-2 border rounded mb-4",required:!0}),a&&i.jsx("p",{className:"text-red-500 text-sm mb-2",children:a}),v&&i.jsx("p",{className:"text-green-500 text-sm mb-2",children:"Password reset email sent."}),i.jsx("button",{type:"submit",className:"w-full btn-primary",disabled:k,children:k?"Signing In...":"Sign In"}),j&&!v&&i.jsx("button",{type:"button",onClick:x,className:"w-full mt-2 text-sm text-center text-blue-500",children:"Forgot password?"}),i.jsx("div",{id:"recaptcha-container"})]})]})};var fS={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},t_=bt.createContext&&bt.createContext(fS),ka=function(){return ka=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},ka.apply(this,arguments)},KV=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n};function pS(t){return t&&t.map(function(e,n){return bt.createElement(e.tag,ka({key:n},e.attr),pS(e.child))})}function Ge(t){return function(e){return bt.createElement(QV,ka({attr:ka({},t.attr)},e),pS(t.child))}}function QV(t){var e=function(n){var r=t.attr,s=t.size,a=t.title,o=KV(t,["attr","size","title"]),l=s||n.size||"1em",c;return n.className&&(c=n.className),t.className&&(c=(c?c+" ":"")+t.className),bt.createElement("svg",ka({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,r,o,{className:c,style:ka(ka({color:t.color||n.color},n.style),t.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),a&&bt.createElement("title",null,a),t.children)};return t_!==void 0?bt.createElement(t_.Consumer,null,function(n){return e(n)}):e(fS)}function YV(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12.01",y2:"16"}}]})(t)}function JV(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12.01",y2:"16"}}]})(t)}function Ks(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"21 8 21 21 3 21 3 8"}},{tag:"rect",attr:{x:"1",y:"3",width:"22",height:"5"}},{tag:"line",attr:{x1:"10",y1:"12",x2:"14",y2:"12"}}]})(t)}function XV(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"18",y1:"20",x2:"18",y2:"10"}},{tag:"line",attr:{x1:"12",y1:"20",x2:"12",y2:"4"}},{tag:"line",attr:{x1:"6",y1:"20",x2:"6",y2:"14"}}]})(t)}function ZV(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}},{tag:"path",attr:{d:"M13.73 21a2 2 0 0 1-3.46 0"}}]})(t)}function n_(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"}},{tag:"path",attr:{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"}}]})(t)}function fx(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"line",attr:{x1:"16",y1:"2",x2:"16",y2:"6"}},{tag:"line",attr:{x1:"8",y1:"2",x2:"8",y2:"6"}},{tag:"line",attr:{x1:"3",y1:"10",x2:"21",y2:"10"}}]})(t)}function Cu(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}},{tag:"polyline",attr:{points:"22 4 12 14.01 9 11.01"}}]})(t)}function Vg(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"9 11 12 14 22 4"}},{tag:"path",attr:{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"}}]})(t)}function mS(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"20 6 9 17 4 12"}}]})(t)}function r_(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"polyline",attr:{points:"12 6 12 12 16 14"}}]})(t)}function px(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12 3h7a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-7m0-18H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h7m0-18v18"}}]})(t)}function s_(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"7 10 12 15 17 10"}},{tag:"line",attr:{x1:"12",y1:"15",x2:"12",y2:"3"}}]})(t)}function Ar(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"}}]})(t)}function Su(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}},{tag:"path",attr:{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"}}]})(t)}function Wi(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}},{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}}]})(t)}function eU(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}},{tag:"polyline",attr:{points:"14 2 14 8 20 8"}},{tag:"line",attr:{x1:"12",y1:"18",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"9",y1:"15",x2:"15",y2:"15"}}]})(t)}function Ll(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}},{tag:"polyline",attr:{points:"14 2 14 8 20 8"}},{tag:"line",attr:{x1:"16",y1:"13",x2:"8",y2:"13"}},{tag:"line",attr:{x1:"16",y1:"17",x2:"8",y2:"17"}},{tag:"polyline",attr:{points:"10 9 9 9 8 9"}}]})(t)}function tU(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"}},{tag:"polyline",attr:{points:"13 2 13 9 20 9"}}]})(t)}function nU(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"}},{tag:"line",attr:{x1:"12",y1:"11",x2:"12",y2:"17"}},{tag:"line",attr:{x1:"9",y1:"14",x2:"15",y2:"14"}}]})(t)}function gS(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"}}]})(t)}function Yu(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"7",height:"7"}},{tag:"rect",attr:{x:"14",y:"3",width:"7",height:"7"}},{tag:"rect",attr:{x:"14",y:"14",width:"7",height:"7"}},{tag:"rect",attr:{x:"3",y:"14",width:"7",height:"7"}}]})(t)}function qc(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"}},{tag:"polyline",attr:{points:"21 15 16 10 5 21"}}]})(t)}function i_(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 2 7 12 12 22 7 12 2"}},{tag:"polyline",attr:{points:"2 17 12 22 22 17"}},{tag:"polyline",attr:{points:"2 12 12 17 22 12"}}]})(t)}function Ol(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}},{tag:"path",attr:{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}}]})(t)}function Zl(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"8",y1:"6",x2:"21",y2:"6"}},{tag:"line",attr:{x1:"8",y1:"12",x2:"21",y2:"12"}},{tag:"line",attr:{x1:"8",y1:"18",x2:"21",y2:"18"}},{tag:"line",attr:{x1:"3",y1:"6",x2:"3.01",y2:"6"}},{tag:"line",attr:{x1:"3",y1:"12",x2:"3.01",y2:"12"}},{tag:"line",attr:{x1:"3",y1:"18",x2:"3.01",y2:"18"}}]})(t)}function a_(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}},{tag:"polyline",attr:{points:"16 17 21 12 16 7"}},{tag:"line",attr:{x1:"21",y1:"12",x2:"9",y2:"12"}}]})(t)}function rU(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"}}]})(t)}function sU(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"}}]})(t)}function yS(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"1"}},{tag:"circle",attr:{cx:"19",cy:"12",r:"1"}},{tag:"circle",attr:{cx:"5",cy:"12",r:"1"}}]})(t)}function iU(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"16.5",y1:"9.4",x2:"7.5",y2:"4.21"}},{tag:"path",attr:{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}},{tag:"polyline",attr:{points:"3.27 6.96 12 12.01 20.73 6.96"}},{tag:"line",attr:{x1:"12",y1:"22.08",x2:"12",y2:"12"}}]})(t)}function aU(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12 19l7-7 3 3-7 7-3-3z"}},{tag:"path",attr:{d:"M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"}},{tag:"path",attr:{d:"M2 2l7.586 7.586"}},{tag:"circle",attr:{cx:"11",cy:"11",r:"2"}}]})(t)}function Yi(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"12",y1:"5",x2:"12",y2:"19"}},{tag:"line",attr:{x1:"5",y1:"12",x2:"19",y2:"12"}}]})(t)}function vS(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"23 4 23 10 17 10"}},{tag:"polyline",attr:{points:"1 20 1 14 7 14"}},{tag:"path",attr:{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"}}]})(t)}function np(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"1 4 1 10 7 10"}},{tag:"path",attr:{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"}}]})(t)}function oU(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"}},{tag:"polyline",attr:{points:"17 21 17 13 7 13 7 21"}},{tag:"polyline",attr:{points:"7 3 7 8 15 8"}}]})(t)}function lU(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}}]})(t)}function cU(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"18",cy:"5",r:"3"}},{tag:"circle",attr:{cx:"6",cy:"12",r:"3"}},{tag:"circle",attr:{cx:"18",cy:"19",r:"3"}},{tag:"line",attr:{x1:"8.59",y1:"13.51",x2:"15.42",y2:"17.49"}},{tag:"line",attr:{x1:"15.41",y1:"6.51",x2:"8.59",y2:"10.49"}}]})(t)}function uU(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"9",cy:"21",r:"1"}},{tag:"circle",attr:{cx:"20",cy:"21",r:"1"}},{tag:"path",attr:{d:"M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"}}]})(t)}function dU(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}}]})(t)}function hU(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}}]})(t)}function fU(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"5"}},{tag:"line",attr:{x1:"12",y1:"1",x2:"12",y2:"3"}},{tag:"line",attr:{x1:"12",y1:"21",x2:"12",y2:"23"}},{tag:"line",attr:{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}},{tag:"line",attr:{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}},{tag:"line",attr:{x1:"1",y1:"12",x2:"3",y2:"12"}},{tag:"line",attr:{x1:"21",y1:"12",x2:"23",y2:"12"}},{tag:"line",attr:{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}},{tag:"line",attr:{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"}}]})(t)}function o_(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"}},{tag:"line",attr:{x1:"7",y1:"7",x2:"7.01",y2:"7"}}]})(t)}function mx(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"}}]})(t)}function gx(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"}}]})(t)}function qt(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"}},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}}]})(t)}function Nu(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"4 7 4 4 20 4 20 7"}},{tag:"line",attr:{x1:"9",y1:"20",x2:"15",y2:"20"}},{tag:"line",attr:{x1:"12",y1:"4",x2:"12",y2:"20"}}]})(t)}function kc(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"17 8 12 3 7 8"}},{tag:"line",attr:{x1:"12",y1:"3",x2:"12",y2:"15"}}]})(t)}function xS(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"23 7 16 12 23 17 23 7"}},{tag:"rect",attr:{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"}}]})(t)}function wS(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"18",y1:"6",x2:"6",y2:"18"}},{tag:"line",attr:{x1:"6",y1:"6",x2:"18",y2:"18"}}]})(t)}function yx(t){return Ge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"}}]})(t)}const rf=({messages:t})=>!t||t.length===0?null:i.jsx("ul",{className:"text-red-500 text-sm space-y-1","data-testid":"error-list",children:t.map((e,n)=>i.jsxs("li",{className:"flex items-center",children:[i.jsx(YV,{className:"mr-1"}),i.jsx("span",{children:e})]},n))}),pU=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,mU=()=>{const[t,e]=m.useState(1),[n,r]=m.useState("agency"),[s,a]=m.useState(""),[o,l]=m.useState(""),[c,d]=m.useState(""),[h,f]=m.useState(""),[p,k]=m.useState([]),[S,T]=m.useState(!1),C=ti(),j=v=>{if(v.preventDefault(),!s.trim()){k(["Company name is required"]);return}k([]),e(2)},y=async v=>{v.preventDefault();const R=[];if(o.trim()||R.push("Full name is required"),pU.test(c)||R.push("Valid email is required"),h||R.push("Password is required"),R.length){k(R);return}k([]),T(!0);try{const O=await ev(Fe,c,h);let M;n==="agency"&&(M=(await rn(fe(F,"agencies"),{name:s.trim(),themeColor:Dl,logoUrl:""})).id),await Jn(ie(F,"users",O.user.uid),{role:n,audience:n,companyName:s.trim(),fullName:o.trim(),email:c.trim(),...M?{agencyId:M}:{}}),await If(O.user),C("/mfa-settings")}catch(O){const M=((O==null?void 0:O.message)||"").replace("Firebase:","").replace(/\(auth.*\)/,"").trim();k([M])}finally{T(!1)}};return i.jsx("div",{className:"flex justify-center p-4",children:i.jsxs("div",{className:"w-80",children:[t===1&&i.jsxs("form",{onSubmit:j,className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Business Type"}),i.jsxs("select",{value:n,onChange:v=>r(v.target.value),className:"w-full p-2 border rounded",children:[i.jsx("option",{value:"agency",children:"Agency"}),i.jsx("option",{value:"client",children:"Brand"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Company Name"}),i.jsx("input",{type:"text",value:s,onChange:v=>a(v.target.value),className:"w-full p-2 border rounded",required:!0})]}),i.jsx(rf,{messages:p}),i.jsx("button",{type:"submit",className:"w-full btn-primary",children:"Next"})]}),t===2&&i.jsxs("form",{onSubmit:y,className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Full Name"}),i.jsx("input",{type:"text",value:o,onChange:v=>l(v.target.value),className:"w-full p-2 border rounded",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Email"}),i.jsx("input",{type:"email",value:c,onChange:v=>d(v.target.value),className:"w-full p-2 border rounded",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Password"}),i.jsx("input",{type:"password",value:h,onChange:v=>f(v.target.value),className:"w-full p-2 border rounded",required:!0})]}),i.jsx(rf,{messages:p}),i.jsx("button",{type:"submit",className:"w-full btn-primary",disabled:S,children:S?"Creating...":"Create Account"})]})]})})},gU=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,yU=()=>{const[t,e]=m.useState(""),[n,r]=m.useState(""),[s,a]=m.useState(""),[o,l]=m.useState(!1),[c,d]=m.useState([]),h=ti(),f=async p=>{p.preventDefault(),d([]);const k=[];if(t.trim()||k.push("Full name is required"),gU.test(n)||k.push("Valid email is required"),s||k.push("Password is required"),k.length){d(k);return}l(!0);try{const S=await ev(Fe,n,s);await Jn(ie(F,"users",S.user.uid),{role:"designer",audience:"designer",fullName:t.trim(),email:n.trim()}),await If(S.user),h("/mfa-settings")}catch(S){const T=((S==null?void 0:S.message)||"").replace("Firebase:","").replace(/\(auth.*\)/,"").trim();d([T])}finally{l(!1)}};return i.jsx("div",{className:"min-h-screen p-4 flex justify-center",children:i.jsxs("form",{onSubmit:f,className:"space-y-4 w-80",children:[i.jsx("h1",{className:"text-2xl mb-2 text-center",children:"Designer Sign Up"}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Full Name"}),i.jsx("input",{type:"text",value:t,onChange:p=>e(p.target.value),className:"w-full p-2 border rounded",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Email"}),i.jsx("input",{type:"email",value:n,onChange:p=>r(p.target.value),className:"w-full p-2 border rounded",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Password"}),i.jsx("input",{type:"password",value:s,onChange:p=>a(p.target.value),className:"w-full p-2 border rounded",required:!0})]}),i.jsx(rf,{messages:c}),i.jsx("button",{type:"submit",className:"w-full btn-primary",disabled:o,children:o?"Creating...":"Create Account"})]})})},ec=({visible:t=!0,text:e="Loading...",className:n=""})=>t?i.jsx("div",{className:`loading-overlay ${n}`.trim(),"data-testid":"loading-overlay",children:i.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[i.jsx("div",{className:"loading-ring"}),e&&i.jsx("div",{children:e})]})}):null,Fr=t=>{const[e,n]=m.useState(null),[r,s]=m.useState([]),[a,o]=m.useState(null),[l,c]=m.useState(!0);return m.useEffect(()=>{if(!t){n(null),s([]),o(null),c(!1);return}c(!0);const d=ie(F,"users",t),h=ps(d,f=>{if(uo("Role snapshot:",f.data()),f.exists()){const p=f.data();n(p.role||null);const k=Array.isArray(p.brandCodes)?p.brandCodes:[];s(k),o(p.agencyId||null)}else n(null),s([]),o(null);c(!1)},f=>{console.error("Failed to fetch user role",f),n(null),s([]),o(null),c(!1)});return()=>{h()}},[t]),m.useEffect(()=>{if(a||r.length===0)return;let d=!1;return(async()=>{try{const f=Ye(fe(F,"brands"),Je("code","in",r),Rg(1)),p=await Ne(f);!d&&!p.empty&&o(p.docs[0].data().agencyId||null)}catch(f){console.error("Failed to fetch brand agency",f)}})(),()=>{d=!0}},[r,a]),{role:e,brandCodes:r,agencyId:a,loading:l}},ai={logoUrl:"",themeColor:Dl},vU=t=>{if(!t)return null;try{const e=localStorage.getItem(`agencyTheme-${t}`);return e?JSON.parse(e):null}catch{return null}},Ju=t=>{const[e,n]=m.useState(()=>{if(!t)return ai;const o=vU(t),l=o?{...ai,...o}:ai,c=l.themeColor||ai.themeColor;return ho(c),l}),[r,s]=m.useState(!0);return m.useEffect(()=>{(async()=>{if(!t){n(ai),s(!1);return}try{const l=await gn(ie(F,"agencies",t));if(l.exists()){const c=l.data(),d={...ai,...c};n(d);const h=c.themeColor||ai.themeColor;ho(h);try{localStorage.setItem(`agencyTheme-${t}`,JSON.stringify({logoUrl:d.logoUrl,themeColor:h}))}catch{}}else{n(ai);try{localStorage.removeItem(`agencyTheme-${t}`)}catch{}}}catch(l){if(console.error("Failed to fetch agency",l),n(ai),t)try{localStorage.removeItem(`agencyTheme-${t}`)}catch{}}finally{s(!1)}})()},[t]),{agency:e,loading:r,saveAgency:async o=>{t&&(await Jn(ie(F,"agencies",t),o,{merge:!0}),n(l=>{const c={...l,...o},d=c.themeColor||ai.themeColor;ho(d);try{localStorage.setItem(`agencyTheme-${t}`,JSON.stringify({logoUrl:c.logoUrl,themeColor:d}))}catch{}return c}))}}},l_=t=>/^https?:\/\//i.test(t||""),sf=({mp4Url:t,webmUrl:e,src:n,poster:r="",...s})=>{const a=Hc(l_(t)?t:t||n),o=Hc((l_(e),e)),l=Hc(r),c=a||o||n||l;return i.jsxs("video",{controls:!0,poster:l,...s,children:[o&&i.jsx("source",{src:o,type:"video/webm"}),a&&i.jsx("source",{src:a,type:"video/mp4"})]},c)};function af(t){if(!t)return!1;const e=t.split("?")[0].toLowerCase();return/\.(mp4|webm|mov|m4v)$/i.test(e)}const xU={primary:"btn-primary",secondary:"btn-secondary",action:"btn-action",logout:"btn-logout",arrow:"btn-arrow",approve:"btn-approve",reject:"btn-reject",edit:"btn-edit",delete:"btn-delete"},Vt=({as:t="button",variant:e="primary",className:n="",...r})=>{const s=xU[e]||"";return i.jsx(t,{className:`${s} ${n}`.trim(),...r})},wU=({ad:t})=>{const[e,n]=m.useState(!0),r=()=>n(!1);return i.jsxs("div",{className:"relative flex-shrink-0 flex items-center justify-center w-[125px] h-auto",children:[e&&i.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:i.jsx("div",{className:"loading-ring w-6 h-6"})}),af(t.firebaseUrl)?i.jsx(sf,{src:t.firebaseUrl,className:"max-w-[125px] w-full h-auto object-contain",onLoadedData:r}):i.jsx(Pn,{pngUrl:t.firebaseUrl,webpUrl:t.firebaseUrl.replace(/\.png$/,".webp"),alt:t.filename,cacheKey:t.firebaseUrl,className:"max-w-[125px] w-full h-auto object-contain",onLoad:r})]})},c_=({ads:t=[],onClose:e})=>i.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 p-4",children:i.jsxs("div",{className:"bg-white p-4 rounded shadow max-w-6xl w-full max-h-[90vh] flex flex-col dark:bg-[var(--dark-sidebar-bg)] dark:text-[var(--dark-text)]",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("h2",{className:"text-lg font-semibold",children:"Ad Gallery"}),i.jsx(Vt,{onClick:e,variant:"secondary",className:"px-3 py-1",children:"Close"})]}),i.jsx("div",{className:"overflow-auto flex-1",children:i.jsx("div",{className:"flex flex-wrap justify-center gap-x-2 gap-y-4",children:t.map((n,r)=>i.jsx(wU,{ad:n},r))})})]})}),bU=({data:t,view:e="current",onViewChange:n,onClose:r})=>{if(!t)return null;const s=e==="previous"?t.previous.firebaseUrl:t.current.firebaseUrl;return i.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:i.jsxs("div",{className:"bg-white p-4 rounded shadow max-w-md text-center",children:[i.jsxs("div",{className:"mb-2 space-x-2",children:[i.jsxs(Vt,{onClick:()=>n("current"),variant:e==="current"?"primary":"secondary",className:"px-2 py-1",children:["V",t.current.version||1]}),i.jsxs(Vt,{onClick:()=>n("previous"),variant:e==="previous"?"primary":"secondary",className:"px-2 py-1",children:["V",t.previous.version||1," (replaced)"]})]}),af(s)?i.jsx(sf,{src:s,className:"max-w-full max-h-[70vh] mx-auto"}):i.jsx(Pn,{pngUrl:s,webpUrl:s.replace(/\.png$/,".webp"),alt:"Ad version",cacheKey:s,className:"max-w-full max-h-[70vh] mx-auto"}),i.jsx(Vt,{onClick:r,variant:"primary",className:"mt-2 px-3 py-1",children:"Close"})]})})};function vx(t="",e=""){const n=t.split(/\s+/).filter(Boolean),r=e.split(/\s+/).filter(Boolean),s=n.length,a=r.length,o=Array.from({length:s+1},()=>Array(a+1).fill(0));for(let h=1;h<=s;h+=1)for(let f=1;f<=a;f+=1)o[h][f]=n[h-1]===r[f-1]?o[h-1][f-1]+1:Math.max(o[h-1][f],o[h][f-1]);const l=[];let c=s,d=a;for(;c>0&&d>0;)n[c-1]===r[d-1]?(l.unshift({type:"same",text:n[c-1]}),c-=1,d-=1):o[c-1][d]>=o[c][d-1]?(l.unshift({type:"removed",text:n[c-1]}),c-=1):(l.unshift({type:"added",text:r[d-1]}),d-=1);for(;c>0;)l.unshift({type:"removed",text:n[c-1]}),c-=1;for(;d>0;)l.unshift({type:"added",text:r[d-1]}),d-=1;return l}const _U=({comment:t,onCommentChange:e,editCopy:n,onEditCopyChange:r,origCopy:s,canSubmit:a,onCancel:o,onSubmit:l,submitting:c})=>i.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:i.jsxs("div",{className:"bg-white p-4 rounded shadow max-w-sm w-full space-y-2 dark:bg-[var(--dark-sidebar-bg)] dark:text-[var(--dark-text)]",children:[i.jsx("textarea",{value:t,onChange:d=>e(d.target.value),className:"w-full p-2 border rounded",placeholder:"Add comments...",rows:3}),i.jsx("p",{className:"text-sm font-medium",children:"Change copy"}),i.jsx("textarea",{value:n,onChange:d=>r(d.target.value),className:"w-full p-2 border rounded",placeholder:"Edit copy...",rows:3}),s&&n&&n!==s&&i.jsx("p",{className:"text-sm mt-1",children:vx(s,n).map((d,h,f)=>{const p=h<f.length-1?" ":"";return d.type==="same"?d.text+p:d.type==="removed"?i.jsxs("span",{className:"text-red-600 line-through",children:[d.text,p]},h):i.jsxs("span",{className:"text-green-600 italic",children:[d.text,p]},h)})}),i.jsxs("div",{className:"flex justify-end space-x-2",children:[i.jsx(Vt,{onClick:o,variant:"secondary",className:"px-3 py-1",children:"Cancel"}),i.jsx(Vt,{onClick:l,variant:"primary",className:`px-3 py-1 ${a?"":"opacity-50 cursor-not-allowed"}`,disabled:c||!a,children:"Submit"})]})]})}),Ds=({value:t=[],onChange:e,suggestions:n=[],id:r="tag-input",onlySuggestions:s=!1})=>{const[a,o]=m.useState(""),l=h=>{const f=h.trim();f&&(s&&!n.includes(f)||(t.includes(f)||e([...t,f]),o("")))},c=h=>{e(t.filter(f=>f!==h))},d=h=>{(h.key==="Enter"||h.key===","||h.key==="Comma")&&(h.preventDefault(),l(a))};return i.jsxs("div",{className:"flex flex-wrap items-center gap-1",children:[t.map(h=>i.jsxs("span",{className:"tag bg-accent-10 text-accent flex items-center",children:[h,i.jsx(Vt,{type:"button",variant:"delete",onClick:()=>c(h),className:"ml-1 text-xs",children:"×"})]},h)),i.jsx("input",{id:r,list:`${r}-list`,value:a,onChange:h=>o(h.target.value),onKeyDown:d,className:"flex-1 p-1 border rounded"}),n.length>0&&i.jsx("datalist",{id:`${r}-list`,children:n.map(h=>i.jsx("option",{value:h},h))})]})};function sl(t){if(t==null)return"";let e=[];return Array.isArray(t)?e=t:typeof t=="string"&&(e=t.split(/[;,\n]+/).map(n=>n.trim()).filter(Boolean)),e.length===0?"":e[Math.floor(Math.random()*e.length)]}const Tu=({onSave:t=null,initialResults:e=null,showOnlyResults:n=!1,brandCode:r="",hideBrandSelect:s=!1,onCopyClick:a=null,onCopiesChange:o=null})=>{var Xe,Ae;const[l,c]=m.useState([]),[d,h]=m.useState(""),[f,p]=m.useState([]),[k,S]=m.useState(null),[T,C]=m.useState(!1),[j,y]=m.useState([]),[v,R]=m.useState(r),[O,M]=m.useState([]),[b,x]=m.useState(""),[w,E]=m.useState({});m.useEffect(()=>{typeof o=="function"&&o(f)},[f,o]),m.useEffect(()=>{e&&Array.isArray(e)&&p(e.map(J=>({id:J.id||`${Date.now()}-${Math.random().toString(36).slice(2,7)}`,primary:J.primary||"",headline:J.headline||"",description:J.description||"",editing:!1})))},[e]),m.useEffect(()=>{r&&R(r)},[r]),m.useEffect(()=>{(async()=>{try{const K=await Ne(fe(F,"copyRecipeTypes"));c(K.docs.map(z=>({id:z.id,writeInFields:[],...z.data()})))}catch(K){console.error("Failed to fetch copy recipe types",K),c([])}})()},[]),m.useEffect(()=>{(async()=>{try{const K=await Ne(fe(F,"brands"));y(K.docs.map(z=>({id:z.id,...z.data()})))}catch(K){console.error("Failed to fetch brands",K),y([])}})()},[]),m.useEffect(()=>{(async()=>{if(!v){M([]);return}try{const K=Ye(fe(F,"brands"),Je("code","==",v)),z=await Ne(K);if(z.empty)M([]);else{const Y=z.docs[0].data(),V=Array.isArray(Y.products)?Y.products:[];M(V.map((q,ae)=>({id:`p-${ae}`,name:q.name,values:{name:q.name,description:Array.isArray(q.description)?q.description:typeof q.description=="string"?q.description.split(/[;\n]+/).map(Ee=>Ee.trim()).filter(Boolean):[],benefits:Array.isArray(q.benefits)?q.benefits:typeof q.benefits=="string"?q.benefits.split(/[;\n]+/).map(Ee=>Ee.trim()).filter(Boolean):[]}})))}}catch(K){console.error("Failed to load products",K),M([])}})()},[v]);const N=(J,K)=>{var Ee,L,B;if(!J)return"";let z=J;const Y=j.find(G=>G.code===v)||{};z=z.replace(/{{brand\.name}}/g,Y.name||""),z=z.replace(/{{brand\.toneOfVoice}}/g,Y.toneOfVoice||""),z=z.replace(/{{brand\.offering}}/g,Y.offering||"");const V=O.find(G=>G.id===b)||{};z=z.replace(/{{product\.name}}/g,((Ee=V.values)==null?void 0:Ee.name)||"");const q=sl((L=V.values)==null?void 0:L.description),ae=sl((B=V.values)==null?void 0:B.benefits);return z=z.replace(/{{product\.description}}/g,q),z=z.replace(/{{product\.benefits}}/g,ae),((K==null?void 0:K.writeInFields)||[]).forEach(G=>{const ne=w[G.key]||"",de=new RegExp(`{{${G.key}}}`,"g");z=z.replace(de,Array.isArray(ne)?ne.join(", "):ne)}),z},D=async J=>{var K,z,Y,V;if(!J)return"";try{const q=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer undefined"},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"user",content:J}],temperature:.7})}),ae=await q.json();return q.ok?((V=(Y=(z=(K=ae.choices)==null?void 0:K[0])==null?void 0:z.message)==null?void 0:Y.content)==null?void 0:V.trim())||"":(console.error("OpenAI API error",ae),"")}catch(q){return console.error("OpenAI request failed",q),""}},I=async J=>{J.preventDefault();const K=l.find(ae=>ae.id===d);if(!K)return;C(!0);const[z,Y,V]=await Promise.all([D(N(K.primaryPrompt,K)),D(N(K.headlinePrompt,K)),D(N(K.descriptionPrompt,K))]),q=`${Date.now()}-${Math.random().toString(36).slice(2,7)}`;p(ae=>[...ae,{id:q,primary:z,headline:Y,description:V,editing:!1}]),C(!1)},pe=l.find(J=>J.id===d);return i.jsxs("div",{className:"space-y-4",children:[!n&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:"Recipe Type"}),i.jsxs("select",{className:"p-2 border rounded",value:d,onChange:J=>h(J.target.value),children:[i.jsx("option",{value:"",children:"Select type..."}),l.map(J=>i.jsx("option",{value:J.id,children:J.name},J.id))]})]}),s?i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:"Brand"}),i.jsx("div",{className:"p-2 border rounded bg-gray-100 dark:bg-gray-800",children:((Xe=j.find(J=>J.code===v))==null?void 0:Xe.name)||v||"-"})]}):i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:"Brand"}),i.jsxs("select",{className:"p-2 border rounded",value:v,onChange:J=>{R(J.target.value),x("")},children:[i.jsx("option",{value:"",children:"Select brand..."}),j.map(J=>i.jsxs("option",{value:J.code,children:[J.code," ",J.name?`- ${J.name}`:""]},J.id))]})]}),O.length>0&&i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:"Product"}),i.jsxs("select",{className:"p-2 border rounded",value:b,onChange:J=>x(J.target.value),children:[i.jsx("option",{value:"",children:"Evergreen"}),O.map(J=>i.jsx("option",{value:J.id,children:J.name},J.id))]})]}),i.jsxs("form",{onSubmit:I,className:"space-y-2",children:[(Ae=pe==null?void 0:pe.writeInFields)==null?void 0:Ae.map(J=>i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:J.label}),J.inputType==="textarea"?i.jsx("textarea",{className:"w-full p-2 border rounded",value:w[J.key]||"",onChange:K=>E({...w,[J.key]:K.target.value})}):J.inputType==="list"?i.jsx(Ds,{id:`list-${J.key}`,value:w[J.key]||[],onChange:K=>E({...w,[J.key]:K})}):i.jsx("input",{className:"w-full p-2 border rounded",type:J.inputType,value:w[J.key]||"",onChange:K=>E({...w,[J.key]:K.target.value})})]},J.key)),i.jsx("button",{type:"submit",className:"btn-primary",disabled:!d||T,children:T?"Generating...":"Generate"})]})]}),n&&a&&i.jsx("div",{children:i.jsx("button",{type:"button",className:"btn-secondary px-2 py-0.5 flex items-center gap-1",onClick:a,children:"Copy"})}),i.jsx("div",{className:"flex flex-wrap gap-4",children:f.map(J=>i.jsxs("div",{className:"rounded-lg border border-gray-300 dark:border-gray-600 shadow p-3 relative max-w-[350px] w-full dark:bg-[var(--dark-sidebar-hover)]",children:[i.jsx("button",{type:"button",onClick:()=>p(K=>K.map(z=>z.id===J.id?{...z,editing:!z.editing}:z)),"aria-label":J.editing?"Save":"Edit",className:"absolute top-1 right-7 text-sm",children:J.editing?i.jsx(mS,{}):i.jsx(Ar,{})}),i.jsx("button",{type:"button",onClick:()=>S(J.id),"aria-label":"Delete",className:"absolute top-1 right-1 text-sm",children:i.jsx(qt,{})}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:"Primary Text"}),J.editing?i.jsx("textarea",{className:"w-full p-2 border rounded",rows:"3",value:J.primary,onChange:K=>p(z=>z.map(Y=>Y.id===J.id?{...Y,primary:K.target.value}:Y))}):i.jsx("p",{className:"p-2 whitespace-pre-wrap bg-gray-50 rounded dark:bg-[var(--dark-sidebar-bg)]",children:J.primary})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:"Headline"}),J.editing?i.jsx("textarea",{className:"w-full p-2 border rounded",rows:"2",value:J.headline,onChange:K=>p(z=>z.map(Y=>Y.id===J.id?{...Y,headline:K.target.value}:Y))}):i.jsx("p",{className:"p-2 whitespace-pre-wrap bg-gray-50 rounded dark:bg-[var(--dark-sidebar-bg)]",children:J.headline})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:"Description"}),J.editing?i.jsx("textarea",{className:"w-full p-2 border rounded",rows:"2",value:J.description,onChange:K=>p(z=>z.map(Y=>Y.id===J.id?{...Y,description:K.target.value}:Y))}):i.jsx("p",{className:"p-2 whitespace-pre-wrap bg-gray-50 rounded dark:bg-[var(--dark-sidebar-bg)]",children:J.description})]})]},J.id))}),!n&&t&&f.length>0&&i.jsx("div",{className:"mt-4 text-right",children:i.jsx("button",{type:"button",className:"btn-primary",onClick:()=>t(f),children:"Save Copy"})}),k&&i.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:i.jsxs("div",{className:"bg-white p-4 rounded shadow max-w-sm w-full dark:bg-[var(--dark-sidebar-bg)] dark:text-[var(--dark-text)]",children:[i.jsx("p",{className:"mb-4",children:"Delete this copy?"}),i.jsxs("div",{className:"flex justify-end gap-2",children:[i.jsx("button",{onClick:()=>S(null),className:"btn-secondary px-3 py-1",children:"Cancel"}),i.jsx("button",{onClick:()=>{p(J=>J.filter(K=>K.id!==k)),S(null)},className:"btn-delete px-3 py-1",children:"Delete"})]})]})})]})},jU=new Set(["new","pending","briefed","ready","approved","rejected","edit_requested","archived","draft","reviewed","in_review","review_pending","mixed"]),Ca=({status:t,className:e=""})=>{if(!t)return null;const n=String(t).replace(/\s+/g,"_").toLowerCase(),r=jU.has(n)?`status-${n}`:"status-default";return i.jsx("span",{className:`status-badge ${r} ${e}`.trim(),children:t})},EU=({entries:t=[],className:e="",onVersionClick:n,origCopy:r=""})=>{const s=!Array.isArray(t)&&t&&typeof t=="object",a=s?Object.keys(t).sort((h,f)=>parseInt(h,10)-parseInt(f,10)):[],o=s?t:{1:Array.isArray(t)?t:[]},l=s&&a.length>1,c=a.length?a.every(h=>(o[h]||[]).length===0):(o[1]||[]).length===0,d=h=>i.jsx("ul",{className:"space-y-2",children:h.slice().reverse().map(f=>i.jsxs("li",{className:"border-b pb-1 last:border-none text-sm",children:[i.jsxs("div",{className:"flex justify-between items-baseline",children:[i.jsx("span",{className:"font-medium",children:f.updatedBy}),f.updatedAt&&i.jsx("span",{className:"text-xs text-gray-500",children:f.updatedAt.toDate?f.updatedAt.toDate().toLocaleString():new Date(f.updatedAt).toLocaleString()})]}),i.jsx(Ca,{status:f.status,className:"mt-1"}),f.comment&&i.jsx("p",{className:"italic",children:f.comment}),f.copyEdit&&i.jsxs("p",{className:"italic",children:["Copy edit:"," ",(()=>{if(!r)return f.copyEdit;const p=vx(r,f.copyEdit);return p.map((k,S)=>{const T=S<p.length-1?" ":"";return k.type==="same"?k.text+T:k.type==="removed"?i.jsxs("span",{className:"text-red-600 line-through",children:[k.text,T]},S):i.jsxs("span",{className:"text-green-600 italic",children:[k.text,T]},S)})})()]})]},f.id))});return i.jsxs("aside",{className:`w-full md:w-60 max-h-[70vh] overflow-y-auto ${e}`,children:[i.jsx("h3",{className:"font-semibold mb-2",children:"Feedback"}),c?i.jsx("p",{className:"text-sm text-gray-500",children:"No feedback yet."}):l?a.map(h=>i.jsxs("div",{className:"mb-4 last:mb-0",children:[i.jsxs("h4",{className:"font-semibold mb-1 cursor-pointer",onClick:()=>n&&n(parseInt(h,10)),children:["V",h," History"]}),d(o[h]||[])]},h)):i.jsxs("div",{children:[i.jsxs("h4",{className:"font-semibold mb-1 cursor-pointer",onClick:()=>n&&n(parseInt(a[0]||1,10)),children:["V",a[0]||1," History"]}),d(o[a[0]||1]||[])]})]})};function Ft(t){if(!t)return{};const n=t.replace(/\.[^/.]+$/,"").split("_"),r=n[0]||"",s=n[1]||"",a=n[2]||"";let o="",l;if(n.length>=5){o=n[3]||"";const c=/^V(\d+)/i.exec(n[4]);c&&(l=parseInt(c[1],10))}else if(n.length===4){const c=/^V(\d+)/i.exec(n[3]);c?l=parseInt(c[1],10):o=n[3]||""}return{brandCode:r,adGroupCode:s,recipeCode:a,aspectRatio:o,version:l}}function kU(t,e){const n=m.useRef(!1),r=m.useRef(e);m.useEffect(()=>(n.current=!0,()=>{}),[]),m.useEffect(()=>{if(!n.current)return;const s={};Object.keys(e).forEach(a=>{r.current[a]!==e[a]&&(s[a]={previous:r.current[a],current:e[a]})}),Object.keys(s).length>0,r.current=e})}const ln=t=>t.version||Ft(t.filename||"").version||1,Ni=(t="")=>t.replace(/_V\d+/i,"").replace(/\.[^/.]+$/,""),om=typeof navigator<"u"&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent),u_=3,CU=m.forwardRef(({user:t,userRole:e=null,brandCodes:n=[],groupId:r=null,reviewerName:s="",agencyId:a=null},o)=>{var ki;const[l,c]=m.useState([]),[d,h]=m.useState([]),[f,p]=m.useState(0),[k,S]=m.useState(""),[T,C]=m.useState(!1),[j,y]=m.useState(""),[v,R]=m.useState(""),[O,M]=m.useState(""),[b,x]=m.useState(!1),[w,E]=m.useState(0),[N,D]=m.useState(!1),[I,pe]=m.useState(!1),[Xe,Ae]=m.useState(!1),[J,K]=m.useState(!0),[z,Y]=m.useState(!1),[V,q]=m.useState(!1),[ae,Ee]=m.useState(!1),[L,B]=m.useState({}),[G,ne]=m.useState([]),[de,Qe]=m.useState(null),[nt,te]=m.useState("current"),[je,Le]=m.useState(0),[mt,Ct]=m.useState(!1),[ze,it]=m.useState(!1),[jt,Lt]=m.useState(!1),[Xt,Cn]=m.useState([]),[xr,zn]=m.useState(!1),[Vr,tn]=m.useState([]),[xn,as]=m.useState(!1),[tr,Ur]=m.useState(!1),[ri,St]=m.useState(null),[ji,qe]=m.useState([]),[wn,Gn]=m.useState(!1),[Dn,Hn]=m.useState(null),[Ei,Cs]=m.useState(!1),[nr,os]=m.useState(0),[ls,Br]=m.useState(!1),[$,Z]=m.useState(!1),X=m.useRef([]),oe=m.useRef(0),ye=m.useRef(0),Re=m.useRef(0),me=m.useRef(0),We=m.useRef(!1),Rt=m.useRef(null),Pt=m.useRef(null),[wr,Ln]=m.useState(null),[rr,Qr]=m.useState(null),[sr,Yr]=m.useState({}),[xt,qn]=m.useState({}),On=m.useRef(f),Jr=m.useRef(d.length),{agency:bn}=Ju(a);m.useEffect(()=>{On.current=f},[f]),m.useEffect(()=>{Jr.current=d.length},[d.length]);const Ss=m.useCallback(()=>{const W=new Set;return l.forEach(he=>{if(he.status==="approved"){const le=Ft(he.filename||""),Me=he.recipeCode||le.recipeCode||"unknown";W.add(Me)}}),W.size},[l]);m.useImperativeHandle(o,()=>({openGallery:()=>Lt(!0),openCopy:()=>zn(!0)}));const Be=m.useMemo(()=>k.trim().length>0||j.trim()&&j.trim()!==v.trim(),[k,j,v]),Ue=m.useMemo(()=>{const W=he=>he.map(le=>({id:le.id||"",primary:le.primary||"",headline:le.headline||"",description:le.description||""}));return JSON.stringify(W(Xt))!==JSON.stringify(W(Vr))},[Xt,Vr]);kU("Review",{groupId:r,agencyId:a,brandCodesLength:n.length,currentIndex:f,reviewAdsLength:d.length,animating:Dn,loading:J}),m.useEffect(()=>()=>{if(a&&["admin","designer"].includes(e)){const W=localStorage.getItem("accentColor")||Dl;ho(W)}},[a,e]),ti();const[st,Ve]=m.useState(!1),[Ze,Et]=m.useState(!1),[Dt,an]=m.useState(typeof window<"u"?window.innerWidth<=640:!1),fn=m.useCallback(W=>{const he=["","9x16","3x5","1x1","4x5","Pinterest","Snapchat"],le=ot=>ot.recipeCode||Ft(ot.filename||"").recipeCode||"unknown",Me=ot=>ot.aspectRatio||Ft(ot.filename||"").aspectRatio||"",ke={};W.forEach(ot=>{const Gt=ot.parentAdId||Ni(ot.filename);(!ke[Gt]||ln(ke[Gt])<ln(ot))&&(ke[Gt]=ot)});const De={};Object.values(ke).forEach(ot=>{const Gt=le(ot);De[Gt]||(De[Gt]=[]),De[Gt].push(ot)});const at=Object.values(De).map(ot=>{ot.sort((Gt,gt)=>ln(gt)-ln(Gt));for(const Gt of he){const gt=ot.find(Ns=>Me(Ns)===Gt);if(gt)return gt}return ot[0]});return at.sort((ot,Gt)=>{const gt=le(ot),Ns=le(Gt);return gt.localeCompare(Ns)}),at},[]),ir=m.useCallback(W=>{const he={};return W.forEach(le=>{const Me=le.parentAdId||Ni(le.filename);(!he[Me]||ln(he[Me])<ln(le))&&(he[Me]=le)}),Object.values(he)},[]);m.useEffect(()=>{const W=()=>{an(window.innerWidth<=640)};return window.addEventListener("resize",W),()=>window.removeEventListener("resize",W)},[]),m.useEffect(()=>{Z(!0);const W=setTimeout(()=>Z(!1),200);return()=>clearTimeout(W)},[]),m.useEffect(()=>{if(!r)return;const W=ps(ie(F,"adGroups",r),he=>{if(!he.exists())return;const le=he.data();Ln(le.status||"pending")});return()=>W()},[r]),m.useEffect(()=>{if(!r)return;const W=ps(fe(F,"adGroups",r,"copyCards"),he=>{const le=he.docs.map(Me=>({id:Me.id,...Me.data()}));Cn(le)});return()=>W()},[r]),m.useEffect(()=>{xr&&tn(Xt)},[xr]),m.useEffect(()=>{!tr||!r||d.length===0||rr==="reviewed"||He(ie(F,"adGroups",r),{status:"in review",reviewProgress:f}).then(()=>Ln("in review")).catch(W=>console.error("Failed to update group status",W))},[tr,r,d.length,f,rr]),m.useEffect(()=>{!tr||!r||rr==="reviewed"||He(ie(F,"adGroups",r),{reviewProgress:f}).catch(W=>console.error("Failed to save progress",W))},[f,tr,r,rr]);const _n=m.useCallback(()=>{if(!r)return;const W=On.current,he=Jr.current;let le,Me;rr==="reviewed"?(le="reviewed",Me=null):(le=W>=he?"reviewed":"review pending",Me=W>=he?null:W),He(ie(F,"adGroups",r),{status:le,reviewProgress:Me}).catch(()=>{})},[r,rr]);m.useEffect(()=>{r&&f>=d.length&&He(ie(F,"adGroups",r),{status:"reviewed",reviewProgress:null}).catch(W=>console.error("Failed to update status",W))},[f,d.length,r]),m.useEffect(()=>{if(f>=d.length){const W=Ss();St(W),Ur(!1)}},[f,d.length,Ss]),m.useEffect(()=>{if(tr)return window.addEventListener("beforeunload",_n),()=>{window.removeEventListener("beforeunload",_n),_n()}},[_n,tr]),m.useEffect(()=>{if(!tr)return;const W=3e5;let he=setTimeout(()=>{as(!0),Ur(!1),_n()},W);const le=()=>{clearTimeout(he),he=setTimeout(()=>{as(!0),Ur(!1),_n()},W)},Me=["mousemove","mousedown","keydown","touchstart"];return Me.forEach(ke=>window.addEventListener(ke,le)),()=>{clearTimeout(he),Me.forEach(ke=>window.removeEventListener(ke,le))}},[tr,_n]);const ar=m.useMemo(()=>{const W={};l.forEach(le=>{const Me=Ft(le.filename||""),ke=le.recipeCode||Me.recipeCode||"unknown",De=le.aspectRatio||Me.aspectRatio||"",at={...le,recipeCode:ke,aspectRatio:De};W[ke]||(W[ke]=[]),W[ke].push(at)});const he={"":0,"9x16":1,"3x5":2,"1x1":3};return Object.entries(W).map(([le,Me])=>(Me.sort((ke,De)=>(he[ke.aspectRatio]??99)-(he[De.aspectRatio]??99)),{recipeCode:le,assets:Me}))},[l]);m.useEffect(()=>{Z(!0);const W=setTimeout(()=>Z(!1),200);return()=>clearTimeout(W)},[f]),m.useEffect(()=>{it(!1)},[f]),m.useEffect(()=>{const W=async()=>{var he;try{let le=[],Me=0,ke="pending";if(r){const et=await gn(ie(F,"adGroups",r));if(et.exists()){const Wt=et.data();ke=Wt.status||"pending",typeof Wt.reviewProgress=="number"&&(Me=Wt.reviewProgress),le=(await Ne(fe(F,"adGroups",r,"assets"))).docs.map(dr=>{const br=dr.data(),Nn=Ft(br.filename||"");return{...br,version:br.version??Nn.version??1,assetId:dr.id,adGroupId:r,groupName:et.data().name,firebaseUrl:br.firebaseUrl,...et.data().brandCode?{brandCode:et.data().brandCode}:{}}})}Qr(ke)}else{const et=Ye(g4(F,"assets"),Je("brandCode","in",n),Je("status","==","ready"),Je("isResolved","==",!1)),Wt=await Ne(et),Mn={};le=await Promise.all(Wt.docs.map(async dr=>{const br=dr.data(),Nn=br.adGroupId||dr.ref.parent.parent.id;if(!Mn[Nn]){const Oo=await gn(ie(F,"adGroups",Nn));Mn[Nn]=Oo.exists()?Oo.data().name:""}const Lo=Ft(br.filename||"");return{...br,version:br.version??Lo.version??1,assetId:dr.id,adGroupId:Nn,groupName:Mn[Nn],firebaseUrl:br.firebaseUrl}}))}const De={"":0,"9x16":1,"3x5":2,"1x1":3};le.sort((et,Wt)=>{const Mn=Ft(et.filename||""),dr=Ft(Wt.filename||""),br=et.recipeCode||Mn.recipeCode||"",Nn=Wt.recipeCode||dr.recipeCode||"";if(br<Nn)return-1;if(br>Nn)return 1;const Lo=et.aspectRatio||Mn.aspectRatio||"",Oo=Wt.aspectRatio||dr.aspectRatio||"";return(De[Lo]??99)-(De[Oo]??99)});const at={};le.forEach(et=>{const Wt=et.parentAdId||Ni(et.filename);(!at[Wt]||ln(at[Wt])<ln(et))&&(at[Wt]=et)});const ot=Object.values(at),Gt=ot.some(et=>et.status==="pending"),gt=ot.filter(et=>et.status!=="pending"),Ns=le.filter(et=>et.status!=="pending");ne(Ns),c(gt),Ve(Gt);const qa=gt.filter(et=>et.status==="ready"),Ts=qa.filter(et=>ln(et)>1);le=qa.length>0?qa:gt;const Ci=r?`lastViewed-${r}`:null,cs=Ci?localStorage.getItem(Ci):null,us=cs?new Date(cs):(he=t==null?void 0:t.metadata)!=null&&he.lastSignInTime?new Date(t.metadata.lastSignInTime):null;let Si=le,Vs=[];if(us&&(Vs=le.filter(et=>{var Mn;const Wt=(Mn=et.lastUpdatedAt)!=null&&Mn.toDate?et.lastUpdatedAt.toDate():et.lastUpdatedAt instanceof Date?et.lastUpdatedAt:null;return Wt&&Wt>us}),Vs.length>0&&(Si=Vs)),Vs.length===0){const et={};gt.forEach(Wt=>{let Mn;if(Wt.status==="approved"?Mn="approve":Wt.status==="rejected"?Mn="reject":Wt.status==="edit_requested"&&(Mn="edit"),Mn){const dr=Wt.adUrl||Wt.firebaseUrl;et[dr]={adUrl:dr,response:Mn}}}),B(et)}const Ht=fn(gt),Ji=fn(Ts);qe(Ht);const ur=Ji.length>0?Ji:Ht;Gn(Ji.length>0),h(ur),p(ke==="reviewed"?ur.length:Ji.length>0?0:Me<ur.length?Me:0),Et(ur.length===0&&gt.length===0&&Gt)}catch(le){console.error("Failed to load ads",le)}finally{K(!1)}};if(!(t!=null&&t.uid)||!r&&n.length===0){c([]),h([]),K(!1);return}W()},[t,n,r]),m.useEffect(()=>{if(d.length===0){Y(!0),Rt.current=null;return}const W=d[0],he=typeof W=="object"?W.adUrl||W.firebaseUrl:W;if(!he){Y(!0),Rt.current=null;return}if(Rt.current===he)return;Rt.current=he,Y(!1);const le=new Image;le.onload=()=>Y(!0),le.onerror=()=>Y(!0),le.src=he},[d]),m.useEffect(()=>{if(!a){q(!0),Pt.current=null;return}const W=bn.logoUrl||Gs;if(Pt.current===W)return;Pt.current=W,q(!1);const he=new Image;he.onload=()=>q(!0),he.onerror=()=>q(!0),he.src=W},[a,bn.logoUrl]);const Ce=d[f],wt=m.useMemo(()=>{if(!Ce)return[];const W=Ce.parentAdId||Ni(Ce.filename),he=G.filter(Me=>Ce.parentAdId?Me.parentAdId===W||Me.assetId===W:Ni(Me.filename)===W),le=[Ce,...he.filter(Me=>Me.assetId!==Ce.assetId)];return le.sort((Me,ke)=>ln(ke)-ln(Me)),le},[Ce,G]),Se=wt[je]||Ce;m.useEffect(()=>{Le(0)},[Ce==null?void 0:Ce.assetId]);const Qt=Se&&typeof Se=="object"?Se.adUrl||Se.firebaseUrl:Se;Ce&&typeof Ce=="object"&&Ce.brandCode,Ce&&typeof Ce=="object"&&Ce.groupName;const on=m.useMemo(()=>{if(!Ce)return null;const{status:W}=Ce;return W==="approved"?"approve":W==="rejected"?"reject":W==="edit_requested"?"edit":null},[Ce]),Ot=((ki=L[Qt])==null?void 0:ki.response)??on,Wn=!!Ot,or=m.useMemo(()=>{const W=Se?ln(Se):1;return{[W]:sr[W]||[]}},[Se==null?void 0:Se.assetId,Se==null?void 0:Se.filename,Se==null?void 0:Se.version,sr]),Bt=d.length>0?(f+(Dn?1:0))/d.length*100:0,A=W=>{if(!Ce)return;const he=Ce.parentAdId||Ni(Ce.filename),le=G.filter(ke=>Ce.parentAdId?ke.parentAdId===he||ke.assetId===he:Ni(ke.filename)===he);let Me;W?Me=le.find(ke=>ln(ke)===W):Me=le.filter(ke=>ln(ke)<ln(Ce)).sort((ke,De)=>ln(De)-ln(ke))[0],Me&&(Qe({current:Ce,previous:Me}),te(W&&W!==ln(Ce)?"previous":"current"))},H=()=>Qe(null);m.useEffect(()=>{if(Yr({}),!(Se!=null&&Se.adGroupId)||!(Se!=null&&Se.assetId))return;const W=ie(F,"adGroups",Se.adGroupId,"assets",Se.assetId),he=ps(W,at=>{if(!at.exists())return;const ot={assetId:at.id,...at.data()};c(Gt=>Gt.map(gt=>gt.assetId===ot.assetId?{...gt,...ot}:gt)),h(Gt=>Gt.map(gt=>gt.assetId===ot.assetId?{...gt,...ot}:gt))}),le=Ce.parentAdId||Ni(Ce.filename),Me=G.filter(at=>Ce.parentAdId?at.assetId===le||at.parentAdId===le:Ni(at.filename)===le),ke={};[...Me,Se].forEach(at=>{ke[at.assetId]=at});const De=Object.values(ke).map(at=>{const ot=Ye(fe(ie(F,"adGroups",at.adGroupId,"assets",at.assetId),"history"),lo("updatedAt","asc"));return ps(ot,Gt=>{Yr(gt=>({...gt,[ln(at)]:Gt.docs.map(Ns=>({id:Ns.id,...Ns.data()}))}))})});return()=>{he(),De.forEach(at=>at()),Yr({})}},[Se==null?void 0:Se.adGroupId,Se==null?void 0:Se.assetId,G]),m.useEffect(()=>{const W=(Se==null?void 0:Se.recipeCode)||Ft((Se==null?void 0:Se.filename)||"").recipeCode||"";if(!(Se!=null&&Se.adGroupId)||!W||xt[W])return;let he=!1;return gn(ie(F,"adGroups",Se.adGroupId,"recipes",W)).then(le=>{if(he)return;const Me=le.exists()&&le.data().copy||"";qn(ke=>({...ke,[W]:Me}))}).catch(le=>console.error("Failed to load recipe copy",le)),()=>{he=!0}},[Se==null?void 0:Se.adGroupId,Se==null?void 0:Se.recipeCode,Se==null?void 0:Se.filename]);const U=W=>{if(ze||T||I||N||W.target.closest("video"))return;const he=W.touches[0];oe.current=he.clientX,ye.current=he.clientY,Re.current=he.clientX,me.current=he.clientY,Br(!0),os(0)},re=W=>{if(!ls)return;const he=W.touches[0],le=he.clientX-oe.current,Me=he.clientY-ye.current;Math.abs(le)>Math.abs(Me)&&W.preventDefault(),Re.current=he.clientX,me.current=he.clientY,os(le)},se=()=>{if(!ls)return;const W=Re.current-oe.current,he=Math.abs(me.current-ye.current);Math.abs(W)>100&&he<100&&(W>0?cr("approve"):cr("reject")),os(0),Br(!1)},ve=W=>{if(Dn&&W.target===W.currentTarget){if(We.current||(p(he=>{const le=he+1;return console.log("Index updated:",le),le}),We.current=!0),Dn==="reject"){const he=w+1;E(he),he===5&&D(!0)}Hn(null)}},we=async()=>{const W=d.slice(f),he=[];W.forEach(le=>{const Me=Ft(le.filename||""),ke=le.recipeCode||Me.recipeCode||"unknown",De=ar.find(ot=>ot.recipeCode===ke);(De?De.assets:[le]).forEach(ot=>he.push(He(ie(F,"adGroups",ot.adGroupId,"assets",ot.assetId),{status:"pending",isResolved:!1})))});try{await Promise.all(he)}catch(le){console.error("Failed to mark remaining ads pending",le)}finally{D(!1),pe(!1),Ae(!1),p(d.length)}},xe=Ce?Ft(Ce.filename||""):{},lt=(Ce==null?void 0:Ce.recipeCode)||xe.recipeCode,Tt=ar.find(W=>W.recipeCode===lt),ft=Tt?Tt.assets.filter(W=>(W.adUrl||W.firebaseUrl)!==Qt):[],zt=((Ce==null?void 0:Ce.aspectRatio)||xe.aspectRatio||"9x16").replace("x","/");m.useEffect(()=>{X.current=X.current.filter(W=>W.index>f);for(let W=1;W<=u_;W+=1){const he=f+W,le=d[he];if(!le)break;if(X.current.find(De=>De.index===he))continue;const Me=le.adUrl||le.firebaseUrl,ke=new Image;ke.src=Me,X.current.push({index:he,img:ke})}X.current=X.current.slice(-u_)},[f,d,Dt]);const Sn=async()=>{if(C(!0),!(Ce!=null&&Ce.adGroupId))return;const W=lt;if(W)try{const he=await gn(ie(F,"adGroups",Ce.adGroupId,"recipes",W)),le=he.exists()&&he.data().copy||"";y(le),R(le),h(Me=>Me.map((ke,De)=>De===f?{...ke,originalCopy:le}:ke)),c(Me=>Me.map(ke=>ke.assetId===Ce.assetId?{...ke,originalCopy:le}:ke))}catch(he){console.error("Failed to load copy",he),y(""),R("")}},lr=async W=>{if(!(!r||!Array.isArray(W)))try{const he=Xt.map(ke=>ke.id),le=W.map(ke=>ke.id).filter(Boolean),Me=he.filter(ke=>!le.includes(ke));await Promise.all(Me.map(ke=>mn(ie(F,"adGroups",r,"copyCards",ke)))),await Promise.all(W.map(ke=>{const De={primary:ke.primary||"",headline:ke.headline||"",description:ke.description||""};return ke.id?Jn(ie(F,"adGroups",r,"copyCards",ke.id),De,{merge:!0}):rn(fe(F,"adGroups",r,"copyCards"),De)})),zn(!1)}catch(he){console.error("Failed to save copy cards",he)}},cr=async W=>{if(!Ce)return;We.current=!1,Hn(W),Ee(!0);const he=(Tt==null?void 0:Tt.assets)||[Ce],le=[],Me={},ke=W==="approve"?"approved":W==="reject"?"rejected":"edit_requested";try{for(const De of he){const at=De.adUrl||De.firebaseUrl,ot=W==="edit"&&j.trim()!==v.trim(),Gt={adUrl:at,response:W,comment:W==="edit"?k:"",copyEdit:ot?j:"",pass:L[at]?"revisit":"initial",...De.brandCode?{brandCode:De.brandCode}:{},...De.groupName?{groupName:De.groupName}:{},...s?{reviewerName:s}:{},...t!=null&&t.email?{userEmail:t.email}:{},...t!=null&&t.uid?{userId:t.uid}:{},...e?{userRole:e}:{}};if(De.adGroupId&&le.push(rn(fe(F,"adGroups",De.adGroupId,"responses"),{...Gt,timestamp:Mt()})),De.assetId&&De.adGroupId){const gt=ie(F,"adGroups",De.adGroupId,"assets",De.assetId),Ns={status:ke,comment:W==="edit"?k:"",copyEdit:ot?j:"",lastUpdatedBy:t.uid,lastUpdatedAt:Mt(),...W==="approve"?{isResolved:!0}:{},...W==="edit"?{isResolved:!1}:{}};le.push(He(gt,Ns));const qa=s||t.displayName||t.uid||"unknown";le.push(rn(fe(F,"adGroups",De.adGroupId,"assets",De.assetId,"history"),{status:ke,updatedBy:qa,updatedAt:Mt(),...W==="edit"&&k?{comment:k}:{},...W==="edit"&&ot?{copyEdit:j}:{}}).catch(ur=>{if((ur==null?void 0:ur.code)==="already-exists")console.log("History entry already exists, skipping");else throw ur})),c(ur=>ur.map(et=>et.assetId===De.assetId?{...et,status:ke,comment:W==="edit"?k:"",copyEdit:ot?j:"",...W==="approve"?{isResolved:!0}:W==="edit"?{isResolved:!1}:{}}:et)),h(ur=>ur.map(et=>et.assetId===De.assetId?{...et,status:ke,comment:W==="edit"?k:"",copyEdit:ot?j:"",...W==="approve"?{isResolved:!0}:W==="edit"?{isResolved:!1}:{}}:et));const Ts=De.status,si=ke;let Ci=0,cs=0,us=0,Si=0;Ts==="ready"&&(Ci+=1),Ts!==si&&(Ts==="approved"&&(cs-=1),Ts==="rejected"&&(us-=1),Ts==="edit_requested"&&(Si-=1),si==="approved"&&(cs+=1),si==="rejected"&&(us+=1),si==="edit_requested"&&(Si+=1));const Vs=ie(F,"adGroups",De.adGroupId),Ht=await gn(Vs),Ji={...Ci?{reviewedCount:Td(Ci)}:{},...cs?{approvedCount:Td(cs)}:{},...us?{rejectedCount:Td(us)}:{},...Si?{editCount:Td(Si)}:{},lastUpdated:Mt(),...Ht.exists()&&!Ht.data().thumbnailUrl?{thumbnailUrl:De.firebaseUrl}:{}};if(le.push(He(Vs,Ji)),W==="approve"&&De.parentAdId){const ur=Ye(fe(F,"adGroups",De.adGroupId,"assets"),Je("parentAdId","==",De.parentAdId)),et=await Ne(ur);le.push(Promise.all(et.docs.map(Wt=>He(ie(F,"adGroups",De.adGroupId,"assets",Wt.id),{isResolved:!0})))),le.push(He(ie(F,"adGroups",De.adGroupId,"assets",De.parentAdId),{isResolved:!0}))}}Me[at]=Gt,B(gt=>({...gt,[at]:Gt}))}if(he.length>0){const De=ie(F,"recipes",lt);le.push(Jn(De,{history:Pg({timestamp:Date.now(),status:ke,user:s||(t==null?void 0:t.displayName)||(t==null?void 0:t.uid)||"unknown",...W==="edit"&&k?{editComment:k}:{}})},{merge:!0}))}await Promise.all(le),r&&localStorage.setItem(`lastViewed-${r}`,new Date().toISOString())}catch(De){console.error("Failed to submit response",De)}finally{S(""),y(""),R(""),C(!1),Ee(!1);const De=f+1;if(We.current||(p(De),We.current=!0),Hn(null),De>=d.length){const at=Ss();St(at),Ur(!1)}}},Do=async()=>{if(!(Ce!=null&&Ce.adGroupId)){pe(!1),M("");return}x(!0);try{await He(ie(F,"adGroups",Ce.adGroupId),{clientNote:O.trim(),clientNoteTimestamp:Mt(),hasClientNote:!0})}catch(W){console.error("Failed to submit note",W)}finally{x(!1),M(""),pe(!1),Ae(!0)}};return J||!V||tr&&!z?i.jsx(ec,{}):tr?!l||l.length===0?i.jsx("div",{className:"text-center mt-10",children:st?"ads are pending":"No ads assigned to your account."}):Ze?i.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen space-y-4 text-center",children:[a&&i.jsx(Pn,{pngUrl:bn.logoUrl||Gs,alt:`${bn.name||"Agency"} logo`,loading:"eager",cacheKey:bn.logoUrl||Gs,onLoad:()=>q(!0),className:"mb-2 max-h-16 w-auto"}),i.jsx("h1",{className:"text-2xl font-bold",children:"Ads Pending Review"}),i.jsx("p",{className:"text-lg",children:"We'll notify you when your ads are ready."})]}):i.jsxs("div",{className:"relative flex flex-col items-center justify-center min-h-screen space-y-4",children:[N&&i.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:i.jsxs("div",{className:"bg-white p-4 rounded shadow max-w-sm space-y-4 dark:bg-[var(--dark-sidebar-bg)] dark:text-[var(--dark-text)]",children:[!I&&!Xe&&i.jsxs(i.Fragment,{children:[i.jsx("p",{className:"mb-4 text-center text-lg font-medium",children:"You’ve rejected 5 ads so far. Leave a note so we can regroup?"}),i.jsxs("div",{className:"flex justify-center space-x-2",children:[i.jsx("button",{onClick:()=>pe(!0),className:"btn-primary",children:"Leave Note"}),i.jsx("button",{onClick:()=>{D(!1),pe(!1),Ae(!1)},className:"btn-secondary text-white",children:"Keep reviewing"})]})]}),I&&!Xe&&i.jsxs("div",{className:"flex flex-col space-y-2",children:[i.jsx("textarea",{value:O,onChange:W=>M(W.target.value),className:"w-full p-2 border rounded",rows:3,placeholder:"Leave a note for the designer..."}),i.jsxs("div",{className:"flex justify-center space-x-2",children:[i.jsx("button",{onClick:Do,disabled:b,className:"btn-primary",children:"Submit Note"}),i.jsx("button",{onClick:()=>{pe(!1),M("")},className:"btn-secondary text-white",children:"Cancel"})]})]}),Xe&&i.jsxs(i.Fragment,{children:[i.jsx("p",{className:"mb-4 text-center text-lg font-medium",children:"Continue Review?"}),i.jsxs("div",{className:"flex justify-center space-x-2",children:[i.jsx("button",{onClick:()=>{D(!1),Ae(!1)},className:"btn-primary",children:"Yes"}),i.jsx("button",{onClick:we,className:"btn-secondary text-white",children:"No"})]})]})]})}),i.jsxs("div",{className:"flex flex-col items-center md:flex-row md:items-start md:justify-center md:gap-4 w-full",children:[i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsxs("div",{className:"relative flex flex-col items-center w-fit mx-auto",children:[a&&i.jsx(Pn,{pngUrl:bn.logoUrl||Gs,alt:`${bn.name||"Agency"} logo`,loading:"eager",cacheKey:bn.logoUrl||Gs,onLoad:()=>q(!0),className:"mb-2 max-h-16 w-auto"}),i.jsxs("div",{className:"relative w-full max-w-md mb-2.5 flex justify-center",children:[i.jsx("button",{type:"button",onClick:()=>{_n(),Ur(!1)},"aria-label":"Exit Review",className:"absolute left-0 top-1/2 -translate-y-1/2 text-gray-500 hover:text-black dark:hover:text-white",children:i.jsx(wS,{})}),i.jsx("div",{className:"progress-bar",role:"progressbar","aria-valuenow":Bt,"aria-valuemin":"0","aria-valuemax":"100",children:i.jsx("div",{className:"progress-bar-inner",style:{width:`${Bt}%`}})})]}),Tt&&Tt.assets.length>1&&i.jsxs("button",{onClick:()=>it(W=>!W),className:"text-xs text-gray-500 mb-2 px-2 py-0.5 rounded-full transition-colors hover:bg-gray-200",children:[Tt.assets.length," sizes"]}),i.jsx("div",{className:"flex justify-center relative",children:i.jsxs("div",{onTouchStart:om?void 0:U,onTouchMove:om?void 0:re,onTouchEnd:om?void 0:se,onAnimationEnd:ve,className:`relative z-10 ${Dt&&ze?"flex flex-col items-center overflow-y-auto h-[72vh]":"size-container"} ${Dn?"simple-fade-out":$?"simple-fade-in":""}`,style:Dt&&ze?{}:Dn?{}:{transform:ze?`translateX(-${ft.length*55}%)`:`translateX(${nr}px)`,transition:ls?"none":void 0},children:[i.jsxs("div",{className:`relative ad-aspect max-w-[90%] mx-auto rounded shadow ${Dt&&ze?"mb-2":"max-h-[72vh]"}`,style:{aspectRatio:zt},children:[af(Qt)?i.jsx(sf,{src:Qt,onLoadedData:()=>Y(!0),style:Dt&&ze?{maxHeight:`${72/(ft.length+1)}vh`}:{},className:"w-full h-full object-contain"}):i.jsx(Pn,{pngUrl:Qt,webpUrl:Qt?Qt.replace(/\.png$/,".webp"):void 0,alt:"Ad",loading:"eager",cacheKey:Qt,onLoad:()=>Y(!0),style:Dt&&ze?{maxHeight:`${72/(ft.length+1)}vh`}:{},className:"w-full h-full object-contain"}),wt.length>1&&(wt.length===2?i.jsxs("span",{onClick:()=>Le(W=>(W+1)%wt.length),className:"version-badge cursor-pointer",children:["V",ln(Se)]}):i.jsxs("div",{className:"relative",children:[i.jsxs("span",{onClick:()=>Cs(W=>!W),className:"version-badge cursor-pointer select-none",children:["V",ln(Se)]}),Ei&&i.jsx("div",{className:"absolute left-0 top-full mt-1 z-10 bg-white dark:bg-[var(--dark-sidebar-bg)] border border-gray-300 dark:border-gray-600 rounded shadow text-sm",children:wt.map((W,he)=>i.jsxs("button",{onClick:()=>{Le(he),Cs(!1)},className:"block w-full text-left px-2 py-1 hover:bg-gray-100 dark:hover:bg-[var(--dark-sidebar-hover)]",children:["V",ln(W)]},he))})]}))]}),ft.map((W,he)=>af(W.firebaseUrl)?i.jsx(sf,{src:W.firebaseUrl,style:Dt&&ze?{maxHeight:`${72/(ft.length+1)}vh`}:{transform:ze?`translateX(${(he+1)*110}%)`:"translateX(0)",opacity:ze?1:0},className:`max-w-[90%] mx-auto rounded shadow ${Dt&&ze?"mb-2 relative":"size-thumb max-h-[72vh]"}`},he):i.jsx(Pn,{pngUrl:W.firebaseUrl,webpUrl:W.firebaseUrl?W.firebaseUrl.replace(/\.png$/,".webp"):void 0,alt:W.filename,cacheKey:W.firebaseUrl,style:Dt&&ze?{maxHeight:`${72/(ft.length+1)}vh`}:{transform:ze?`translateX(${(he+1)*110}%)`:"translateX(0)",opacity:ze?1:0},className:`max-w-[90%] mx-auto rounded shadow ${Dt&&ze?"mb-2 relative":"size-thumb max-h-[72vh]"}`},he))]})})]}),!ze&&(Wn?i.jsxs("div",{className:"flex items-center space-x-4",children:[f>0&&i.jsx("button",{"aria-label":"Previous",onClick:()=>p(W=>Math.max(0,W-1)),className:"btn-arrow",children:"<"}),i.jsxs("div",{className:"flex space-x-4 pt-2",children:[i.jsx("button",{onClick:()=>cr("reject"),className:`btn-reject ${Ot&&Ot!=="reject"?"opacity-50":""}`,disabled:ae,children:"Reject"}),i.jsx("button",{onClick:Sn,className:`btn-edit ${Ot&&Ot!=="edit"?"opacity-50":""}`,disabled:ae,"aria-label":"Request Edit",children:i.jsx(Su,{})}),i.jsx("button",{onClick:()=>cr("approve"),className:`btn-approve ${Ot&&Ot!=="approve"?"opacity-50":""}`,disabled:ae,children:"Approve"})]}),f<d.length-1?i.jsx("button",{"aria-label":"Next",onClick:()=>p(W=>Math.min(d.length-1,W+1)),className:"btn-arrow",children:">"}):i.jsx("button",{"aria-label":"End Review",onClick:()=>p(d.length),className:"btn-arrow",children:"End"})]}):i.jsxs("div",{className:"flex space-x-4",children:[i.jsx("button",{onClick:()=>cr("reject"),className:`btn-reject ${Ot&&Ot!=="reject"?"opacity-50":""}`,disabled:ae,children:"Reject"}),i.jsx("button",{onClick:Sn,className:`btn-edit ${Ot&&Ot!=="edit"?"opacity-50":""}`,disabled:ae,"aria-label":"Request Edit",children:i.jsx(Su,{})}),i.jsx("button",{onClick:()=>cr("approve"),className:`btn-approve ${Ot&&Ot!=="approve"?"opacity-50":""}`,disabled:ae,children:"Approve"})]})),T&&i.jsx(_U,{comment:k,onCommentChange:S,editCopy:j,onEditCopyChange:y,origCopy:v,canSubmit:Be,onCancel:()=>C(!1),onSubmit:()=>cr("edit"),submitting:ae}),de&&i.jsx(bU,{data:de,view:nt,onViewChange:te,onClose:H}),jt&&i.jsx(c_,{ads:l,onClose:()=>Lt(!1)}),xr&&i.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 overflow-auto p-4",children:i.jsxs("div",{className:"bg-white p-4 rounded shadow max-w-[50rem] w-full overflow-auto max-h-[90vh] flex flex-col dark:bg-[var(--dark-sidebar-bg)] dark:text-[var(--dark-text)]",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("h2",{className:"text-lg font-semibold",children:"Platform Copy"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{onClick:()=>lr(Vr),className:`btn-primary ${Ue?"":"opacity-50 cursor-not-allowed"}`,disabled:!Ue,children:"Save"}),i.jsx("button",{onClick:()=>zn(!1),className:"btn-secondary",children:"Close"})]})]}),i.jsx("p",{className:"text-sm mb-2",children:"These lines appear as the primary text, headline, and description on your Meta ads. Feel free to tweak or remove any of the options."}),i.jsx(Tu,{onSave:lr,initialResults:Xt,showOnlyResults:!0,hideBrandSelect:!0,onCopiesChange:tn})]})})]}),i.jsx(EU,{entries:or,onVersionClick:A,origCopy:xt[lt]||"",className:"mt-4 md:mt-0 w-full md:w-60 max-h-[70vh] overflow-y-auto"})]})]}):i.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen space-y-4 text-center",children:[xn&&i.jsx("p",{className:"text-red-600",children:"Review timed out due to inactivity."}),a&&i.jsx(Pn,{pngUrl:bn.logoUrl||Gs,alt:`${bn.name||"Agency"} logo`,loading:"eager",cacheKey:bn.logoUrl||Gs,onLoad:()=>q(!0),className:"mb-2 max-h-16 w-auto"}),ri===null?i.jsx("h1",{className:"text-2xl font-bold",children:"Your ads are ready!"}):i.jsxs(i.Fragment,{children:[i.jsx("h1",{className:"text-2xl font-bold",children:"Thank you for your feedback!"}),i.jsxs("h2",{className:"text-xl",children:["You've approved"," ",i.jsx("span",{style:{color:"var(--approved-color)"},children:ri})," ","ads."]})]}),i.jsxs("div",{className:"flex flex-col items-center space-y-3",children:[i.jsxs("button",{onClick:()=>{as(!1),Lt(!1),zn(!1),St(null);const W=ir(l.filter(at=>at.status!=="pending")),le=W.filter(at=>at.status==="ready").filter(at=>ln(at)>1),Me=fn(W),ke=fn(le);qe(Me);const De=ke.length>0?ke:Me;Gn(ke.length>0),h(De),p(0),Ur(!0)},className:"btn-primary px-6 py-3 text-lg",children:[i.jsx(mS,{className:"mr-2"})," Review Ads"]}),i.jsxs("div",{className:"flex space-x-2",children:[i.jsxs("button",{onClick:()=>Lt(!0),className:"btn-secondary",children:[i.jsx(Yu,{className:"mr-1"})," Ad Gallery"]}),Xt.length>0&&i.jsxs("button",{onClick:()=>zn(!0),className:"btn-secondary",children:[i.jsx(Nu,{className:"mr-1"})," Platform Copy"]})]})]}),jt&&i.jsx(c_,{ads:l,onClose:()=>Lt(!1)}),xr&&i.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 p-4",children:i.jsxs("div",{className:"bg-white p-4 rounded shadow max-w-[50rem] w-full max-h-[90vh] flex flex-col dark:bg-[var(--dark-sidebar-bg)] dark:text-[var(--dark-text)]",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("h2",{className:"text-lg font-semibold",children:"Platform Copy"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{onClick:()=>lr(Vr),className:`btn-primary ${Ue?"":"opacity-50 cursor-not-allowed"}`,disabled:!Ue,children:"Save"}),i.jsx("button",{onClick:()=>zn(!1),className:"btn-secondary",children:"Close"})]})]}),i.jsx("p",{className:"text-sm mb-2",children:"These lines appear as the primary text, headline, and description on your Meta ads. Feel free to tweak or remove any of the options."}),i.jsx("div",{className:"overflow-auto flex-1",children:i.jsx(Tu,{onSave:lr,initialResults:Xt,showOnlyResults:!0,hideBrandSelect:!0,onCopiesChange:tn})})]})})]})}),of=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia.bind(window):null,d_=()=>{if(typeof localStorage>"u")return"system";try{return localStorage.getItem("theme")||"system"}catch{return"system"}},h_=t=>t==="system"?of&&of("(prefers-color-scheme: dark)").matches?"dark":"light":t,xx=()=>{const[t,e]=m.useState(d_()),[n,r]=m.useState(()=>h_(d_()));m.useEffect(()=>{const o=document.querySelector('meta[name="theme-color"]'),l=f=>{o&&o.setAttribute("content",f==="dark"?"#0d1116":"#ffffff")},c=f=>{const p=h_(f);r(p),document.documentElement.classList.toggle("dark",p==="dark"),l(p)};c(t);const d=of?of("(prefers-color-scheme: dark)"):null,h=()=>{t==="system"&&c("system")};return t==="system"&&d&&d.addEventListener("change",h),()=>{d&&d.removeEventListener("change",h)}},[t]);const s=o=>{if(e(o),typeof localStorage<"u")try{localStorage.setItem("theme",o)}catch{}};return{theme:t,resolvedTheme:n,setTheme:s,toggleTheme:()=>{s(n==="dark"?"light":"dark")}}},SU=({className:t=""})=>{const{resolvedTheme:e,toggleTheme:n}=xx();return i.jsx("button",{type:"button","aria-label":"Toggle dark mode",onClick:n,className:`p-2 rounded hover:bg-[var(--accent-color-10)] focus:outline-none active:bg-[var(--accent-color-10)] ${t}`,children:e==="dark"?i.jsx(sU,{}):i.jsx(fU,{})})},NU=({userRole:t=null,brandCodes:e=[]})=>{const{groupId:n}=By(),[r,s]=m.useState(Fe.currentUser),[a,o]=m.useState(""),[l,c]=m.useState(""),[d,h]=m.useState(null),[f,p]=m.useState(null),[k,S]=m.useState(null),[T,C]=m.useState(!1),[j,y]=m.useState(!1),[v,R]=m.useState(!1),[O,M]=m.useState(""),[b,x]=m.useState(!1),[w,E]=m.useState(""),[N,D]=m.useState(!Fe.currentUser),[I,pe]=m.useState(0),Xe=m.useRef(null);if(m.useEffect(()=>{r||RE(Fe).then(()=>{s(Fe.currentUser),D(!1)}).catch(J=>{console.error("Anonymous sign-in failed",J),E(J.message),D(!1)})},[r]),m.useEffect(()=>{if(!n){h(null);return}(async()=>{try{const K=await gn(ie(F,"adGroups",n));if(!K.exists()){h(null);return}const z=K.data().brandCode;if(!z){h(null);return}const Y=Ye(fe(F,"brands"),Je("code","==",z)),V=await Ne(Y);V.empty?h(null):h(V.docs[0].data().agencyId||null)}catch(K){console.error("Failed to fetch agency",K),h(null)}})()},[n]),m.useEffect(()=>{if(!n)return;const J=ps(fe(F,"adGroups",n,"copyCards"),K=>pe(K.size));return()=>J()},[n]),m.useEffect(()=>{if(!n){p(null),S(null),R(!1);return}(async()=>{var K;try{const z=await gn(ie(F,"adGroups",n));if(!z.exists()){R(!0),p(null),S(null),C(!1),y(!1);return}const Y=z.data();p(Y.password||null),S(Y.visibility||"private"),C(!!Y.requireAuth),y(!!Y.requirePassword);const V=Y.visibility!=="public"||Y.requireAuth&&((K=Fe.currentUser)==null?void 0:K.isAnonymous);R(V)}catch(z){console.error("Failed to fetch group info",z),R(!0),p(null),S(null),C(!1),y(!1)}})()},[n]),m.useEffect(()=>{if(f===null||v)return;const J=typeof localStorage<"u"?localStorage.getItem(`reviewPassword-${n}`):null;(!j||J===f)&&x(!0)},[f,j,n,v]),m.useEffect(()=>{if(r)if(r.isAnonymous){const J=typeof localStorage<"u"?localStorage.getItem("reviewerName"):"";J&&(o(J),c(J))}else o(r.displayName||"")},[r]),m.useEffect(()=>{r!=null&&r.isAnonymous&&a&&localStorage.setItem("reviewerName",a)},[a,r]),w)return i.jsx("div",{className:"p-4 text-center text-red-500",children:w});if(N)return i.jsx(ec,{});if(v)return i.jsx("div",{className:"p-4 text-center",children:"This link is currently private."});if(j&&!b)return i.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen p-4 space-y-2",children:[i.jsx("label",{className:"text-lg",htmlFor:"reviewPassword",children:"Group Password"}),i.jsx("input",{id:"reviewPassword",type:"password",value:O,onChange:J=>M(J.target.value),className:"w-full max-w-xs p-2 border rounded"}),i.jsx("button",{onClick:()=>{O===f?(localStorage.setItem(`reviewPassword-${n}`,f),x(!0)):window.alert("Incorrect password")},className:"btn-primary",disabled:!O.trim(),children:"Enter"})]});if(r!=null&&r.isAnonymous&&!a)return i.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen p-4 space-y-2",children:[i.jsx("label",{className:"text-lg",htmlFor:"reviewerName",children:"Your Name"}),i.jsx("input",{id:"reviewerName",type:"text",value:l,onChange:J=>c(J.target.value),className:"w-full max-w-xs p-2 border rounded"}),i.jsx("button",{onClick:()=>o(l.trim()),className:"btn-primary",disabled:!l.trim(),children:"Continue"})]});const Ae=r!=null&&r.isAnonymous?{uid:r.uid||"public",email:"public@campfire"}:r;return i.jsxs("div",{className:"min-h-screen relative",children:[i.jsxs("div",{className:"absolute top-2 right-2 flex gap-2 z-40",children:[(r==null?void 0:r.isAnonymous)&&i.jsx(SU,{}),I>0&&i.jsx("button",{type:"button","aria-label":"See platform copy",onClick:()=>{var J;return(J=Xe.current)==null?void 0:J.openCopy()},className:"p-2 rounded",children:i.jsx(Nu,{})}),i.jsx("button",{type:"button","aria-label":"See gallery",onClick:()=>{var J;return(J=Xe.current)==null?void 0:J.openGallery()},className:"p-2 rounded",children:i.jsx(Yu,{})})]}),i.jsx(CU,{ref:Xe,user:Ae,groupId:n,reviewerName:a,userRole:r!=null&&r.isAnonymous?null:t,brandCodes:r!=null&&r.isAnonymous?[]:e,agencyId:d})]})},TU=()=>{const[t,e]=m.useState(Fe.currentUser),[n,r]=m.useState(!Fe.currentUser);m.useEffect(()=>{t||RE(Fe).then(()=>{e(Fe.currentUser),r(!1)}).catch(c=>{console.error("Anonymous sign-in failed",c),r(!1)})},[t]);const s=t==null?void 0:t.isAnonymous,{role:a,brandCodes:o,loading:l}=Fr(s?null:t==null?void 0:t.uid);return l||n?i.jsx(ec,{}):i.jsx(NU,{userRole:s?null:a,brandCodes:s?[]:o})};function Ug(t){return Ge({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M224 96l16-32 32-16-32-16-16-32-16 32-32 16 32 16 16 32zM80 160l26.66-53.33L160 80l-53.34-26.67L80 0 53.34 53.33 0 80l53.34 26.67L80 160zm352 128l-26.66 53.33L352 368l53.34 26.67L432 448l26.66-53.33L512 368l-53.34-26.67L432 288zm70.62-193.77L417.77 9.38C411.53 3.12 403.34 0 395.15 0c-8.19 0-16.38 3.12-22.63 9.38L9.38 372.52c-12.5 12.5-12.5 32.76 0 45.25l84.85 84.85c6.25 6.25 14.44 9.37 22.62 9.37 8.19 0 16.38-3.12 22.63-9.37l363.14-363.15c12.5-12.48 12.5-32.75 0-45.24zM359.45 203.46l-50.91-50.91 86.6-86.6 50.91 50.91-86.6 86.6z"}}]})(t)}const IU=({options:t=[],value:e=[],onChange:n,id:r="tag-checklist"})=>{const[s,a]=m.useState(""),o=Object.fromEntries(t.map(p=>[p.name,p.id])),l=e||[],c=t.filter(p=>!l.includes(p.id)),d=p=>{const k=o[p];k&&(l.includes(k)||n([...l,k]),a(""))},h=p=>{n(l.filter(k=>k!==p))},f=p=>{p.key==="Enter"&&(p.preventDefault(),d(s.trim()))};return i.jsxs("div",{className:"flex flex-wrap items-center gap-1",children:[l.map(p=>{const k=t.find(T=>T.id===p),S=k?k.name:p;return i.jsxs("span",{className:"tag bg-accent-10 text-accent flex items-center",children:[S,i.jsx(Vt,{type:"button",variant:"delete",onClick:()=>h(p),className:"ml-1 text-xs",children:"×"})]},p)}),i.jsx("input",{id:r,list:`${r}-list`,value:s,onChange:p=>a(p.target.value),onKeyDown:f,className:"flex-1 p-1 border rounded"}),c.length>0&&i.jsx("datalist",{id:`${r}-list`,children:c.map(p=>i.jsx("option",{value:p.name},p.id))})]})};function AU(t=""){return t.toLowerCase().split(/[;,\s]+/).map(e=>e.trim()).filter(Boolean)}function Ml(t=""){const e=[];let n="",r=!1;for(let s=0;s<t.length;s+=1){const a=t[s];a==='"'?r&&t[s+1]==='"'?(n+='"',s+=1):r=!r:a===","&&!r?(e.push(n),n=""):n+=a}return e.push(n),e}function oh(t){try{return localStorage.getItem(t)}catch{return null}}function lm(t,e){try{localStorage.setItem(t,e)}catch{}}function so(t){try{localStorage.removeItem(t)}catch{}}const RU=({brandCode:t="",onSelect:e,onClose:n})=>{const r=Fe.currentUser,{brandCodes:s}=Fr(r==null?void 0:r.uid),[a,o]=m.useState([]),[l,c]=m.useState(""),[d,h]=m.useState(t||s[0]||"");m.useEffect(()=>{t?h(t):s.length>0&&h(p=>p||s[0])},[t,s]),m.useEffect(()=>{let p=!1;return(async()=>{try{let S=fe(F,"adAssets");d&&(S=Ye(S,Je("brandCode","==",d)));const T=await Ne(S);p||o(T.docs.map(C=>({id:C.id,...C.data()})))}catch(S){console.error("Failed to load asset library",S),p||o([])}})(),()=>{p=!0}},[d]);const f=a.filter(p=>{const k=l.toLowerCase();return!k||p.name.toLowerCase().includes(k)||(p.product||"").toLowerCase().includes(k)||(p.campaign||"").toLowerCase().includes(k)});return i.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:i.jsxs("div",{className:"bg-white p-4 rounded shadow max-h-[80vh] overflow-y-auto w-full max-w-lg dark:bg-[var(--dark-sidebar-bg)] dark:text-[var(--dark-text)]",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[!t&&i.jsx("input",{type:"text",className:"p-1 border rounded w-32",placeholder:"Brand Code",value:d,onChange:p=>h(p.target.value)}),i.jsx("input",{type:"text",className:"flex-1 p-1 border rounded",placeholder:"Filter",value:l,onChange:p=>c(p.target.value)}),i.jsx(Vt,{type:"button",variant:"secondary",className:"px-2 py-1",onClick:n,children:"Close"})]}),i.jsx("div",{className:"columns-2 sm:columns-3 gap-2",children:f.map(p=>i.jsx("button",{type:"button",onClick:()=>e&&e(p),className:"break-inside-avoid mb-2 w-full rounded",children:p.thumbnailUrl||p.url||p.firebaseUrl?i.jsx("img",{src:p.thumbnailUrl||p.url||p.firebaseUrl,alt:p.name,className:"w-full h-auto object-contain border rounded",style:{minWidth:"100px"}}):i.jsx("span",{className:`p-4 text-xl rounded flex items-center justify-center w-full border ${ci(p.type||p.assetType)==="video"?"":"bg-accent-10 text-accent"}`,style:ci(p.type||p.assetType)==="video"?{backgroundColor:"rgba(0,17,255,0.1)",color:"#0011FF"}:{},children:ci(p.type||p.assetType)==="video"?i.jsx(xS,{}):i.jsx(qc,{})})},p.id))})]})})},PU=(t,e)=>{if(!t||!e)return 1;const n=t.toString().toLowerCase(),r=e.toString().toLowerCase();if(n===r)return 10;const s=new Set(n.split(/\s+/)),a=new Set(r.split(/\s+/));let o=0;s.forEach(c=>{a.has(c)&&(o+=1)});const l=new Set([...s,...a]);return Math.round(o/l.size*9)+1},ci=t=>{if(!t)return"";const e=t.toString().trim().toLowerCase();if(!e)return"";const n=["still","image","static","img","picture","photo"],r=["motion","video","animated","gif"];return n.some(s=>e.includes(s))?"image":r.some(s=>e.includes(s))?"video":e},Bg=({onSave:t=null,initialResults:e=null,showOnlyResults:n=!1,onSelectChange:r=null,brandCode:s="",hideBrandSelect:a=!1,onRecipesClick:o=null})=>{var Ei,Cs,nr,os,ls,Br;const[l,c]=m.useState([]),[d,h]=m.useState([]),[f,p]=m.useState([]),[k,S]=m.useState([]),[T,C]=m.useState([]),[j,y]=m.useState(s),[v,R]=m.useState(""),[O,M]=m.useState({}),[b,x]=m.useState({}),[w,E]=m.useState([]),[N,D]=m.useState(1),[I,pe]=m.useState({}),[Xe,Ae]=m.useState(!1),[J,K]=m.useState([]),[z,Y]=m.useState([]),[V,q]=m.useState({}),[ae,Ee]=m.useState({}),[L,B]=m.useState(""),[G,ne]=m.useState([]);m.useEffect(()=>{pe({})},[v]);const de=m.useMemo(()=>[...f,...k],[f,k]),Qe=m.useMemo(()=>{const $=L.toLowerCase();return $?J.filter(Z=>Z.name.toLowerCase().includes($)||(Z.product||"").toLowerCase().includes($)||(Z.campaign||"").toLowerCase().includes($)):J},[J,L]);m.useEffect(()=>{try{const $=j?`reviews_${j}`:"reviews",Z=oh($);if(!Z){ne([]);return}const X=JSON.parse(Z);Array.isArray(X)?ne(X.map(oe=>({name:"",body:"",title:"",rating:"",product:"",...oe}))):ne([])}catch($){console.error("Failed to load reviews",$),ne([])}},[j]),m.useEffect(()=>{(async()=>{if(!j){S([]);return}try{const Z=Ye(fe(F,"brands"),Je("code","==",j)),X=await Ne(Z);if(X.empty)S([]);else{const oe=X.docs[0].data(),ye=Array.isArray(oe.products)?oe.products:[];S(ye.map((Re,me)=>({id:`product-${me}`,componentKey:"product",name:Re.name,values:{name:Re.name,description:Array.isArray(Re.description)?Re.description:typeof Re.description=="string"?Re.description.split(/[;\n]+/).map(We=>We.trim()).filter(Boolean):[],benefits:Array.isArray(Re.benefits)?Re.benefits:typeof Re.benefits=="string"?Re.benefits.split(/[;\n]+/).map(We=>We.trim()).filter(Boolean):[]},relationships:{brandCode:j}})))}}catch(Z){console.error("Failed to load products",Z),S([])}})()},[j]);const{role:nt}=Fr((Ei=Fe.currentUser)==null?void 0:Ei.uid),te=nt==="admin"||nt==="agency";m.useEffect(()=>{(async()=>{try{const Z=await Ne(fe(F,"recipeTypes"));c(Z.docs.map(me=>({id:me.id,...me.data()})));const oe=(await Ne(fe(F,"componentTypes"))).docs.map(me=>{const We=me.data();return{id:me.id,...We,selectionMode:We.selectionMode||"dropdown"}});oe.push({id:"brand",key:"brand",label:"Brand",selectionMode:"brand",attributes:[{label:"Name",key:"name",inputType:"text"},{label:"Tone of Voice",key:"toneOfVoice",inputType:"text"},{label:"Offering",key:"offering",inputType:"text"}]}),oe.push({id:"product",key:"product",label:"Product",selectionMode:"checklist",attributes:[{label:"Name",key:"name",inputType:"text"},{label:"Description",key:"description",inputType:"list"},{label:"Benefits",key:"benefits",inputType:"list"}]}),h(oe);const ye=await Ne(fe(F,"componentInstances"));p(ye.docs.map(me=>({id:me.id,...me.data()})));const Re=await Ne(fe(F,"brands"));C(Re.docs.map(me=>({id:me.id,...me.data()})))}catch(Z){console.error("Failed to load data",Z)}})()},[]),m.useEffect(()=>{var $,Z;e&&Array.isArray(e)&&(E(e.map((X,oe)=>({recipeNo:oe+1,...X}))),($=e[0])!=null&&$.type&&R(e[0].type),(Z=e[0])!=null&&Z.brandCode&&y(e[0].brandCode))},[e]),m.useEffect(()=>{s&&y(s)},[s]);const je=async $=>{var Qr,sr,Yr;const Z=(Qr=$.target.files)==null?void 0:Qr[0];if(!Z){K([]),Y([]),q({}),Ee({});return}const oe=(await Z.text()).trim().split(/\r?\n/);if(oe.length===0){K([]),Y([]),q({}),Ee({});return}const ye=Ml(oe[0]).map(xt=>xt.trim()),Re=[];for(let xt=1;xt<oe.length;xt+=1){if(!oe[xt])continue;const qn=Ml(oe[xt]).map(Jr=>Jr.trim()),On={};ye.forEach((Jr,bn)=>{On[Jr]=qn[bn]||""}),Re.push(On)}K(Re),Y(ye),B("");const me={};((qe==null?void 0:qe.assetMatchFields)||[]).forEach(xt=>{me[xt]={header:ye.includes(xt)?xt:"",score:10}});const We=ye.find(xt=>/url/i.test(xt));We&&(me.imageUrl={header:We,score:10});const Rt=ye.find(xt=>/(name|file)/i.test(xt));Rt&&(me.imageName={header:Rt,score:10});const Pt=ye.find(xt=>/context/i.test(xt));Pt&&(me.context={header:Pt});const wr=ye.find(xt=>/asset.?type/i.test(xt)||/^type$/i.test(xt));wr&&(me.assetType={header:wr}),q(me);const Ln=((sr=me.imageName)==null?void 0:sr.header)||((Yr=me.imageUrl)==null?void 0:Yr.header)||"",rr={};Re.forEach(xt=>{const qn=xt[Ln]||xt.imageUrl||xt.imageName||"";qn&&(rr[qn]=0)}),Ee(rr),uo("Asset CSV loaded",{headers:ye,rowsSample:Re.slice(0,2),map:me})},Le=async()=>{var $,Z;try{let X=[],oe=fe(F,"adAssets");if(j&&(oe=Ye(oe,Je("brandCode","==",j))),X=(await Ne(oe)).docs.map(Pt=>({id:Pt.id,...Pt.data()})),X.length===0)return;K(X),B("");const Re=["name","url","thumbnailUrl","type","description","product","campaign"];Y(Re);const me={};((qe==null?void 0:qe.assetMatchFields)||[]).forEach(Pt=>{me[Pt]={header:Re.includes(Pt)?Pt:"",score:10}}),me.imageUrl={header:"url",score:10},me.imageName={header:"name",score:10},me.thumbnailUrl={header:"thumbnailUrl"},me.context={header:"description"},me.assetType={header:"type"},q(me);const We=(($=me.imageName)==null?void 0:$.header)||((Z=me.imageUrl)==null?void 0:Z.header)||"",Rt={};X.forEach(Pt=>{const wr=Pt[We]||Pt.imageUrl||Pt.imageName||"";wr&&(Rt[wr]=0)}),Ee(Rt),uo("Asset library loaded",{rowsSample:X.slice(0,2),map:me})}catch(X){console.error("Failed to load asset library",X)}};m.useEffect(()=>{j?Le():(K([]),Y([]),q({}),Ee({}))},[j]);const mt=async($=null,Z=j)=>{var Yr,xt,qn,On,Jr,bn,Ss;if(!qe)return null;let X=qe.gptPrompt||"";X=X.replace(/{{brandCode}}/g,Z);const oe=$?{...$}:{...O},ye={};for(const Be of Gn)if(Be.key==="brand"){let Ue=T.find(Ve=>Ve.code===Z);if(!Ue&&Z)try{const Ve=Ye(fe(F,"brands"),Je("code","==",Z)),Ze=await Ne(Ve);Ze.empty||(Ue={id:Ze.docs[0].id,...Ze.docs[0].data()},C(Et=>Et.some(an=>an.code===Z)?Et.map(an=>an.code===Z?Ue:an):[...Et,Ue]))}catch(Ve){console.error("Failed to fetch brand",Ve)}const st=Ue||{};(Yr=Be.attributes)==null||Yr.forEach(Ve=>{const Ze=st[Ve.key]||"";ye[`${Be.key}.${Ve.key}`]=Ze;const Et=new RegExp(`{{${Be.key}\\.${Ve.key}}}`,"g");X=X.replace(Et,Ze)})}else if($)(xt=Be.attributes)==null||xt.forEach(Ue=>{const st=oe[`${Be.key}.${Ue.key}`]||"";ye[`${Be.key}.${Ue.key}`]=st;const Ve=new RegExp(`{{${Be.key}\\.${Ue.key}}}`,"g");X=X.replace(Ve,st)});else{const Ue=de.filter(Ve=>{var Ze;return Ve.componentKey===Be.key&&(!((Ze=Ve.relationships)!=null&&Ze.brandCode)||Ve.relationships.brandCode===Z)});let st=null;if(Be.selectionMode==="random")Ue.length>0&&(st=Ue[Math.floor(Math.random()*Ue.length)]);else if(Be.selectionMode==="checklist"){const Ze=(b[Be.key]!==void 0?b[Be.key]:Ue.map(Et=>Et.id)).map(Et=>Ue.find(Dt=>Dt.id===Et)).filter(Boolean);Ze.length>0&&(st=Ze[Math.floor(Math.random()*Ze.length)])}else{const Ve=b[Be.key],Ze=Ue.find(Et=>Et.id===Ve);Ze&&(st=Ze)}(qn=Be.attributes)==null||qn.forEach(Ve=>{var Dt;let Ze="";st?Ze=((Dt=st.values)==null?void 0:Dt[Ve.key])||"":Ze=oe[`${Be.key}.${Ve.key}`]||"",$||(Ve.inputType==="list"||Array.isArray(Ze))&&(Ze=sl(Ze)),ye[`${Be.key}.${Ve.key}`]=Ze;const Et=new RegExp(`{{${Be.key}\\.${Ve.key}}}`,"g");X=X.replace(Et,Ze)})}(qe.writeInFields||[]).forEach(Be=>{let Ue=oe[Be.key];$?Ue===void 0&&(Ue=""):Be.inputType==="list"||Array.isArray(Ue)?Ue=sl(Ue):Ue===void 0&&(Ue=""),ye[Be.key]=Ue;const st=new RegExp(`{{${Be.key}}}`,"g");X=X.replace(st,Ue)});const me=G.length>0?G[Math.floor(Math.random()*G.length)]:{name:"",body:"",title:"",rating:"",product:""};ye["review.name"]=me.name||"",ye["review.body"]=me.body||"",ye["review.title"]=me.title||"",ye["review.rating"]=me.rating||"",ye["review.product"]=me.product||"",X=X.replace(/{{review\.name}}/g,me.name||""),X=X.replace(/{{review\.body}}/g,me.body||""),X=X.replace(/{{review\.title}}/g,me.title||""),X=X.replace(/{{review\.rating}}/g,me.rating||""),X=X.replace(/{{review\.product}}/g,me.product||"");const We={};Object.entries(ye).forEach(([Be,Ue])=>{const st=Be.match(/^(.+)\.(assetNo|assetCount)$/);if(st){const Ve=parseInt(Ue,10);Ve>0&&(We[st[1]]=Ve)}});const Rt=Object.keys(We).length>0?Object.values(We).reduce((Be,Ue)=>Be+Ue,0):parseInt(ye["layout.assetNo"],10)||parseInt(ye["layout.assetCount"],10)||0,Pt=(Be=ae,Ue=null)=>{var ir,_n,ar;uo("Searching best asset",{rows:Qe.length,map:V});let st=0,Ve=[];if((Ue&&((ir=V.assetType)!=null&&ir.header)?Qe.filter(Ce=>ci(Ce[V.assetType.header])===ci(Ue)):Qe).forEach((Ce,wt)=>{let Se=0;const Qt={};(qe.assetMatchFields||[]).forEach(Ot=>{const Wn=V[Ot];if(!Wn||!Wn.header)return;const or=Ce[Wn.header];if(or===void 0)return;const Bt=ye[Ot]||"",A=PU(Bt,or);Qt[Ot]={recipeVal:Bt,rowVal:or,sim:A,threshold:Wn.score||10},A>=(Wn.score||10)&&(Se+=1)}),Se>st?(st=Se,Ve=[Ce]):Se===st&&Ve.push(Ce)}),Ve.length===0)return null;const Et=((_n=V.imageName)==null?void 0:_n.header)||((ar=V.imageUrl)==null?void 0:ar.header)||"";let Dt=1/0;Ve.forEach(Ce=>{const wt=Ce[Et]||Ce.imageUrl||Ce.imageName||"",Se=Be[wt]||0;Se<Dt&&(Dt=Se)});const an=Ve.filter(Ce=>{const wt=Ce[Et]||Ce.imageUrl||Ce.imageName||"";return(Be[wt]||0)===Dt});return an[Math.floor(Math.random()*an.length)]},wr=(Be,Ue,st,Ve=null)=>{var _n,ar,Ce;if(!Be||Be.size===0)return null;let Ze=0,Et=[];if((Ve&&((_n=V.assetType)!=null&&_n.header)?Qe.filter(wt=>ci(wt[V.assetType.header])===ci(Ve)):Qe).forEach(wt=>{var or,Bt,A;const Se=((or=V.imageName)==null?void 0:or.header)||((Bt=V.imageUrl)==null?void 0:Bt.header)||"",Qt=wt[Se]||wt.imageUrl||wt.imageName||"";if(!Qt||Qt===Ue)return;const on=((A=V.context)==null?void 0:A.header)||"",Ot=new Set(Ln(wt[on]||""));let Wn=0;Be.forEach(H=>{Ot.has(H)&&(Wn+=1)}),Wn>Ze?(Ze=Wn,Et=[wt]):Wn===Ze&&Et.push(wt)}),Et.length===0)return null;const an=((ar=V.imageName)==null?void 0:ar.header)||((Ce=V.imageUrl)==null?void 0:Ce.header)||"";let fn=1/0;Et.forEach(wt=>{const Se=wt[an]||wt.imageUrl||wt.imageName||"",Qt=st[Se]||0;Qt<fn&&(fn=Qt)});const ir=Et.filter(wt=>{const Se=wt[an]||wt.imageUrl||wt.imageName||"";return(st[Se]||0)===fn});return ir[Math.floor(Math.random()*ir.length)]},Ln=Be=>AU(Be),rr=(Be,Ue,st)=>{var Et,Dt,an,fn,ir,_n,ar,Ce,wt,Se,Qt;const Ve=[];let Ze="";if(Be>0){const on=Pt(st,Ue);let Ot="";if(on){const or=((Et=V.imageUrl)==null?void 0:Et.header)||"imageUrl",Bt=((Dt=V.imageName)==null?void 0:Dt.header)||"imageName",A=((an=V.imageName)==null?void 0:an.header)||((fn=V.imageUrl)==null?void 0:fn.header)||"",H=((ir=V.context)==null?void 0:ir.header)||"",U=on[or]||on.imageUrl||on.url||"",re=on[Bt]||on.imageName||on.filename||U;if(Ot=on[A]||on.imageUrl||on.imageName||"",Ze=on[H]||"",Ot&&(st[Ot]=(st[Ot]||0)+1),U){const se=((_n=V.assetType)==null?void 0:_n.header)||"",ve=se?on[se]:"",we=ci(ve);Ve.push({id:re,adUrl:U,assetType:we,thumbnailUrl:on.thumbnailUrl||""})}else Ve.push({needAsset:!0})}else Ve.push({needAsset:!0});const Wn=new Set(Ln(Ze));for(let or=1;or<Be;or+=1){const Bt=wr(Wn,Ot,st,Ue);if(Bt){const A=((ar=V.imageUrl)==null?void 0:ar.header)||"imageUrl",H=((Ce=V.imageName)==null?void 0:Ce.header)||"imageName",U=((wt=V.imageName)==null?void 0:wt.header)||((Se=V.imageUrl)==null?void 0:Se.header)||"",re=Bt[A]||Bt.imageUrl||Bt.url||"",se=Bt[H]||Bt.imageName||Bt.filename||re,ve=Bt[U]||Bt.imageUrl||Bt.imageName||"";if(ve&&(st[ve]=(st[ve]||0)+1),re){const we=((Qt=V.assetType)==null?void 0:Qt.header)||"",xe=we?Bt[we]:"",lt=ci(xe);Ve.push({id:se,adUrl:re,assetType:lt,thumbnailUrl:Bt.thumbnailUrl||""})}else Ve.push({needAsset:!0})}else Ve.push({needAsset:!0})}}for(;Ve.length<Be;)Ve.push({needAsset:!0});return{assets:Ve,context:Ze}},Qr=[];let sr="";if(Rt>0){const Be={...ae};if(Object.keys(We).length>0)Object.entries(We).forEach(([Ue,st])=>{const Ve=(ye[`${Ue}.assetType`]||"").trim(),{assets:Ze,context:Et}=rr(st,Ve,Be);sr||(sr=Et),Qr.push(...Ze),ye[`${Ue}.assets`]=Ze.slice()});else{const{assets:Ue,context:st}=rr(Rt,null,Be);sr=st,Qr.push(...Ue)}Ee(Be)}for(;Qr.length<Rt;)Qr.push({needAsset:!0});X=X.replace(/{{csv\.context}}/g,sr);try{const Be=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer undefined"},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"user",content:X}],temperature:.7})}),Ue=await Be.json();if(!Be.ok)return console.error("OpenAI API error",Ue),null;const st=((Ss=(bn=(Jr=(On=Ue.choices)==null?void 0:On[0])==null?void 0:Jr.message)==null?void 0:bn.content)==null?void 0:Ss.trim())||"No result",Ve={type:v,brandCode:Z,components:ye,copy:st,assets:Qr.slice()};for(;Ve.assets.length<Rt;)Ve.assets.push({needAsset:!0});return Ve}catch(Be){return console.error("Failed to call OpenAI",Be),null}},Ct=async $=>{$.preventDefault();const Z=Number(N)||1;for(let X=0;X<Z;X++){const oe=await mt(null,j);oe&&E(ye=>[...ye,{recipeNo:ye.length+1,...oe,type:v}])}},ze=()=>{const $={};Hn.forEach(Z=>{$[Z.key]=Z.key.endsWith(".assets")?[]:""}),E(Z=>[...Z,{recipeNo:Z.length+1,components:$,copy:"",assets:[]}])},[it,jt]=m.useState(null),[Lt,Xt]=m.useState(""),[Cn,xr]=m.useState({}),[zn,Vr]=m.useState(null),tn=$=>{if(it===$){const Z=[...w];Z[$].copy=Lt,Z[$].components={...Cn},E(Z),jt(null)}else jt($),Xt(w[$].copy),xr({...w[$].components})},xn=$=>{E(Z=>Z.filter((X,oe)=>oe!==$).map((X,oe)=>({...X,recipeNo:oe+1})))},as=($,Z)=>{const X=de.find(ye=>{var Re;return ye.componentKey===$&&ye.id===Z&&(!((Re=ye.relationships)!=null&&Re.brandCode)||ye.relationships.brandCode===j)});if(!X)return;const oe={...Cn};Object.entries(X.values||{}).forEach(([ye,Re])=>{oe[`${$}.${ye}`]=Re}),xr(oe)},tr=$=>{if(!zn)return;const{rowIdx:Z,key:X,assetIdx:oe}=zn,ye=[...w],Re={...ye[Z]},me={...Re.components},We=Array.isArray(me[X])?me[X].slice():[];if(We[oe]={id:$.name||$.filename||$.url||$.firebaseUrl,adUrl:$.url||$.firebaseUrl,assetType:ci($.type||$.assetType),thumbnailUrl:$.thumbnailUrl||$.firebaseUrl||""},me[X]=We,Re.components=me,ye[Z]=Re,E(ye),it===Z){const Rt={...Cn},Pt=Array.isArray(Rt[X])?Rt[X].slice():[];Pt[oe]=We[oe],Rt[X]=Pt,xr(Rt)}Vr(null)},Ur=($,Z,X)=>{const oe=[...w],ye={...oe[$]},Re={...ye.components},me=Array.isArray(Re[Z])?Re[Z].slice():[],We=Z.replace(/\.assets$/,""),Rt=parseInt(ye.components[`${We}.assetNo`],10)||parseInt(ye.components[`${We}.assetCount`],10)||0;if(X>=Rt?me.splice(X,1):me[X]={needAsset:!0},Re[Z]=me,ye.components=Re,oe[$]=ye,E(oe),it===$){const Pt={...Cn},wr=Array.isArray(Pt[Z])?Pt[Z].slice():[];X>=Rt?wr.splice(X,1):wr[X]=me[X],Pt[Z]=wr,xr(Pt)}},ri=($,Z)=>{const X=[...w],oe={...X[$]},ye={...oe.components},Re=Array.isArray(ye[Z])?ye[Z].slice():[];if(Re.push({needAsset:!0}),ye[Z]=Re,oe.components=ye,X[$]=oe,E(X),it===$){const me={...Cn},We=Array.isArray(me[Z])?me[Z].slice():[];We.push({needAsset:!0}),me[Z]=We,xr(me)}},St=($=[],Z=null,X="")=>i.jsxs("div",{className:"flex justify-center gap-1",children:[$&&$.length>0?$.map((oe,ye)=>oe.needAsset?i.jsx("button",{type:"button",onClick:()=>Vr({rowIdx:Z,key:X,assetIdx:ye}),className:"text-red-500 text-xs underline",children:"Need asset"},`na-${ye}`):i.jsxs("span",{className:"relative inline-block group",children:[i.jsx("button",{type:"button",onClick:()=>nt==="admin"&&it===Z?Vr({rowIdx:Z,key:X,assetIdx:ye}):window.open(oe.adUrl||oe.firebaseUrl,"_blank"),"aria-label":"Asset",className:`p-2 text-xl rounded inline-flex items-center justify-center ${(oe.assetType||"").toLowerCase()==="video"?"":"bg-accent-10 text-accent"}`,style:(oe.assetType||"").toLowerCase()==="video"?{backgroundColor:"rgba(0,17,255,0.1)",color:"#0011FF"}:{},children:(oe.assetType||"").toLowerCase()==="video"?i.jsx(xS,{}):i.jsx(qc,{})}),nt==="admin"&&it===Z&&i.jsx("button",{type:"button",onClick:()=>Ur(Z,X,ye),className:"absolute -top-1 -right-1 bg-white rounded-full text-red-600 hover:text-red-800","aria-label":"Remove Asset",children:i.jsx(wS,{})}),i.jsx("img",{src:oe.thumbnailUrl||oe.adUrl||oe.firebaseUrl,alt:"preview",className:"hidden group-hover:block absolute left-[-8rem] top-1/2 -translate-y-1/2 min-w-[100px] w-auto h-auto border shadow-lg z-10"})]},oe.id)):"-",nt==="admin"&&it===Z&&i.jsx("button",{type:"button",onClick:()=>ri(Z,X),className:"btn-secondary px-1.5 py-0.5 text-xs flex items-center","aria-label":"Add Asset",children:i.jsx(Yi,{})})]}),ji=async $=>{const Z=w[$].components,X=await mt(Z,j);if(X){const oe=[...w];oe[$]={...oe[$],...X},E(oe)}},qe=l.find($=>$.id===v);m.useEffect(()=>{qe!=null&&qe.enableAssetCsv||(K([]),Y([]),q({}))},[qe]);const wn=m.useMemo(()=>Object.fromEntries(d.map($=>[$.key,$])),[d]),Gn=m.useMemo(()=>{var $;return($=qe==null?void 0:qe.components)!=null&&$.length?qe.components.map(Z=>wn[Z]).filter(Boolean):d},[qe,wn,d]),Dn=m.useMemo(()=>(qe==null?void 0:qe.writeInFields)||[],[qe]),Hn=m.useMemo(()=>{const $=[],Z=[];if(Gn.length>0?(Gn.forEach(X=>{var oe;(oe=X.attributes)==null||oe.forEach(ye=>{$.push({key:`${X.key}.${ye.key}`,label:`${X.label} - ${ye.label}`,inputType:ye.inputType||"text"}),(ye.key==="assetNo"||ye.key==="assetCount")&&Z.push({key:`${X.key}.assets`,label:`${X.label} Assets`})})}),Dn.forEach(X=>{$.push({key:X.key,label:X.label})}),Z.forEach(X=>$.push(X)),$.push({key:"review.name",label:"Review - Name"}),$.push({key:"review.body",label:"Review - Body"}),$.push({key:"review.title",label:"Review - Title"}),$.push({key:"review.rating",label:"Review - Rating"}),$.push({key:"review.product",label:"Review - Product"})):e&&e.length>0&&Array.from(new Set(e.flatMap(oe=>Object.keys(oe.components||{})))).forEach(oe=>{$.push({key:oe,label:oe,inputType:"text"})}),qe!=null&&qe.defaultColumns&&qe.defaultColumns.length>0){const X=qe.defaultColumns;$.sort((oe,ye)=>{const Re=X.indexOf(oe.key),me=X.indexOf(ye.key);return Re===-1&&me===-1?0:Re===-1?1:me===-1?-1:Re-me})}return $},[Gn,Dn,e,qe]);return m.useEffect(()=>{pe($=>{const Z={...$},X=oe=>{if(!(oe in Z)){let ye=!1;qe!=null&&qe.defaultColumns&&qe.defaultColumns.length>0&&(ye=qe.defaultColumns.includes(oe)),Z[oe]=ye}};return X("recipeNo"),Hn.forEach(oe=>X(oe.key)),X("copy"),Object.keys(Z).forEach(oe=>{Hn.some(ye=>ye.key===oe)||oe==="recipeNo"||oe==="copy"||delete Z[oe]}),Z})},[Hn,qe]),i.jsxs("div",{children:[!n&&i.jsxs("form",{onSubmit:Ct,className:"space-y-2 max-w-[50rem]",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:"Recipe Type"}),i.jsxs("select",{className:"w-full p-2 border rounded",value:v,onChange:$=>R($.target.value),children:[i.jsx("option",{value:"",children:"Select..."}),l.map($=>i.jsx("option",{value:$.id,children:$.name},$.id))]})]}),!a&&i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:"Brand"}),i.jsxs("select",{className:"w-full p-2 border rounded",value:j,onChange:$=>y($.target.value),children:[i.jsx("option",{value:"",children:"None"}),T.map($=>i.jsxs("option",{value:$.code,children:[$.code," ",$.name?`- ${$.name}`:""]},$.id))]})]}),(qe==null?void 0:qe.enableAssetCsv)&&i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:"Asset Source"}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("input",{type:"file",accept:".csv",onChange:je}),i.jsx("button",{type:"button",className:"btn-secondary px-2 py-0.5",onClick:Le,children:"Use Library"})]}),J.length>0&&i.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[i.jsxs("p",{className:"text-xs",children:[J.length," rows loaded"]}),i.jsx("input",{type:"text",placeholder:"Filter",value:L,onChange:$=>B($.target.value),className:"p-1 border rounded text-xs"})]})]}),z.length>0&&i.jsxs("div",{className:"space-y-1",children:[(Cs=qe.assetMatchFields)==null?void 0:Cs.map($=>{var Z,X;return i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("label",{className:"text-xs w-28",children:$}),i.jsxs("select",{className:"p-1 border rounded flex-1",value:((Z=V[$])==null?void 0:Z.header)||"",onChange:oe=>q({...V,[$]:{...V[$],header:oe.target.value}}),children:[i.jsx("option",{value:"",children:"Select..."}),z.map(oe=>i.jsx("option",{value:oe,children:oe},oe))]}),i.jsx("input",{type:"number",min:"1",max:"10",className:"w-16 p-1 border rounded",value:((X=V[$])==null?void 0:X.score)||10,onChange:oe=>q({...V,[$]:{...V[$],score:Math.min(10,Math.max(1,parseInt(oe.target.value,10)||10))}})})]},$)}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("label",{className:"text-xs w-28",children:"context"}),i.jsxs("select",{className:"p-1 border rounded flex-1",value:((nr=V.context)==null?void 0:nr.header)||"",onChange:$=>q({...V,context:{header:$.target.value}}),children:[i.jsx("option",{value:"",children:"Ignore"}),z.map($=>i.jsx("option",{value:$,children:$},$))]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("label",{className:"text-xs w-28",children:"imageUrl"}),i.jsxs("select",{className:"p-1 border rounded flex-1",value:((os=V.imageUrl)==null?void 0:os.header)||"",onChange:$=>q({...V,imageUrl:{header:$.target.value,score:10}}),children:[i.jsx("option",{value:"",children:"Ignore"}),z.map($=>i.jsx("option",{value:$,children:$},$))]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("label",{className:"text-xs w-28",children:"imageName"}),i.jsxs("select",{className:"p-1 border rounded flex-1",value:((ls=V.imageName)==null?void 0:ls.header)||"",onChange:$=>q({...V,imageName:{header:$.target.value,score:10}}),children:[i.jsx("option",{value:"",children:"Ignore"}),z.map($=>i.jsx("option",{value:$,children:$},$))]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("label",{className:"text-xs w-28",children:"assetType"}),i.jsxs("select",{className:"p-1 border rounded flex-1",value:((Br=V.assetType)==null?void 0:Br.header)||"",onChange:$=>q({...V,assetType:{header:$.target.value}}),children:[i.jsx("option",{value:"",children:"Ignore"}),z.map($=>i.jsx("option",{value:$,children:$},$))]})]})]})]}),qe&&i.jsxs("div",{className:"space-y-4",children:[Gn.map($=>{var Re;if($.key==="brand")return null;const Z=de.filter(me=>{var We;return me.componentKey===$.key&&(!((We=me.relationships)!=null&&We.brandCode)||me.relationships.brandCode===j)}),X=Z.map(me=>me.id),oe=b[$.key]!==void 0?b[$.key]:$.selectionMode==="checklist"?X:"",ye=$.selectionMode==="dropdown"?de.find(me=>{var We;return me.id===oe&&me.componentKey===$.key&&(!((We=me.relationships)!=null&&We.brandCode)||me.relationships.brandCode===j)}):null;return i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-sm mb-1",children:$.label}),$.selectionMode==="dropdown"&&Z.length>0&&i.jsxs("select",{className:"w-full p-2 border rounded",value:oe,onChange:me=>x({...b,[$.key]:me.target.value}),children:[i.jsx("option",{value:"",children:"Custom..."}),Z.map(me=>i.jsx("option",{value:me.id,children:me.name},me.id))]}),$.selectionMode==="checklist"&&Z.length>0&&i.jsx(IU,{options:Z.map(me=>({id:me.id,name:me.name})),value:oe,onChange:me=>x({...b,[$.key]:me}),id:`check-${$.id}`}),$.selectionMode==="random"&&Z.length>0&&i.jsx("p",{className:"text-sm italic",children:"Random instance"}),($.selectionMode==="dropdown"&&!ye||Z.length===0)&&((Re=$.attributes)==null?void 0:Re.map(me=>i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs mb-1",children:me.label}),i.jsx("input",{className:"w-full p-2 border rounded",value:O[`${$.key}.${me.key}`]||"",onChange:We=>M({...O,[`${$.key}.${me.key}`]:We.target.value})})]},me.key)))]},$.id)}),Dn.map($=>i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:$.label}),$.inputType==="textarea"?i.jsx("textarea",{className:"w-full p-2 border rounded",value:O[$.key]||"",onChange:Z=>M({...O,[$.key]:Z.target.value})}):$.inputType==="list"?i.jsx(Ds,{id:`list-${$.key}`,value:O[$.key]||[],onChange:Z=>M({...O,[$.key]:Z})}):i.jsx("input",{className:"w-full p-2 border rounded",type:$.inputType,value:O[$.key]||"",onChange:Z=>M({...O,[$.key]:Z.target.value})})]},$.key)),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("button",{type:"submit",className:"btn-primary",children:"Generate"}),i.jsx("input",{type:"number",min:"1",className:"p-2 border rounded w-20",value:N,onChange:$=>D(Math.max(1,parseInt($.target.value,10)||1))})]})]})]}),i.jsxs("div",{className:"overflow-x-auto table-container mt-6",children:[i.jsxs("div",{className:"relative inline-block mb-2",children:[w.length>0&&i.jsxs(i.Fragment,{children:[i.jsx("button",{type:"button",className:"btn-secondary px-2 py-0.5",onClick:()=>Ae(!0),children:"Columns"}),nt!=="designer"&&i.jsx("button",{type:"button",className:"btn-secondary ml-2 px-2 py-0.5",onClick:ze,children:"Add Recipe Row"})]}),nt!=="designer"&&o&&i.jsxs("button",{type:"button",className:`btn-secondary px-2 py-0.5 flex items-center gap-1 ${w.length>0?"ml-2":""}`,onClick:o,children:[i.jsx(Ug,{})," ",w.length>0?"Replace Recipes":"Recipes"]})]}),w.length>0&&Xe&&i.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",onClick:()=>Ae(!1),children:i.jsxs("div",{className:"bg-white p-4 rounded shadow max-w-sm w-full dark:bg-[var(--dark-sidebar-bg)] dark:text-[var(--dark-text)]",onClick:$=>$.stopPropagation(),children:[i.jsx("h3",{className:"mb-2 font-semibold",children:"Visible Columns"}),i.jsxs("label",{className:"block whitespace-nowrap",children:[i.jsx("input",{type:"checkbox",className:"mr-1",checked:I.recipeNo||!1,onChange:()=>pe({...I,recipeNo:!I.recipeNo})}),"Recipe #"]}),Hn.map($=>i.jsxs("label",{className:"block whitespace-nowrap",children:[i.jsx("input",{type:"checkbox",className:"mr-1",checked:I[$.key]||!1,onChange:()=>pe({...I,[$.key]:!I[$.key]})}),$.label]},$.key)),i.jsxs("label",{className:"block whitespace-nowrap",children:[i.jsx("input",{type:"checkbox",className:"mr-1",checked:I.copy||!1,onChange:()=>pe({...I,copy:!I.copy})}),"Copy"]}),i.jsx("div",{className:"text-right mt-2",children:i.jsx("button",{type:"button",className:"btn-secondary px-3 py-1",onClick:()=>Ae(!1),children:"Close"})})]})}),w.length>0&&i.jsxs("table",{className:"ad-table min-w-full table-auto text-sm",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[I.recipeNo&&i.jsx("th",{children:"Recipe #"}),Hn.map($=>I[$.key]&&i.jsx("th",{children:$.label},$.key)),I.copy&&i.jsx("th",{className:"w-80",children:"Copy"}),i.jsx("th",{className:"text-center",children:te?"Actions":""})]})}),i.jsx("tbody",{children:w.map(($,Z)=>i.jsxs("tr",{className:nt==="designer"&&$.selected?"designer-selected":"",children:[I.recipeNo&&i.jsx("td",{className:"text-center align-middle font-bold",children:$.recipeNo}),Hn.map(X=>I[X.key]&&i.jsx("td",{className:"align-middle",children:X.key.endsWith(".assets")?St(it===Z?Cn[X.key]||[]:$.components[X.key]||[],Z,X.key):i.jsxs(bt.Fragment,{children:[it===Z&&X.key.includes(".")?i.jsxs("select",{className:"p-1 border rounded mb-1",onChange:oe=>as(X.key.split(".")[0],oe.target.value),children:[i.jsx("option",{value:"",children:"Select..."}),de.filter(oe=>{var ye;return oe.componentKey===X.key.split(".")[0]&&(!((ye=oe.relationships)!=null&&ye.brandCode)||oe.relationships.brandCode===j)}).map(oe=>i.jsx("option",{value:oe.id,children:oe.name},oe.id))]}):null,X.inputType==="image"?(it===Z?Cn[X.key]:$.components[X.key])?i.jsx("img",{src:it===Z?Cn[X.key]:$.components[X.key],alt:X.label,className:"max-w-[125px] w-auto h-auto"}):null:it===Z?Cn[X.key]:$.components[X.key]]})},X.key)),I.copy&&i.jsx("td",{className:"whitespace-pre-wrap break-words w-80 align-middle copy-cell",children:it===Z?i.jsx("textarea",{className:"w-full p-1 border rounded",value:Lt,onChange:X=>Xt(X.target.value)}):i.jsx("div",{className:"min-h-[1.5rem] w-full",onClick:()=>navigator.clipboard.writeText($.copy),children:$.copy})}),i.jsx("td",{className:"text-center align-middle",children:te?i.jsxs("div",{className:"flex items-center justify-center gap-1",children:[i.jsx("button",{type:"button",onClick:()=>tn(Z),"aria-label":it===Z?"Save":"Edit",className:"btn-secondary px-1.5 py-0.5 text-xs",children:it===Z?i.jsx(Vg,{}):i.jsx(Ar,{})}),i.jsx("button",{type:"button",onClick:()=>ji(Z),"aria-label":"Refresh",className:"btn-secondary px-1.5 py-0.5 text-xs",children:i.jsx(Ug,{})}),i.jsx("button",{type:"button",onClick:()=>xn(Z),"aria-label":"Delete",className:"btn-secondary px-1.5 py-0.5 text-xs btn-delete",children:i.jsx(qt,{})})]}):i.jsx("button",{type:"button",onClick:()=>{const X=[...w];X[Z].selected=!X[Z].selected,E(X),r&&r(X[Z].recipeNo,X[Z].selected)},"aria-label":"Toggle Select",children:$.selected?i.jsx(Vg,{}):i.jsx(dU,{})})})]},Z))})]}),w.length>0&&nt!=="designer"&&i.jsx("div",{className:"mt-4 text-right",children:i.jsx("button",{type:"button",className:"btn-primary",onClick:()=>t&&t(w),children:"Save Recipes"})}),zn&&i.jsx(RU,{brandCode:j,onSelect:tr,onClose:()=>Vr(null)})]})]})},Hs=({children:t,sizeClass:e="max-w-md w-full",className:n="",style:r={}})=>i.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 p-4",children:i.jsx("div",{className:`bg-white p-4 rounded shadow ${e} ${n} dark:bg-[var(--dark-sidebar-bg)] dark:text-[var(--dark-text)]`,style:r,children:t})}),f_=({brandCode:t,onClose:e,inline:n=!1})=>{const[r,s]=m.useState(null);if(m.useEffect(()=>{(async()=>{if(t)try{const l=Ye(fe(F,"brands"),Je("code","==",t)),c=await Ne(l);c.empty||s({id:c.docs[0].id,...c.docs[0].data()})}catch(l){console.error("Failed to load brand",l)}})()},[t]),!r)return null;const a=i.jsxs(i.Fragment,{children:[e&&!n&&i.jsx("button",{onClick:e,className:"absolute top-2 right-2 btn-secondary px-3 py-1",children:"Close"}),i.jsx("h3",{className:"mb-3 font-semibold text-lg",children:"Brand Assets"}),r.guidelinesUrl&&i.jsx("div",{className:"mb-3",children:i.jsx("a",{href:r.guidelinesUrl,target:"_blank",rel:"noopener noreferrer",className:"underline",children:"Brand Guidelines"})}),Array.isArray(r.logos)&&r.logos.length>0&&i.jsxs("div",{className:"mb-3",children:[i.jsx("p",{className:"font-medium text-sm mb-1",children:"Logos"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:r.logos.map((o,l)=>i.jsx(Pn,{pngUrl:o,alt:"logo",className:"h-16 w-auto"},l))})]}),Array.isArray(r.palette)&&r.palette.length>0&&i.jsxs("div",{className:"mb-3",children:[i.jsx("p",{className:"font-medium text-sm mb-1",children:"Palette"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:r.palette.map((o,l)=>i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("div",{className:"w-6 h-6 rounded",style:{backgroundColor:o}}),i.jsx("span",{className:"text-sm font-mono",children:o})]},l))})]}),Array.isArray(r.fonts)&&r.fonts.length>0&&i.jsxs("div",{className:"mb-3",children:[i.jsx("p",{className:"font-medium text-sm mb-1",children:"Typefaces"}),i.jsx("ul",{className:"list-disc list-inside space-y-1",children:r.fonts.map((o,l)=>i.jsx("li",{className:"text-sm",children:o.type==="google"?o.value:i.jsx("a",{href:o.value,target:"_blank",rel:"noopener noreferrer",className:"underline",children:o.name||`Custom Font ${l+1}`})},l))})]}),Array.isArray(r.notes)&&r.notes.length>0&&i.jsxs("div",{className:"mb-3",children:[i.jsx("p",{className:"font-medium text-sm mb-1",children:"Brand Notes"}),i.jsx("ul",{className:"list-disc list-inside space-y-1",children:r.notes.map((o,l)=>i.jsx("li",{className:"text-sm whitespace-pre-wrap",children:o},l))})]})]});return n?i.jsx("div",{className:"mb-4 bg-white p-4 rounded shadow max-w-md w-full overflow-auto relative dark:bg-[var(--dark-sidebar-bg)] dark:text-[var(--dark-text)]",style:{outline:"1px solid var(--border-color-default, #d1d5db)"},children:a}):i.jsx(Hs,{sizeClass:"max-w-md w-full",className:"relative overflow-auto",style:{outline:"1px solid var(--border-color-default, #d1d5db)"},children:a})};async function rp(t){var e;try{await rn(fe(F,"requests"),{type:"archive",status:"new",createdAt:Mt(),createdBy:((e=Fe.currentUser)==null?void 0:e.uid)||null,...t})}catch(n){console.error("Failed to create archive ticket",n)}}const DU=Po(ni);function p_(t){return(t||"").replace(/\//g,"-").replace(/\s+/g," ").trim()}async function lh(t,e,n,r){const s=p_(n),a=p_(r),o=`Campfire/Brands/${s}/Adgroups/${a}/${t.name}`,l=xi(DU,o);return await Jl(l,t,{cacheControl:"public,max-age=31536000,immutable"}),await Xl(l)}function fo(){const e=new Uint8Array(12);window.crypto.getRandomValues(e);const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";return Array.from(e,r=>n[r%n.length]).join("")}const Xu=({groupId:t,url:e,visibility:n="private",requireAuth:r=!1,requirePassword:s=!1,password:a="",onClose:o,onUpdate:l})=>{const[c,d]=m.useState(n),[h,f]=m.useState(r?"auth":"any"),[p,k]=m.useState(s),[S,T]=m.useState(a),C=e||(t?`${window.location.origin}/review/${t}`:""),j=()=>{navigator.clipboard.writeText(C).then(()=>window.alert("Link copied to clipboard")).catch(b=>console.error("Failed to copy link",b))},y=async(b=c,x=h,w=p,E=S)=>{if(!t)return;const N={visibility:b,requireAuth:x==="auth",requirePassword:x==="any"?w:!1,password:x==="any"&&w?E:""};try{await He(ie(F,"adGroups",t),N),l&&l(N)}catch(D){console.error("Failed to update visibility",D)}},v=async()=>{if(c==="public")d("private"),await y("private","any",!1,""),f("any"),k(!1),T("");else{let b=S;h==="any"&&p&&!b&&(b=fo()),d("public"),T(b),await y("public",h,p,b)}},R=async b=>{const x=b.target.value;f(x),c==="public"&&await y(c,x,x==="any"?p:!1,S)},O=async()=>{const b=!p;k(b);let x=S;b&&!x&&(x=fo()),T(x),c==="public"&&h==="any"&&await y(c,h,b,x)},M=async()=>{const b=fo();T(b),c==="public"&&h==="any"&&p&&await y(c,h,!0,b)};return i.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:i.jsxs("div",{className:"bg-white p-4 rounded shadow max-w-sm w-full dark:bg-[var(--dark-sidebar-bg)] dark:text-[var(--dark-text)]",children:[i.jsx("h3",{className:"mb-2 font-semibold",children:"Public Review"}),i.jsxs("label",{className:"flex items-center gap-2 mb-3",children:[i.jsx("input",{type:"checkbox",checked:c==="public",onChange:v}),"Enable Public Review"]}),c==="public"&&i.jsxs(i.Fragment,{children:[i.jsxs("label",{className:"block mb-3 text-sm",children:["Who can access this link?",i.jsxs("select",{value:h,onChange:R,className:"mt-1 w-full border rounded p-1 text-black dark:text-black",children:[i.jsx("option",{value:"any",children:"Anyone with the link"}),i.jsx("option",{value:"auth",children:"Only authenticated users"})]})]}),h==="any"&&i.jsxs(i.Fragment,{children:[i.jsxs("label",{className:"flex items-center gap-2 mb-3",children:[i.jsx("input",{type:"checkbox",checked:p,onChange:O}),"Require password"]}),p&&i.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[i.jsx("input",{type:"text",value:S,onChange:async b=>{const x=b.target.value;T(x),c==="public"&&h==="any"&&await y(c,h,!0,x)},className:"flex-1 border rounded p-1 text-black dark:text-black"}),i.jsx(Vt,{onClick:M,variant:"secondary",className:"px-2 py-1",children:"Generate Password"})]})]}),i.jsx(Vt,{onClick:j,variant:"primary",className:"mb-3 px-3 py-1",children:"Copy Link"})]}),i.jsx("div",{className:"text-right",children:i.jsx(Vt,{onClick:o,variant:"secondary",className:"px-3 py-1",children:"Close"})})]})})};function LU(t=[]){if(!t||t.length===0)return null;const e=["","9x16","3x5","1x1","4x5","Pinterest","Snapchat"],n=a=>a.aspectRatio||Ft(a.filename||"").aspectRatio||"",r=a=>a.version||Ft(a.filename||"").version||1,s=[...t].sort((a,o)=>r(o)-r(a));for(const a of e){const o=s.find(l=>n(l)===a);if(o)return o}return s[0]}function OU(t=[],e="pending"){return e==="archived"?"archived":e==="in review"?"in review":t.some(n=>n.status==="ready")?"ready":t.length>0&&t.every(n=>n.status!=="ready"&&n.status!=="pending")?"reviewed":e==="review pending"?"review pending":e==="briefed"?"briefed":"pending"}const bS=t=>bt.Children.toArray(t).some(e=>typeof e=="string"||typeof e=="number"?!0:bt.isValidElement(e)?bS(e.props.children):!1),be=bt.forwardRef(({as:t="button",className:e="",children:n,...r},s)=>{const o=bS(n)?"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-gray-600 dark:text-gray-300 hover:bg-[var(--accent-color-10)] hover:text-gray-900 dark:hover:text-white focus:outline-none active:bg-[var(--accent-color-10)]":"p-2 rounded flex items-center justify-center text-gray-600 dark:text-gray-300 hover:bg-[var(--accent-color-10)] hover:text-gray-900 dark:hover:text-white focus:outline-none active:bg-[var(--accent-color-10)]";return i.jsx(t,{ref:s,className:`${o} ${e}`.trim(),...r,children:n})}),_t=({active:t,className:e="",children:n,...r})=>i.jsx("button",{...r,className:`px-3 py-1 rounded flex items-center gap-1 transition-colors duration-200 ${t?"bg-accent-10 text-accent":"border"} ${e}`.trim(),children:n});function m_(t=""){return t.replace(/\.[^/.]+$/,"").replace(/_V\d+$/i,"")}const MU={approved:3,edit_requested:2,rejected:1};function g_(t=""){return MU[t]||0}function _S(t=[]){const e={reviewed:0,approved:0,edit:0,rejected:0,thumbnail:""},n={};return t.forEach(r=>{!e.thumbnail&&(r.thumbnailUrl||r.firebaseUrl)&&(e.thumbnail=r.thumbnailUrl||r.firebaseUrl);const s=Ft(r.filename||""),a=r.recipeCode||s.recipeCode||"";if(!a)return;const o=n[a];(!o||g_(r.status)>g_(o))&&(n[a]=r.status)}),Object.values(n).forEach(r=>{r!=="ready"&&(e.reviewed+=1),r==="approved"&&(e.approved+=1),r==="edit_requested"&&(e.edit+=1),r==="rejected"&&(e.rejected+=1)}),e}const FU=t=>{const e=t.lastIndexOf(".");return e>=0?t.slice(e+1).toLowerCase():""},VU=({ext:t})=>{let e=tU;return t==="ai"?e=aU:t==="pdf"?e=Ll:["otf","ttf","woff","woff2"].includes(t)&&(e=Nu),i.jsx("div",{className:"w-40 h-32 flex items-center justify-center bg-accent-10 text-accent rounded",children:i.jsx(e,{size:32})})},y_=t=>String(t??"").trim().replace(/^0+/,"").toLowerCase(),UU=()=>{var Bt;const{id:t}=By(),[e,n]=m.useState(null),[r,s]=m.useState(""),[a,o]=m.useState([]),[l,c]=m.useState([]),[d,h]=m.useState(!1),[f,p]=m.useState(!1),[k,S]=m.useState(null),[T,C]=m.useState({}),[j,y]=m.useState(!1),[v,R]=m.useState(null),[O,M]=m.useState(null),[b,x]=m.useState(null),[w,E]=m.useState({}),[N,D]=m.useState(null),[I,pe]=m.useState({copy:""}),[Xe,Ae]=m.useState(!1),[J,K]=m.useState([]),[z,Y]=m.useState(1),[V,q]=m.useState(0),[ae,Ee]=m.useState(!1),[L,B]=m.useState(!1),[G,ne]=m.useState(!1),[de,Qe]=m.useState([]),[nt,te]=m.useState(!1),[je,Le]=m.useState([]),[mt,Ct]=m.useState(!1),[ze,it]=m.useState("stats"),[jt,Lt]=m.useState(!1),[Xt,Cn]=m.useState(""),[xr,zn]=m.useState(!1),[Vr,tn]=m.useState([]),[xn,as]=m.useState([]),[tr,Ur]=m.useState(""),ri=m.useRef(null),{role:St}=Fr((Bt=Fe.currentUser)==null?void 0:Bt.uid),ji=Es(),qe=St==="designer",wn=St==="admin",Gn=St==="manager"||St==="editor",Dn=wn||qe||Gn,Hn=Dn?ze==="ads":j,Ei=Dn?ze==="brief":G,Cs=Dn?ze==="stats":!j,nr=(A,H)=>{var se;const U=((se=w[A])==null?void 0:se.copy)||"";if(!H||H===U)return null;const re=vx(U,H);return re.map((ve,we)=>{const xe=we<re.length-1?" ":"";return ve.type==="same"?ve.text+xe:ve.type==="removed"?i.jsxs("span",{className:"text-red-600 line-through",children:[ve.text,xe]},we):i.jsxs("span",{className:"text-green-600 italic",children:[ve.text,xe]},we)})},os=m.useMemo(()=>{let A="/";switch(St){case"admin":A="/admin/ad-groups";break;case"manager":A="/admin/ad-groups";break;case"editor":A="/editor/ad-groups";break;case"agency":A="/agency/ad-groups";break;case"designer":A="/dashboard/designer";break;case"client":A="/dashboard/client";break;default:A="/"}return St==="agency"&&ji.search?A+ji.search:A},[St,ji.search]),ls=m.useMemo(()=>{const A=H=>H.map(U=>({id:U.id||"",primary:U.primary||"",headline:U.headline||"",description:U.description||""}));return JSON.stringify(A(de))!==JSON.stringify(A(je))},[de,je]),Br=A=>_S(A);m.useEffect(()=>{(async()=>{const se=await gn(ie(F,"adGroups",t));se.exists()&&n({id:se.id,...se.data()})})();const H=ps(fe(F,"adGroups",t,"assets"),se=>{const ve=se.docs.map(we=>({id:we.id,...we.data()}));o(ve)}),U=ps(fe(F,"adGroups",t,"groupAssets"),se=>{const ve=se.docs.map(we=>({id:we.id,...we.data()}));c(ve)}),re=ps(Ye(fe(F,"adGroups",t,"responses"),lo("timestamp","desc")),se=>{const ve=se.docs.map(we=>({id:we.id,...we.data()}));tn(ve)});return()=>{H(),U(),re()}},[t]),m.useEffect(()=>{const A=ps(fe(F,"adGroups",t,"recipes"),H=>{const U={};H.docs.forEach(re=>{const se=re.data()||{},ve=se.metadata||{};U[re.id]={id:re.id,...ve,components:se.components||{},copy:se.copy||"",assets:se.assets||[],type:se.type||"",selected:se.selected||!1,brandCode:se.brandCode||(e==null?void 0:e.brandCode)||""}}),E(U)});return()=>A()},[t]),m.useEffect(()=>{const A=ps(fe(F,"adGroups",t,"copyCards"),H=>{const U=H.docs.map(re=>({id:re.id,...re.data()}));Qe(U)});return()=>A()},[t]),m.useEffect(()=>{nt&&Le(de)},[nt]),m.useEffect(()=>{(async()=>{if(e!=null&&e.brandCode)try{const H=Ye(fe(F,"brands"),Je("code","==",e.brandCode)),U=await Ne(H);U.empty?s(e.brandCode):s(U.docs[0].data().name||e.brandCode)}catch(H){console.error("Failed to fetch brand name",H),s(e.brandCode)}})()},[e==null?void 0:e.brandCode]),m.useEffect(()=>{if(!wn&&!Gn)return;(async()=>{try{const H=Ye(fe(F,"users"),Je("role","==","designer")),U=await Ne(H);as(U.docs.map(re=>({id:re.id,name:re.data().fullName||re.data().email||re.id})))}catch(H){console.error("Failed to fetch designers",H),as([])}})()},[wn,Gn]),m.useEffect(()=>{let A=!1;return(async()=>{if(!(e!=null&&e.designerId)){Ur("");return}try{const U=await gn(ie(F,"users",e.designerId));A||Ur(U.exists()?U.data().fullName||U.data().email||U.id:e.designerId)}catch(U){console.error("Failed to fetch designer name",U),A||Ur(e.designerId)}})(),()=>{A=!0}},[e==null?void 0:e.designerId]),m.useEffect(()=>{e&&(ri.current={reviewed:e.reviewedCount||0,approved:e.approvedCount||0,edit:e.editCount||0,rejected:e.rejectedCount||0})},[e]),m.useEffect(()=>{if(!e)return;const A=Br(a),H=ri.current||{};if(A.reviewed!==H.reviewed||A.approved!==H.approved||A.edit!==H.edit||A.rejected!==H.rejected||!e.thumbnailUrl&&A.thumbnail){const re={reviewedCount:A.reviewed,approvedCount:A.approved,editCount:A.edit,rejectedCount:A.rejected,lastUpdated:Mt(),...e.thumbnailUrl?{}:A.thumbnail?{thumbnailUrl:A.thumbnail}:{}},se=OU(a,e.status);se!==e.status&&(re.status=se),He(ie(F,"adGroups",t),re).catch(ve=>console.error("Failed to update summary",ve)),ri.current=A,n(ve=>({...ve,...re}))}},[a,e,t]);const $=m.useMemo(()=>{const A={};a.forEach(re=>{const se=Ft(re.filename||""),ve=se.recipeCode||"unknown",we=se.aspectRatio||"",xe={...re,recipeCode:ve,aspectRatio:we};A[ve]||(A[ve]=[]),A[ve].push(xe)});const H={"":0,"3x5":1,"9x16":2,"1x1":3},U=Object.entries(A).map(([re,se])=>(se.sort((ve,we)=>{const xe=(H[ve.aspectRatio]??99)-(H[we.aspectRatio]??99);return xe!==0?xe:(ve.version||1)-(we.version||1)}),{recipeCode:re,assets:se}));return U.sort((re,se)=>Number(re.recipeCode)-Number(se.recipeCode)),U},[a]),Z=m.useMemo(()=>Object.keys(w).length,[w]),X=m.useMemo(()=>{const A=Object.keys(w);return A.sort((H,U)=>Number(H)-Number(U)),A.map(H=>({recipeNo:Number(H),components:w[H].components||{},copy:w[H].copy||"",assets:w[H].assets||[],type:w[H].type||"",selected:w[H].selected||!1,brandCode:w[H].brandCode||(e==null?void 0:e.brandCode)||""}))},[w]),oe=m.useMemo(()=>{const A={pending:0,ready:0,approved:0,rejected:0,edit_requested:0};return a.forEach(H=>{A[H.status]!==void 0&&(A[H.status]+=1)}),A},[a]);function ye(A){const H=Array.from(new Set(A.map(U=>U.status)));return H.length===1?H[0]:"mixed"}const Re=m.useMemo(()=>$.filter(A=>["rejected","edit_requested"].includes(ye(A.assets))),[$]),me=m.useMemo(()=>$.filter(A=>!["rejected","edit_requested"].includes(ye(A.assets))),[$]),We=A=>{C(H=>({...H,[A]:!H[A]}))},Rt=async A=>{try{const H=a.filter(we=>(Ft(we.filename||"").recipeCode||"unknown")===A),U=we=>{var xe;return((xe=we==null?void 0:we.toMillis)==null?void 0:xe.call(we))??(typeof we=="number"?we:0)},re=[],se=new Set;for(const we of H)(await Ne(Ye(fe(F,"adGroups",t,"assets",we.id,"history"),lo("updatedAt","desc")))).docs.forEach(lt=>{const Tt=lt.data()||{},ft=Tt.updatedBy;ft&&se.add(ft),re.push({id:lt.id,assetId:we.id,lastUpdatedAt:Tt.updatedAt,email:ft||"N/A",status:Tt.status,comment:Tt.comment||"",copyEdit:Tt.copyEdit||""})});const ve={};await Promise.all(Array.from(se).map(async we=>{try{const xe=await gn(ie(F,"users",we));ve[we]=xe.exists()&&(xe.data().fullName||xe.data().email)||we}catch{ve[we]=we}})),re.forEach(we=>{ve[we.email]&&(we.email=ve[we.email])}),re.sort((we,xe)=>U(xe.lastUpdatedAt)-U(we.lastUpdatedAt)),R({recipeCode:A,assets:re})}catch(H){console.error("Failed to load recipe history",H)}},Pt=async A=>{try{const H=await Ne(Ye(fe(F,"adGroups",t,"assets",A.id,"history"),lo("updatedAt","desc"))),U=[],re=new Set;H.docs.forEach(we=>{const xe=we.data(),lt=xe.updatedBy;lt&&re.add(lt),U.push({id:we.id,lastUpdatedAt:xe.updatedAt,email:lt||"N/A",status:xe.status,comment:xe.comment||"",copyEdit:xe.copyEdit||""})});const se={};await Promise.all(Array.from(re).map(async we=>{try{const xe=await gn(ie(F,"users",we));se[we]=xe.exists()&&(xe.data().fullName||xe.data().email)||we}catch{se[we]=we}})),U.forEach(we=>{se[we.email]&&(we.email=se[we.email])});const ve=Ft(A.filename||"");M({filename:A.filename,assetId:A.id,recipeCode:ve.recipeCode||"",assets:U})}catch(H){console.error("Failed to load ad history",H)}},wr=A=>{const H=a.filter(U=>(Ft(U.filename||"").recipeCode||"unknown")===A);x({recipeCode:A,assets:H})};m.useEffect(()=>{if(N){const A=String(N.id),H=y_(A),U=w[A]||w[A.toLowerCase()]||w[H]||N;pe({copy:U.copy||""})}},[N,w]);const Ln=()=>{R(null),M(null),x(null),D(null)},rr=async(A,H)=>{try{await mn(ie(F,"adGroups",t,"assets",A,"history",H)),R(U=>U&&{...U,assets:U.assets.filter(re=>re.id!==H)}),M(U=>U&&U.assetId===A?{...U,assets:U.assets.filter(re=>re.id!==H)}:U)}catch(U){console.error("Failed to delete history entry",U)}},Qr=async()=>{if(!(!e||!window.confirm("Reset this group to pending?")))try{const H=Id(F);a.forEach(U=>{H.update(ie(F,"adGroups",t,"assets",U.id),{status:"pending",lastUpdatedBy:null,lastUpdatedAt:Mt()})}),H.update(ie(F,"adGroups",t),{status:"pending"}),await H.commit(),o(U=>U.map(re=>({...re,status:"pending"}))),n(U=>({...U,status:"pending"}))}catch(H){console.error("Failed to reset group",H)}},sr=async()=>{var A;if(e&&window.confirm("Archive this group?"))try{await He(ie(F,"adGroups",t),{status:"archived",archivedAt:Mt(),archivedBy:((A=Fe.currentUser)==null?void 0:A.uid)||null}),n(H=>({...H,status:"archived"})),await rp({target:"adGroup",groupId:t})}catch(H){console.error("Failed to archive group",H)}},Yr=async()=>{if(e)try{await He(ie(F,"adGroups",t),{status:"pending",archivedAt:null,archivedBy:null}),n(A=>({...A,status:"pending"}))}catch(A){console.error("Failed to restore group",A)}},xt=async A=>{if(!A||A.length===0)return;if((e==null?void 0:e.status)!=="in review"&&(e==null?void 0:e.status)!=="pending")try{await He(ie(F,"adGroups",t),{status:"pending"}),n(ve=>({...ve,status:"pending"}))}catch(ve){console.error("Failed to update group status",ve)}const H=new Set(a.map(ve=>ve.filename)),U=new Set,re=[],se=[];for(const ve of Array.from(A))H.has(ve.name)||U.has(ve.name)?se.push(ve.name):(U.add(ve.name),re.push(ve));if(se.length>0&&window.alert(`Duplicate files skipped: ${se.join(", ")}`),re.length!==0){h(!0);for(const ve of re)try{const we=await lh(ve,t,r||(e==null?void 0:e.brandCode),(e==null?void 0:e.name)||t),xe=Ft(ve.name);let lt=null;if(xe.version&&xe.version>1){const Tt=m_(ve.name),ft=a.find(zt=>m_(zt.filename)===Tt);if(ft){lt=ft.parentAdId||ft.id;try{await He(ie(F,"adGroups",t,"assets",ft.id),{status:"archived"})}catch(zt){console.error("Failed to archive previous version",zt)}}}await rn(fe(F,"adGroups",t,"assets"),{adGroupId:t,brandCode:xe.brandCode||(e==null?void 0:e.brandCode)||"",adGroupCode:xe.adGroupCode||"",recipeCode:xe.recipeCode||"",aspectRatio:xe.aspectRatio||"",filename:ve.name,firebaseUrl:we,uploadedAt:Mt(),status:"pending",comment:null,lastUpdatedBy:null,lastUpdatedAt:Mt(),version:xe.version||1,parentAdId:lt,isResolved:!1})}catch(we){console.error("Upload failed",we)}h(!1)}},qn=async A=>{if(!(!A||A.length===0)){h(!0);for(const H of Array.from(A))try{const U=await lh(H,t,r||(e==null?void 0:e.brandCode),(e==null?void 0:e.name)||t);await rn(fe(F,"adGroups",t,"groupAssets"),{filename:H.name,firebaseUrl:U,uploadedAt:Mt(),note:""})}catch(U){console.error("Brief upload failed",U)}h(!1)}},On=async A=>{if(window.confirm("Delete this asset?"))try{if(await mn(ie(F,"adGroups",t,"groupAssets",A.id)),A.filename||A.firebaseUrl)try{const U=xi(ah,A.firebaseUrl||`Campfire/Brands/${r||(e==null?void 0:e.brandCode)}/Adgroups/${(e==null?void 0:e.name)||t}/${A.filename}`);await ih(U)}catch(U){console.error("Failed to delete storage file",U)}}catch(U){console.error("Failed to delete asset",U)}},Jr=async A=>{const H=window.prompt("Asset note",A.note||"");if(H!==null)try{await He(ie(F,"adGroups",t,"groupAssets",A.id),{note:H.trim()})}catch(U){console.error("Failed to update note",U)}},bn=async(A,H)=>{if(H)try{const U=await lh(H,t,r||(e==null?void 0:e.brandCode),(e==null?void 0:e.name)||t);await He(ie(F,"adGroups",t,"groupAssets",A.id),{filename:H.name,firebaseUrl:U,uploadedAt:Mt()})}catch(U){console.error("Failed to replace asset",U)}},Ss=async()=>{const A=[];for(const se of l)try{const we=await(await fetch(se.firebaseUrl)).arrayBuffer();A.push({path:se.filename,data:we})}catch(ve){console.error("Failed to download",ve)}if(A.length===0)return;const H=await Qt(A),U=URL.createObjectURL(H),re=document.createElement("a");re.href=U,re.download=`${(e==null?void 0:e.name)||"assets"}.zip`,document.body.appendChild(re),re.click(),re.remove(),URL.revokeObjectURL(U)},Be=async()=>{try{await He(ie(F,"adGroups",t),{notes:Xt}),n(A=>({...A,notes:Xt})),Lt(!1)}catch(A){console.error("Failed to save notes",A)}},Ue=async()=>{if(N)try{await Jn(ie(F,"adGroups",t,"recipes",N.id),{copy:I.copy},{merge:!0}),E(A=>({...A,[N.id]:{...A[N.id]||{id:N.id},copy:I.copy}})),D(null)}catch(A){console.error("Failed to save metadata",A)}},st=async A=>{if(!(!Array.isArray(A)||A.length===0))try{if(L&&Object.keys(w).length>0&&!window.confirm("Replace existing saved recipes with new generation?"))return;const H=Id(F),U=Object.keys(w),re=A.map(se=>String(se.recipeNo));if(U.forEach(se=>{re.includes(se)||H.delete(ie(F,"adGroups",t,"recipes",se))}),A.forEach(se=>{const ve=ie(F,"adGroups",t,"recipes",String(se.recipeNo));H.set(ve,{components:se.components,copy:se.copy,assets:se.assets||[],type:se.type||"",selected:se.selected||!1,brandCode:se.brandCode||(e==null?void 0:e.brandCode)||""},{merge:!0})}),await H.commit(),(e==null?void 0:e.status)==="pending")try{await He(ie(F,"adGroups",t),{status:"briefed"}),n(se=>({...se,status:"briefed"}))}catch(se){console.error("Failed to update group status",se)}B(!1),ne(!1)}catch(H){console.error("Failed to save recipes",H)}},Ve=async A=>{if(!(!Array.isArray(A)||A.length===0))try{if(nt&&de.length>0&&!window.confirm("Replace existing saved copy with new generation?"))return;const H=de.map(se=>se.id),U=A.map(se=>se.id).filter(Boolean),re=H.filter(se=>!U.includes(se));await Promise.all(re.map(se=>mn(ie(F,"adGroups",t,"copyCards",se)))),await Promise.all(A.map(se=>{const ve={primary:se.primary||"",headline:se.headline||"",description:se.description||""};return se.id?Jn(ie(F,"adGroups",t,"copyCards",se.id),ve,{merge:!0}):rn(fe(F,"adGroups",t,"copyCards"),ve)})),te(!1)}catch(H){console.error("Failed to save copy cards",H)}},Ze=async(A,H)=>{var U,re;try{await He(ie(F,"adGroups",t,"assets",A),{status:H});const se=a.find(ve=>ve.id===A);if(H==="ready"&&(se!=null&&se.parentAdId)&&await He(ie(F,"adGroups",t,"assets",se.parentAdId),{status:"archived"}),se){const we=Ft(se.filename||"").recipeCode||"unknown",xe=((U=Fe.currentUser)==null?void 0:U.displayName)||((re=Fe.currentUser)==null?void 0:re.uid)||"unknown";await rn(fe(F,"adGroups",t,"assets",A,"history"),{status:H,updatedBy:xe,updatedAt:Mt()}).catch(lt=>{if((lt==null?void 0:lt.code)==="already-exists")console.log("History entry already exists, skipping");else throw lt}),await Jn(ie(F,"recipes",we),{history:Pg({timestamp:Date.now(),status:H,user:xe})},{merge:!0})}}catch(se){console.error("Failed to update asset status",se)}},Et=async(A,H)=>{try{await He(ie(F,"adGroups",t,"recipes",String(A)),{selected:H}),E(U=>({...U,[A]:{...U[A]||{},selected:H}}))}catch(U){console.error("Failed to update selection",U)}},Dt=async(A,H,U="")=>{var we,xe,lt,Tt;const re=a.filter(ft=>(Ft(ft.filename||"").recipeCode||"unknown")===A);if(re.length===0)return;const se=LU(re),ve=Id(F);re.forEach(ft=>{var zt;ve.update(ie(F,"adGroups",t,"assets",ft.id),{status:H,lastUpdatedBy:((zt=Fe.currentUser)==null?void 0:zt.uid)||null,lastUpdatedAt:Mt()})});try{if(await ve.commit(),se){const ft=((we=Fe.currentUser)==null?void 0:we.displayName)||((xe=Fe.currentUser)==null?void 0:xe.uid)||"unknown";await rn(fe(F,"adGroups",t,"assets",se.id,"history"),{status:H,updatedBy:ft,updatedAt:Mt()}).catch(zt=>{if((zt==null?void 0:zt.code)==="already-exists")console.log("History entry already exists, skipping");else throw zt})}await Jn(ie(F,"recipes",A),{history:Pg({timestamp:Date.now(),status:H,user:((lt=Fe.currentUser)==null?void 0:lt.displayName)||((Tt=Fe.currentUser)==null?void 0:Tt.uid)||"unknown",...U?{editComment:U}:{}})},{merge:!0}),o(ft=>ft.map(zt=>re.some(Sn=>Sn.id===zt.id)?{...zt,status:H}:zt))}catch(ft){console.error("Failed to update recipe status",ft)}},an=async()=>{p(!0);try{const A=Id(F),H=a.filter(U=>U.status==="pending");for(const U of H)A.update(ie(F,"adGroups",t,"assets",U.id),{status:"ready",lastUpdatedBy:null,lastUpdatedAt:Mt()});A.update(ie(F,"adGroups",t),{status:"ready"}),await A.commit(),H.length>0&&o(U=>U.map(re=>H.some(se=>se.id===re.id)?{...re,status:"ready"}:re))}catch(A){console.error("Failed to mark ready",A)}finally{p(!1)}},[fn,ir]=m.useState(!1),_n=()=>{ir(!0)},ar=A=>(A||"").replace(/[\\/:*?"<>|]/g,"").replace(/\s+/g," ").trim()||"unknown",Ce=()=>{const A=a.filter(U=>U.status==="approved"),H={};return A.forEach(U=>{const re=Ft(U.filename||""),se=U.recipeCode||re.recipeCode,ve=w[se]||{},xe=J.map(lt=>ar(ve[lt])).join("|");H[xe]||(H[xe]=[]),H[xe].push({asset:U,meta:ve})}),Object.values(H)};m.useEffect(()=>{if(!Xe)return;const A=Ce();q(A.length)},[Xe,J,z,a,w]);const wt=m.useMemo(()=>{const A=new Uint32Array(256);for(let H=0;H<256;H+=1){let U=H;for(let re=0;re<8;re+=1)U=U&1?3988292384^U>>>1:U>>>1;A[H]=U>>>0}return A},[]),Se=A=>{let H=4294967295;for(let U=0;U<A.length;U+=1)H=wt[(H^A[U])&255]^H>>>8;return(H^4294967295)>>>0},Qt=async A=>{const H=new TextEncoder,U=[],re=[];let se=0;for(const Sn of A){const lr=H.encode(Sn.path),cr=new Uint8Array(Sn.data),Do=Se(cr),ki=new Uint8Array(30+lr.length),W=new DataView(ki.buffer);W.setUint32(0,67324752,!0),W.setUint16(4,20,!0),W.setUint16(6,0,!0),W.setUint16(8,0,!0),W.setUint16(10,0,!0),W.setUint16(12,0,!0),W.setUint32(14,Do,!0),W.setUint32(18,cr.length,!0),W.setUint32(22,cr.length,!0),W.setUint16(26,lr.length,!0),W.setUint16(28,0,!0),ki.set(lr,30),U.push(ki,cr);const he=new Uint8Array(46+lr.length),le=new DataView(he.buffer);le.setUint32(0,33639248,!0),le.setUint16(4,20,!0),le.setUint16(6,20,!0),le.setUint16(8,0,!0),le.setUint16(10,0,!0),le.setUint16(12,0,!0),le.setUint16(14,0,!0),le.setUint32(16,Do,!0),le.setUint32(20,cr.length,!0),le.setUint32(24,cr.length,!0),le.setUint16(28,lr.length,!0),le.setUint16(30,0,!0),le.setUint16(32,0,!0),le.setUint16(34,0,!0),le.setUint16(36,0,!0),le.setUint32(38,0,!0),le.setUint32(42,se,!0),he.set(lr,46),re.push(he),se+=ki.length+cr.length}const ve=se,we=re.reduce((Sn,lr)=>Sn+lr.length,0),xe=new Uint8Array(22),lt=new DataView(xe.buffer);lt.setUint32(0,101010256,!0),lt.setUint16(8,A.length,!0),lt.setUint16(10,A.length,!0),lt.setUint32(12,we,!0),lt.setUint32(16,ve,!0),lt.setUint16(20,0,!0);const Tt=U.reduce((Sn,lr)=>Sn+lr.length,0)+we+xe.length,ft=new Uint8Array(Tt);let zt=0;for(const Sn of U)ft.set(Sn,zt),zt+=Sn.length;for(const Sn of re)ft.set(Sn,zt),zt+=Sn.length;return ft.set(xe,zt),new Blob([ft],{type:"application/zip"})},on=async()=>{Ee(!0);try{const A=Ce(),H=[];for(const ve of A){if(ve.length===0)continue;const we=ve[0].meta,xe=J.map(Tt=>ar(we[Tt])).join("-")||"group",lt=ve.slice(0,z);for(const{asset:Tt}of lt){const zt=await(await fetch(Tt.firebaseUrl)).arrayBuffer();H.push({path:`${xe}/${Tt.filename}`,data:zt})}}if(H.length===0){window.alert("No approved ads found");return}const U=await Qt(H),re=URL.createObjectURL(U),se=document.createElement("a");se.href=re,se.download=`${(e==null?void 0:e.name)||"export"}.zip`,document.body.appendChild(se),se.click(),se.remove(),URL.revokeObjectURL(re),Ae(!1)}catch(A){console.error("Export failed",A),window.alert("Export failed")}finally{Ee(!1)}},Ot=async A=>{if(window.confirm("Delete this asset?"))try{await mn(ie(F,"adGroups",t,"assets",A.id));try{await mn(ie(F,"adAssets",A.id))}catch{}if(A.filename||A.firebaseUrl)try{const U=xi(ah,A.firebaseUrl||`Campfire/Brands/${r||(e==null?void 0:e.brandCode)}/Adgroups/${(e==null?void 0:e.name)||t}/${A.filename}`);await ih(U)}catch(U){console.error("Failed to delete storage file",U)}o(U=>U.filter(re=>re.id!==A.id))}catch(U){console.error("Failed to delete asset",U)}},Wn=async A=>{if(!window.confirm("Delete this recipe and all assets?"))return;const U=a.filter(re=>(Ft(re.filename||"").recipeCode||"unknown")===A);try{await Promise.all(U.map(async re=>{await mn(ie(F,"adGroups",t,"assets",re.id));try{await mn(ie(F,"adAssets",re.id))}catch{}if(re.filename||re.firebaseUrl)try{const se=xi(ah,re.firebaseUrl||`Campfire/Brands/${r||(e==null?void 0:e.brandCode)}/Adgroups/${(e==null?void 0:e.name)||t}/${re.filename}`);await ih(se)}catch(se){console.error("Failed to delete storage file",se)}})),o(re=>re.filter(se=>!U.some(ve=>ve.id===se.id)))}catch(re){console.error("Failed to delete recipe assets",re)}},or=A=>{var H;return i.jsx("tbody",{className:"table-row-group",children:i.jsxs("tr",{onClick:()=>We(A.recipeCode),className:"cursor-pointer recipe-row",children:[i.jsxs("td",{colSpan:"2",className:"font-semibold relative",children:["Recipe ",A.recipeCode,i.jsx("div",{className:`asset-panel absolute left-0 w-full ${T[A.recipeCode]?"open":""}`,children:i.jsx("div",{className:"overflow-x-auto table-container",children:i.jsx("table",{className:"ad-table min-w-max w-full",children:i.jsx("tbody",{children:A.assets.map(U=>i.jsxs("tr",{className:"asset-row",children:[i.jsx("td",{className:"break-all",children:U.filename}),i.jsx("td",{className:"text-center",children:U.version||1}),i.jsx("td",{className:"text-center",children:i.jsxs("div",{className:"flex flex-col items-center",children:[wn?i.jsxs("select",{className:`status-select status-${U.status}`,value:U.status,onChange:re=>{re.stopPropagation(),Ze(U.id,re.target.value)},children:[i.jsx("option",{value:"pending",children:"pending"}),i.jsx("option",{value:"ready",children:"ready"}),i.jsx("option",{value:"approved",children:"approved"}),i.jsx("option",{value:"rejected",children:"rejected"}),i.jsx("option",{value:"edit_requested",children:"edit_requested"}),i.jsx("option",{value:"archived",children:"archived"})]}):i.jsx(Ca,{status:U.status}),U.status==="edit_requested"&&U.comment&&i.jsx("span",{className:"italic text-xs",children:U.comment}),U.status==="edit_requested"&&nr(A.recipeCode,U.copyEdit)&&i.jsxs("span",{className:"italic text-xs",children:["copy edit:"," ",nr(A.recipeCode,U.copyEdit)]})]})}),i.jsx("td",{className:"text-center",children:i.jsxs("div",{className:"flex items-center justify-center gap-2",children:[i.jsx(be,{onClick:re=>{re.stopPropagation(),Pt(U)},"aria-label":"History",className:"px-1.5 text-xs",children:i.jsx(r_,{})}),i.jsx(be,{onClick:re=>{re.stopPropagation(),Ot(U)},"aria-label":"Delete",children:i.jsx(qt,{})})]})})]},U.id))})})})})]}),i.jsxs("td",{className:"flex flex-col",children:[St==="designer"||St==="client"?ye(A.assets)==="pending"?i.jsxs("select",{className:"status-select status-pending",value:"pending",onChange:U=>{U.stopPropagation(),Dt(A.recipeCode,U.target.value)},children:[i.jsx("option",{value:"pending",children:"pending"}),i.jsx("option",{value:"ready",children:"ready"})]}):i.jsx(Ca,{status:ye(A.assets)}):i.jsxs("select",{className:`status-select status-${ye(A.assets)}`,value:ye(A.assets),onChange:U=>{U.stopPropagation(),Dt(A.recipeCode,U.target.value)},children:[i.jsx("option",{value:"pending",children:"pending"}),i.jsx("option",{value:"ready",children:"ready"}),i.jsx("option",{value:"approved",children:"approved"}),i.jsx("option",{value:"rejected",children:"rejected"}),i.jsx("option",{value:"edit_requested",children:"edit_requested"}),i.jsx("option",{value:"archived",children:"archived"}),i.jsx("option",{value:"mixed",disabled:!0,children:"mixed"})]}),A.assets.find(U=>U.status==="edit_requested"&&U.comment)&&i.jsx("span",{className:"italic text-xs mt-1 max-w-[20rem] block",children:(H=A.assets.find(U=>U.status==="edit_requested"&&U.comment))==null?void 0:H.comment}),(()=>{const U=A.assets.find(re=>re.status==="edit_requested"&&re.copyEdit);return U&&nr(A.recipeCode,U.copyEdit)&&i.jsxs("span",{className:"italic text-xs mt-1 max-w-[20rem] block",children:["copy edit: ",nr(A.recipeCode,U.copyEdit)]})})()]}),i.jsx("td",{className:"text-center",children:i.jsxs("div",{className:"flex items-center justify-center",children:[i.jsxs(be,{onClick:U=>{U.stopPropagation(),wr(A.recipeCode)},"aria-label":"View",className:"px-1.5 text-xs mr-2",children:[i.jsx(Wi,{}),i.jsx("span",{className:"ml-1",children:"View"})]}),i.jsxs(be,{onClick:U=>{U.stopPropagation(),Rt(A.recipeCode)},"aria-label":"History",className:"px-1.5 text-xs mr-2",children:[i.jsx(r_,{}),i.jsx("span",{className:"ml-1",children:"History"})]}),St==="admin"&&i.jsxs(be,{onClick:U=>{U.stopPropagation();const re=A.recipeCode,se=y_(re);D(w[re]||w[String(re).toLowerCase()]||w[se]||{id:re})},"aria-label":"Metadata",className:"px-1.5 text-xs mr-2",children:[i.jsx(n_,{}),i.jsx("span",{className:"ml-1",children:"Metadata"})]}),i.jsx(be,{onClick:U=>{U.stopPropagation(),Wn(A.recipeCode)},className:"text-xs","aria-label":"Delete",children:i.jsx(qt,{})})]})})]})},A.recipeCode)};return e?i.jsxs("div",{className:"min-h-screen p-4 ",children:[i.jsxs("div",{className:"flex items-center mb-2",children:[i.jsx($n,{to:os,className:"btn-arrow mr-2","aria-label":"Back",children:"<"}),i.jsx("h1",{className:"text-2xl mb-0",children:e.name})]}),i.jsxs("p",{className:"text-sm text-gray-500 flex flex-wrap items-center gap-2",children:["Brand: ",e.brandCode,i.jsx("span",{className:"hidden sm:inline",children:"|"}),"Status: ",i.jsx(Ca,{status:e.status}),i.jsx("span",{className:"hidden sm:inline",children:"|"}),"Due Date:",St==="admin"||St==="agency"?i.jsx("input",{type:"date",value:e.dueDate?e.dueDate.toDate().toISOString().slice(0,10):"",onChange:async A=>{const H=A.target.value?sn.fromDate(new Date(A.target.value)):null;try{await He(ie(F,"adGroups",t),{dueDate:H}),n(U=>({...U,dueDate:H}))}catch(U){console.error("Failed to update due date",U)}},className:"border p-1 rounded"}):i.jsx("span",{children:e.dueDate?e.dueDate.toDate().toLocaleDateString():"N/A"}),i.jsx("span",{className:"hidden sm:inline",children:"|"}),"Designer:",wn||Gn?i.jsxs("select",{value:e.designerId||"",onChange:async A=>{const H=A.target.value||null;try{await He(ie(F,"adGroups",t),{designerId:H}),n(U=>({...U,designerId:H}))}catch(U){console.error("Failed to update designer",U)}},className:"border p-1 rounded",children:[i.jsx("option",{value:"",children:"Unassigned"}),xn.map(A=>i.jsx("option",{value:A.id,children:A.name},A.id))]}):i.jsx("span",{children:tr||"Unassigned"})]}),e.status==="archived"&&i.jsx("p",{className:"text-red-500 text-sm mb-2",children:"This ad group is archived and read-only."}),i.jsxs("div",{className:"text-sm text-gray-500 mb-4 flex flex-wrap items-center justify-between",children:[i.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.jsxs(_t,{active:ze==="stats",onClick:()=>it("stats"),children:[i.jsx(XV,{size:18}),"Stats"]}),i.jsxs(_t,{active:ze==="brief",onClick:()=>it("brief"),children:[i.jsx(Ll,{size:18}),"Brief"]}),(wn||Gn)&&i.jsxs(_t,{active:ze==="copy",onClick:()=>it("copy"),children:[i.jsx(Nu,{size:18}),"Platform Copy"]}),i.jsxs(_t,{active:ze==="assets",onClick:()=>it("assets"),children:[i.jsx(gS,{size:18}),"Brand Assets"]}),i.jsxs(_t,{active:ze==="ads",onClick:()=>it("ads"),children:[i.jsx(Wi,{size:18}),"Ads"]})]}),(wn||St==="agency"||qe)&&i.jsx(i.Fragment,{children:e.status==="archived"?i.jsx("div",{className:"flex flex-wrap gap-2",children:wn&&i.jsx(be,{onClick:Yr,"aria-label":"Restore Group",className:"bg-transparent",children:i.jsx(np,{size:20})})}):i.jsxs("div",{className:"flex flex-wrap gap-2",children:[ze==="ads"&&e.status!=="archived"&&i.jsxs(i.Fragment,{children:[i.jsx("input",{id:"upload-input",type:"file",multiple:!0,onChange:A=>{const H=A.target.files;xt(H),A.target.value=null},className:"hidden"}),i.jsxs(be,{onClick:()=>document.getElementById("upload-input").click(),className:"bg-transparent",children:[i.jsx(kc,{size:20}),"Upload"]})]}),(wn||St==="agency")&&i.jsxs(i.Fragment,{children:[i.jsx(be,{onClick:Qr,"aria-label":"Reset",className:"bg-transparent",children:i.jsx(vS,{size:20})}),i.jsx(be,{onClick:an,disabled:f||a.length===0||e.status==="ready"||e.status==="in review",className:"bg-transparent","aria-label":"Ready",children:i.jsx(Cu,{size:20})}),i.jsx(be,{as:$n,to:`/review/${t}`,"aria-label":"Review",className:"bg-transparent",children:i.jsx(n_,{size:20})}),i.jsx(be,{onClick:_n,"aria-label":"Share",className:"bg-transparent",children:i.jsx(cU,{size:20})}),(wn||Gn)&&i.jsxs(i.Fragment,{children:[i.jsx(be,{onClick:()=>Ae(!0),"aria-label":"Export Approved",className:"bg-transparent",children:i.jsx(s_,{size:20})}),i.jsx(be,{onClick:sr,"aria-label":"Archive",className:"bg-transparent",children:i.jsx(Ks,{size:20})})]})]})]})})]}),d&&i.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Uploading..."}),Cs&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex flex-wrap justify-center gap-4 mb-4",children:[i.jsxs("div",{className:"stat-card",children:[i.jsx("p",{className:"stat-card-title",children:"Recipes"}),i.jsx("p",{className:"stat-card-value",children:Z})]}),i.jsxs("div",{className:"stat-card",children:[i.jsx("p",{className:"stat-card-title",children:"Total Ads"}),i.jsx("p",{className:"stat-card-value",children:a.length})]})]}),i.jsxs("div",{className:"flex flex-wrap justify-center gap-4 mb-4",children:[i.jsxs("div",{className:"stat-card status-pending",children:[i.jsx("p",{className:"stat-card-title",children:"Pending"}),i.jsx("p",{className:"stat-card-value",children:oe.pending})]}),i.jsxs("div",{className:"stat-card status-ready",children:[i.jsx("p",{className:"stat-card-title",children:"Ready"}),i.jsx("p",{className:"stat-card-value",children:oe.ready})]}),i.jsxs("div",{className:"stat-card status-approved",children:[i.jsx("p",{className:"stat-card-title",children:"Approved"}),i.jsx("p",{className:"stat-card-value",children:oe.approved})]}),i.jsxs("div",{className:"stat-card status-rejected",children:[i.jsx("p",{className:"stat-card-title",children:"Rejected"}),i.jsx("p",{className:"stat-card-value",children:oe.rejected})]}),i.jsxs("div",{className:"stat-card status-edit_requested",children:[i.jsx("p",{className:"stat-card-title",children:"Edit"}),i.jsx("p",{className:"stat-card-value",children:oe.edit_requested})]})]})]}),(Hn||Cs&&Re.length>0)&&i.jsx("div",{className:"overflow-x-auto table-container",children:i.jsxs("table",{className:"ad-table min-w-max",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Filename"}),i.jsx("th",{children:"Version"}),i.jsx("th",{children:"Status"}),i.jsx("th",{children:"Actions"})]})}),(Hn?[...Re,...me]:Cs?Re:[]).map(A=>or(A))]})}),i.jsxs("div",{className:"flex my-4",children:[!Dn&&i.jsxs(i.Fragment,{children:[i.jsx(be,{onClick:()=>y(A=>!A),children:j?"Hide Table":"Show All Ads"}),X.length>0&&i.jsx(be,{onClick:()=>ne(A=>!A),className:"ml-2",children:G?"Hide Brief":"See Brief"})]}),Dn&&ze==="ads"&&e.status!=="archived"&&i.jsxs("button",{onClick:()=>document.getElementById("upload-input").click(),className:"btn-primary px-2 py-0.5 flex items-center gap-1 ml-2",children:[i.jsx(kc,{}),"Upload Ads"]})]}),ze==="ads"&&Vr.length>0&&i.jsxs("div",{className:"my-4",children:[i.jsx("h4",{className:"font-medium mb-1",children:"Responses"}),i.jsx("ul",{className:"space-y-2",children:Vr.map(A=>i.jsxs("li",{className:"border p-2 rounded bg-white shadow dark:bg-[var(--dark-sidebar-bg)] dark:text-[var(--dark-text)]",children:[i.jsx("div",{className:"text-sm font-medium capitalize",children:A.response}),A.comment&&i.jsx("div",{className:"text-sm italic",children:A.comment}),A.copyEdit&&i.jsxs("div",{className:"text-sm italic",children:["copy edit: ",A.copyEdit]}),i.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[A.timestamp?A.timestamp.toDate?A.timestamp.toDate().toLocaleString():new Date(A.timestamp).toLocaleString():""," ","- ",A.reviewerName||A.userEmail||A.userId||""]})]},A.id))})]}),Ei&&i.jsxs("div",{className:"my-4",children:[St==="admin"?jt?i.jsxs(i.Fragment,{children:[i.jsx("h4",{className:"font-medium mb-1",children:"Brief Note:"}),i.jsxs("div",{className:"mb-4",children:[i.jsx("textarea",{className:"w-full border rounded p-2",rows:3,value:Xt,onChange:A=>Cn(A.target.value)}),i.jsxs("div",{className:"flex gap-2 mt-1",children:[i.jsx("button",{onClick:Be,className:"btn-primary px-2 py-0.5",children:"Save"}),i.jsx(be,{onClick:()=>Lt(!1),children:"Cancel"})]})]})]}):i.jsxs(i.Fragment,{children:[i.jsx("h4",{className:"font-medium mb-1",children:"Brief Note:"}),i.jsxs("div",{style:{outline:"1px solid var(--border-color-default, #d1d5db)"},className:"mb-4 whitespace-pre-line p-2 bg-white shadow rounded relative dark:bg-[var(--dark-sidebar-bg)] dark:text-[var(--dark-text)]",children:[i.jsx("button",{onClick:()=>{Cn((e==null?void 0:e.notes)||""),Lt(!0)},className:"absolute top-1 right-1 btn-secondary px-1 py-0.5 text-xs",children:"Edit"}),e==null?void 0:e.notes]})]}):(e==null?void 0:e.notes)&&i.jsxs(i.Fragment,{children:[i.jsx("h4",{className:"font-medium mb-1",children:"Brief Note:"}),i.jsx("div",{style:{outline:"1px solid var(--border-color-default, #d1d5db)"},className:"mb-4 whitespace-pre-line p-2 bg-white shadow rounded dark:bg-[var(--dark-sidebar-bg)] dark:text-[var(--dark-text)]",children:e.notes})]}),St==="admin"&&!(e!=null&&e.notes)&&!jt&&i.jsx("div",{className:"mb-4",children:i.jsx(be,{onClick:()=>{Cn(""),Lt(!0)},children:"Add Note"})}),l.length>0&&i.jsxs(i.Fragment,{children:[i.jsx("h4",{className:"font-medium mb-1",children:"Brief Assets:"}),i.jsxs("div",{style:{outline:"1px solid var(--border-color-default, #d1d5db)"},className:`flex flex-wrap gap-2 mb-4 p-2 bg-white shadow rounded relative ${xr?"bg-accent-10":""} dark:bg-[var(--dark-sidebar-bg)]`,onDragOver:A=>{A.preventDefault(),zn(!0)},onDragLeave:()=>zn(!1),onDrop:A=>{A.preventDefault(),zn(!1),qn(A.dataTransfer.files)},children:[i.jsxs("div",{className:"w-full flex justify-between mb-2",children:[i.jsxs(be,{onClick:Ss,children:[i.jsx(s_,{}),"Download All"]}),St==="admin"&&i.jsxs(i.Fragment,{children:[i.jsx("input",{id:"brief-upload",type:"file",multiple:!0,onChange:A=>{qn(A.target.files),A.target.value=null},className:"hidden"}),i.jsxs(be,{onClick:()=>document.getElementById("brief-upload").click(),children:[i.jsx(kc,{}),"Upload"]})]})]}),l.map(A=>i.jsxs("div",{className:"asset-card group cursor-pointer",children:[(()=>{const H=FU(A.filename||"");if(A.firebaseUrl&&H==="svg"){const U=i.jsx("img",{src:A.firebaseUrl,alt:A.filename,className:"object-contain max-w-[10rem] max-h-32"});return i.jsx("a",{href:A.firebaseUrl,download:!0,children:U})}if(A.firebaseUrl&&!["ai","pdf"].includes(H)&&!["otf","ttf","woff","woff2"].includes(H)){const U=i.jsx(Pn,{pngUrl:A.firebaseUrl,alt:A.filename,className:"object-contain max-w-[10rem] max-h-32"});return i.jsx("a",{href:A.firebaseUrl,download:!0,children:U})}return i.jsx("a",{href:A.firebaseUrl,download:!0,children:i.jsx(VU,{ext:H})})})(),A.note&&i.jsx("div",{className:"absolute bottom-1 right-1 bg-accent text-white rounded-full p-1",children:i.jsx(Ll,{size:14})}),St==="admin"&&i.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-60 hidden group-hover:flex flex-col items-center justify-center gap-1 text-white text-xs",children:[i.jsx("a",{href:A.firebaseUrl,download:!0,className:"btn-secondary px-1 py-0.5",children:"Download"}),i.jsxs("label",{className:"btn-secondary px-1 py-0.5 cursor-pointer",children:["Replace",i.jsx("input",{type:"file",className:"hidden",onChange:H=>{bn(A,H.target.files[0]),H.target.value=null}})]}),i.jsx("button",{onClick:()=>Jr(A),className:"btn-secondary px-1 py-0.5",children:"Note"}),i.jsx("button",{onClick:()=>On(A),className:"btn-delete px-1 py-0.5",children:"Delete"})]}),St==="designer"&&A.note&&i.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-60 hidden group-hover:flex items-center justify-center text-white text-xs p-1 text-center whitespace-pre-wrap",children:A.note})]},A.id))]})]}),St==="admin"&&l.length===0&&i.jsxs("div",{className:"mb-4",children:[i.jsx("input",{id:"brief-upload",type:"file",multiple:!0,onChange:A=>{qn(A.target.files),A.target.value=null},className:"hidden"}),i.jsxs(be,{onClick:()=>document.getElementById("brief-upload").click(),children:[i.jsx(kc,{})," Add Assets"]})]}),X.length>0&&i.jsx(Bg,{onSave:st,initialResults:X,showOnlyResults:!0,onSelectChange:Et,onRecipesClick:()=>B(!0)}),St==="admin"&&X.length===0&&i.jsx("div",{className:"mt-4",children:i.jsxs(be,{onClick:()=>B(!0),children:[i.jsx(Ug,{})," Recipes"]})})]}),(wn||Gn)&&ze==="copy"&&i.jsx("div",{className:"my-4",children:de.length>0?i.jsx(Tu,{onSave:Ve,initialResults:de,showOnlyResults:!0,onCopyClick:()=>te(!0),brandCode:e==null?void 0:e.brandCode,hideBrandSelect:!0}):i.jsx("div",{className:"mt-4",children:i.jsxs(be,{onClick:()=>te(!0),children:[i.jsx(Nu,{})," Platform Copy"]})})}),b&&i.jsxs(Hs,{sizeClass:"max-w-md",children:[i.jsxs("h3",{className:"mb-2 font-semibold",children:["Recipe ",b.recipeCode]}),i.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-[60vh] overflow-auto",children:b.assets.map(A=>i.jsx(Pn,{pngUrl:A.thumbnailUrl||A.firebaseUrl,alt:A.filename,className:"w-full object-contain max-h-40"},A.id))}),i.jsx("button",{onClick:Ln,className:"mt-2 btn-primary px-3 py-1",children:"Close"})]}),v&&i.jsxs(Hs,{sizeClass:"max-w-md",children:[i.jsxs("h3",{className:"mb-2 font-semibold",children:["Recipe ",v.recipeCode," History"]}),i.jsx("ul",{className:"mb-2 space-y-2 max-h-[60vh] overflow-auto",children:v.assets.map((A,H)=>i.jsxs("li",{className:"border-b pb-2 last:border-none flex justify-between items-start",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"text-sm font-medium",children:[A.lastUpdatedAt?A.lastUpdatedAt.toDate?A.lastUpdatedAt.toDate().toLocaleString():new Date(A.lastUpdatedAt).toLocaleString():""," ","- ",A.email]}),i.jsxs("div",{className:"text-sm",children:["Status: ",A.status]}),A.comment&&i.jsxs("div",{className:"text-sm italic",children:["Note: ",A.comment]}),(()=>{const U=nr(v.recipeCode,A.copyEdit);return U?i.jsxs("div",{className:"text-sm italic",children:["Edit Request: ",U]}):null})()]}),wn&&i.jsx(be,{onClick:()=>rr(A.assetId,A.id),"aria-label":"Delete",children:i.jsx(qt,{})})]},H))}),i.jsx("button",{onClick:Ln,className:"btn-primary px-3 py-1",children:"Close"})]}),O&&i.jsxs(Hs,{sizeClass:"max-w-md",children:[i.jsxs("h3",{className:"mb-2 font-semibold",children:["Ad ",O.filename," History"]}),i.jsx("ul",{className:"mb-2 space-y-2 max-h-[60vh] overflow-auto",children:O.assets.map((A,H)=>i.jsxs("li",{className:"border-b pb-2 last:border-none flex justify-between items-start",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"text-sm font-medium",children:[A.lastUpdatedAt?A.lastUpdatedAt.toDate?A.lastUpdatedAt.toDate().toLocaleString():new Date(A.lastUpdatedAt).toLocaleString():""," ","- ",A.email]}),i.jsxs("div",{className:"text-sm",children:["Status: ",A.status]}),A.comment&&i.jsxs("div",{className:"text-sm italic",children:["Note: ",A.comment]}),(()=>{const U=nr(O.recipeCode,A.copyEdit);return U?i.jsxs("div",{className:"text-sm italic",children:["Edit Request: ",U]}):null})()]}),wn&&i.jsx(be,{onClick:()=>rr(O.assetId,A.id),"aria-label":"Delete",children:i.jsx(qt,{})})]},H))}),i.jsx("button",{onClick:Ln,className:"btn-primary px-3 py-1",children:"Close"})]}),N&&i.jsxs(Hs,{sizeClass:"max-w-sm",children:[i.jsxs("h3",{className:"mb-2 font-semibold",children:["Metadata for Recipe ",N.id]}),i.jsxs("div",{className:"space-y-2",children:[N.components&&i.jsx("div",{className:"text-sm",children:Object.entries(N.components).map(([A,H])=>i.jsxs("div",{children:[i.jsxs("span",{className:"font-semibold mr-1",children:[A,":"]}),typeof H=="object"&&H!==null?JSON.stringify(H):String(H)]},A))}),i.jsxs("label",{className:"block text-sm",children:["Copy",i.jsx("textarea",{className:"mt-1 w-full border rounded p-1 text-black dark:text-black",value:I.copy,onChange:A=>pe({...I,copy:A.target.value})})]})]}),i.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[i.jsx(be,{onClick:Ln,children:"Cancel"}),i.jsx("button",{onClick:Ue,className:"btn-primary px-3 py-1",children:"Save"})]})]}),Xe&&i.jsxs(Hs,{sizeClass:"max-w-sm w-full",children:[i.jsx("h3",{className:"mb-2 font-semibold",children:"Export Approved Ads"}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium mb-1",children:"Group By"}),i.jsxs("label",{className:"mr-2 text-sm",children:[i.jsx("input",{type:"checkbox",className:"mr-1",checked:J.includes("offer"),onChange:A=>{A.target.checked?K(H=>[...H,"offer"]):K(H=>H.filter(U=>U!=="offer"))}}),"Offer"]}),i.jsxs("label",{className:"mr-2 text-sm",children:[i.jsx("input",{type:"checkbox",className:"mr-1",checked:J.includes("angle"),onChange:A=>{A.target.checked?K(H=>[...H,"angle"]):K(H=>H.filter(U=>U!=="angle"))}}),"Angle"]}),i.jsxs("label",{className:"text-sm",children:[i.jsx("input",{type:"checkbox",className:"mr-1",checked:J.includes("audience"),onChange:A=>{A.target.checked?K(H=>[...H,"audience"]):K(H=>H.filter(U=>U!=="audience"))}}),"Audience"]})]}),i.jsxs("label",{className:"block text-sm",children:["Max Ads per Group",i.jsxs("select",{className:"mt-1 w-full border rounded p-1 text-black dark:text-black",value:z,onChange:A=>Y(Number(A.target.value)),children:[i.jsx("option",{value:1,children:"1"}),i.jsx("option",{value:2,children:"2"}),i.jsx("option",{value:3,children:"3"})]})]}),i.jsxs("p",{className:"text-sm",children:["Preview Groups: ",V]})]}),i.jsxs("div",{className:"mt-3 flex justify-end gap-2",children:[i.jsx(be,{onClick:()=>Ae(!1),children:"Cancel"}),i.jsx("button",{onClick:on,disabled:ae,className:"btn-primary px-3 py-1",children:ae?"Exporting...":"Export"})]})]}),L&&i.jsxs(Hs,{sizeClass:"max-w-[50rem] w-full overflow-auto max-h-[90vh] relative",children:[i.jsx(be,{onClick:()=>B(!1),className:"absolute top-2 right-2",children:"Close"}),i.jsx(Bg,{onSave:st,brandCode:e==null?void 0:e.brandCode,hideBrandSelect:!0})]}),nt&&i.jsxs(Hs,{sizeClass:"max-w-[50rem] w-full max-h-[90vh] flex flex-col",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("h2",{className:"text-lg font-semibold",children:"Platform Copy"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{onClick:()=>Ve(je),className:`btn-primary px-3 py-1 ${ls?"":"opacity-50 cursor-not-allowed"}`,disabled:!ls,children:"Save"}),i.jsx(be,{onClick:()=>te(!1),children:"Close"})]})]}),i.jsx("p",{className:"text-sm mb-2",children:"These lines appear as the primary text, headline, and description on your Meta ads. Feel free to tweak or remove any of the options."}),i.jsx("div",{className:"overflow-auto flex-1",children:i.jsx(Tu,{onSave:Ve,brandCode:e==null?void 0:e.brandCode,hideBrandSelect:!0,onCopiesChange:Le})})]}),fn&&i.jsx(Xu,{groupId:t,visibility:e==null?void 0:e.visibility,requireAuth:e==null?void 0:e.requireAuth,requirePassword:e==null?void 0:e.requirePassword,password:e==null?void 0:e.password,onClose:()=>ir(!1),onUpdate:A=>n(H=>({...H,...A}))}),Dn?ze==="assets"&&i.jsx(f_,{brandCode:e==null?void 0:e.brandCode,inline:!0}):mt&&i.jsx(f_,{brandCode:e==null?void 0:e.brandCode,onClose:()=>Ct(!1)})]}):i.jsx(ec,{})},ko=({group:t,onReview:e,onShare:n,onRename:r,onArchive:s,onRestore:a,onDelete:o})=>{const[l,c]=m.useState(!1),d=(h,f)=>{h.preventDefault(),h.stopPropagation(),c(!1),f&&f()};return i.jsxs("div",{className:"relative bg-white dark:bg-[var(--dark-sidebar-bg)] border border-gray-300 dark:border-gray-600 rounded-lg text-inherit shadow-md w-full",children:[i.jsx(be,{onClick:h=>{h.preventDefault(),h.stopPropagation(),c(f=>!f)},className:"absolute top-1 right-1 bg-transparent hover:bg-gray-100 dark:hover:bg-[var(--dark-sidebar-hover)]","aria-label":"Menu",children:i.jsx(yS,{})}),l&&i.jsxs("div",{className:"absolute right-1 top-7 z-10 bg-white dark:bg-[var(--dark-sidebar-bg)] border border-gray-300 dark:border-gray-600 rounded shadow text-sm",children:[i.jsxs($n,{to:`/ad-group/${t.id}`,onClick:()=>c(!1),className:"block w-full text-left px-3 py-1 hover:bg-gray-100 dark:hover:bg-[var(--dark-sidebar-hover)] flex items-center gap-1",children:[i.jsx(Wi,{})," View Details"]}),e&&i.jsxs("button",{onClick:h=>d(h,e),className:"block w-full text-left px-3 py-1 hover:bg-gray-100 dark:hover:bg-[var(--dark-sidebar-hover)] flex items-center gap-1",children:[i.jsx(Cu,{})," Review"]}),n&&i.jsxs("button",{onClick:h=>d(h,n),className:"block w-full text-left px-3 py-1 hover:bg-gray-100 dark:hover:bg-[var(--dark-sidebar-hover)] flex items-center gap-1",children:[i.jsx(Ol,{})," Share Link"]}),r&&i.jsxs("button",{onClick:h=>d(h,r),className:"block w-full text-left px-3 py-1 hover:bg-gray-100 dark:hover:bg-[var(--dark-sidebar-hover)] flex items-center gap-1",children:[i.jsx(Ar,{})," Rename"]}),s&&i.jsxs("button",{onClick:h=>d(h,s),className:"block w-full text-left px-3 py-1 hover:bg-gray-100 dark:hover:bg-[var(--dark-sidebar-hover)] flex items-center gap-1",children:[i.jsx(Ks,{})," Archive"]}),a&&i.jsxs("button",{onClick:h=>d(h,a),className:"block w-full text-left px-3 py-1 hover:bg-gray-100 dark:hover:bg-[var(--dark-sidebar-hover)] flex items-center gap-1",children:[i.jsx(np,{})," Restore"]}),o&&i.jsxs("button",{onClick:h=>d(h,o),className:"block w-full text-left px-3 py-1 hover:bg-gray-100 dark:hover:bg-[var(--dark-sidebar-hover)] flex items-center gap-1 text-red-600",children:[i.jsx(qt,{})," Delete"]})]}),i.jsxs($n,{to:`/ad-group/${t.id}`,className:"block",children:[i.jsxs("div",{className:"flex items-start px-3 py-2",children:[i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("p",{className:"font-bold text-[14px] text-black dark:text-[var(--dark-text)] mb-0 line-clamp-2",children:t.name}),i.jsx("p",{className:"text-[12px] text-black dark:text-[var(--dark-text)] mb-0",children:t.brandCode}),t.designerName&&i.jsx("p",{className:"text-[12px] text-black dark:text-[var(--dark-text)] mb-0",children:t.designerName})]}),t.dueDate&&i.jsxs("p",{className:"text-[12px] text-black dark:text-[var(--dark-text)] flex items-center gap-1","data-testid":"due-date",children:[i.jsx(fx,{className:"text-gray-600 dark:text-gray-300"}),t.dueDate.toDate?t.dueDate.toDate().toLocaleDateString():new Date(t.dueDate).toLocaleDateString()]})]}),i.jsx("div",{className:"border-t border-gray-300 dark:border-gray-600 px-3 py-2",children:i.jsxs("div",{className:"grid grid-cols-6 text-center text-sm",children:[i.jsxs("div",{className:"flex items-center justify-center gap-1 text-gray-600",children:[i.jsx(yx,{}),i.jsx("span",{children:t.recipeCount})]}),i.jsxs("div",{className:"flex items-center justify-center gap-1 text-gray-600",children:[i.jsx(Yu,{}),i.jsx("span",{children:t.assetCount})]}),i.jsxs("div",{className:"flex items-center justify-center gap-1 text-accent",children:[i.jsx(Cu,{}),i.jsx("span",{children:t.readyCount})]}),i.jsxs("div",{className:"flex items-center justify-center gap-1 text-approve",children:[i.jsx(gx,{}),i.jsx("span",{children:t.counts.approved})]}),i.jsxs("div",{className:"flex items-center justify-center gap-1 text-reject",children:[i.jsx(mx,{}),i.jsx("span",{children:t.counts.rejected})]}),i.jsxs("div",{className:"flex items-center justify-center gap-1 text-edit",children:[i.jsx(Su,{}),i.jsx("span",{children:t.counts.edit})]})]})})]})]})};async function sp(t){if(!t)return"";try{const e=await gn(ie(F,"users",t));return e.exists()?e.data().fullName||e.data().email||e.id:t}catch(e){return console.error("Failed to fetch user name",e),t}}const BU=()=>{const[t,e]=m.useState([]),[n,r]=m.useState(!0),[s,a]=m.useState(null),o=Fe.currentUser,{role:l,brandCodes:c}=Fr(o==null?void 0:o.uid),[d,h]=m.useState(null),f=[{label:"Pending",statuses:["pending"]},{label:"Briefed",statuses:["briefed"]},{label:"Designed",statuses:["ready"]},{label:"In Review/Review Pending",statuses:["in review","review pending"]},{label:"Reviewed",statuses:["reviewed"]}],p=async k=>{let S=`${window.location.origin}/review/${k}`;const T=new URLSearchParams;o!=null&&o.email&&T.set("email",o.email),l&&T.set("role",l);const C=T.toString();C&&(S+=`?${C}`);const j=fo();try{await He(ie(F,"adGroups",k),{password:j})}catch(y){console.error("Failed to set password",y)}h({url:S,password:j})};return m.useEffect(()=>{(async()=>{var S,T;r(!0);try{const C=new Map;let j;l==="designer"?(j=Ye(fe(F,"adGroups"),Je("designerId","==",((S=Fe.currentUser)==null?void 0:S.uid)||""),Je("status","not-in",["archived"])),(await Ne(j)).docs.forEach(M=>C.set(M.id,M))):c&&c.length>0?(j=Ye(fe(F,"adGroups"),Je("brandCode","in",c)),(await Ne(j)).docs.forEach(M=>C.set(M.id,M))):(j=Ye(fe(F,"adGroups"),Je("uploadedBy","==",((T=Fe.currentUser)==null?void 0:T.uid)||""),Je("status","not-in",["archived"])),(await Ne(j)).docs.forEach(M=>C.set(M.id,M)));const y=Array.from(C.values()),R=(await Promise.all(y.map(async O=>{const M=O.data();let b=0,x=0,w=0;const E=new Set;try{const D=await Ne(fe(F,"adGroups",O.id,"assets"));x=D.docs.length,D.docs.forEach(I=>{const pe=I.data();pe.status==="ready"&&(w+=1);const Xe=pe.recipeCode||Ft(pe.filename||"").recipeCode;Xe&&E.add(Xe)}),b=E.size}catch(D){console.error("Failed to load assets",D),b=0}const N=M.designerId?await sp(M.designerId):"";return{id:O.id,...M,recipeCount:b,assetCount:x,readyCount:w,counts:{approved:M.approvedCount||0,rejected:M.rejectedCount||0,edit:M.editCount||0},designerName:N}}))).filter(O=>O.status!=="archived").sort((O,M)=>{var w,E;const b=(w=O.dueDate)!=null&&w.toDate?O.dueDate.toDate():null,x=(E=M.dueDate)!=null&&E.toDate?M.dueDate.toDate():null;return!b&&!x?0:b?x?x-b:-1:1});e(R)}catch(C){console.error("Failed to fetch groups",C),e([])}finally{r(!1)}})()},[c]),i.jsxs("div",{className:"min-h-screen p-4",children:[i.jsx("h1",{className:"text-2xl mb-4",children:"Designer Dashboard"}),i.jsxs("div",{className:"mb-8",children:[i.jsx("h2",{className:"text-xl mb-2",children:"My Ad Groups"}),n?i.jsx("p",{children:"Loading groups..."}):t.length===0?i.jsx("p",{children:"No ad groups found."}):i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"sm:hidden space-y-4",children:t.map(k=>i.jsx(ko,{group:k,onReview:()=>window.location.href=`/review/${k.id}`,onShare:()=>p(k.id)},k.id))}),i.jsx("div",{className:"hidden sm:block overflow-x-auto mt-[0.8rem]",children:i.jsx("div",{className:"min-w-max flex gap-4",children:f.map(k=>i.jsxs("div",{className:"flex-shrink-0 w-[240px] sm:w-[320px]",children:[i.jsx("h3",{className:"mb-2",children:k.label}),i.jsx("div",{className:"bg-[#F7F7F7] dark:bg-[var(--dark-bg)] border border-gray-300 dark:border-gray-600 rounded-t-[1rem] rounded-b-[1rem] flex flex-col items-center gap-4 p-[0.6rem] overflow-y-auto",style:{maxHeight:"calc(100vh - 13rem)"},children:t.filter(S=>k.statuses.includes(S.status)).map(S=>i.jsx(ko,{group:S,onReview:()=>window.location.href=`/review/${S.id}`,onShare:()=>p(S.id)},S.id))})]},k.label))})})]})]}),s&&i.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:i.jsxs("div",{className:"bg-white p-4 rounded shadow max-w-sm dark:bg-[var(--dark-sidebar-bg)] dark:text-[var(--dark-text)]",children:[i.jsx("p",{className:"mb-4 whitespace-pre-wrap",children:s}),i.jsx("button",{onClick:()=>a(null),className:"btn-primary px-3 py-1",children:"Close"})]})}),d&&i.jsx(Xu,{url:d.url,password:d.password,onClose:()=>h(null)})]})},$U=({group:t})=>{const e=m.useMemo(()=>t.previewAds.map(()=>Math.random()*10-5),[t.id,t.previewAds.length]),n=t.previewAds[0]||{},r=Ft(n.filename||""),s=(n.aspectRatio||r.aspectRatio||"9x16").replace("x","/");return i.jsxs($n,{to:`/review/${t.id}`,className:"block text-center p-3",children:[i.jsx("div",{className:"relative mb-2",style:{aspectRatio:s},children:t.previewAds.map((a,o)=>i.jsx(Pn,{pngUrl:a.thumbnailUrl||a.firebaseUrl,alt:t.name,className:"absolute inset-0 w-full h-full object-cover rounded shadow",style:{transform:`rotate(${e[o]}deg)`,zIndex:o+1,top:`${-o*4}px`,left:`${o*4}px`}},a.id))}),i.jsxs("div",{className:"flex justify-center items-center gap-2 mb-1 text-sm",children:[t.status!=="ready"&&i.jsx(Ca,{status:t.status}),t.hasReady?i.jsx("span",{className:"tag tag-new",children:"New!"}):t.counts.approved>0?i.jsxs("span",{className:"tag bg-green-500 text-white",children:[t.counts.approved," Approved"]}):null]}),i.jsx("h3",{className:"font-medium text-gray-700 dark:text-white",children:t.name})]})},zU=({user:t,brandCodes:e=[]})=>{const[n,r]=m.useState([]),[s,a]=m.useState(!0);return m.useEffect(()=>{(async()=>{if(!(t!=null&&t.uid)||e.length===0){r([]),a(!1);return}a(!0);try{const l=Ye(fe(F,"adGroups"),Je("brandCode","in",e),Je("status","==","ready")),c=await Ne(l),d=await Promise.all(c.docs.map(async h=>{var y;const f=h.data(),p={id:h.id,...f,thumbnail:f.thumbnailUrl||"",lastUpdated:(y=f.lastUpdated)!=null&&y.toDate?f.lastUpdated.toDate():null,counts:{reviewed:f.reviewedCount||0,approved:f.approvedCount||0,edit:f.editCount||0,rejected:f.rejectedCount||0}};let k;try{k=await Ne(Ye(fe(F,"adGroups",h.id,"assets"),Rg(3)))}catch(v){console.error("Failed to load preview ads",v),k={docs:[]}}p.previewAds=k.docs.map(v=>({id:v.id,...v.data()}));let S=!1;try{S=!(await Ne(Ye(fe(F,"adGroups",h.id,"assets"),Je("status","==","ready"),Rg(1)))).empty}catch(v){console.error("Failed to check ready status",v)}p.hasReady=S;const T=await Ne(fe(F,"adGroups",h.id,"assets")),C=_S(T.docs.map(v=>v.data()));if(p.thumbnail=p.thumbnail||C.thumbnail,p.counts={reviewed:C.reviewed,approved:C.approved,edit:C.edit,rejected:C.rejected},!f.thumbnailUrl||f.reviewedCount!==C.reviewed||f.approvedCount!==C.approved||f.editCount!==C.edit||f.rejectedCount!==C.rejected)try{const v={reviewedCount:C.reviewed,approvedCount:C.approved,editCount:C.edit,rejectedCount:C.rejected,...f.thumbnailUrl?{}:C.thumbnail?{thumbnailUrl:C.thumbnail}:{}};await He(ie(F,"adGroups",h.id),v)}catch(v){console.error("Failed to update group summary",v)}return p}));r(d)}catch(l){console.error("Failed to fetch groups",l),r([])}finally{a(!1)}})()},[e,t]),i.jsx("div",{className:"min-h-screen p-4",children:s?i.jsx("p",{children:"Loading groups..."}):n.length===0?i.jsx("p",{children:"No ad groups found."}):i.jsx("div",{className:"grid gap-4 sm:grid-cols-2 md:grid-cols-3",children:n.map(o=>i.jsx($U,{group:o},o.id))})})},jS=async t=>{const e=await zM(t);await Promise.all(e.items.map(n=>ih(n))),await Promise.all(e.prefixes.map(n=>jS(n)))};async function ES(t,e,n){const r=await Ne(fe(F,"adGroups",t,"assets"));await Promise.all(r.docs.map(l=>mn(ie(F,"adGroups",t,"assets",l.id))));const s=Ye(fe(F,"adAssets"),Je("adGroupId","==",t)),a=await Ne(s);await Promise.all(a.docs.map(l=>mn(ie(F,"adAssets",l.id))));const o=`Campfire/Brands/${e}/Adgroups/${n}`;await jS(xi(ah,o)),await mn(ie(F,"adGroups",t))}const Un=({children:t})=>i.jsx("div",{className:"overflow-x-auto table-container",children:i.jsx("table",{className:"ad-table min-w-max text-sm",children:t})}),GU=({showSidebar:t=!0,asModal:e=!1})=>{const[n,r]=m.useState(""),[s,a]=m.useState(""),[o,l]=m.useState([]),[c,d]=m.useState(""),[h,f]=m.useState(""),[p,k]=m.useState([]),[S,T]=m.useState(!1),C=ti();m.useEffect(()=>{(async()=>{var v;if(!((v=Fe.currentUser)!=null&&v.uid)){l([]);return}try{const R=await gn(ie(F,"users",Fe.currentUser.uid)),O=R.exists()?R.data().brandCodes:[];Array.isArray(O)?l(O):l([])}catch(R){console.error("Failed to fetch brand codes",R),l([])}})()},[]);const j=async y=>{var R;y.preventDefault(),T(!0);const v=n.trim()||`Group ${Date.now()}`;try{const O=await rn(fe(F,"adGroups"),{name:v,brandCode:s.trim(),notes:h.trim(),uploadedBy:((R=Fe.currentUser)==null?void 0:R.uid)||null,createdAt:Mt(),status:"pending",reviewedCount:0,approvedCount:0,editCount:0,rejectedCount:0,thumbnailUrl:"",lastUpdated:Mt(),visibility:"private",requireAuth:!1,requirePassword:!1,password:"",dueDate:c?sn.fromDate(new Date(c)):null});for(const M of p)try{const b=await lh(M,O.id,s.trim(),v);await rn(fe(F,"adGroups",O.id,"groupAssets"),{filename:M.name,firebaseUrl:b,uploadedAt:Mt()})}catch(b){console.error("Asset upload failed",b)}C(`/ad-group/${O.id}`)}catch(O){console.error("Failed to create ad group",O)}finally{T(!1)}};return i.jsxs("div",{className:`${e?"":"min-h-screen mt-10"} p-4 max-w-md mx-auto`,children:[i.jsx("h1",{className:"text-2xl mb-4",children:"Create Ad Group"}),i.jsxs("form",{onSubmit:j,className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Group Name"}),i.jsx("input",{type:"text",value:n,onChange:y=>r(y.target.value),className:"w-full p-2 border rounded",placeholder:"Optional"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Brand"}),o.length>0?i.jsxs("select",{value:s,onChange:y=>a(y.target.value),className:"w-full p-2 border rounded",required:!0,children:[i.jsx("option",{value:"",children:"Select brand"}),o.map(y=>i.jsx("option",{value:y,children:y},y))]}):i.jsx("p",{className:"text-sm text-gray-500",children:"No brands assigned"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Due Date"}),i.jsx("input",{type:"date",value:c,onChange:y=>d(y.target.value),className:"w-full p-2 border rounded"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Notes"}),i.jsx("textarea",{value:h,onChange:y=>f(y.target.value),className:"w-full p-2 border rounded",rows:3,placeholder:"Optional"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Ad Group Assets"}),i.jsx("input",{type:"file",multiple:!0,onChange:y=>k(Array.from(y.target.files)),className:"w-full"})]}),i.jsx("button",{type:"submit",className:"w-full btn-primary",disabled:S,children:S?"Creating...":"Create Group"})]})]})},HU=()=>{const[t,e]=m.useState([]),[n,r]=m.useState(!0),[s,a]=m.useState(null),[o,l]=m.useState(!1),c=Fe.currentUser,{role:d}=Fr(c==null?void 0:c.uid),h=d==="admin",f=d==="manager"||d==="editor",[p,k]=m.useState(null),[S,T]=m.useState(null),[C,j]=m.useState(""),[y,v]=m.useState(!1),[R,O]=m.useState(""),[M,b]=m.useState("status"),[x,w]=m.useState([]),[E,N]=m.useState(""),[D,I]=m.useState("kanban"),pe=async B=>{let G=`${window.location.origin}/review/${B}`;const ne=new URLSearchParams;c!=null&&c.email&&ne.set("email",c.email),d&&ne.set("role",d);const de=ne.toString();de&&(G+=`?${de}`);const Qe=fo();try{await He(ie(F,"adGroups",B),{password:Qe})}catch(nt){console.error("Failed to set password",nt)}k({url:G,password:Qe})};m.useEffect(()=>{(async()=>{r(!0);try{const G=fe(F,"adGroups");let ne=G;const de=[];o||de.push(Je("status","not-in",["archived"])),de.length>0&&(ne=Ye(G,...de));const Qe=await Ne(ne),nt=await Promise.all(Qe.docs.map(async te=>{const je=te.data();let Le=0,mt=0,Ct=0;const ze=new Set;try{const jt=await Ne(fe(F,"adGroups",te.id,"assets"));mt=jt.docs.length,jt.docs.forEach(Lt=>{const Xt=Lt.data();Xt.status==="ready"&&(Ct+=1);const Cn=Xt.recipeCode||Ft(Xt.filename||"").recipeCode;Cn&&ze.add(Cn)}),Le=ze.size}catch(jt){console.error("Failed to load assets",jt),Le=0}const it=je.designerId?await sp(je.designerId):"";return{id:te.id,...je,recipeCount:Le,assetCount:mt,readyCount:Ct,counts:{approved:je.approvedCount||0,rejected:je.rejectedCount||0,edit:je.editCount||0},designerName:it}}));e(nt)}catch(G){console.error("Failed to fetch groups",G),e([])}finally{r(!1)}})()},[o]),m.useEffect(()=>{(async()=>{try{const G=Ye(fe(F,"users"),Je("role","==","designer")),ne=await Ne(G);w(ne.docs.map(de=>({id:de.id,name:de.data().fullName||de.data().email||de.id})))}catch(G){console.error("Failed to fetch designers",G),w([])}})()},[]);const Xe=async(B,G,ne)=>{if(window.confirm("Delete this group?"))try{await ES(B,G,ne),e(de=>de.filter(Qe=>Qe.id!==B))}catch(de){console.error("Failed to delete group",de)}},Ae=async B=>{var G;if(window.confirm("Archive this group?"))try{await He(ie(F,"adGroups",B),{status:"archived",archivedAt:Mt(),archivedBy:((G=Fe.currentUser)==null?void 0:G.uid)||null}),e(ne=>ne.map(de=>de.id===B?{...de,status:"archived"}:de)),await rp({target:"adGroup",groupId:B})}catch(ne){console.error("Failed to archive group",ne)}},J=async B=>{try{await He(ie(F,"adGroups",B),{status:"pending",archivedAt:null,archivedBy:null}),e(G=>G.map(ne=>ne.id===B?{...ne,status:"pending"}:ne))}catch(G){console.error("Failed to restore group",G)}},K=B=>{T(B.id),j(B.name||"")},z=()=>T(null),Y=async B=>{const G=C.trim();if(G)try{await He(ie(F,"adGroups",B),{name:G}),e(ne=>ne.map(de=>de.id===B?{...de,name:G}:de)),T(null)}catch(ne){console.error("Failed to rename group",ne)}},V=async B=>{const G=window.prompt("New group name",B.name||"");if(!G)return;const ne=G.trim();if(ne)try{await He(ie(F,"adGroups",B.id),{name:ne}),e(de=>de.map(Qe=>Qe.id===B.id?{...Qe,name:ne}:Qe))}catch(de){console.error("Failed to rename group",de)}},q={pending:1,briefed:2,ready:3,"review pending":4,"in review":4,reviewed:5,archived:6},ae=[{label:"Pending",statuses:["pending"]},{label:"Briefed",statuses:["briefed"]},{label:"Ready",statuses:["ready"]},{label:"In Review/Review Pending",statuses:["in review","review pending"]},{label:"Reviewed",statuses:["reviewed"]}],Ee=R.toLowerCase(),L=t.filter(B=>{var G,ne;return!Ee||((G=B.name)==null?void 0:G.toLowerCase().includes(Ee))||((ne=B.brandCode)==null?void 0:ne.toLowerCase().includes(Ee))}).filter(B=>!E||B.designerId===E).sort((B,G)=>M==="name"?(B.name||"").localeCompare(G.name||""):M==="brand"?(B.brandCode||"").localeCompare(G.brandCode||""):(q[B.status]??99)-(q[G.status]??99));return i.jsxs("div",{className:"min-h-screen p-4",children:[i.jsx("h1",{className:"text-2xl mb-4",children:"Admin Ad Groups"}),i.jsxs("div",{className:"mb-8",children:[i.jsx("h2",{className:"text-xl mb-2",children:"All Ad Groups"}),i.jsxs("div",{className:"flex items-center justify-between mb-2 flex-wrap gap-2",children:[i.jsxs("button",{onClick:()=>v(!0),className:"btn-primary flex items-center gap-1",children:[i.jsx(Yi,{}),"Create Ad Group"]}),i.jsxs("div",{className:"flex flex-wrap gap-2 flex-1 order-last md:order-none justify-center",children:[i.jsx(_t,{active:D==="table",onClick:()=>I("table"),"aria-label":"Table view",children:i.jsx(Zl,{})}),i.jsx(_t,{active:D==="kanban",onClick:()=>I("kanban"),"aria-label":"Kanban view",children:i.jsx(px,{})})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[D==="kanban"?i.jsxs("select",{value:E,onChange:B=>N(B.target.value),className:"p-1 border rounded",children:[i.jsx("option",{value:"",children:"All designers"}),x.map(B=>i.jsx("option",{value:B.id,children:B.name},B.id))]}):i.jsxs(i.Fragment,{children:[i.jsxs("select",{value:M,onChange:B=>b(B.target.value),className:"p-1 border rounded",children:[i.jsx("option",{value:"status",children:"Status"}),i.jsx("option",{value:"brand",children:"Brand"}),i.jsx("option",{value:"name",children:"Group Name"})]}),i.jsx(_t,{type:"button",active:o,onClick:()=>l(B=>!B),"aria-label":o?"Hide archived":"Show archived",children:i.jsx(Ks,{})})]}),i.jsx("input",{type:"text",placeholder:"Filter",value:R,onChange:B=>O(B.target.value),className:"p-1 border rounded"})]})]}),n?i.jsx("p",{children:"Loading groups..."}):L.length===0?i.jsx("p",{children:"No ad groups found."}):i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"sm:hidden space-y-4",children:L.map(B=>i.jsx(ko,{group:B,onReview:()=>window.location.href=`/review/${B.id}`,onShare:()=>pe(B.id),onRename:()=>V(B),onArchive:B.status!=="archived"&&(h||f)?()=>Ae(B.id):void 0,onRestore:B.status==="archived"&&(h||f)?()=>J(B.id):void 0,onDelete:h?()=>Xe(B.id,B.brandCode,B.name):void 0},B.id))}),D==="table"?i.jsx("div",{className:"hidden sm:block",children:i.jsxs(Un,{children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Group Name"}),i.jsx("th",{children:"Brand"}),i.jsx("th",{className:"text-center",children:i.jsx(Yu,{"aria-label":"Recipes"})}),i.jsx("th",{children:"Status"}),i.jsx("th",{className:"text-center",children:i.jsx(gx,{"aria-label":"Approved"})}),i.jsx("th",{className:"text-center",children:i.jsx(mx,{"aria-label":"Rejected"})}),i.jsx("th",{className:"text-center",children:i.jsx(Su,{"aria-label":"Edit Requested"})}),i.jsx("th",{children:"Note"}),i.jsx("th",{children:"Actions"})]})}),i.jsx("tbody",{children:L.map(B=>i.jsxs("tr",{children:[i.jsx("td",{children:S===B.id?i.jsx("input",{type:"text",value:C,onChange:G=>j(G.target.value),className:"w-full p-1 border rounded"}):B.name}),i.jsx("td",{children:B.brandCode}),i.jsx("td",{className:"text-center",children:B.recipeCount}),i.jsx("td",{className:"text-center",children:i.jsx(Ca,{status:B.status})}),i.jsx("td",{className:"text-center text-approve",children:B.counts.approved}),i.jsx("td",{className:"text-center text-reject",children:B.counts.rejected}),i.jsx("td",{className:"text-center text-edit",children:B.counts.edit}),i.jsx("td",{className:"text-center",children:B.clientNote?i.jsxs("button",{onClick:()=>a(B.clientNote),className:"flex items-center text-gray-700 underline","aria-label":"View Client Note",children:[i.jsx(Ll,{className:"mr-1"}),"View Note"]}):"-"}),i.jsx("td",{className:"text-center",children:i.jsx("div",{className:"flex items-center justify-center",children:S===B.id?i.jsxs(i.Fragment,{children:[i.jsx("button",{onClick:()=>Y(B.id),className:"btn-action mr-2",children:"Save"}),i.jsx("button",{onClick:z,className:"btn-action",children:"Cancel"})]}):i.jsxs(i.Fragment,{children:[i.jsx(be,{as:$n,to:`/ad-group/${B.id}`,"aria-label":"View Details",children:i.jsx(Wi,{})}),i.jsx(be,{as:$n,to:`/review/${B.id}`,className:"ml-2","aria-label":"Review",children:i.jsx(Cu,{})}),i.jsx(be,{onClick:()=>pe(B.id),className:"ml-2","aria-label":"Share Link",children:i.jsx(Ol,{})}),i.jsx(be,{onClick:()=>K(B),className:"ml-2","aria-label":"Rename",children:i.jsx(Ar,{})}),B.status==="archived"?i.jsx(be,{onClick:()=>J(B.id),className:"ml-2","aria-label":"Restore",disabled:!h&&!f,children:i.jsx(np,{})}):i.jsx(be,{onClick:()=>Ae(B.id),className:"ml-2","aria-label":"Archive",disabled:!h&&!f,children:i.jsx(Ks,{})}),h&&i.jsx(be,{onClick:()=>Xe(B.id,B.brandCode,B.name),className:"ml-2","aria-label":"Delete",children:i.jsx(qt,{})})]})})})]},B.id))})]})}):i.jsx("div",{className:"hidden sm:block overflow-x-auto mt-[0.8rem]",children:i.jsx("div",{className:"min-w-max flex gap-4",children:ae.map(B=>i.jsxs("div",{className:"flex-shrink-0 w-[240px] sm:w-[320px]",children:[i.jsx("h3",{className:"mb-2",children:B.label}),i.jsx("div",{className:"bg-[#F7F7F7] dark:bg-[var(--dark-bg)] border border-gray-300 dark:border-gray-600 rounded-t-[1rem] rounded-b-[1rem] flex flex-col items-center gap-4 p-[0.6rem] overflow-y-auto",style:{maxHeight:"calc(100vh - 13rem)"},children:L.filter(G=>B.statuses.includes(G.status)).map(G=>i.jsx(ko,{group:G},G.id))})]},B.label))})})]})]}),y&&i.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:i.jsxs("div",{className:"bg-white p-4 rounded shadow max-w-md w-full dark:bg-[var(--dark-sidebar-bg)] dark:text-[var(--dark-text)] overflow-y-auto max-h-[90vh]",children:[i.jsx(GU,{showSidebar:!1,asModal:!0}),i.jsx("div",{className:"text-right mt-2",children:i.jsx("button",{onClick:()=>v(!1),className:"btn-secondary px-3 py-1",children:"Close"})})]})}),s&&i.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:i.jsxs("div",{className:"bg-white p-4 rounded shadow max-w-sm dark:bg-[var(--dark-sidebar-bg)] dark:text-[var(--dark-text)]",children:[i.jsx("p",{className:"mb-4 whitespace-pre-wrap",children:s}),i.jsx("button",{onClick:()=>a(null),className:"btn-primary px-3 py-1",children:"Close"})]})}),p&&i.jsx(Xu,{url:p.url,password:p.password,onClose:()=>k(null)})]})},qU=()=>{const[t,e]=m.useState([]),[n,r]=m.useState(!0),[s,a]=m.useState(null),[o,l]=m.useState(!1),c=Fe.currentUser,{brandCodes:d}=Fr(c==null?void 0:c.uid),[h,f]=m.useState(null),[p,k]=m.useState(""),[S,T]=m.useState("status"),[C,j]=m.useState([]),[y,v]=m.useState(""),[R,O]=m.useState("kanban"),M=async E=>{let N=`${window.location.origin}/review/${E}`;const D=new URLSearchParams;c!=null&&c.email&&D.set("email",c.email);const I=D.toString();I&&(N+=`?${I}`);const pe=fo();try{await He(ie(F,"adGroups",E),{password:pe})}catch(Xe){console.error("Failed to set password",Xe)}f({url:N,password:pe})};m.useEffect(()=>{(async()=>{if(!d||d.length===0){e([]),r(!1);return}r(!0);try{const N=fe(F,"adGroups"),D=[];for(let Ae=0;Ae<d.length;Ae+=10)D.push(d.slice(Ae,Ae+10));const I=[];for(const Ae of D){const J=Ye(N,Je("brandCode","in",Ae)),K=await Ne(J),z=o?K.docs:K.docs.filter(Y=>{var V;return((V=Y.data())==null?void 0:V.status)!=="archived"});I.push(...z)}const pe=new Set,Xe=await Promise.all(I.filter(Ae=>pe.has(Ae.id)?!1:(pe.add(Ae.id),!0)).map(async Ae=>{const J=Ae.data();let K=0,z=0,Y=0;const V=new Set;try{const ae=await Ne(fe(F,"adGroups",Ae.id,"assets"));z=ae.docs.length,ae.docs.forEach(Ee=>{const L=Ee.data();L.status==="ready"&&(Y+=1);const B=L.recipeCode||Ft(L.filename||"").recipeCode;B&&V.add(B)}),K=V.size}catch(ae){console.error("Failed to load assets",ae),K=0}const q=J.designerId?await sp(J.designerId):"";return{id:Ae.id,...J,recipeCount:K,assetCount:z,readyCount:Y,counts:{approved:J.approvedCount||0,rejected:J.rejectedCount||0,edit:J.editCount||0},designerName:q}}));e(Xe)}catch(N){console.error("Failed to fetch groups",N),e([])}finally{r(!1)}})()},[o,d]),m.useEffect(()=>{(async()=>{try{const N=Ye(fe(F,"users"),Je("role","==","designer")),D=await Ne(N);j(D.docs.map(I=>({id:I.id,name:I.data().fullName||I.data().email||I.id})))}catch(N){console.error("Failed to fetch designers",N),j([])}})()},[]);const b={pending:1,briefed:2,ready:3,"review pending":4,"in review":4,reviewed:5,archived:6},x=p.toLowerCase(),w=t.filter(E=>{var N,D;return!x||((N=E.name)==null?void 0:N.toLowerCase().includes(x))||((D=E.brandCode)==null?void 0:D.toLowerCase().includes(x))}).filter(E=>!y||E.designerId===y).sort((E,N)=>S==="name"?(E.name||"").localeCompare(N.name||""):S==="brand"?(E.brandCode||"").localeCompare(N.brandCode||""):(b[E.status]??99)-(b[N.status]??99));return i.jsxs("div",{className:"min-h-screen p-4",children:[i.jsx("h1",{className:"text-2xl mb-4",children:"Ad Groups"}),i.jsxs("div",{className:"mb-8",children:[i.jsx("h2",{className:"text-xl mb-2",children:"All Ad Groups"}),i.jsxs("div",{className:"flex items-center justify-between mb-2 flex-wrap gap-2",children:[i.jsxs("div",{className:"flex flex-wrap gap-2 flex-1 order-last md:order-none justify-center",children:[i.jsx(_t,{active:R==="table",onClick:()=>O("table"),"aria-label":"Table view",children:i.jsx(Zl,{})}),i.jsx(_t,{active:R==="kanban",onClick:()=>O("kanban"),"aria-label":"Kanban view",children:i.jsx(px,{})})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[R==="kanban"?i.jsxs("select",{value:y,onChange:E=>v(E.target.value),className:"p-1 border rounded",children:[i.jsx("option",{value:"",children:"All designers"}),C.map(E=>i.jsx("option",{value:E.id,children:E.name},E.id))]}):i.jsxs(i.Fragment,{children:[i.jsxs("select",{value:S,onChange:E=>T(E.target.value),className:"p-1 border rounded",children:[i.jsx("option",{value:"status",children:"Status"}),i.jsx("option",{value:"brand",children:"Brand"}),i.jsx("option",{value:"name",children:"Group Name"})]}),i.jsx(_t,{type:"button",active:o,onClick:()=>l(E=>!E),"aria-label":o?"Hide archived":"Show archived",children:"Archive"})]}),i.jsx("input",{type:"text",placeholder:"Filter",value:p,onChange:E=>k(E.target.value),className:"p-1 border rounded"})]})]}),n?i.jsx("p",{children:"Loading groups..."}):w.length===0?i.jsx("p",{children:"No ad groups found."}):i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"sm:hidden space-y-4",children:w.map(E=>i.jsx(ko,{group:E,onReview:()=>window.location.href=`/review/${E.id}`,onShare:()=>M(E.id)},E.id))}),R==="table"?i.jsx("div",{className:"hidden sm:block overflow-x-auto mt-[0.8rem]",children:i.jsxs(Un,{children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Group Name"}),i.jsx("th",{children:"Brand"}),i.jsx("th",{className:"text-center",children:i.jsx(FiGrid,{"aria-label":"Recipes"})}),i.jsx("th",{children:"Status"}),i.jsx("th",{className:"text-center",children:i.jsx(FiThumbsUp,{"aria-label":"Approved"})}),i.jsx("th",{className:"text-center",children:i.jsx(FiThumbsDown,{"aria-label":"Rejected"})}),i.jsx("th",{className:"text-center",children:i.jsx(FiEdit,{"aria-label":"Edit Requested"})}),i.jsx("th",{children:"Note"}),i.jsx("th",{children:"Actions"})]})}),i.jsx("tbody",{children:w.map(E=>i.jsxs("tr",{children:[i.jsx("td",{children:E.name}),i.jsx("td",{children:E.brandCode}),i.jsx("td",{className:"text-center",children:E.recipeCount}),i.jsx("td",{className:"text-center",children:i.jsx(Ca,{status:E.status})}),i.jsx("td",{className:"text-center text-approve",children:E.counts.approved}),i.jsx("td",{className:"text-center text-reject",children:E.counts.rejected}),i.jsx("td",{className:"text-center text-edit",children:E.counts.edit}),i.jsx("td",{className:"text-center",children:E.clientNote?i.jsxs("button",{onClick:()=>a(E.clientNote),className:"flex items-center text-gray-700 underline","aria-label":"View Client Note",children:[i.jsx(Ll,{className:"mr-1"}),"View Note"]}):"-"}),i.jsx("td",{className:"text-center",children:i.jsxs("div",{className:"flex items-center justify-center",children:[i.jsx(be,{as:$n,to:`/ad-group/${E.id}`,"aria-label":"View Details",children:i.jsx(Wi,{})}),i.jsx(be,{as:$n,to:`/review/${E.id}`,className:"ml-2","aria-label":"Review",children:i.jsx(Cu,{})}),i.jsx(be,{onClick:()=>M(E.id),className:"ml-2","aria-label":"Share Link",children:i.jsx(Ol,{})})]})})]},E.id))})]})}):i.jsx("div",{className:"hidden sm:block overflow-x-auto mt-[0.8rem]",children:i.jsx("div",{className:"min-w-max flex gap-4",children:["pending","briefed","ready","in review","reviewed"].map(E=>i.jsxs("div",{className:"flex-shrink-0 w-[240px] sm:w-[320px]",children:[i.jsx("h3",{className:"mb-2",children:E}),i.jsx("div",{className:"bg-[#F7F7F7] dark:bg-[var(--dark-bg)] border border-gray-300 dark:border-gray-600 rounded-t-[1rem] rounded-b-[1rem] flex flex-col items-center gap-4 p-[0.6rem] overflow-y-auto",style:{maxHeight:"calc(100vh - 13rem)"},children:w.filter(N=>N.status===E).map(N=>i.jsx(ko,{group:N},N.id))})]},E))})})]})]}),s&&i.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:i.jsxs("div",{className:"bg-white p-4 rounded shadow max-w-sm dark:bg-[var(--dark-sidebar-bg)] dark:text-[var(--dark-text)]",children:[i.jsx("p",{className:"mb-4 whitespace-pre-wrap",children:s}),i.jsx("button",{onClick:()=>a(null),className:"btn-primary px-3 py-1",children:"Close"})]})}),h&&i.jsx(Xu,{url:h.url,password:h.password,onClose:()=>f(null)})]})};function Cc(t=""){const e=l=>l.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),n=/(https?:\/\/[^\s]+)/g,r=t.split(/\r?\n/);let s="",a=!1;const o=()=>{a&&(s+="</ul>",a=!1)};for(const l of r)if(/^\s*[-*\u2022]\s+/.test(l)){a||(s+="<ul>",a=!0);const c=l.replace(/^\s*[-*\u2022]\s+/,""),d=e(c).replace(n,'<a href="$1" target="_blank" rel="noopener noreferrer" class="break-all">$1</a>');s+=`<li>${d}</li>`}else if(l.trim()==="")o();else{o();const c=e(l).replace(n,'<a href="$1" target="_blank" rel="noopener noreferrer" class="break-all">$1</a>');s+=`<p>${c}</p>`}return o(),s}const WU={newAds:eU,newBrand:iU,bug:JV,feature:yx},KU={newAds:"text-blue-500",newBrand:"text-green-600",bug:"text-red-500",feature:"text-purple-500"},QU=({request:t,onEdit:e,onDelete:n,onArchive:r,onCreateGroup:s,onDragStart:a})=>{const[o,l]=m.useState(!1),[c,d]=m.useState(!1),[h,f]=m.useState(!1),p=typeof window<"u"&&window.matchMedia("(pointer: coarse)").matches,[k,S]=m.useState(!p),T=m.useRef(null),C=m.useRef(null),j=m.useRef(null),y=WU[t.type],v=KU[t.type]||"text-gray-600 dark:text-gray-300",R=O=>{var M,b;(M=C.current)!=null&&M.contains(O.target)||(b=j.current)!=null&&b.contains(O.target)||h||d(x=>!x)};return i.jsxs("div",{"data-testid":"request-card",className:"bg-white dark:bg-[var(--dark-sidebar-bg)] border border-gray-300 dark:border-gray-600 rounded-lg shadow-md p-3 space-y-1 w-[220px] sm:w-[300px]",draggable:k,onDragStart:()=>{f(!0),a(t.id)},onDragEnd:()=>{f(!1),p&&S(!1)},onTouchStart:()=>{p&&(T.current=setTimeout(()=>S(!0),300))},onTouchEnd:()=>{p&&(clearTimeout(T.current),S(!1))},onTouchMove:()=>{p&&clearTimeout(T.current)},onClick:R,children:[i.jsxs("div",{className:"relative space-y-1",children:[i.jsxs("div",{className:"flex items-start justify-between",children:[y&&i.jsx("div",{className:`text-lg ${v}`,children:bt.createElement(y)}),i.jsx(be,{ref:j,onClick:()=>l(O=>!O),className:"ml-auto bg-transparent hover:bg-gray-100 dark:hover:bg-[var(--dark-sidebar-hover)]","aria-label":"Menu",children:i.jsx(yS,{})}),o&&i.jsxs("div",{ref:C,className:"absolute right-0 top-6 z-10 bg-white dark:bg-[var(--dark-sidebar-bg)] border border-gray-300 dark:border-gray-600 rounded shadow text-sm",children:[i.jsxs("button",{onClick:()=>{l(!1),e(t)},className:"block w-full text-left px-3 py-1 hover:bg-gray-100 dark:hover:bg-[var(--dark-sidebar-hover)] flex items-center gap-1",children:[i.jsx(Ar,{})," Edit"]}),i.jsxs("button",{onClick:()=>{l(!1),r(t.id)},className:"block w-full text-left px-3 py-1 hover:bg-gray-100 dark:hover:bg-[var(--dark-sidebar-hover)] flex items-center gap-1",children:[i.jsx(Ks,{})," Archive"]}),i.jsxs("button",{onClick:()=>{l(!1),n(t.id)},className:"block w-full text-left px-3 py-1 hover:bg-gray-100 dark:hover:bg-[var(--dark-sidebar-hover)] flex items-center gap-1 text-red-600",children:[i.jsx(qt,{})," Delete"]})]})]}),t.title&&i.jsx("p",{className:"font-bold text-[14px] text-black dark:text-[var(--dark-text)] mb-0",children:t.title}),c&&t.brandCode&&i.jsx("p",{className:"font-bold text-[14px] text-black dark:text-[var(--dark-text)] mb-0",children:t.brandCode}),c&&t.dueDate&&i.jsxs("p",{className:"text-[12px] text-black dark:text-[var(--dark-text)] mb-0 flex items-center gap-1",children:[i.jsx(fx,{className:"text-gray-600 dark:text-gray-300"}),t.dueDate.toDate().toLocaleDateString()]}),t.priority&&i.jsxs("p",{className:"text-[12px] text-black dark:text-[var(--dark-text)] mb-0",children:["Priority: ",t.priority]})]}),c&&t.details&&i.jsx("div",{className:"text-sm text-black dark:text-[var(--dark-text)]",dangerouslySetInnerHTML:{__html:Cc(t.details)}}),c&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"flex items-center justify-between text-sm",children:t.type==="newAds"&&i.jsxs("span",{children:["# Ads: ",t.numAds]})}),i.jsx("div",{className:"text-right",children:t.type==="bug"||t.type==="feature"?null:t.status==="done"?i.jsx("span",{className:"text-sm text-gray-500",children:t.type==="newBrand"?"Brand Created":"Ad Group Created"}):i.jsx("button",{onClick:()=>s(t),className:`btn-primary mt-2 text-sm ${t.status!=="ready"?"opacity-50 cursor-not-allowed":""}`,disabled:t.status!=="ready",children:t.type==="newBrand"?"Create Brand":"Create Ad Group"})})]}),i.jsx("p",{className:"text-xs text-gray-500 text-right mt-1",children:c?"Show less":"Show more"})]})},YU=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],JU=({requests:t})=>{const e=new Date,n=e.getFullYear(),r=e.getMonth(),s=new Date(n,r,1),a=new Date(n,r+1,0),o=s.getDay(),l=a.getDate(),c=[];for(let h=0;h<o;h++)c.push(null);for(let h=1;h<=l;h++)c.push(new Date(n,r,h));for(;c.length%7!==0;)c.push(null);const d={};return t.forEach(h=>{if(!h.dueDate)return;const p=(h.dueDate.toDate?h.dueDate.toDate():new Date(h.dueDate)).toISOString().slice(0,10);d[p]||(d[p]=[]),d[p].push(h)}),i.jsxs("div",{children:[i.jsx("div",{className:"grid grid-cols-7 gap-1 text-center text-sm font-semibold mb-2",children:YU.map(h=>i.jsx("div",{children:h},h))}),i.jsx("div",{className:"grid grid-cols-7 gap-1",children:c.map((h,f)=>{if(!h)return i.jsx("div",{className:"h-20 border"},f);const p=h.toISOString().slice(0,10),k=d[p]||[];return i.jsxs("div",{className:"h-20 border p-1 text-sm relative",children:[i.jsx("div",{className:"text-xs",children:h.getDate()}),i.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:k.map(S=>i.jsxs("div",{className:"relative group",children:[i.jsx("div",{className:"w-2 h-2 bg-accent rounded-full"}),i.jsx("div",{className:"absolute z-10 hidden group-hover:block bg-white dark:bg-[var(--dark-sidebar-bg)] border border-gray-300 dark:border-gray-600 text-xs p-1 rounded whitespace-nowrap",children:S.title||S.brandCode||"Ticket"})]},S.id))})]},f)})})]})};function Zu(){const[t,e]=m.useState([]),[n,r]=m.useState(!0);return m.useEffect(()=>{let s=!1;return(async()=>{try{const o=await Ne(fe(F,"agencies"));s||e(o.docs.map(l=>({id:l.id,...l.data()})))}catch(o){console.error("Failed to load agencies",o),s||e([])}finally{s||r(!1)}})(),()=>{s=!0}},[]),{agencies:t,loading:n}}const v_={type:"newAds",brandCode:"",title:"",dueDate:"",numAds:1,details:"",priority:"low",name:"",agencyId:"",toneOfVoice:"",offering:"",designerId:"",editorId:""},kS=({filterEditorId:t,canAssignEditor:e=!0}={})=>{const[n,r]=m.useState([]),[s,a]=m.useState(!0),[o,l]=m.useState(!1),[c,d]=m.useState(null),[h,f]=m.useState(v_),[p,k]=m.useState([]),[S,T]=m.useState([]),[C,j]=m.useState([]),[y,v]=m.useState("kanban"),[R,O]=m.useState(null),M=ti(),{agencies:b}=Zu();m.useEffect(()=>{const L=async()=>{a(!0);try{const de=fe(F,"requests"),Qe=t?Ye(de,Je("editorId","==",t)):de,te=(await Ne(Qe)).docs.map(je=>({id:je.id,...je.data()}));r(te)}catch(de){console.error("Failed to fetch requests",de),r([])}finally{a(!1)}},B=async()=>{try{const de=await Ne(fe(F,"brands"));k(de.docs.map(Qe=>Qe.data().code))}catch(de){console.error("Failed to fetch brands",de),k([])}},G=async()=>{try{const de=Ye(fe(F,"users"),Je("role","==","designer")),Qe=await Ne(de);T(Qe.docs.map(nt=>({id:nt.id,name:nt.data().fullName||nt.data().email||nt.id})))}catch(de){console.error("Failed to fetch designers",de),T([])}},ne=async()=>{try{const de=Ye(fe(F,"users"),Je("role","==","editor")),Qe=await Ne(de);j(Qe.docs.map(nt=>({id:nt.id,name:nt.data().fullName||nt.data().email||nt.id})))}catch(de){console.error("Failed to fetch editors",de),j([])}};L(),B(),G(),e&&ne()},[]);const x=()=>{f(v_),d(null)},w=()=>{x(),e||f(L=>{var B;return{...L,editorId:t||((B=Fe.currentUser)==null?void 0:B.uid)||""}}),l(!0)},E=L=>{d(L.id),f({type:L.type||"newAds",brandCode:L.brandCode||"",title:L.title||"",dueDate:L.dueDate?L.dueDate.toDate().toISOString().slice(0,10):"",numAds:L.numAds||1,details:L.details||"",priority:L.priority||"low",name:L.name||"",agencyId:L.agencyId||"",toneOfVoice:L.toneOfVoice||"",offering:L.offering||"",designerId:L.designerId||"",editorId:L.editorId||""}),l(!0)},N=async()=>{var B,G;const L={type:h.type,brandCode:h.brandCode,title:h.title,dueDate:h.dueDate?sn.fromDate(new Date(h.dueDate)):null,numAds:Number(h.numAds)||0,details:h.details,priority:h.priority,name:h.name,agencyId:h.agencyId,toneOfVoice:h.toneOfVoice,offering:h.offering,designerId:h.designerId,editorId:e?h.editorId:t||((B=Fe.currentUser)==null?void 0:B.uid)||h.editorId,status:c&&((G=n.find(ne=>ne.id===c))==null?void 0:G.status)||"new"};try{if(c)await He(ie(F,"requests",c),L),r(ne=>ne.map(de=>de.id===c?{...de,...L}:de));else{const ne=await rn(fe(F,"requests"),L);r(de=>[...de,{id:ne.id,...L}])}l(!1),x()}catch(ne){console.error("Failed to save request",ne)}},D=async L=>{if(window.confirm("Delete this request?"))try{await mn(ie(F,"requests",L)),r(B=>B.filter(G=>G.id!==L))}catch(B){console.error("Failed to delete request",B)}},I=async L=>{var B;if(window.confirm("Archive this request?"))try{await He(ie(F,"requests",L),{status:"archived",archivedAt:Mt(),archivedBy:((B=Fe.currentUser)==null?void 0:B.uid)||null}),r(G=>G.filter(ne=>ne.id!==L))}catch(G){console.error("Failed to archive request",G)}},pe=async(L,B)=>{try{await He(ie(F,"requests",L),{status:B}),r(G=>G.map(ne=>ne.id===L?{...ne,status:B}:ne))}catch(G){console.error("Failed to update status",G)}},Xe=L=>{O(L)},Ae=L=>{R&&(pe(R,L),O(null))},J=L=>L.preventDefault(),K=L=>{if(L.key===" "&&L.target.selectionStart>=2){const B=L.target.value,G=L.target.selectionStart;if(B.slice(G-2,G)==="- "&&(G===2||B[G-3]===`
`)){L.preventDefault();const ne=B.slice(0,G-2),de=B.slice(G),Qe="• ",nt=ne+Qe+de;f(te=>({...te,details:nt})),setTimeout(()=>{L.target.selectionStart=L.target.selectionEnd=ne.length+Qe.length},0)}}},z=async L=>{var B,G;if(L.type==="newBrand")try{await rn(fe(F,"brands"),{code:L.brandCode||"",name:L.name||"",agencyId:L.agencyId||"",toneOfVoice:L.toneOfVoice||"",offering:L.offering||"",archived:!1,archivedAt:null,archivedBy:null,createdAt:Mt()}),await He(ie(F,"requests",L.id),{status:"done"}),r(ne=>ne.map(de=>de.id===L.id?{...de,status:"done"}:de))}catch(ne){console.error("Failed to create brand",ne)}else{const ne=((B=L.title)==null?void 0:B.trim())||`Group ${Date.now()}`;try{const de=await rn(fe(F,"adGroups"),{name:ne,brandCode:L.brandCode||"",notes:L.details||"",uploadedBy:((G=Fe.currentUser)==null?void 0:G.uid)||null,createdAt:Mt(),status:"pending",reviewedCount:0,approvedCount:0,editCount:0,rejectedCount:0,thumbnailUrl:"",lastUpdated:Mt(),visibility:"private",requireAuth:!1,requirePassword:!1,password:"",dueDate:L.dueDate||null,clientNote:"",designerId:L.designerId||null,editorId:L.editorId||null});await He(ie(F,"requests",L.id),{status:"done"}),r(Qe=>Qe.map(nt=>nt.id===L.id?{...nt,status:"done"}:nt)),M(`/ad-group/${de.id}`)}catch(de){console.error("Failed to create group",de)}}},Y=n.filter(L=>L.status==="new"),V=n.filter(L=>L.status==="pending"),q=n.filter(L=>L.status==="ready"),ae=n.filter(L=>L.status==="done"),Ee={new:Y,pending:V,ready:q,done:ae};return i.jsxs("div",{className:"min-h-screen p-4",children:[i.jsx("h1",{className:"text-2xl mb-4",children:"Tickets"}),i.jsxs("div",{className:"flex items-center justify-between mb-4 flex-wrap gap-2",children:[i.jsxs("button",{onClick:w,className:"btn-primary flex items-center gap-1",children:[i.jsx(Yi,{})," Add Ticket"]}),i.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[i.jsx(_t,{active:y==="table",onClick:()=>v("table"),"aria-label":"Table view",children:i.jsx(Zl,{})}),i.jsx(_t,{active:y==="kanban",onClick:()=>v("kanban"),"aria-label":"Kanban view",children:i.jsx(px,{})}),i.jsx(_t,{active:y==="dashboard",onClick:()=>v("dashboard"),"aria-label":"Dashboard view",children:i.jsx(fx,{})})]})]}),y==="table"?i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"mb-8",children:[i.jsx("h2",{className:"text-xl mb-2",children:"New"}),s?i.jsx("p",{children:"Loading..."}):Y.length===0?i.jsx("p",{children:"No tickets."}):i.jsxs(Un,{children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Brand"}),i.jsx("th",{children:"Due Date"}),i.jsx("th",{children:"# Ads"}),i.jsx("th",{children:"Details"}),i.jsx("th",{children:"Status"}),i.jsx("th",{children:"Actions"})]})}),i.jsx("tbody",{children:Y.map(L=>i.jsxs("tr",{children:[i.jsx("td",{children:L.brandCode}),i.jsx("td",{children:L.dueDate?L.dueDate.toDate().toLocaleDateString():""}),i.jsx("td",{children:L.numAds}),i.jsx("td",{dangerouslySetInnerHTML:{__html:Cc(L.details)}}),i.jsx("td",{children:i.jsxs("select",{value:L.status,onChange:B=>pe(L.id,B.target.value),className:`status-select status-${L.status.replace(/\s+/g,"_")}`,children:[i.jsx("option",{value:"new",children:"New"}),i.jsx("option",{value:"pending",children:"Pending"}),i.jsx("option",{value:"ready",children:"Ready"}),i.jsx("option",{value:"done",children:"Done"})]})}),i.jsx("td",{className:"text-center",children:i.jsxs("div",{className:"flex items-center justify-center",children:[i.jsx(be,{onClick:()=>E(L),className:"mr-2","aria-label":"Edit",children:i.jsx(Ar,{})}),i.jsx(be,{onClick:()=>D(L.id),"aria-label":"Delete",children:i.jsx(qt,{})}),i.jsx(be,{onClick:()=>I(L.id),className:"ml-2","aria-label":"Archive",children:i.jsx(Ks,{})})]})})]},L.id))})]})]}),i.jsxs("div",{className:"mb-8",children:[i.jsx("h2",{className:"text-xl mb-2",children:"Pending"}),s?i.jsx("p",{children:"Loading..."}):V.length===0?i.jsx("p",{children:"No tickets."}):i.jsxs(Un,{children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Brand"}),i.jsx("th",{children:"Due Date"}),i.jsx("th",{children:"# Ads"}),i.jsx("th",{children:"Details"}),i.jsx("th",{children:"Status"}),i.jsx("th",{children:"Actions"})]})}),i.jsx("tbody",{children:V.map(L=>i.jsxs("tr",{children:[i.jsx("td",{children:L.brandCode}),i.jsx("td",{children:L.dueDate?L.dueDate.toDate().toLocaleDateString():""}),i.jsx("td",{children:L.numAds}),i.jsx("td",{dangerouslySetInnerHTML:{__html:Cc(L.details)}}),i.jsx("td",{children:i.jsxs("select",{value:L.status,onChange:B=>pe(L.id,B.target.value),className:`status-select status-${L.status.replace(/\s+/g,"_")}`,children:[i.jsx("option",{value:"new",children:"New"}),i.jsx("option",{value:"pending",children:"Pending"}),i.jsx("option",{value:"ready",children:"Ready"}),i.jsx("option",{value:"done",children:"Done"})]})}),i.jsx("td",{className:"text-center",children:i.jsxs("div",{className:"flex items-center justify-center",children:[i.jsx(be,{onClick:()=>E(L),className:"mr-2","aria-label":"Edit",children:i.jsx(Ar,{})}),i.jsx(be,{onClick:()=>D(L.id),"aria-label":"Delete",children:i.jsx(qt,{})}),i.jsx(be,{onClick:()=>I(L.id),className:"ml-2","aria-label":"Archive",children:i.jsx(Ks,{})})]})})]},L.id))})]})]}),i.jsxs("div",{className:"mb-8",children:[i.jsx("h2",{className:"text-xl mb-2",children:"Ready"}),s?i.jsx("p",{children:"Loading..."}):q.length===0?i.jsx("p",{children:"No tickets."}):i.jsxs(Un,{children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Brand"}),i.jsx("th",{children:"Due Date"}),i.jsx("th",{children:"# Ads"}),i.jsx("th",{children:"Details"}),i.jsx("th",{children:"Status"}),i.jsx("th",{children:"Actions"})]})}),i.jsx("tbody",{children:q.map(L=>i.jsxs("tr",{children:[i.jsx("td",{children:L.brandCode}),i.jsx("td",{children:L.dueDate?L.dueDate.toDate().toLocaleDateString():""}),i.jsx("td",{children:L.numAds}),i.jsx("td",{dangerouslySetInnerHTML:{__html:Cc(L.details)}}),i.jsx("td",{children:i.jsxs("select",{value:L.status,onChange:B=>pe(L.id,B.target.value),className:`status-select status-${L.status.replace(/\s+/g,"_")}`,children:[i.jsx("option",{value:"new",children:"New"}),i.jsx("option",{value:"pending",children:"Pending"}),i.jsx("option",{value:"ready",children:"Ready"}),i.jsx("option",{value:"done",children:"Done"})]})}),i.jsx("td",{className:"text-center",children:i.jsxs("div",{className:"flex items-center justify-center",children:[i.jsx(be,{onClick:()=>E(L),className:"mr-2","aria-label":"Edit",children:i.jsx(Ar,{})}),i.jsx(be,{onClick:()=>D(L.id),"aria-label":"Delete",children:i.jsx(qt,{})}),i.jsx(be,{onClick:()=>I(L.id),className:"ml-2","aria-label":"Archive",children:i.jsx(Ks,{})})]})})]},L.id))})]})]}),i.jsxs("div",{children:[i.jsx("h2",{className:"text-xl mb-2",children:"Done"}),ae.length===0?i.jsx("p",{children:"No tickets."}):i.jsxs(Un,{children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Brand"}),i.jsx("th",{children:"Due Date"}),i.jsx("th",{children:"# Ads"}),i.jsx("th",{children:"Details"}),i.jsx("th",{children:"Status"}),i.jsx("th",{children:"Actions"})]})}),i.jsx("tbody",{children:ae.map(L=>i.jsxs("tr",{children:[i.jsx("td",{children:L.brandCode}),i.jsx("td",{children:L.dueDate?L.dueDate.toDate().toLocaleDateString():""}),i.jsx("td",{children:L.numAds}),i.jsx("td",{dangerouslySetInnerHTML:{__html:Cc(L.details)}}),i.jsx("td",{children:i.jsxs("select",{value:L.status,onChange:B=>pe(L.id,B.target.value),className:`status-select status-${L.status.replace(/\s+/g,"_")}`,children:[i.jsx("option",{value:"new",children:"New"}),i.jsx("option",{value:"pending",children:"Pending"}),i.jsx("option",{value:"ready",children:"Ready"}),i.jsx("option",{value:"done",children:"Done"})]})}),i.jsx("td",{className:"text-center",children:i.jsxs("div",{className:"flex items-center justify-center",children:[i.jsx(be,{onClick:()=>E(L),className:"mr-2","aria-label":"Edit",children:i.jsx(Ar,{})}),i.jsx(be,{onClick:()=>D(L.id),"aria-label":"Delete",children:i.jsx(qt,{})}),i.jsx(be,{onClick:()=>I(L.id),className:"ml-2","aria-label":"Archive",children:i.jsx(Ks,{})})]})})]},L.id))})]})]})]}):y==="kanban"?i.jsx("div",{className:"overflow-x-auto mt-[0.8rem]",children:i.jsx("div",{className:"min-w-max flex gap-4",children:["new","pending","ready","done"].map(L=>i.jsxs("div",{className:"flex-shrink-0 w-[240px] sm:w-[320px]",onDragOver:J,onDrop:()=>Ae(L),children:[i.jsx("h2",{className:"text-xl mb-2 capitalize",children:L}),i.jsx("div",{className:"bg-[#F7F7F7] dark:bg-[var(--dark-bg)] border border-gray-300 dark:border-gray-600 rounded-t-[1rem] rounded-b-[1rem] flex flex-col items-center gap-4 p-[0.6rem] overflow-y-auto",style:{maxHeight:"calc(100vh - 13rem)"},children:s?i.jsx("p",{children:"Loading..."}):Ee[L].length===0?i.jsx("p",{children:"No tickets."}):i.jsx(i.Fragment,{children:Ee[L].map(B=>i.jsx(QU,{request:B,onEdit:E,onDelete:D,onArchive:I,onDragStart:Xe,onCreateGroup:z},B.id))})})]},L))})}):i.jsx(JU,{requests:n}),o&&i.jsxs(Hs,{children:[i.jsx("h2",{className:"text-xl mb-4",children:c?"Edit Ticket":"Add Ticket"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Type"}),i.jsxs("select",{value:h.type,onChange:L=>f(B=>({...B,type:L.target.value})),className:"w-full p-2 border rounded",children:[i.jsx("option",{value:"newAds",children:"New Ads"}),i.jsx("option",{value:"newBrand",children:"New Brand"}),i.jsx("option",{value:"bug",children:"Bug"}),i.jsx("option",{value:"feature",children:"Feature"})]})]}),e&&i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Editor"}),i.jsxs("select",{value:h.editorId,onChange:L=>f(B=>({...B,editorId:L.target.value})),className:"w-full p-2 border rounded",children:[i.jsx("option",{value:"",children:"Select editor"}),C.map(L=>i.jsx("option",{value:L.id,children:L.name},L.id))]})]}),h.type==="newAds"&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Brand"}),i.jsxs("select",{value:h.brandCode,onChange:L=>f(B=>({...B,brandCode:L.target.value})),className:"w-full p-2 border rounded",children:[i.jsx("option",{value:"",children:"Select brand"}),p.map(L=>i.jsx("option",{value:L,children:L},L))]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Title"}),i.jsx("input",{type:"text",value:h.title,onChange:L=>f(B=>({...B,title:L.target.value})),className:"w-full p-2 border rounded"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Due Date"}),i.jsx("input",{type:"date",value:h.dueDate,onChange:L=>f(B=>({...B,dueDate:L.target.value})),className:"w-full p-2 border rounded"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Designer"}),i.jsxs("select",{value:h.designerId,onChange:L=>f(B=>({...B,designerId:L.target.value})),className:"w-full p-2 border rounded",children:[i.jsx("option",{value:"",children:"Select designer"}),S.map(L=>i.jsx("option",{value:L.id,children:L.name},L.id))]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Number of Ads"}),i.jsx("input",{type:"number",min:"1",value:h.numAds,onChange:L=>f(B=>({...B,numAds:L.target.value})),className:"w-full p-2 border rounded"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Details"}),i.jsx("textarea",{value:h.details,onChange:L=>f(B=>({...B,details:L.target.value})),onKeyDown:K,className:"w-full p-2 border rounded",rows:3})]})]}),h.type==="newBrand"&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Brand Code"}),i.jsx("input",{type:"text",value:h.brandCode,onChange:L=>f(B=>({...B,brandCode:L.target.value})),className:"w-full p-2 border rounded"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Brand Name"}),i.jsx("input",{type:"text",value:h.name,onChange:L=>f(B=>({...B,name:L.target.value})),className:"w-full p-2 border rounded"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Agency ID"}),i.jsxs("select",{value:h.agencyId,onChange:L=>f(B=>({...B,agencyId:L.target.value})),className:"w-full p-2 border rounded",children:[i.jsx("option",{value:"",children:"Select agency"}),b.map(L=>i.jsx("option",{value:L.id,children:L.name},L.id))]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Tone of Voice"}),i.jsx("input",{type:"text",value:h.toneOfVoice,onChange:L=>f(B=>({...B,toneOfVoice:L.target.value})),className:"w-full p-2 border rounded"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Offering"}),i.jsx("input",{type:"text",value:h.offering,onChange:L=>f(B=>({...B,offering:L.target.value})),className:"w-full p-2 border rounded"})]})]}),(h.type==="bug"||h.type==="feature")&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Title"}),i.jsx("input",{type:"text",value:h.title,onChange:L=>f(B=>({...B,title:L.target.value})),className:"w-full p-2 border rounded"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Description"}),i.jsx("textarea",{value:h.details,onChange:L=>f(B=>({...B,details:L.target.value})),onKeyDown:K,className:"w-full p-2 border rounded",rows:3})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Priority"}),i.jsxs("select",{value:h.priority,onChange:L=>f(B=>({...B,priority:L.target.value})),className:"w-full p-2 border rounded",children:[i.jsx("option",{value:"low",children:"Low"}),i.jsx("option",{value:"medium",children:"Medium"}),i.jsx("option",{value:"high",children:"High"})]})]})]})]}),i.jsxs("div",{className:"text-right mt-4 space-x-2",children:[i.jsx("button",{onClick:N,className:"btn-primary",children:"Save"}),i.jsx("button",{onClick:()=>{l(!1),x()},className:"btn-secondary",children:"Cancel"})]})]})]})},XU=()=>{const t=Fe.currentUser;return i.jsx(kS,{filterEditorId:t==null?void 0:t.uid,canAssignEditor:!1})},ed=({title:t,children:e,className:n=""})=>i.jsxs("div",{className:`min-h-screen p-4 ${n}`,children:[t&&i.jsx("h1",{className:"text-2xl mb-4",children:t}),e]});function $g(t=new Date){const e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0");return`${e}-${n}`}const ZU=({startDate:t,endDate:e,onChange:n})=>{const r=()=>{const s=$g();n({start:s,end:s})};return i.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[i.jsx("input",{type:"month",value:t,onChange:s=>n({start:s.target.value,end:e}),className:"border px-2 py-1 rounded"}),i.jsx("span",{children:"-"}),i.jsx("input",{type:"month",value:e,onChange:s=>n({start:t,end:s.target.value}),className:"border px-2 py-1 rounded"}),i.jsx("button",{type:"button",onClick:r,className:"btn-secondary px-2 py-1",children:"This Month"})]})};function e3(){const t=$g(),e=(()=>{const c=new Date;return c.setMonth(c.getMonth()-1),$g(c)})(),[n,r]=m.useState({start:e,end:t}),[s,a]=m.useState([]),[o,l]=m.useState(!0);return m.useEffect(()=>{let c=!0;return(async()=>{l(!0);try{const[h,f]=n.start.split("-").map(Number),[p,k]=n.end.split("-").map(Number),S=new Date(Date.UTC(h,f-1,1)),T=new Date(Date.UTC(p,k,0,23,59,59,999)),j=(await Ne(fe(F,"brands"))).docs.map(v=>({id:v.id,...v.data()})),y=[];for(const v of j){const R=Array.isArray(v.contracts)?v.contracts:[];let O=0;for(const Ae of R){if(!Ae.startDate)continue;const J=Number(Ae.stills||0),K=Number(Ae.videos||0);let z=new Date(Ae.startDate);const Y=Ae.endDate?new Date(Ae.endDate):null;for(;z<=T&&(!Y||z<=Y)&&(z>=S&&z<=T&&(O+=J+K),!!Ae.renews);)z.setMonth(z.getMonth()+1)}if(O===0)continue;const M=Ye(fe(F,"adGroups"),Je("brandCode","==",v.code||v.codeId||""),Je("dueDate",">=",sn.fromDate(S)),Je("dueDate","<=",sn.fromDate(T))),b=await Ne(M),x=new Set,w=new Set,E=new Set;for(const Ae of b.docs)(await Ne(fe(F,"adGroups",Ae.id,"assets"))).docs.forEach(K=>{const z=K.data()||{},Y=Ft(z.filename||""),V=z.recipeCode||Y.recipeCode||"";if(!V)return;const ae=`${z.adGroupCode||Y.adGroupCode||Ae.id}-${V}`;x.add(ae),["ready","approved","rejected","edit_requested"].includes(z.status)&&E.add(ae),z.status==="approved"&&w.add(ae)});const N=x.size,D=E.size,I=w.size,pe=O>I?O-I:0,Xe=I<O?"under":I>O?"over":"complete";y.push({id:v.id,code:v.code,name:v.name,contracted:O,briefed:N,delivered:D,approved:I,needed:pe,status:Xe})}c&&a(y)}catch(h){console.error("Failed to fetch dashboard data",h),c&&a([])}finally{c&&l(!1)}})(),()=>{c=!1}},[n.start,n.end]),i.jsxs(ed,{title:"Dashboard",children:[i.jsx(ZU,{startDate:n.start,endDate:n.end,onChange:c=>r(c)}),o?i.jsx("p",{children:"Loading..."}):s.length===0?i.jsx("p",{children:"No contracts found."}):i.jsxs(Un,{children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Brand"}),i.jsx("th",{children:"Contracted"}),i.jsx("th",{children:"Briefed"}),i.jsx("th",{children:"Delivered"}),i.jsx("th",{children:"Approved"}),i.jsx("th",{children:"Needed"}),i.jsx("th",{children:"Status"})]})}),i.jsx("tbody",{children:s.map(c=>i.jsxs("tr",{children:[i.jsx("td",{children:c.code||c.name}),i.jsx("td",{className:"text-center",children:c.contracted}),i.jsx("td",{className:"text-center",children:c.briefed}),i.jsx("td",{className:"text-center",children:c.delivered}),i.jsx("td",{className:"text-center",children:c.approved}),i.jsx("td",{className:"text-center",children:c.needed}),i.jsx("td",{className:"text-center",children:c.status==="under"?i.jsxs("span",{className:"flex items-center justify-center gap-1 text-reject",children:[i.jsx(mx,{}),c.status]}):c.status==="over"?i.jsxs("span",{className:"flex items-center justify-center gap-1 text-edit",children:[i.jsx(Su,{}),c.status]}):c.status==="complete"?i.jsxs("span",{className:"flex items-center justify-center gap-1 text-approve",children:[i.jsx(gx,{}),c.status]}):c.status})]},c.id))})]})]})}function t3(){const[t,e]=m.useState(null),n=new URLSearchParams(Es().search).get("agencyId");return m.useEffect(()=>{async function r(){if(!n)return;const s=ie(F,"agencies",n),a=await gn(s);a.exists()&&e(a.data())}r()},[n]),i.jsx("div",{className:"p-4",style:{color:t==null?void 0:t.themeColor},children:t&&i.jsx(Pn,{pngUrl:t.logoUrl,alt:`${t.name} logo`,loading:"eager",cacheKey:t.logoUrl,className:"mb-4 max-h-16 w-auto"})})}const n3=()=>i.jsxs("div",{className:"min-h-screen p-4",children:[i.jsx("h1",{className:"text-2xl mb-4",children:"Request"}),i.jsx("p",{children:"Coming soon..."})]}),r3=Po(ni);async function Wc(t,e,n){const s=`Campfire/Brands/${(e||"").replace(/\//g,"-").trim()}/Assets/${n}/${t.name}`,a=xi(r3,s);return await Jl(a,t,{cacheControl:"public,max-age=31536000,immutable"}),await Xl(a)}const Yn=({label:t,children:e,className:n=""})=>i.jsxs("div",{className:n,children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:t}),e]}),Pd={url:"",file:null},Dd={type:"google",value:"",name:"",file:null},s3=({brandId:t=null,brandCode:e=""})=>{const n=Fe.currentUser,{brandCodes:r}=Fr(n==null?void 0:n.uid),[s,a]=m.useState(t),[o,l]=m.useState(e||r[0]||""),[c,d]=m.useState({url:"",file:null}),[h,f]=m.useState([{...Pd}]),[p,k]=m.useState(["#000000"]),[S,T]=m.useState([{...Dd}]),[C,j]=m.useState(""),[y,v]=m.useState(""),[R,O]=m.useState(!1);m.useEffect(()=>{!t&&!e&&l(r[0]||"")},[r,t,e]),m.useEffect(()=>{(async()=>{try{if(t){const E=await gn(ie(F,"brands",t));if(E.exists()){a(t);const N=E.data();l(N.code||e),j(N.offering||""),d({url:N.guidelinesUrl||"",file:null}),f(Array.isArray(N.logos)&&N.logos.length?N.logos.map(D=>({url:D,file:null})):[{...Pd}]),k(Array.isArray(N.palette)&&N.palette.length?N.palette:["#000000"]),T(Array.isArray(N.fonts)&&N.fonts.length?N.fonts.map(D=>({type:D.type||"google",value:D.value||"",name:D.name||"",file:null})):[{...Dd}])}}else if(o){const E=Ye(fe(F,"brands"),Je("code","==",o)),N=await Ne(E);if(!N.empty){const D=N.docs[0];a(D.id);const I=D.data();l(I.code||o),j(I.offering||""),d({url:I.guidelinesUrl||"",file:null}),f(Array.isArray(I.logos)&&I.logos.length?I.logos.map(pe=>({url:pe,file:null})):[{...Pd}]),k(Array.isArray(I.palette)&&I.palette.length?I.palette:["#000000"]),T(Array.isArray(I.fonts)&&I.fonts.length?I.fonts.map(pe=>({type:pe.type||"google",value:pe.value||"",name:pe.name||"",file:null})):[{...Dd}])}}}catch(E){console.error("Failed to load brand",E)}})()},[o,t,e]);const M=async w=>{if(w.preventDefault(),!!s){O(!0),v("");try{let E=c.url;c.file&&(E=await Wc(c.file,o,"guidelines"));const N=[];for(const I of h)if(I.file){const pe=await Wc(I.file,o,"logos");N.push(pe)}else I.url&&N.push(I.url);const D=[];for(const I of S)if(I.type==="custom"){let pe=I.value;I.file&&(pe=await Wc(I.file,o,"fonts")),pe&&D.push({type:"custom",value:pe,name:I.name||""})}else I.type==="google"&&I.value&&D.push({type:"google",value:I.value});await Jn(ie(F,"brands",s),{guidelinesUrl:E,logos:N,palette:p,fonts:D,offering:C},{merge:!0}),d({url:E,file:null}),f(N.map(I=>({url:I,file:null}))),T(D.map(I=>({...I,file:null}))),v("Brand assets saved")}catch(E){console.error("Failed to save brand",E),v("Failed to save brand")}finally{O(!1)}}},b=(w,E)=>{f(N=>N.map((D,I)=>I===w?{url:E?URL.createObjectURL(E):D.url,file:E}:D))},x=(w,E)=>{T(N=>N.map((D,I)=>I===w?{...D,...E}:D))};return i.jsx(ed,{title:"Brand Setup",children:i.jsxs("form",{onSubmit:M,className:"space-y-4 max-w-md",children:[i.jsx(Yn,{label:"Offering",children:i.jsx("input",{type:"text",value:C,onChange:w=>j(w.target.value),className:"w-full p-2 border rounded"})}),i.jsxs(Yn,{label:"Brand Guidelines (PDF)",children:[i.jsx("input",{type:"file",accept:"application/pdf",onChange:w=>d({url:c.url,file:w.target.files[0]||null}),className:"w-full p-2 border rounded"}),c.url&&i.jsx("a",{href:c.url,target:"_blank",rel:"noopener noreferrer",className:"text-sm underline block mt-1",children:"Current file"})]}),i.jsxs(Yn,{label:"Logos",children:[h.map((w,E)=>i.jsxs("div",{className:"mb-2",children:[i.jsx("input",{type:"file",accept:"image/*",onChange:N=>b(E,N.target.files[0]),className:"w-full p-2 border rounded"}),w.url&&i.jsx("img",{src:w.url,alt:"logo",className:"mt-1 h-16 w-auto"})]},E)),i.jsx("button",{type:"button",onClick:()=>f(w=>[...w,{...Pd}]),className:"btn-action mt-1",children:"Add Logo"})]}),i.jsxs(Yn,{label:"Palette",children:[p.map((w,E)=>i.jsxs("div",{className:"flex items-center mb-2 space-x-2",children:[i.jsx("input",{type:"color",value:w,onChange:N=>k(D=>D.map((I,pe)=>pe===E?N.target.value:I)),className:"h-10 w-10 p-0 border rounded"}),i.jsx("input",{type:"text",value:w,onChange:N=>k(D=>D.map((I,pe)=>pe===E?N.target.value:I)),className:"w-24 p-1 border rounded"})]},E)),i.jsx("button",{type:"button",onClick:()=>k(w=>[...w,"#000000"]),className:"btn-action mt-1",children:"Add Color"})]}),i.jsxs(Yn,{label:"Typefaces",children:[S.map((w,E)=>i.jsxs("div",{className:"mb-2 space-y-1",children:[i.jsxs("select",{value:w.type,onChange:N=>x(E,{type:N.target.value}),className:"p-1 border rounded mr-2",children:[i.jsx("option",{value:"google",children:"Google Font"}),i.jsx("option",{value:"custom",children:"Custom"})]}),w.type==="google"?i.jsx("input",{type:"text",value:w.value,placeholder:"Font Name",onChange:N=>x(E,{value:N.target.value}),className:"w-full p-2 border rounded"}):i.jsxs(i.Fragment,{children:[i.jsx("input",{type:"text",value:w.name,placeholder:"Font Name",onChange:N=>x(E,{name:N.target.value}),className:"w-full p-2 border rounded"}),i.jsx("input",{type:"file",onChange:N=>x(E,{file:N.target.files[0],value:N.target.files[0]?URL.createObjectURL(N.target.files[0]):w.value}),className:"w-full p-2 border rounded"})]}),w.type==="custom"&&w.value&&!w.file&&i.jsx("a",{href:w.value,target:"_blank",rel:"noopener noreferrer",className:"text-sm underline block",children:"Current file"}),i.jsx("button",{type:"button",onClick:()=>T(N=>N.filter((D,I)=>I!==E)),className:"btn-action",children:"Delete"})]},E)),i.jsx("button",{type:"button",onClick:()=>T(w=>[...w,{...Dd}]),className:"btn-action mt-1",children:"Add Typeface"})]}),y&&i.jsx("p",{className:"text-sm",children:y}),i.jsx("div",{className:"text-right",children:i.jsx("button",{type:"submit",className:"btn-primary",disabled:R,children:R?"Saving...":"Save Assets"})})]})})};async function wx(t="",e=[]){if(!Array.isArray(e))return;const n=t?Ye(fe(F,"adAssets"),Je("brandCode","==",t)):fe(F,"adAssets"),s=(await Ne(n)).docs.map(l=>l.id),a=e.map(l=>l.id),o=[];for(const l of s)a.includes(l)||o.push(mn(ie(F,"adAssets",l)));for(const l of e)!l||!l.id||o.push(Jn(ie(F,"adAssets",l.id),{...l,brandCode:t},{merge:!0}));await Promise.all(o)}const i3=({onClose:t,brandCode:e=""})=>{const[n,r]=m.useState(""),[s,a]=m.useState(""),[o,l]=m.useState(!1),[c,d]=m.useState([]),[h,f]=m.useState(""),[p,k]=m.useState("");m.useEffect(()=>(lm("taggerModalOpen","true"),()=>{so("taggerModalOpen")}),[]);const S=(y,v,R)=>{d(O=>O.map((M,b)=>b===y?{...M,[v]:R}:M))},T=async()=>{try{let y=fe(F,"adAssets");e&&(y=Ye(y,Je("brandCode","==",e)));const R=(await Ne(y)).docs.map(b=>({id:b.id,...b.data()})),O=Object.fromEntries(R.filter(b=>b.url).map(b=>[b.url,b])),M=[...R];for(const b of c){if(O[b.url])continue;const x={id:Math.random().toString(36).slice(2),createdAt:Date.now(),...b};M.push(x),O[b.url]=x}await wx(e,M),so("pendingTaggerJobId"),so("pendingTaggerJobBrand"),t()}catch(y){console.error("Failed to save assets",y)}};m.useEffect(()=>{if(!p)return;const y=ps(ie(F,"taggerJobs",p),v=>{const R=v.data();if(R)if(R.status==="complete"){const O=Array.isArray(R.results)?R.results:[];d(M=>[...M,...O]),l(!1)}else R.status==="error"&&(f(R.error||"Failed to tag assets"),l(!1))});return()=>y()},[p]);const C=async y=>{var v;if(y.preventDefault(),!n||n.trim()===""){f("Drive folder URL is required");return}l(!0),f(""),k("");try{const R={driveFolderUrl:n.trim(),campaign:s},M=await gl(yl,"tagger",{timeout:3e5})({data:R,...R});if((v=M.data)!=null&&v.jobId){k(M.data.jobId);try{lm("pendingTaggerJobId",M.data.jobId),e&&lm("pendingTaggerJobBrand",e)}catch{}}else throw new Error("No job ID returned")}catch(R){console.error("Tagger failed",R),R&&(console.error("Error code:",R.code),console.error("Error message:",R.message),console.error("Error details:",R.details)),f("Failed to tag assets"),l(!1)}},j=async()=>{var y;if(!n||n.trim()===""){f("Drive folder URL is required");return}l(!0),f("");try{const v={driveFolderUrl:n.trim(),campaign:s},O=await gl(yl,"listDriveFiles",{timeout:6e4})({data:v,...v}),M=Array.isArray((y=O.data)==null?void 0:y.results)?O.data.results:[];d(b=>[...b,...M])}catch(v){console.error("Add rows from drive failed",v),f("Failed to add rows")}l(!1)};return i.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:i.jsxs("div",{className:"bg-white p-4 rounded shadow max-w-lg w-full relative dark:bg-[var(--dark-sidebar-bg)] dark:text-[var(--dark-text)]",children:[o&&i.jsx(ec,{text:"Tagging assets...",className:"!absolute"}),i.jsx("h3",{className:"mb-2 font-semibold",children:"Tag Assets from Drive"}),!p&&c.length===0||o?i.jsxs("form",{onSubmit:C,className:"space-y-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm",children:"Google Drive Folder Link"}),i.jsx("input",{type:"text",value:n,onChange:y=>r(y.target.value),className:"w-full p-1 border rounded",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm",children:"Folder Name"}),i.jsx("input",{type:"text",value:s,onChange:y=>a(y.target.value),className:"w-full p-1 border rounded"})]}),h&&i.jsx("p",{className:"text-sm text-red-600",children:h}),i.jsxs("div",{className:"text-right space-x-2",children:[i.jsx("button",{type:"button",onClick:t,className:"btn-secondary px-3 py-1",children:"Cancel"}),i.jsx("button",{type:"button",onClick:j,className:"btn-primary px-3 py-1",disabled:o,children:"Add Rows from Drive"})]})]}):i.jsxs("div",{className:"space-y-3",children:[i.jsxs("form",{onSubmit:y=>{y.preventDefault(),j()},className:"space-y-2",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm",children:"Google Drive Folder Link"}),i.jsx("input",{type:"text",value:n,onChange:y=>r(y.target.value),className:"w-full p-1 border rounded",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm",children:"Folder Name"}),i.jsx("input",{type:"text",value:s,onChange:y=>a(y.target.value),className:"w-full p-1 border rounded"})]}),i.jsx("div",{className:"text-right",children:i.jsx("button",{type:"submit",className:"btn-primary px-3 py-1",disabled:o,children:"Add Rows from Drive"})})]}),i.jsx("div",{className:"overflow-x-auto max-h-96",children:i.jsxs("table",{className:"ad-table min-w-max text-sm",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Name"}),i.jsx("th",{children:"URL"}),i.jsx("th",{children:"Type"}),i.jsx("th",{children:"Description"}),i.jsx("th",{children:"Product"}),i.jsx("th",{children:"Folder Name"})]})}),i.jsx("tbody",{children:c.map((y,v)=>i.jsxs("tr",{children:[i.jsx("td",{children:i.jsx("input",{className:"w-full p-1 border rounded",value:y.name,onChange:R=>S(v,"name",R.target.value)})}),i.jsx("td",{children:i.jsx("input",{className:"w-full p-1 border rounded",value:y.url,onChange:R=>S(v,"url",R.target.value)})}),i.jsx("td",{children:i.jsx("input",{className:"w-full p-1 border rounded",value:y.type,onChange:R=>S(v,"type",R.target.value)})}),i.jsx("td",{children:i.jsx("input",{className:"w-full p-1 border rounded",value:y.description,onChange:R=>S(v,"description",R.target.value)})}),i.jsx("td",{children:i.jsx("input",{className:"w-full p-1 border rounded",value:y.product,onChange:R=>S(v,"product",R.target.value)})}),i.jsx("td",{children:i.jsx("input",{className:"w-full p-1 border rounded",value:y.campaign,onChange:R=>S(v,"campaign",R.target.value)})})]},v))})]})}),i.jsxs("div",{className:"text-right space-x-2",children:[i.jsx("button",{onClick:t,className:"btn-secondary px-3 py-1",children:"Close"}),i.jsx("button",{onClick:T,className:"btn-primary px-3 py-1",children:"Save"})]})]})]})})},x_={id:"",name:"",url:"",type:"",description:"",product:"",campaign:"",thumbnailUrl:"",createdAt:null},a3=({brandCode:t=""})=>{const[e,n]=m.useState([]),[r,s]=m.useState({}),[a,o]=m.useState(""),[l,c]=m.useState("createdAt"),[d,h]=m.useState({type:"",product:"",campaign:""}),[f,p]=m.useState(!1),[k,S]=m.useState(!1),[T,C]=m.useState(!1),j=m.useRef(null),[y,v]=m.useState(!1),R=25,[O,M]=m.useState(0),[b,x]=m.useState(R),w=m.useRef(null),E=m.useRef(null),N=m.useRef(null);m.useEffect(()=>{let te=!1;(async()=>{try{let mt=fe(F,"adAssets");t&&(mt=Ye(mt,Je("brandCode","==",t)));const Ct=await Ne(mt);te||(n(Ct.docs.map(ze=>({id:ze.id,...ze.data()}))),v(!1))}catch(mt){console.error("Failed to load asset library",mt)}})();const Le=()=>{E.current=null,N.current=null};return window.addEventListener("mouseup",Le),()=>{te=!0,window.removeEventListener("mouseup",Le)}},[t]),m.useEffect(()=>{M(0),x(R)},[a,e]),m.useEffect(()=>{x(R)},[O]);const D=()=>{const te=Math.random().toString(36).slice(2);n(je=>[...je,{...x_,id:te,createdAt:Date.now()}]),v(!0)},I=(te,je,Le)=>{n(mt=>mt.map(Ct=>Ct.id===te?{...Ct,[je]:Le}:Ct)),v(!0)},pe=()=>{const te=Object.keys(r).filter(je=>r[je]);n(je=>je.filter(Le=>!te.includes(Le.id))),s({}),v(!0)},Xe=te=>{n(je=>je.filter(Le=>Le.id!==te)),s(je=>{const Le={...je};return delete Le[te],Le}),v(!0)},Ae=()=>{const te=Object.keys(r).filter(je=>r[je]);n(je=>je.map(Le=>te.includes(Le.id)?{...Le,...Object.fromEntries(Object.entries(d).filter(([mt,Ct])=>Ct!==""))}:Le)),h({type:"",product:"",campaign:""}),v(!0)},J=async()=>{var je;const te=e.filter(Le=>r[Le.id]);if(te.length!==0){p(!0);try{const Le=gl(yl,"generateThumbnailsForAssets",{timeout:6e4}),mt=te.map(it=>({url:it.url,name:it.name})),ze=((je=(await Le({assets:mt})).data)==null?void 0:je.results)||[];n(it=>it.map(jt=>{const Lt=ze.find(Xt=>Xt.name===jt.name);return Lt&&Lt.thumbnailUrl?{...jt,thumbnailUrl:Lt.thumbnailUrl}:jt})),v(!0)}catch(Le){console.error("Failed to generate thumbnails",Le)}p(!1)}},K=async()=>{var Le,mt;const te=e.filter(Ct=>!Ct.thumbnailUrl&&Ct.url);if(te.length===0)return;p(!0);const je=gl(yl,"generateThumbnailsForAssets",{timeout:6e4});for(const Ct of te)try{const it=(mt=(Le=(await je({assets:[{url:Ct.url,name:Ct.name}]})).data)==null?void 0:Le.results)==null?void 0:mt[0];it!=null&&it.thumbnailUrl&&n(jt=>jt.map(Lt=>Lt.id===Ct.id?{...Lt,thumbnailUrl:it.thumbnailUrl}:Lt))}catch(ze){console.error("Failed to generate thumbnail",ze)}p(!1),v(!0)},z=async te=>{var Le,mt;const je=gl(yl,"generateTagsForAssets",{timeout:3e5});try{const ze=(mt=(Le=(await je({assets:[{url:te.url,name:te.name}]})).data)==null?void 0:Le.results)==null?void 0:mt[0];ze&&(n(it=>it.map(jt=>jt.id===te.id?{...jt,type:ze.type||jt.type,description:ze.description||jt.description,product:ze.product||jt.product,campaign:ze.campaign||jt.campaign}:jt)),v(!0))}catch(Ct){console.error("Failed to tag asset",Ct)}},Y=async()=>{const te=e.filter(je=>r[je.id]&&je.url);if(te.length!==0){p(!0);for(const je of te)await z(je);p(!1),v(!0)}},V=async()=>{const te=e.filter(je=>(!je.type||!je.description)&&je.url);if(te.length!==0){p(!0);for(const je of te)await z(je);p(!1),v(!0)}},q=async()=>{try{await wx(t,e),alert("Assets saved"),v(!1)}catch(te){console.error("Failed to save assets",te)}},ae=(te,je,Le)=>{const mt=te.target.checked;if(te.shiftKey&&w.current!==null){const Ct=Math.min(w.current,je),ze=Math.max(w.current,je),it=G.slice(Ct,ze+1).map(jt=>jt.id);s(jt=>{const Lt={...jt};return it.forEach(Xt=>{Lt[Xt]=mt}),Lt})}else s(Ct=>({...Ct,[Le]:mt})),w.current=je},Ee=(te,je)=>Le=>{Le.altKey&&(E.current=je,N.current=te)},L=te=>je=>{E.current!==null&&N.current&&I(te,N.current,E.current)},B=async te=>{if(!te||te.length===0)return;p(!0);const je=[];for(const Le of te)try{const mt=await Wc(Le,t,"library");je.push({...x_,id:Math.random().toString(36).slice(2),createdAt:Date.now(),name:Le.name,url:mt,campaign:Le.webkitRelativePath?Le.webkitRelativePath.split("/")[0]:""})}catch(mt){console.error("Upload failed",mt)}n(Le=>[...Le,...je]),v(!0),p(!1)},G=e.filter(te=>{const je=a.toLowerCase();return!je||te.name.toLowerCase().includes(je)||te.product.toLowerCase().includes(je)||te.campaign.toLowerCase().includes(je)}).sort((te,je)=>l==="createdAt"?(je.createdAt||0)-(te.createdAt||0):l==="type"?(te.type||"").localeCompare(je.type||""):l==="product"?(te.product||"").localeCompare(je.product||""):l==="campaign"?(te.campaign||"").localeCompare(je.campaign||""):(te.name||"").localeCompare(je.name||"")),ne=Math.ceil(G.length/R)||1,de=O*R,Qe=G.slice(de,de+b),nt=de+b<Math.min(G.length,(O+1)*R);return i.jsxs("div",{children:[i.jsxs("div",{className:"mb-4 flex items-start justify-between flex-wrap gap-2",children:[i.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[i.jsxs("select",{value:l,onChange:te=>c(te.target.value),className:"p-1 border rounded",children:[i.jsx("option",{value:"createdAt",children:"Date Added"}),i.jsx("option",{value:"name",children:"Name"}),i.jsx("option",{value:"type",children:"Type"}),i.jsx("option",{value:"product",children:"Product"}),i.jsx("option",{value:"campaign",children:"Folder Name"})]}),i.jsx("input",{type:"text",placeholder:"Filter",value:a,onChange:te=>o(te.target.value),className:"p-1 border rounded"})]}),i.jsxs("div",{className:"flex flex-wrap gap-2 items-center relative",children:[i.jsxs("span",{className:"relative group",children:[i.jsx(be,{onClick:q,"aria-label":"Save",disabled:!y,className:`text-xl ${y?"bg-[var(--accent-color-10)] text-accent":""}`,children:i.jsx(oU,{})}),i.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-1 whitespace-nowrap bg-white border rounded text-xs p-1 shadow hidden group-hover:block dark:bg-[var(--dark-sidebar-bg)]",children:"Save"})]}),i.jsx("div",{className:"border-l h-6 mx-2"}),i.jsxs("span",{className:"relative group",children:[i.jsx(be,{onClick:()=>C(te=>!te),"aria-label":"Add Folder",className:"text-xl",children:i.jsx(nU,{})}),i.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-1 whitespace-nowrap bg-white border rounded text-xs p-1 shadow hidden group-hover:block dark:bg-[var(--dark-sidebar-bg)]",children:"Upload Folder"})]}),i.jsxs("div",{className:"relative",children:[T&&i.jsxs("div",{className:"absolute right-0 mt-1 bg-white border rounded shadow z-10 dark:bg-[var(--dark-sidebar-bg)]",children:[i.jsxs("button",{type:"button",className:"btn-action w-full text-left",onClick:()=>{C(!1),S(!0)},children:[i.jsx(Ol,{})," Drive"]}),i.jsxs("button",{type:"button",className:"btn-action w-full text-left",onClick:()=>{var te;C(!1),(te=j.current)==null||te.click()},children:[i.jsx(kc,{})," Upload"]})]}),i.jsx("input",{ref:j,type:"file",multiple:!0,webkitdirectory:"true",className:"hidden",onChange:te=>{B(te.target.files),te.target.value=null}})]}),i.jsxs("span",{className:"relative group",children:[i.jsx(be,{onClick:D,"aria-label":"Add Row",className:"text-xl",children:i.jsx(Yi,{})}),i.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-1 whitespace-nowrap bg-white border rounded text-xs p-1 shadow hidden group-hover:block dark:bg-[var(--dark-sidebar-bg)]",children:"Add Row"})]}),i.jsx("div",{className:"border-l h-6 mx-2"}),i.jsxs("span",{className:"relative group",children:[i.jsx(be,{onClick:K,"aria-label":"Create Missing Thumbnails",disabled:f,className:"text-xl",children:i.jsx(qc,{})}),i.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-1 whitespace-nowrap bg-white border rounded text-xs p-1 shadow hidden group-hover:block dark:bg-[var(--dark-sidebar-bg)]",children:"Thumbnails"})]}),i.jsxs("span",{className:"relative group",children:[i.jsx(be,{onClick:V,"aria-label":"Tag Missing",disabled:f,className:"text-xl",children:i.jsx(o_,{})}),i.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-1 whitespace-nowrap bg-white border rounded text-xs p-1 shadow hidden group-hover:block dark:bg-[var(--dark-sidebar-bg)]",children:"Auto Tag"})]})]})]}),Object.keys(r).some(te=>r[te])&&i.jsxs("div",{className:"mb-2 flex flex-wrap gap-2 items-end",children:[i.jsxs("span",{className:"relative group",children:[i.jsx(be,{onClick:pe,"aria-label":"Delete Selected",className:"btn-delete text-xl",children:i.jsx(qt,{})}),i.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-1 whitespace-nowrap bg-white border rounded text-xs p-1 shadow hidden group-hover:block dark:bg-[var(--dark-sidebar-bg)]",children:"Delete"})]}),i.jsxs("span",{className:"relative group",children:[i.jsx(be,{onClick:J,"aria-label":"Create Thumbnails",disabled:f,className:"text-xl",children:i.jsx(qc,{})}),i.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-1 whitespace-nowrap bg-white border rounded text-xs p-1 shadow hidden group-hover:block dark:bg-[var(--dark-sidebar-bg)]",children:"Thumbnails"})]}),i.jsxs("span",{className:"relative group",children:[i.jsx(be,{onClick:Y,"aria-label":"Tag Selected",disabled:f,className:"text-xl",children:i.jsx(o_,{})}),i.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-1 whitespace-nowrap bg-white border rounded text-xs p-1 shadow hidden group-hover:block dark:bg-[var(--dark-sidebar-bg)]",children:"Auto Tag"})]}),i.jsx("input",{className:"p-1 border rounded",placeholder:"Type",value:d.type,onChange:te=>h({...d,type:te.target.value})}),i.jsx("input",{className:"p-1 border rounded",placeholder:"Product",value:d.product,onChange:te=>h({...d,product:te.target.value})}),i.jsx("input",{className:"p-1 border rounded",placeholder:"Folder Name",value:d.campaign,onChange:te=>h({...d,campaign:te.target.value})}),i.jsx("button",{type:"button",className:"btn-secondary",onClick:Ae,children:"Apply To Selected"})]}),i.jsxs(Un,{children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{}),i.jsx("th",{children:"Name"}),i.jsx("th",{children:"URL"}),i.jsx("th",{children:"Thumbnail"}),i.jsx("th",{children:"Type"}),i.jsx("th",{children:"Description"}),i.jsx("th",{children:"Product"}),i.jsx("th",{children:"Folder Name"}),i.jsx("th",{})]})}),i.jsx("tbody",{children:Qe.map((te,je)=>i.jsxs("tr",{children:[i.jsx("td",{className:"text-center",children:i.jsx("input",{type:"checkbox",checked:r[te.id]||!1,onChange:Le=>ae(Le,de+je,te.id)})}),i.jsx("td",{title:te.name,children:te.name.length>10?`${te.name.slice(0,10)}...`:te.name}),i.jsx("td",{className:"text-center",children:te.url&&i.jsx("button",{type:"button",onClick:()=>window.open(te.url,"_blank"),className:"p-2 text-xl rounded inline-flex items-center justify-center hover:bg-[var(--accent-color-10)] text-accent","aria-label":"Open link",children:i.jsx(Ol,{})})}),i.jsx("td",{className:"text-center",children:te.thumbnailUrl&&i.jsxs("span",{className:"relative inline-block group",children:[i.jsx("button",{type:"button",onClick:()=>window.open(te.thumbnailUrl,"_blank"),className:"p-2 text-xl rounded inline-flex items-center justify-center bg-[var(--accent-color-10)] text-accent","aria-label":"Preview image",children:i.jsx(qc,{})}),i.jsx("img",{src:te.thumbnailUrl,alt:"preview",className:"hidden group-hover:block absolute left-full ml-2 top-1/2 -translate-y-1/2 min-w-[100px] w-auto h-auto border shadow-lg z-10"})]})}),i.jsx("td",{children:i.jsx("input",{className:"w-full p-1 border rounded",value:te.type,onMouseDown:Ee("type",te.type),onMouseOver:L(te.id),onChange:Le=>I(te.id,"type",Le.target.value)})}),i.jsx("td",{children:i.jsx("input",{className:"w-full p-1 border rounded",value:te.description,onMouseDown:Ee("description",te.description),onMouseOver:L(te.id),onChange:Le=>I(te.id,"description",Le.target.value)})}),i.jsx("td",{children:i.jsx("input",{className:"w-full p-1 border rounded",value:te.product,onMouseDown:Ee("product",te.product),onMouseOver:L(te.id),onChange:Le=>I(te.id,"product",Le.target.value)})}),i.jsx("td",{children:i.jsx("input",{className:"w-full p-1 border rounded",value:te.campaign,onMouseDown:Ee("campaign",te.campaign),onMouseOver:L(te.id),onChange:Le=>I(te.id,"campaign",Le.target.value)})}),i.jsx("td",{className:"text-center",children:i.jsx("button",{type:"button",onClick:()=>Xe(te.id),"aria-label":"Delete",className:"btn-delete",children:i.jsx(qt,{})})})]},te.id))})]}),i.jsxs("div",{className:"flex items-center justify-between mt-2",children:[i.jsx("button",{type:"button",onClick:()=>M(te=>Math.max(0,te-1)),className:"btn-secondary px-2 py-1",disabled:O===0,children:"<"}),i.jsxs("span",{className:"text-sm",children:[O+1," / ",ne]}),i.jsx("button",{type:"button",onClick:()=>M(te=>Math.min(ne-1,te+1)),className:"btn-secondary px-2 py-1",disabled:O>=ne-1,children:">"})]}),nt&&i.jsx("div",{className:"mt-2 text-center",children:i.jsx("button",{type:"button",onClick:()=>x(te=>Math.min(te+R,G.length-de)),className:"btn-secondary px-3 py-1",children:"Show 25 More"})}),k&&i.jsx(i3,{brandCode:t,onClose:()=>S(!1)})]})},w_={id:"",name:"",body:"",title:"",rating:"",product:""},o3=({brandCode:t=""})=>{const[e,n]=m.useState([]),[r,s]=m.useState([]),[a,o]=m.useState([]),[l,c]=m.useState({});m.useEffect(()=>{const T=t?`reviews_${t}`:"reviews",C=localStorage.getItem(T);if(C)try{const j=JSON.parse(C);Array.isArray(j)&&n(j.map(y=>({...w_,...y})))}catch(j){console.error("Failed to parse stored reviews",j)}},[t]);const d=()=>{const T=Math.random().toString(36).slice(2);n(C=>[...C,{...w_,id:T}])},h=(T,C,j)=>{n(y=>y.map(v=>v.id===T?{...v,[C]:j}:v))},f=T=>{n(C=>C.filter(j=>j.id!==T))},p=()=>{try{const T=t?`reviews_${t}`:"reviews";localStorage.setItem(T,JSON.stringify(e)),alert("Reviews saved")}catch(T){console.error("Failed to save reviews",T)}},k=async T=>{var O;const C=(O=T.target.files)==null?void 0:O[0];if(s([]),o([]),c({}),!C)return;const y=(await C.text()).trim().split(/\r?\n/);if(y.length<2)return;const v=Ml(y[0]).map(M=>M.trim()),R=[];for(let M=1;M<y.length;M+=1)y[M]&&R.push(Ml(y[M]).map(b=>b.trim()));s(v),o(R)},S=()=>{const T=a.map(C=>({id:Math.random().toString(36).slice(2),name:l.name!==void 0&&l.name!==""&&C[l.name]||"",body:l.body!==void 0&&l.body!==""&&C[l.body]||"",title:l.title!==void 0&&l.title!==""&&C[l.title]||"",rating:l.rating!==void 0&&l.rating!==""&&C[l.rating]||"",product:l.product!==void 0&&l.product!==""&&C[l.product]||""}));n(C=>[...C,...T]),s([]),o([]),c({})};return i.jsxs("div",{children:[i.jsxs("div",{className:"mb-4 flex gap-2 flex-wrap",children:[i.jsx("button",{type:"button",className:"btn-secondary",onClick:d,children:"Add Row"}),i.jsx("input",{type:"file",accept:".csv",onChange:k}),i.jsx("button",{type:"button",className:"btn-primary",onClick:p,children:"Save Reviews"})]}),r.length>0&&i.jsxs("div",{className:"mb-4 space-y-2",children:[["name","body","title","rating","product"].map(T=>i.jsxs("div",{children:[i.jsxs("label",{className:"block text-sm mb-1 capitalize",children:[T," Column"]}),i.jsxs("select",{className:"p-1 border rounded w-full",value:l[T]??"",onChange:C=>c({...l,[T]:C.target.value}),children:[i.jsx("option",{value:"",children:"Ignore"}),r.map((C,j)=>i.jsx("option",{value:j,children:C},j))]})]},T)),i.jsx("button",{type:"button",className:"btn-primary",onClick:S,children:"Add Rows"})]}),e.length===0?i.jsx("p",{children:"No reviews found."}):i.jsxs(Un,{children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Name"}),i.jsx("th",{children:"Body"}),i.jsx("th",{children:"Title"}),i.jsx("th",{children:"Rating"}),i.jsx("th",{children:"Product"}),i.jsx("th",{children:"Actions"})]})}),i.jsx("tbody",{children:e.map(T=>i.jsxs("tr",{children:[i.jsx("td",{children:i.jsx("input",{className:"p-1 border rounded w-full",value:T.name,onChange:C=>h(T.id,"name",C.target.value)})}),i.jsx("td",{children:i.jsx("textarea",{className:"p-1 border rounded w-full",value:T.body,onChange:C=>h(T.id,"body",C.target.value)})}),i.jsx("td",{children:i.jsx("input",{className:"p-1 border rounded w-full",value:T.title,onChange:C=>h(T.id,"title",C.target.value)})}),i.jsx("td",{children:i.jsx("input",{type:"number",min:"1",max:"5",className:"p-1 border rounded w-full",value:T.rating,onChange:C=>h(T.id,"rating",C.target.value)})}),i.jsx("td",{children:i.jsx("input",{className:"p-1 border rounded w-full",value:T.product,onChange:C=>h(T.id,"product",C.target.value)})}),i.jsx("td",{className:"text-center",children:i.jsx("button",{type:"button",className:"btn-delete",onClick:()=>f(T.id),children:"Delete"})})]},T.id))})]})]})},ch={url:"",file:null},Ld={name:"",description:[],benefits:[],images:[{...ch}],archived:!1},l3=({brandId:t=null,brandCode:e=""})=>{const n=Fe.currentUser,{brandCodes:r,role:s}=Fr(n==null?void 0:n.uid),a=s==="manager"||s==="editor",o=s==="admin",[l,c]=m.useState(t),[d,h]=m.useState(e||r[0]||""),[f,p]=m.useState([{...Ld}]),[k,S]=m.useState(!1),[T,C]=m.useState("");m.useEffect(()=>{!t&&!e&&h(r[0]||"")},[r,t,e]),m.useEffect(()=>{(async()=>{try{if(t){const b=await gn(ie(F,"brands",t));if(b.exists()){c(t);const x=b.data();h(x.code||e),p(Array.isArray(x.products)&&x.products.length?x.products.map(w=>({name:w.name||"",description:Array.isArray(w.description)?w.description:typeof w.description=="string"?w.description.split(/[;\n]+/).map(E=>E.trim()).filter(Boolean):[],benefits:Array.isArray(w.benefits)?w.benefits:typeof w.benefits=="string"?w.benefits.split(/[;\n]+/).map(E=>E.trim()).filter(Boolean):[],images:Array.isArray(w.images)&&w.images.length?w.images.map(E=>({url:E,file:null})):[{...ch}],archived:!!w.archived})):[{...Ld}])}}else if(d){const b=Ye(fe(F,"brands"),Je("code","==",d)),x=await Ne(b);if(!x.empty){const w=x.docs[0];c(w.id);const E=w.data();h(E.code||d),p(Array.isArray(E.products)&&E.products.length?E.products.map(N=>({name:N.name||"",description:Array.isArray(N.description)?N.description:typeof N.description=="string"?N.description.split(/[;\n]+/).map(D=>D.trim()).filter(Boolean):[],benefits:Array.isArray(N.benefits)?N.benefits:typeof N.benefits=="string"?N.benefits.split(/[;\n]+/).map(D=>D.trim()).filter(Boolean):[],images:Array.isArray(N.images)&&N.images.length?N.images.map(D=>({url:D,file:null})):[{...ch}],archived:!!N.archived})):[{...Ld}])}}}catch(b){console.error("Failed to load brand",b)}})()},[d,t,e]);const j=(M,b,x)=>{p(w=>w.map((E,N)=>N===M?{...E,images:E.images.map((D,I)=>I===b?{url:x?URL.createObjectURL(x):D.url,file:x}:D)}:E))},y=(M,b)=>{p(x=>x.map((w,E)=>E===M?{...w,...b}:w))},v=M=>{p(b=>b.map((x,w)=>w===M?{...x,images:[...x.images,{...ch}]}:x))},R=M=>{a&&!o?(p(b=>b.map((x,w)=>w===M?{...x,archived:!0}:x)),rp({target:"product",brandId:l,index:M})):p(b=>b.filter((x,w)=>w!==M))},O=async M=>{if(M.preventDefault(),!!l){S(!0),C("");try{const b=[];for(const x of f){if(x.archived)continue;const w=[];for(const E of x.images)if(E.file){const N=await Wc(E.file,d,"products");w.push(N)}else E.url&&w.push(E.url);b.push({name:x.name.trim(),description:x.description.map(E=>E.trim()).filter(Boolean),benefits:x.benefits.map(E=>E.trim()).filter(Boolean),images:w,archived:!!x.archived})}await Jn(ie(F,"brands",l),{products:b},{merge:!0}),p(b.map(x=>({...x,archived:!1,images:x.images.map(w=>({url:w,file:null}))}))),C("Products saved")}catch(b){console.error("Failed to save products",b),C("Failed to save products")}finally{S(!1)}}};return i.jsx(ed,{title:"Products",children:i.jsxs("form",{onSubmit:O,className:"space-y-4 max-w-md",children:[f.filter(M=>!M.archived).map((M,b)=>i.jsxs("div",{className:"border p-3 rounded space-y-2",children:[i.jsx(Yn,{label:"Name",children:i.jsx("input",{type:"text",value:M.name,onChange:x=>y(b,{name:x.target.value}),className:"w-full p-2 border rounded"})}),i.jsx(Yn,{label:"Description",children:i.jsx(Ds,{id:`desc-${b}`,value:M.description,onChange:x=>y(b,{description:x})})}),i.jsx(Yn,{label:"Benefits",children:i.jsx(Ds,{id:`benefits-${b}`,value:M.benefits,onChange:x=>y(b,{benefits:x})})}),i.jsxs(Yn,{label:"Images",children:[M.images.map((x,w)=>i.jsxs("div",{className:"mb-2",children:[i.jsx("input",{type:"file",accept:"image/*",onChange:E=>j(b,w,E.target.files[0]),className:"w-full p-2 border rounded"}),x.url&&i.jsx("img",{src:x.url,alt:"product",className:"mt-1 h-16 w-auto"})]},w)),i.jsx("button",{type:"button",onClick:()=>v(b),className:"btn-action mt-1",children:"Add Image"})]}),i.jsx("button",{type:"button",onClick:()=>R(b),className:"btn-action mt-1",children:a&&!o?"Archive Product":"Delete Product"})]},b)),i.jsx("button",{type:"button",onClick:()=>p(M=>[...M,{...Ld}]),className:"btn-action",children:"Add Product"}),T&&i.jsx("p",{className:"text-sm",children:T}),i.jsx("div",{className:"text-right",children:i.jsx("button",{type:"submit",className:"btn-primary",disabled:k,children:k?"Saving...":"Save Products"})})]})})},c3=({brandId:t=null,brandCode:e=""})=>{const n=Fe.currentUser,{brandCodes:r}=Fr(n==null?void 0:n.uid),[s,a]=m.useState(t),[o,l]=m.useState(e||r[0]||""),[c,d]=m.useState(""),[h,f]=m.useState(""),[p,k]=m.useState(""),[S,T]=m.useState(""),[C,j]=m.useState(""),[y,v]=m.useState(""),[R,O]=m.useState(!1);m.useEffect(()=>{!t&&!e&&l(r[0]||"")},[r,t,e]),m.useEffect(()=>{(async()=>{try{if(t){const w=await gn(ie(F,"brands",t));if(w.exists()){a(t);const E=w.data();l(E.code||e),d(E.voice||""),f(E.phrasing||""),k(Array.isArray(E.wordBank)?E.wordBank.join(", "):""),T(Array.isArray(E.noGos)?E.noGos.join(", "):""),j(E.ctaStyle||"")}}else if(o){const w=Ye(fe(F,"brands"),Je("code","==",o)),E=await Ne(w);if(!E.empty){const N=E.docs[0];a(N.id);const D=N.data();l(D.code||o),d(D.voice||""),f(D.phrasing||""),k(Array.isArray(D.wordBank)?D.wordBank.join(", "):""),T(Array.isArray(D.noGos)?D.noGos.join(", "):""),j(D.ctaStyle||"")}}}catch(w){console.error("Failed to load brand",w)}})()},[o,t,e]);const M=async x=>{if(x.preventDefault(),!!s){O(!0),v("");try{const w=p.split(",").map(D=>D.trim()).filter(Boolean),E=S.split(",").map(D=>D.trim()).filter(Boolean),N=`---
Write in a tone that is: ${c}.
Use phrasing that is: ${h}.
Incorporate brand-specific words when possible: ${w.join(", ")}.
Avoid the following language or style: ${E.join(", ")}.
CTAs should follow this style: ${C}.
---`;await Jn(ie(F,"brands",s),{voice:c,phrasing:h,wordBank:w,noGos:E,ctaStyle:C,toneOfVoice:N},{merge:!0}),v("Tone settings saved")}catch(w){console.error("Failed to save tone settings",w),v("Failed to save tone settings")}finally{O(!1)}}},b=`---
Write in a tone that is: ${c}.
Use phrasing that is: ${h}.
Incorporate brand-specific words when possible: ${p}.
Avoid the following language or style: ${S}.
CTAs should follow this style: ${C}.
---`;return i.jsxs(ed,{title:"Tone of Voice",children:[i.jsxs("form",{onSubmit:M,className:"space-y-4 max-w-md",children:[i.jsx(Yn,{label:"Voice",children:i.jsx("textarea",{value:c,onChange:x=>d(x.target.value),className:"w-full p-2 border rounded"})}),i.jsx(Yn,{label:"Phrasing",children:i.jsx("textarea",{value:h,onChange:x=>f(x.target.value),className:"w-full p-2 border rounded"})}),i.jsx(Yn,{label:"Word Bank (comma separated)",children:i.jsx("input",{type:"text",value:p,onChange:x=>k(x.target.value),className:"w-full p-2 border rounded"})}),i.jsx(Yn,{label:"No-Go's (comma separated)",children:i.jsx("input",{type:"text",value:S,onChange:x=>T(x.target.value),className:"w-full p-2 border rounded"})}),i.jsx(Yn,{label:"CTA Style",children:i.jsx("textarea",{value:C,onChange:x=>j(x.target.value),className:"w-full p-2 border rounded"})}),y&&i.jsx("p",{className:"text-sm",children:y}),i.jsx("div",{className:"text-right",children:i.jsx("button",{type:"submit",className:"btn-primary",disabled:R,children:R?"Saving...":"Save Tone"})})]}),i.jsx("div",{className:"mt-6 p-4 border rounded bg-accent-10 text-sm whitespace-pre-wrap",children:b})]})},Od={startDate:"",endDate:"",stills:"",videos:"",renews:!1},u3=({brandId:t=null,brandCode:e=""})=>{const n=Fe.currentUser,{brandCodes:r}=Fr(n==null?void 0:n.uid),[s,a]=m.useState(t),[o,l]=m.useState(e||r[0]||""),[c,d]=m.useState([{...Od}]),[h,f]=m.useState(!1),[p,k]=m.useState("");m.useEffect(()=>{!t&&!e&&l(r[0]||"")},[r,t,e]),m.useEffect(()=>{(async()=>{try{if(t){const v=await gn(ie(F,"brands",t));if(v.exists()){a(t);const R=v.data();l(R.code||e),d(Array.isArray(R.contracts)&&R.contracts.length?R.contracts.map(O=>({startDate:O.startDate||"",endDate:O.endDate||"",stills:O.stills||"",videos:O.videos||"",renews:O.renews||!1})):[{...Od}])}}else if(o){const v=Ye(fe(F,"brands"),Je("code","==",o)),R=await Ne(v);if(!R.empty){const O=R.docs[0];a(O.id);const M=O.data();l(M.code||o),d(Array.isArray(M.contracts)&&M.contracts.length?M.contracts.map(b=>({startDate:b.startDate||"",endDate:b.endDate||"",stills:b.stills||"",videos:b.videos||"",renews:b.renews||!1})):[{...Od}])}}}catch(v){console.error("Failed to load brand",v)}})()},[o,t,e]);const S=(y,v)=>{d(R=>R.map((O,M)=>M===y?{...O,...v}:O))},T=()=>d(y=>[...y,{...Od}]),C=y=>d(v=>v.filter((R,O)=>O!==y)),j=async y=>{if(y.preventDefault(),!!s){f(!0),k("");try{await Jn(ie(F,"brands",s),{contracts:c},{merge:!0}),k("Contracts saved")}catch(v){console.error("Failed to save contracts",v),k("Failed to save contracts")}finally{f(!1)}}};return i.jsx(ed,{title:"Contracts",children:i.jsxs("form",{onSubmit:j,className:"space-y-4 max-w-md",children:[c.map((y,v)=>i.jsxs("div",{className:"border p-2 rounded space-y-2",children:[i.jsx(Yn,{label:"Start Date",children:i.jsx("input",{type:"date",value:y.startDate,onChange:R=>S(v,{startDate:R.target.value}),className:"w-full p-2 border rounded"})}),i.jsx(Yn,{label:"End Date (optional)",children:i.jsx("input",{type:"date",value:y.endDate,onChange:R=>S(v,{endDate:R.target.value}),className:"w-full p-2 border rounded"})}),i.jsx(Yn,{label:"Number of Stills",children:i.jsx("input",{type:"number",min:"0",value:y.stills,onChange:R=>S(v,{stills:R.target.value}),className:"w-full p-2 border rounded"})}),i.jsx(Yn,{label:"Number of Videos",children:i.jsx("input",{type:"number",min:"0",value:y.videos,onChange:R=>S(v,{videos:R.target.value}),className:"w-full p-2 border rounded"})}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx(be,{type:"button",onClick:()=>S(v,{renews:!y.renews}),"aria-label":"Toggle renews",title:"Renews monthly",children:i.jsx(vS,{className:y.renews?"text-green-600":"text-gray-600"})}),i.jsx("button",{type:"button",onClick:()=>C(v),className:"btn-action",children:"Delete"})]})]},v)),i.jsx("button",{type:"button",onClick:T,className:"btn-action",children:"Add Contract"}),p&&i.jsx("p",{className:"text-sm",children:p}),i.jsx("div",{className:"text-right",children:i.jsx("button",{type:"submit",className:"btn-primary",disabled:h,children:h?"Saving...":"Save Contracts"})})]})})},cm=({brandId:t=null})=>{const{id:e}=By(),n=t||e||null,r=Fe.currentUser,{brandCodes:s}=Fr(r==null?void 0:r.uid),[a,o]=m.useState(""),[l,c]=m.useState(""),[d,h]=m.useState("setup");return m.useEffect(()=>{(async()=>{if(n)try{const p=await gn(ie(F,"brands",n));if(p.exists()){const k=p.data();o(k.code||""),c(k.name||"")}}catch(p){console.error("Failed to load brand",p)}else if(s.length>0){const p=s[0];o(p);try{const k=Ye(fe(F,"brands"),Je("code","==",p)),S=await Ne(k);S.empty?c(p):c(S.docs[0].data().name||p)}catch(k){console.error("Failed to load brand by code",k),c(p)}}})()},[n,s]),i.jsxs("div",{className:"min-h-screen p-4",children:[i.jsxs("div",{className:"flex items-center mb-2",children:[e&&i.jsx($n,{to:"/admin/brands",className:"btn-arrow mr-2","aria-label":"Back",children:"<"}),i.jsx("h1",{className:"text-2xl mb-0",children:l||"Brand Profile"})]}),i.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[i.jsxs(_t,{active:d==="setup",onClick:()=>h("setup"),children:[i.jsx(lU,{})," ",i.jsx("span",{children:"Brand Setup"})]}),i.jsxs(_t,{active:d==="library",onClick:()=>h("library"),children:[i.jsx(gS,{})," ",i.jsx("span",{children:"Asset Library"})]}),i.jsxs(_t,{active:d==="tone",onClick:()=>h("tone"),children:[i.jsx(rU,{})," ",i.jsx("span",{children:"Tone of Voice"})]}),i.jsxs(_t,{active:d==="reviews",onClick:()=>h("reviews"),children:[i.jsx(hU,{})," ",i.jsx("span",{children:"Customer Reviews"})]}),i.jsxs(_t,{active:d==="products",onClick:()=>h("products"),children:[i.jsx(uU,{})," ",i.jsx("span",{children:"Products"})]}),i.jsxs(_t,{active:d==="contracts",onClick:()=>h("contracts"),children:[i.jsx(Ll,{})," ",i.jsx("span",{children:"Contracts"})]})]}),d==="setup"&&i.jsx(s3,{brandId:n}),d==="tone"&&i.jsx(c3,{brandId:n,brandCode:a}),d==="library"&&i.jsx(a3,{brandCode:a}),d==="reviews"&&i.jsx(o3,{brandCode:a}),d==="products"&&i.jsx(l3,{brandId:n,brandCode:a}),d==="contracts"&&i.jsx(u3,{brandId:n,brandCode:a})]})},ip=()=>{const t=Fe.currentUser,[e,n]=m.useState((t==null?void 0:t.displayName)||""),[r,s]=m.useState((t==null?void 0:t.email)||""),[a,o]=m.useState(""),[l,c]=m.useState(""),[d,h]=m.useState(""),{theme:f,setTheme:p}=xx(),k=ti(),S=t?Ja(t).enrolledFactors.length>0:!1,T=async C=>{if(C.preventDefault(),!!t){c(""),h("");try{e&&e!==t.displayName&&(await HR(t,{displayName:e}),await He(ie(F,"users",t.uid),{fullName:e})),r&&r!==t.email&&(await qR(t,r),await He(ie(F,"users",t.uid),{email:r})),a&&(await WR(t,a),o("")),h("Account updated")}catch(j){c(j.message)}}};return i.jsxs("div",{className:"min-h-screen p-4 space-y-4",children:[i.jsx("h1",{className:"text-2xl mb-4",children:"Account Settings"}),i.jsxs("form",{onSubmit:T,className:"space-y-4 max-w-md",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Name"}),i.jsx("input",{type:"text",value:e,onChange:C=>n(C.target.value),className:"w-full p-2 border rounded"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Email"}),i.jsx("input",{type:"email",value:r,onChange:C=>s(C.target.value),className:"w-full p-2 border rounded"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Theme"}),i.jsxs("select",{value:f,onChange:C=>p(C.target.value),className:"border rounded px-2 py-1",children:[i.jsx("option",{value:"system",children:"System"}),i.jsx("option",{value:"light",children:"Light"}),i.jsx("option",{value:"dark",children:"Dark"})]})]}),i.jsx("h2",{className:"text-xl mt-6",children:"Login & Security"}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"New Password"}),i.jsx("input",{type:"password",value:a,onChange:C=>o(C.target.value),className:"w-full p-2 border rounded"}),i.jsx("p",{className:"text-xs text-gray-500",children:"Leave blank to keep current password"})]}),i.jsxs("div",{children:[i.jsxs("h3",{className:"text-lg font-medium flex items-center",children:["Two-Factor Authentication",!S&&i.jsx("span",{className:"ml-2 text-xs bg-blue-100 text-blue-600 px-2 py-0.5 rounded",children:"Recommended"})]}),i.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Add an extra layer of security to your account by requiring a code when you sign in."}),S&&(t==null?void 0:t.metadata.lastLoginAt)&&i.jsxs("p",{className:"text-xs text-gray-500 mb-2",children:["Last MFA login: ",new Date(Number(t.metadata.lastLoginAt)).toLocaleString()]}),i.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>k("/mfa-settings"),children:S?"Manage MFA":"Set Up MFA"})]}),l&&i.jsx("p",{className:"text-red-500 text-sm",children:l}),d&&i.jsx("p",{className:"text-green-600 text-sm",children:d}),i.jsx("button",{type:"submit",className:"btn-primary",children:"Save Changes"})]})]})},d3=()=>i.jsx(ip,{}),um="designerNotificationsRead",fc="designerNotificationsDismissed",h3=({brandCodes:t=[]})=>{const[e,n]=m.useState([]),[r,s]=m.useState(!0);m.useEffect(()=>{(async()=>{s(!0);try{let d=Ye(fe(F,"notifications"),Je("audience","==","designer"),lo("createdAt","desc"));t.length>0&&(d=Ye(d,Je("brandCode","in",t)));const h=await Ne(d);let f=[];try{f=JSON.parse(localStorage.getItem(fc)||"[]")}catch{f=[]}const p=h.docs.map(T=>({id:T.id,...T.data()})).filter(T=>!f.includes(T.id));n(p);let k=[];try{k=JSON.parse(localStorage.getItem(um)||"[]")}catch{k=[]}const S=new Set([...k,...p.map(T=>T.id)]);try{localStorage.setItem(um,JSON.stringify(Array.from(S)))}catch{}}catch(d){console.error("Failed to load notifications",d),n([])}finally{s(!1)}})()},[t]);const a=c=>{let d=[];try{d=JSON.parse(localStorage.getItem(fc)||"[]")}catch{d=[]}d.includes(c)||d.push(c);try{localStorage.setItem(fc,JSON.stringify(d))}catch{}n(h=>h.filter(f=>f.id!==c))},o=()=>{let c=[];try{c=JSON.parse(localStorage.getItem(fc)||"[]")}catch{c=[]}const d=e.map(h=>h.id).filter(h=>!c.includes(h));try{localStorage.setItem(fc,JSON.stringify([...c,...d]))}catch{}n([])};let l=[];try{l=JSON.parse(localStorage.getItem(um)||"[]")}catch{l=[]}return i.jsxs("div",{className:"min-h-screen p-4",children:[i.jsx("h1",{className:"text-2xl mb-4",children:"Notifications"}),r?i.jsx("p",{children:"Loading..."}):e.length===0?i.jsx("p",{children:"No notifications found."}):i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"text-right mb-4",children:i.jsx("button",{onClick:o,className:"underline text-sm",children:"Clear All"})}),i.jsx("div",{className:"space-y-4",children:e.map(c=>i.jsx("div",{className:"border-2 border-gray-300 dark:border-gray-600 rounded-lg shadow p-3",children:i.jsxs("div",{className:"flex items-start justify-between gap-3",children:[i.jsx("div",{className:"flex-1",children:c.url?i.jsxs($n,{to:c.url,className:"block",children:[i.jsxs("h2",{className:"font-semibold text-black dark:text-[var(--dark-text)] flex items-center",children:[!l.includes(c.id)&&i.jsx("span",{className:"inline-block w-2 h-2 bg-accent rounded-full mr-2","aria-label":"new"}),c.title]}),i.jsx("p",{className:"mt-1 text-sm whitespace-pre-wrap text-black dark:text-[var(--dark-text)]",children:c.body})]}):i.jsxs(i.Fragment,{children:[i.jsxs("h2",{className:"font-semibold text-black dark:text-[var(--dark-text)] flex items-center",children:[!l.includes(c.id)&&i.jsx("span",{className:"inline-block w-2 h-2 bg-accent rounded-full mr-2","aria-label":"new"}),c.title]}),i.jsx("p",{className:"mt-1 text-sm whitespace-pre-wrap text-black dark:text-[var(--dark-text)]",children:c.body})]})}),i.jsx("button",{onClick:()=>a(c.id),"aria-label":"Dismiss",className:"text-gray-500 hover:text-black dark:text-gray-400 dark:hover:text-white",children:i.jsx(qt,{})})]})},c.id))})]})]})},f3=()=>i.jsx(ip,{}),p3=()=>i.jsx(ip,{}),m3=()=>i.jsx(ip,{}),g3=()=>{const[t,e]=m.useState(""),[n,r]=m.useState(""),[s,a]=m.useState("client"),[o,l]=m.useState([]),[c,d]=m.useState([]),[h,f]=m.useState(!1),[p,k]=m.useState([]),[S,T]=m.useState("");m.useEffect(()=>{(async()=>{try{const y=await Ne(fe(F,"brands"));d(y.docs.map(v=>v.data().code))}catch(y){console.error("Failed to fetch brands",y),d([])}})()},[]);const C=async j=>{j.preventDefault(),k([]),T(""),f(!0);try{const y=await ev(Fe,t,n),v=o.filter(Boolean);await Jn(ie(F,"users",y.user.uid),{role:s,brandCodes:v,audience:s}),await If(y.user),T("Account created. Ask the user to verify their email."),e(""),r(""),a("client"),l([])}catch(y){const v=((y==null?void 0:y.message)||"").replace("Firebase:","").replace(/\(auth.*\)/,"").trim();k([v])}finally{f(!1)}};return i.jsxs("div",{className:"min-h-screen p-4 max-w-md mx-auto mt-10",children:[i.jsx("h1",{className:"text-2xl mb-4",children:"Create Account"}),i.jsxs("form",{onSubmit:C,className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Email"}),i.jsx("input",{type:"email",value:t,onChange:j=>e(j.target.value),className:"w-full p-2 border rounded",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Password"}),i.jsx("input",{type:"password",value:n,onChange:j=>r(j.target.value),className:"w-full p-2 border rounded",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Role"}),i.jsxs("select",{value:s,onChange:j=>a(j.target.value),className:"w-full p-2 border rounded",children:[i.jsx("option",{value:"client",children:"Client"}),i.jsx("option",{value:"designer",children:"Designer"}),i.jsx("option",{value:"manager",children:"Manager"}),i.jsx("option",{value:"editor",children:"Editor"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Brand Codes"}),i.jsx(Ds,{value:o,onChange:l,suggestions:c,id:"brand-code-input"})]}),i.jsx(rf,{messages:p}),S&&i.jsx("p",{className:"text-green-600 text-sm",children:S}),i.jsx("button",{type:"submit",className:"w-full btn-primary",disabled:h,children:h?"Creating...":"Create Account"})]})]})},y3=()=>{const[t,e]=m.useState([]),[n,r]=m.useState(!0),[s,a]=m.useState(""),[o,l]=m.useState("name"),[c,d]=m.useState(null),[h,f]=m.useState({role:"client",brandCodes:[],audience:""}),[p,k]=m.useState([]),[S,T]=m.useState(null);m.useEffect(()=>{const b=async()=>{r(!0);try{const E=(await Ne(fe(F,"users"))).docs.map(N=>({id:N.id,...N.data()}));e(E)}catch(w){console.error("Failed to fetch accounts",w),e([])}finally{r(!1)}},x=async()=>{try{const w=await Ne(fe(F,"brands"));k(w.docs.map(E=>E.data().code))}catch(w){console.error("Failed to fetch brands",w),k([])}};b(),x()},[]);const C=b=>{d(b.id),f({role:b.role||"client",brandCodes:Array.isArray(b.brandCodes)?b.brandCodes:[],audience:b.audience||""})},j=()=>d(null),y=async b=>{const x=h.brandCodes.filter(Boolean);try{await He(ie(F,"users",b),{role:h.role,brandCodes:x,audience:h.audience}),e(w=>w.map(E=>E.id===b?{...E,role:h.role,brandCodes:x,audience:h.audience}:E)),d(null)}catch(w){console.error("Failed to update account",w)}},v=async b=>{if(window.confirm("Delete this account?"))try{await mn(ie(F,"users",b)),e(x=>x.filter(w=>w.id!==b))}catch(x){console.error("Failed to delete account",x)}},R=async b=>{if(window.confirm("Sign this user out?"))try{await gl(yl,"signOutUser")({uid:b})}catch(x){console.error("Failed to sign out user",x)}},O=s.toLowerCase(),M=t.filter(b=>{var x,w;return!O||((x=b.fullName)==null?void 0:x.toLowerCase().includes(O))||((w=b.email)==null?void 0:w.toLowerCase().includes(O))}).sort((b,x)=>o==="role"?(b.role||"").localeCompare(x.role||""):o==="email"?(b.email||"").localeCompare(x.email||""):(b.fullName||"").localeCompare(x.fullName||""));return i.jsxs("div",{className:"min-h-screen p-4",children:[i.jsx("h1",{className:"text-2xl mb-4",children:"Accounts"}),i.jsxs("div",{className:"flex items-center justify-between mb-2 flex-wrap gap-2",children:[i.jsxs($n,{to:"/admin/accounts/new",className:"btn-primary flex items-center gap-1",children:[i.jsx(Yi,{}),"Create Account"]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("select",{value:o,onChange:b=>l(b.target.value),className:"p-1 border rounded",children:[i.jsx("option",{value:"name",children:"Name"}),i.jsx("option",{value:"email",children:"Email"}),i.jsx("option",{value:"role",children:"Role"})]}),i.jsx("input",{type:"text",placeholder:"Filter",value:s,onChange:b=>a(b.target.value),className:"p-1 border rounded"})]})]}),n?i.jsx("p",{children:"Loading accounts..."}):t.length===0?i.jsx("p",{children:"No accounts found."}):i.jsxs(Un,{children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Name"}),i.jsx("th",{children:"Role"}),i.jsx("th",{children:"Audience"}),i.jsx("th",{children:"Brand Codes"}),i.jsx("th",{children:"Actions"})]})}),i.jsx("tbody",{children:M.map(b=>i.jsxs("tr",{children:[i.jsx("td",{children:b.fullName||b.email||b.id}),i.jsx("td",{children:c===b.id?i.jsxs("select",{value:h.role,onChange:x=>f(w=>({...w,role:x.target.value})),className:"w-full p-1 border rounded",children:[i.jsx("option",{value:"client",children:"Client"}),i.jsx("option",{value:"designer",children:"Designer"}),i.jsx("option",{value:"manager",children:"Manager"}),i.jsx("option",{value:"editor",children:"Editor"}),i.jsx("option",{value:"admin",children:"Admin"})]}):b.role||""}),i.jsx("td",{children:c===b.id?i.jsx("input",{type:"text",value:h.audience,onChange:x=>f(w=>({...w,audience:x.target.value})),className:"w-full p-1 border rounded"}):b.audience||""}),i.jsx("td",{children:c===b.id?i.jsx(Ds,{value:h.brandCodes,onChange:x=>f(w=>({...w,brandCodes:x})),suggestions:p,id:`brand-${b.id}`}):Array.isArray(b.brandCodes)?b.brandCodes.join(", "):""}),i.jsx("td",{className:"text-center",children:c===b.id?i.jsxs("div",{className:"flex items-center justify-center gap-2",children:[i.jsx(Vt,{variant:"action",onClick:()=>y(b.id),children:"Save"}),i.jsx(Vt,{variant:"action",onClick:j,children:"Cancel"})]}):i.jsxs("div",{className:"flex items-center justify-center gap-2",children:[i.jsx(be,{onClick:()=>T(b),"aria-label":"View",children:i.jsx(Wi,{})}),i.jsx(be,{onClick:()=>C(b),"aria-label":"Edit",children:i.jsx(Ar,{})}),i.jsx(be,{onClick:()=>R(b.id),"aria-label":"Sign Out",children:i.jsx(a_,{})}),i.jsx(be,{onClick:()=>v(b.id),"aria-label":"Delete",children:i.jsx(qt,{})})]})})]},b.id))})]}),S&&i.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:i.jsxs("div",{className:"bg-white p-4 rounded shadow max-w-sm dark:bg-[var(--dark-sidebar-bg)] dark:text-[var(--dark-text)]",children:[i.jsx("h3",{className:"mb-2 font-semibold",children:S.fullName||S.email||S.id}),i.jsxs("p",{className:"text-sm mb-1",children:["Email: ",S.email||"N/A"]}),i.jsxs("p",{className:"text-sm mb-1",children:["Role: ",S.role]}),S.audience&&i.jsxs("p",{className:"text-sm mb-1",children:["Audience: ",S.audience]}),Array.isArray(S.brandCodes)&&S.brandCodes.length>0&&i.jsxs("p",{className:"text-sm mb-1",children:["Brands: ",S.brandCodes.join(", ")]}),i.jsxs("div",{className:"flex gap-2 mt-2",children:[i.jsxs("button",{onClick:()=>R(S.id),className:"btn-secondary px-3 py-1 flex items-center gap-1",children:[i.jsx(a_,{}),i.jsx("span",{children:"Sign Out"})]}),i.jsx("button",{onClick:()=>T(null),className:"btn-primary px-3 py-1",children:"Close"})]})]})})]})},At=({loading:t,userRole:e,requiredRole:n,isAdmin:r=!1,children:s})=>{if(t)return i.jsx(ec,{});const a=Array.isArray(n)?n:[n],o=e&&a.includes(e)||a.includes("admin")&&r;if(n&&!o){const l=e||(r?"admin":"");return i.jsx(ut,{to:`/dashboard/${l}`,replace:!0})}return i.jsx(i.Fragment,{children:s})},v3=()=>{const[t,e]=m.useState(!1),[n,r]=m.useState(!0),[s,a]=m.useState(!1);return m.useEffect(()=>{const o=ME(Fe,async l=>{if(a(!1),l)try{await l.getIdToken(!0);const c=await pE(l);e(!!c.claims.admin)}catch(c){console.error("Failed to get token claims",c),e(!1)}else e(!1);a(!0),r(!1)});return()=>{o()}},[]),{isAdmin:t,loading:n,isReady:s}},x3=()=>{const[t,e]=m.useState(""),[n,r]=m.useState(""),[s,a]=m.useState(""),[o,l]=m.useState(""),[c,d]=m.useState(""),[h,f]=m.useState(!1),[p,k]=m.useState(""),{agencies:S}=Zu(),T=async C=>{if(C.preventDefault(),k(""),!!t.trim()){f(!0);try{await rn(fe(F,"brands"),{code:t.trim(),name:n.trim(),agencyId:s.trim(),toneOfVoice:o.trim(),offering:c.trim(),archived:!1,archivedAt:null,archivedBy:null,createdAt:Mt()}),e(""),r(""),a(""),l(""),d(""),k("Brand added")}catch(j){console.error("Failed to add brand",j),k("Failed to add brand")}finally{f(!1)}}};return i.jsxs("div",{className:"min-h-screen p-4 flex flex-col items-center",children:[i.jsx("h1",{className:"text-2xl mb-4",children:"Add Brand"}),i.jsxs("form",{onSubmit:T,className:"space-y-4 w-full max-w-sm",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Code"}),i.jsx("input",{type:"text",value:t,onChange:C=>e(C.target.value),className:"w-full p-2 border rounded",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Name"}),i.jsx("input",{type:"text",value:n,onChange:C=>r(C.target.value),className:"w-full p-2 border rounded"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Agency ID"}),i.jsxs("select",{value:s,onChange:C=>a(C.target.value),className:"w-full p-2 border rounded",children:[i.jsx("option",{value:"",children:"Select agency"}),S.map(C=>i.jsx("option",{value:C.id,children:C.name},C.id))]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Tone of Voice"}),i.jsx("input",{type:"text",value:o,onChange:C=>l(C.target.value),className:"w-full p-2 border rounded"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Offering"}),i.jsx("input",{type:"text",value:c,onChange:C=>d(C.target.value),className:"w-full p-2 border rounded"})]}),p&&i.jsx("p",{className:"text-sm text-center",children:p}),i.jsx("button",{type:"submit",className:"w-full btn-primary",disabled:h,children:h?"Saving...":"Add Brand"})]})]})},bx=({brand:t})=>{const e=Array.isArray(t.logos)&&t.logos.length>0?t.logos[0]:null;return i.jsxs("div",{className:"border rounded shadow bg-white dark:bg-[var(--dark-sidebar-bg)] overflow-hidden text-center",children:[e&&i.jsx(Pn,{pngUrl:e,alt:`${t.code} logo`,className:"w-full h-32 object-contain border-b border-gray-200 dark:border-gray-600 p-4 bg-white dark:bg-white"}),i.jsx("p",{className:"p-2 font-medium text-gray-700 dark:text-gray-300 mb-0",children:t.code})]})},w3=()=>{const[t,e]=m.useState([]),[n,r]=m.useState(!0),[s,a]=m.useState(""),[o,l]=m.useState("code"),[c,d]=m.useState(!1),[h,f]=m.useState("cards"),p=Fe.currentUser,{role:k}=Fr(p==null?void 0:p.uid),S=k==="admin",T=k==="manager"||k==="editor",{agencies:C}=Zu(),j=m.useMemo(()=>Object.fromEntries(C.map(b=>[b.id,b.name])),[C]);m.useEffect(()=>{(async()=>{r(!0);try{const x=fe(F,"brands"),E=(await Ne(x)).docs.map(N=>({id:N.id,...N.data()}));e(E)}catch(x){console.error("Failed to fetch brands",x),e([])}finally{r(!1)}})()},[c]);const y=async b=>{if(window.confirm("Delete this brand?"))try{await mn(ie(F,"brands",b)),e(x=>x.filter(w=>w.id!==b))}catch(x){console.error("Failed to delete brand",x)}},v=async b=>{var x;if(window.confirm("Archive this brand?"))try{await He(ie(F,"brands",b),{archived:!0,archivedAt:Mt(),archivedBy:((x=Fe.currentUser)==null?void 0:x.uid)||null}),e(w=>w.map(E=>E.id===b?{...E,archived:!0}:E)),await rp({target:"brand",brandId:b})}catch(w){console.error("Failed to archive brand",w)}},R=async b=>{try{await He(ie(F,"brands",b),{archived:!1,archivedAt:null,archivedBy:null}),e(x=>x.map(w=>w.id===b?{...w,archived:!1}:w))}catch(x){console.error("Failed to restore brand",x)}},O=s.toLowerCase(),M=t.filter(b=>{var x,w;return(c||!b.archived)&&(!O||((x=b.code)==null?void 0:x.toLowerCase().includes(O))||((w=b.name)==null?void 0:w.toLowerCase().includes(O)))}).sort((b,x)=>o==="name"?(b.name||"").localeCompare(x.name||""):(b.code||"").localeCompare(x.code||""));return i.jsxs("div",{className:"min-h-screen p-4",children:[i.jsx("h1",{className:"text-2xl mb-4",children:"Brands"}),i.jsxs("div",{className:"flex items-center justify-between mb-2 flex-wrap gap-2",children:[i.jsxs($n,{to:"/admin/brands/new",className:"btn-primary flex items-center gap-1",children:[i.jsx(Yi,{}),"Create Brand"]}),i.jsxs("div",{className:"flex flex-wrap gap-2 flex-1 order-last md:order-none justify-center",children:[i.jsx(_t,{active:h==="list",onClick:()=>f("list"),"aria-label":"List view",children:i.jsx(Zl,{})}),i.jsx(_t,{active:h==="cards",onClick:()=>f("cards"),"aria-label":"Card view",children:i.jsx(Yu,{})})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("select",{value:o,onChange:b=>l(b.target.value),className:"p-1 border rounded",children:[i.jsx("option",{value:"code",children:"Code"}),i.jsx("option",{value:"name",children:"Name"})]}),i.jsx(_t,{type:"button",active:c,onClick:()=>d(b=>!b),"aria-label":c?"Hide archived":"Show archived",children:i.jsx(Ks,{})}),i.jsx("input",{type:"text",placeholder:"Filter",value:s,onChange:b=>a(b.target.value),className:"p-1 border rounded"})]})]}),n?i.jsx("p",{children:"Loading brands..."}):t.length===0?i.jsx("p",{children:"No brands found."}):h==="list"?i.jsxs(Un,{children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Code"}),i.jsx("th",{children:"Name"}),i.jsx("th",{children:"Agency"}),i.jsx("th",{children:"Actions"})]})}),i.jsx("tbody",{children:M.map(b=>i.jsxs("tr",{children:[i.jsx("td",{children:b.code}),i.jsx("td",{children:b.name}),i.jsx("td",{children:j[b.agencyId]||b.agencyId}),i.jsx("td",{className:"text-center",children:i.jsxs("div",{className:"flex items-center justify-center gap-2",children:[i.jsx(be,{as:"a",href:`/admin/brands/${b.id}`,"aria-label":"Edit",children:i.jsx(Ar,{})}),(S||T)&&(b.archived?i.jsx(be,{onClick:()=>R(b.id),"aria-label":"Restore",children:i.jsx(np,{})}):i.jsx(be,{onClick:()=>v(b.id),"aria-label":"Archive",children:i.jsx(Ks,{})})),S&&i.jsx(be,{onClick:()=>y(b.id),"aria-label":"Delete",children:i.jsx(qt,{})})]})})]},b.id))})]}):i.jsx("div",{className:"grid gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4",children:M.map(b=>i.jsx($n,{to:`/admin/brands/${b.id}`,children:i.jsx(bx,{brand:b})},b.id))})]})},b3=()=>{const[t,e]=m.useState([]),[n,r]=m.useState(!0),[s,a]=m.useState(""),[o,l]=m.useState("code"),[c,d]=m.useState(!1),[h,f]=m.useState("cards"),p=Fe.currentUser,{brandCodes:k}=Fr(p==null?void 0:p.uid),{agencies:S}=Zu(),T=m.useMemo(()=>Object.fromEntries(S.map(y=>[y.id,y.name])),[S]);m.useEffect(()=>{(async()=>{if(!k||k.length===0){e([]),r(!1);return}r(!0);try{const v=fe(F,"brands"),R=[];for(let x=0;x<k.length;x+=10)R.push(k.slice(x,x+10));const O=[];for(const x of R){const w=Ye(v,Je("code","in",x)),E=await Ne(w);O.push(...E.docs)}const M=new Set,b=O.filter(x=>M.has(x.id)?!1:(M.add(x.id),!0)).map(x=>({id:x.id,...x.data()}));e(b)}catch(v){console.error("Failed to fetch brands",v),e([])}finally{r(!1)}})()},[c,k]);const C=s.toLowerCase(),j=t.filter(y=>{var v,R;return(c||!y.archived)&&(!C||((v=y.code)==null?void 0:v.toLowerCase().includes(C))||((R=y.name)==null?void 0:R.toLowerCase().includes(C)))}).sort((y,v)=>o==="name"?(y.name||"").localeCompare(v.name||""):(y.code||"").localeCompare(v.code||""));return i.jsxs("div",{className:"min-h-screen p-4",children:[i.jsx("h1",{className:"text-2xl mb-4",children:"Brands"}),i.jsxs("div",{className:"flex items-center justify-between mb-2 flex-wrap gap-2",children:[i.jsxs("div",{className:"flex flex-wrap gap-2 flex-1 order-last md:order-none justify-center",children:[i.jsx(_t,{active:h==="list",onClick:()=>f("list"),"aria-label":"List view",children:"List"}),i.jsx(_t,{active:h==="cards",onClick:()=>f("cards"),"aria-label":"Card view",children:"Cards"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("select",{value:o,onChange:y=>l(y.target.value),className:"p-1 border rounded",children:[i.jsx("option",{value:"code",children:"Code"}),i.jsx("option",{value:"name",children:"Name"})]}),i.jsx(_t,{type:"button",active:c,onClick:()=>d(y=>!y),"aria-label":c?"Hide archived":"Show archived",children:"Archive"}),i.jsx("input",{type:"text",placeholder:"Filter",value:s,onChange:y=>a(y.target.value),className:"p-1 border rounded"})]})]}),n?i.jsx("p",{children:"Loading brands..."}):t.length===0?i.jsx("p",{children:"No brands found."}):h==="list"?i.jsxs(Un,{children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Code"}),i.jsx("th",{children:"Name"}),i.jsx("th",{children:"Agency"}),i.jsx("th",{children:"Actions"})]})}),i.jsx("tbody",{children:j.map(y=>i.jsxs("tr",{children:[i.jsx("td",{children:y.code}),i.jsx("td",{children:y.name}),i.jsx("td",{children:T[y.agencyId]||y.agencyId}),i.jsx("td",{className:"text-center",children:i.jsx("div",{className:"flex items-center justify-center gap-2",children:i.jsx(be,{as:$n,to:`/editor/brands/${y.id}`,"aria-label":"Edit",children:"Edit"})})})]},y.id))})]}):i.jsx("div",{className:"grid gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4",children:j.map(y=>i.jsx($n,{to:`/editor/brands/${y.id}`,children:i.jsx(bx,{brand:y})},y.id))})]})},_3=()=>{const{agencies:t,loading:e}=Zu();return i.jsxs("div",{className:"min-h-screen p-4",children:[i.jsx("h1",{className:"text-2xl mb-4",children:"Agencies"}),e?i.jsx("p",{children:"Loading agencies..."}):t.length===0?i.jsx("p",{children:"No agencies found."}):i.jsxs(Un,{children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Name"}),i.jsx("th",{children:"ID"})]})}),i.jsx("tbody",{children:t.map(n=>i.jsxs("tr",{children:[i.jsx("td",{children:i.jsx($n,{to:`/agency/theme?agencyId=${n.id}`,className:"text-blue-600 underline",children:n.name||n.id})}),i.jsx("td",{children:n.id})]},n.id))})]})]})},fs={TYPES:"types",COMPONENTS:"components",INSTANCES:"instances",PREVIEW:"preview"},j3=({view:t,setView:e})=>i.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[i.jsxs(_t,{active:t===fs.TYPES,onClick:()=>e(fs.TYPES),children:[i.jsx(Zl,{})," ",i.jsx("span",{children:"Recipe Types"})]}),i.jsxs(_t,{active:t===fs.COMPONENTS,onClick:()=>e(fs.COMPONENTS),children:[i.jsx(i_,{})," ",i.jsx("span",{children:"Components"})]}),i.jsxs(_t,{active:t===fs.INSTANCES,onClick:()=>e(fs.INSTANCES),children:[i.jsx(i_,{})," ",i.jsx("span",{children:"Instances"})]}),i.jsxs(_t,{active:t===fs.PREVIEW,onClick:()=>e(fs.PREVIEW),children:[i.jsx(Wi,{})," ",i.jsx("span",{children:"Preview"})]})]}),Kc=({value:t,onChange:e,placeholders:n=[],className:r=""})=>{const s=m.useRef(null),[a,o]=m.useState(!1),[l,c]=m.useState([]),[d,h]=m.useState(""),f=k=>{const S=k.target.value;e(S);const T=k.target.selectionStart,j=S.slice(0,T).match(/{{([^{}]*)$/);if(j){const y=j[1],v=n.filter(R=>R.startsWith(y));h(y),c(v),o(v.length>0)}else o(!1)},p=k=>{const S=s.current;if(!S)return;const T=S.selectionStart-d.length-2,C=t.slice(0,T),j=t.slice(S.selectionEnd),y=`{{${k}}}`,v=`${C}${y}${j}`;e(v),o(!1),setTimeout(()=>{S.focus();const R=C.length+y.length;S.selectionStart=S.selectionEnd=R},0)};return i.jsxs("div",{className:"relative",children:[i.jsx("textarea",{ref:s,className:`w-full p-2 border rounded ${r}`,value:t,onChange:f}),a&&i.jsx("ul",{className:"absolute z-10 bg-white border rounded shadow text-sm mt-1 max-h-40 overflow-auto",children:l.map(k=>i.jsx("li",{children:i.jsx(Vt,{type:"button",className:"block w-full text-left px-2 py-1 hover:bg-accent-10",onClick:()=>p(k),children:"{{"+k+"}}"})},k))})]})};function E3(){const[t,e]=m.useState([]);return m.useEffect(()=>{let n=!1;return(async()=>{try{const s=await Ne(fe(F,"componentTypes"));if(!n){const a=s.docs.map(o=>({id:o.id,...o.data()}));a.push({id:"brand",key:"brand",label:"Brand",selectionMode:"brand",attributes:[{label:"Name",key:"name",inputType:"text"},{label:"Tone of Voice",key:"toneOfVoice",inputType:"text"},{label:"Offering",key:"offering",inputType:"text"}]}),a.push({id:"product",key:"product",label:"Product",selectionMode:"checklist",attributes:[{label:"Name",key:"name",inputType:"text"},{label:"Description",key:"description",inputType:"text"},{label:"Benefits",key:"benefits",inputType:"text"}]}),e(a)}}catch(s){console.error("Failed to load component types",s),n||e([])}})(),()=>{n=!0}},[]),t}const k3=()=>{const t=E3(),[e,n]=m.useState([]),[r,s]=m.useState(""),[a,o]=m.useState(!0),[l,c]=m.useState(""),[d,h]=m.useState(""),[f,p]=m.useState(""),[k,S]=m.useState([]),[T,C]=m.useState([{label:"",key:"",inputType:"text"}]),[j,y]=m.useState(!1),[v,R]=m.useState([]),[O,M]=m.useState([]),[b,x]=m.useState(null),[w,E]=m.useState(!1);m.useEffect(()=>{(async()=>{try{const Y=await Ne(fe(F,"recipeTypes"));n(Y.docs.map(V=>({id:V.id,...V.data()})))}catch(Y){console.error("Failed to fetch recipe types",Y),n([])}})()},[]);const N=()=>{x(null),c(""),h(""),p(""),S([]),C([{label:"",key:"",inputType:"text"}]),y(!1),R([]),M([])},D=()=>{N(),E(!0)},I=async z=>{z.preventDefault();const Y=k.filter(Boolean),V=O.filter(Boolean),q=T.map(ae=>({label:ae.label.trim(),key:ae.key.trim(),inputType:ae.inputType||"text"})).filter(ae=>ae.label&&ae.key);try{if(b)await He(ie(F,"recipeTypes",b),{name:l.trim(),gptPrompt:d,assetPrompt:f,enableAssetCsv:j,assetMatchFields:v,components:Y,writeInFields:q,defaultColumns:V}),n(ae=>ae.map(Ee=>Ee.id===b?{...Ee,name:l.trim(),gptPrompt:d,assetPrompt:f,enableAssetCsv:j,assetMatchFields:v,components:Y,writeInFields:q,defaultColumns:V}:Ee));else{const ae=await rn(fe(F,"recipeTypes"),{name:l.trim(),gptPrompt:d,assetPrompt:f,enableAssetCsv:j,assetMatchFields:v,components:Y,writeInFields:q,defaultColumns:V});n(Ee=>[...Ee,{id:ae.id,name:l.trim(),gptPrompt:d,assetPrompt:f,enableAssetCsv:j,assetMatchFields:v,components:Y,writeInFields:q,defaultColumns:V}])}N(),E(!1)}catch(ae){console.error("Failed to save recipe type",ae)}},pe=z=>{x(z.id),c(z.name),h(z.gptPrompt||""),p(z.assetPrompt||""),y(!!z.enableAssetCsv),R(z.assetMatchFields||[]),S(z.components||[]),M(z.defaultColumns||[]),C(z.writeInFields&&z.writeInFields.length>0?z.writeInFields:[{label:"",key:"",inputType:"text"}]),E(!0)},Xe=async z=>{try{await mn(ie(F,"recipeTypes",z)),n(Y=>Y.filter(V=>V.id!==z))}catch(Y){console.error("Failed to delete recipe type",Y)}},Ae=m.useMemo(()=>{const z=[];return t.forEach(Y=>{var V;(V=Y.attributes)==null||V.forEach(q=>{z.push(`${Y.key}.${q.key}`)})}),T.forEach(Y=>{Y.key&&z.push(Y.key)}),z.push("review.name","review.body","review.title","review.rating","review.product"),z},[t,T]),J=m.useMemo(()=>{const z=[];return t.forEach(Y=>{var V;(V=Y.attributes)==null||V.forEach(q=>{z.push(`${Y.key}.${q.key}`),(q.key==="assetNo"||q.key==="assetCount")&&z.push(`${Y.key}.assets`)})}),T.forEach(Y=>{Y.key&&z.push(Y.key)}),z.push("review.name","review.body","review.title","review.rating","review.product","recipeNo","copy"),Array.from(new Set(z))},[t,T]),K=m.useMemo(()=>{const z=r.toLowerCase(),Y=e.filter(V=>V.name.toLowerCase().includes(z));return Y.sort((V,q)=>V.name.localeCompare(q.name)),a||Y.reverse(),Y},[e,r,a]);return i.jsxs("div",{children:[i.jsx("h2",{className:"text-xl mb-2",children:"Recipe Types"}),i.jsxs("div",{className:"flex justify-between mb-2",children:[i.jsxs("div",{children:[i.jsx("input",{type:"text",placeholder:"Filter",value:r,onChange:z=>s(z.target.value),className:"p-1 border rounded mr-2"}),i.jsxs("select",{value:a?"asc":"desc",onChange:z=>o(z.target.value==="asc"),className:"p-1 border rounded",children:[i.jsx("option",{value:"asc",children:"Sort A-Z"}),i.jsx("option",{value:"desc",children:"Sort Z-A"})]})]}),i.jsxs(Vt,{variant:"primary",onClick:D,className:"flex items-center gap-1",children:[i.jsx(Yi,{})," Create Recipe Type"]})]}),K.length===0?i.jsx("p",{children:"No recipe types found."}):i.jsxs(Un,{children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Name"}),i.jsx("th",{children:"Components"}),i.jsx("th",{children:"Write-In Fields"}),i.jsx("th",{children:"Asset Prompt"}),i.jsx("th",{children:"Asset Fields"}),i.jsx("th",{children:"Default Columns"}),i.jsx("th",{children:"Actions"})]})}),i.jsx("tbody",{children:K.map(z=>i.jsxs("tr",{children:[i.jsx("td",{children:z.name}),i.jsx("td",{children:z.components&&z.components.length>0?z.components.join(", "):"-"}),i.jsx("td",{children:z.writeInFields&&z.writeInFields.length>0?z.writeInFields.map(Y=>Y.key).join(", "):"-"}),i.jsx("td",{children:z.assetPrompt||"-"}),i.jsx("td",{children:z.assetMatchFields&&z.assetMatchFields.length>0?z.assetMatchFields.join(", "):"-"}),i.jsx("td",{children:z.defaultColumns&&z.defaultColumns.length>0?z.defaultColumns.join(", "):"-"}),i.jsx("td",{className:"text-center",children:i.jsxs("div",{className:"flex items-center justify-center gap-2",children:[i.jsx(be,{onClick:()=>pe(z),"aria-label":"Edit",children:i.jsx(Ar,{})}),i.jsx(be,{onClick:()=>Xe(z.id),className:"btn-delete","aria-label":"Delete",children:i.jsx(qt,{})})]})})]},z.id))})]}),w&&i.jsx(Hs,{sizeClass:"max-w-2xl",children:i.jsxs("form",{onSubmit:I,className:"space-y-2 max-w-[50rem]",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:"Name"}),i.jsx("input",{className:"w-full p-2 border rounded",value:l,onChange:z=>c(z.target.value),required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:"GPT Prompt"}),i.jsx(Kc,{value:d,onChange:h,placeholders:Ae})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:"Asset Prompt"}),i.jsx(Kc,{value:f,onChange:p,placeholders:Ae})]}),i.jsxs("div",{children:[i.jsxs("label",{className:"block text-sm",children:[i.jsx("input",{type:"checkbox",className:"mr-1",checked:j,onChange:z=>y(z.target.checked)}),"Enable Asset CSV"]}),j&&i.jsxs("div",{className:"mt-2",children:[i.jsx("label",{className:"block text-sm mb-1",children:"Asset Match Fields"}),i.jsx(Ds,{id:"asset-fields",value:v,onChange:R,suggestions:Ae})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:"Components (in order)"}),i.jsx(Ds,{id:"component-order",value:k,onChange:S,suggestions:t.map(z=>z.key),onlySuggestions:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:"Default Visible Columns"}),i.jsx(Ds,{id:"default-columns",value:O,onChange:M,suggestions:J})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-sm",children:"Write-In Fields"}),T.map((z,Y)=>i.jsxs("div",{className:"flex gap-2 items-center",children:[i.jsx("input",{className:"p-2 border rounded flex-1",placeholder:"Label",value:z.label,onChange:V=>{const q=[...T];q[Y].label=V.target.value,C(q)}}),i.jsx("input",{className:"p-2 border rounded flex-1",placeholder:"Key",value:z.key,onChange:V=>{const q=[...T];q[Y].key=V.target.value,C(q)}}),i.jsxs("select",{className:"p-2 border rounded",value:z.inputType,onChange:V=>{const q=[...T];q[Y].inputType=V.target.value,C(q)},children:[i.jsx("option",{value:"text",children:"Text"}),i.jsx("option",{value:"number",children:"Number"}),i.jsx("option",{value:"textarea",children:"Textarea"}),i.jsx("option",{value:"image",children:"Image"}),i.jsx("option",{value:"list",children:"List"})]}),i.jsx(Vt,{type:"button",variant:"secondary",onClick:()=>C(T.filter((V,q)=>q!==Y)),className:"px-2 py-0.5",children:i.jsx(qt,{})})]},Y)),i.jsx(Vt,{type:"button",variant:"secondary",onClick:()=>C([...T,{label:"",key:"",inputType:"text"}]),className:"px-2 py-0.5",children:"Add Field"})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(Vt,{type:"submit",variant:"primary",children:b?"Save Type":"Add Type"}),i.jsx(Vt,{type:"button",onClick:()=>{N(),E(!1)},variant:"secondary",className:"px-2 py-0.5",children:"Cancel"})]})]})})]})},C3=()=>{const[t,e]=m.useState([]),[n,r]=m.useState(""),[s,a]=m.useState(""),[o,l]=m.useState("dropdown"),[c,d]=m.useState([{label:"",key:"",inputType:"text"}]),[h,f]=m.useState(null);m.useEffect(()=>{(async()=>{try{const j=await Ne(fe(F,"componentTypes"));e(j.docs.map(y=>({id:y.id,...y.data()})))}catch(j){console.error("Failed to fetch components",j),e([])}})()},[]);const p=()=>{f(null),r(""),a(""),l("dropdown"),d([{label:"",key:"",inputType:"text"}])},k=async C=>{C.preventDefault();const j=c.map(y=>({label:y.label.trim(),key:y.key.trim(),inputType:y.inputType||"text"})).filter(y=>y.label&&y.key);try{if(h)await He(ie(F,"componentTypes",h),{label:n.trim(),key:s.trim(),selectionMode:o,attributes:j}),e(y=>y.map(v=>v.id===h?{...v,label:n.trim(),key:s.trim(),selectionMode:o,attributes:j}:v));else{const y=await rn(fe(F,"componentTypes"),{label:n.trim(),key:s.trim(),selectionMode:o,attributes:j});e(v=>[...v,{id:y.id,label:n.trim(),key:s.trim(),selectionMode:o,attributes:j}])}p()}catch(y){console.error("Failed to save component type",y)}},S=C=>{f(C.id),r(C.label),a(C.key),l(C.selectionMode||"dropdown"),d(C.attributes&&C.attributes.length>0?C.attributes:[{label:"",key:"",inputType:"text"}])},T=async C=>{try{await mn(ie(F,"componentTypes",C)),e(j=>j.filter(y=>y.id!==C))}catch(j){console.error("Failed to delete component type",j)}};return i.jsxs("div",{children:[i.jsx("h2",{className:"text-xl mb-2",children:"Components"}),t.length===0?i.jsx("p",{children:"No components found."}):i.jsxs(Un,{children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Label"}),i.jsx("th",{children:"Key"}),i.jsx("th",{children:"Mode"}),i.jsx("th",{children:"Attributes"}),i.jsx("th",{children:"Actions"})]})}),i.jsx("tbody",{children:t.map(C=>i.jsxs("tr",{children:[i.jsx("td",{children:C.label}),i.jsx("td",{children:C.key}),i.jsx("td",{children:C.selectionMode||"dropdown"}),i.jsx("td",{children:C.attributes?C.attributes.length:0}),i.jsx("td",{className:"text-center",children:i.jsxs("div",{className:"flex items-center justify-center",children:[i.jsx(be,{onClick:()=>S(C),className:"mr-2","aria-label":"Edit",children:i.jsx(Ar,{})}),i.jsx(be,{onClick:()=>T(C.id),className:"btn-delete","aria-label":"Delete",children:i.jsx(qt,{})})]})})]},C.id))})]}),i.jsxs("form",{onSubmit:k,className:"space-y-2 max-w-[50rem]",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:"Label"}),i.jsx("input",{className:"w-full p-2 border rounded",value:n,onChange:C=>r(C.target.value),required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:"Key"}),i.jsx("input",{className:"w-full p-2 border rounded",value:s,onChange:C=>a(C.target.value),required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:"Selection Mode"}),i.jsxs("select",{className:"w-full p-2 border rounded",value:o,onChange:C=>l(C.target.value),children:[i.jsx("option",{value:"random",children:"random"}),i.jsx("option",{value:"dropdown",children:"dropdown"}),i.jsx("option",{value:"checklist",children:"checklist"})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-sm",children:"Attributes"}),c.map((C,j)=>i.jsxs("div",{className:"flex gap-2 items-center",children:[i.jsx("input",{className:"p-2 border rounded flex-1",placeholder:"Label",value:C.label,onChange:y=>{const v=[...c];v[j].label=y.target.value,d(v)}}),i.jsx("input",{className:"p-2 border rounded flex-1",placeholder:"Key",value:C.key,onChange:y=>{const v=[...c];v[j].key=y.target.value,d(v)}}),i.jsxs("select",{className:"p-2 border rounded",value:C.inputType,onChange:y=>{const v=[...c];v[j].inputType=y.target.value,d(v)},children:[i.jsx("option",{value:"text",children:"Text"}),i.jsx("option",{value:"number",children:"Number"}),i.jsx("option",{value:"textarea",children:"Textarea"}),i.jsx("option",{value:"image",children:"Image"}),i.jsx("option",{value:"list",children:"List"})]}),i.jsx(Vt,{type:"button",variant:"secondary",onClick:()=>d(c.filter((y,v)=>v!==j)),className:"px-2 py-0.5",children:i.jsx(qt,{})})]},j)),i.jsx(Vt,{type:"button",variant:"secondary",onClick:()=>d([...c,{label:"",key:"",inputType:"text"}]),className:"px-2 py-0.5",children:"Add Attribute"})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(Vt,{type:"submit",variant:"primary",children:h?"Save Component":"Add Component"}),h&&i.jsx(Vt,{type:"button",onClick:p,variant:"secondary",className:"px-2 py-0.5",children:"Cancel"})]})]})]})},S3=Po(ni);function b_(t){return(t||"").replace(/\//g,"-").replace(/\s+/g," ").trim()}async function N3(t,e,n){const r=b_(e),s=b_(n),a=`Campfire/Instances/${r}/${s}/${t.name}`,o=xi(S3,a);return await Jl(o,t,{cacheControl:"public,max-age=31536000,immutable"}),await Xl(o)}const T3=()=>{var K,z,Y;const[t,e]=m.useState([]),[n,r]=m.useState([]),[s,a]=m.useState([]),[o,l]=m.useState(""),[c,d]=m.useState(""),[h,f]=m.useState({}),[p,k]=m.useState(""),[S,T]=m.useState(null),[C,j]=m.useState(""),[y,v]=m.useState(null),[R,O]=m.useState([]),[M,b]=m.useState([]),[x,w]=m.useState({});m.useEffect(()=>{(async()=>{try{const q=await Ne(fe(F,"componentTypes"));e(q.docs.map(L=>{const B=L.data();return{id:L.id,...B,selectionMode:B.selectionMode||"dropdown"}}));const ae=await Ne(fe(F,"componentInstances"));r(ae.docs.map(L=>({id:L.id,...L.data()})));const Ee=await Ne(fe(F,"brands"));a(Ee.docs.map(L=>({id:L.id,...L.data()})))}catch(q){console.error("Failed to load component instances",q)}})()},[]);const E=()=>{T(null),l(""),d(""),f({}),k("")},N=async V=>{V.preventDefault();const q=t.find(ae=>ae.id===o);if(q)try{const ae={...h};for(const Ee of q.attributes||[])if(Ee.inputType==="image"){const L=h[Ee.key];L!=null&&L.file?ae[Ee.key]=await N3(L.file,q.key,c.trim()):L!=null&&L.url?ae[Ee.key]=L.url:ae[Ee.key]=""}if(S)await He(ie(F,"componentInstances",S),{componentKey:q.key,name:c.trim(),values:ae,relationships:p?{brandCode:p}:{}}),r(Ee=>Ee.map(L=>L.id===S?{...L,componentKey:q.key,name:c.trim(),values:ae,relationships:p?{brandCode:p}:{}}:L));else{const Ee=await rn(fe(F,"componentInstances"),{componentKey:q.key,name:c.trim(),values:ae,relationships:p?{brandCode:p}:{}});r(L=>[...L,{id:Ee.id,componentKey:q.key,name:c.trim(),values:ae,relationships:p?{brandCode:p}:{}}])}E()}catch(ae){console.error("Failed to save instance",ae)}},D=V=>{var Ee,L;T(V.id);const q=t.find(B=>B.key===V.componentKey);l(q?q.id:""),d(V.name);const ae={};q?(Ee=q.attributes)==null||Ee.forEach(B=>{var ne;const G=(ne=V.values)==null?void 0:ne[B.key];B.inputType==="image"?ae[B.key]=G?{url:G,file:null}:{url:"",file:null}:ae[B.key]=G}):Object.assign(ae,V.values||{}),f(ae),k(((L=V.relationships)==null?void 0:L.brandCode)||"")},I=async V=>{try{await mn(ie(F,"componentInstances",V)),r(q=>q.filter(ae=>ae.id!==V))}catch(q){console.error("Failed to delete instance",q)}},pe=async V=>{var ae;const q=(ae=V.target.files)==null?void 0:ae[0];if(v(q||null),O([]),b([]),w({}),q){const L=(await q.text()).trim().split(/\r?\n/);if(L.length>1){const B=Ml(L[0]).map(ne=>ne.trim()),G=[];for(let ne=1;ne<L.length;ne+=1)L[ne]&&G.push(Ml(L[ne]).map(de=>de.trim()));O(B),b(G)}}},Xe=async()=>{var q;const V=t.find(ae=>ae.id===o);if(!(!V||M.length===0)){for(const ae of M){const Ee=x.name,L=Ee!==void 0&&Ee!==""?(ae[Ee]||"").trim():"",B={};(q=V.attributes)==null||q.forEach(G=>{const ne=x[G.key];ne!==void 0&&ne!==""&&(B[G.key]=ae[ne]||"")});try{const G=await rn(fe(F,"componentInstances"),{componentKey:V.key,name:L,values:B,relationships:p?{brandCode:p}:{}});r(ne=>[...ne,{id:G.id,componentKey:V.key,name:L,values:B,relationships:p?{brandCode:p}:{}}])}catch(G){console.error("Failed to save instance from CSV",G)}}v(null),O([]),b([]),w({})}},Ae=t.find(V=>V.id===o),J=n.filter(V=>{var ae;const q=C.toLowerCase();return!q||V.name.toLowerCase().includes(q)||V.componentKey.toLowerCase().includes(q)||(((ae=V.relationships)==null?void 0:ae.brandCode)||"").toLowerCase().includes(q)});return i.jsxs("div",{children:[i.jsx("h2",{className:"text-xl mb-2",children:"Component Instances"}),i.jsx("div",{className:"mb-2",children:i.jsx("input",{type:"text",placeholder:"Filter",value:C,onChange:V=>j(V.target.value),className:"p-1 border rounded"})}),J.length===0?i.jsx("p",{children:"No instances found."}):i.jsxs(Un,{children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Name"}),i.jsx("th",{children:"Component"}),i.jsx("th",{children:"Brand"}),i.jsx("th",{children:"Actions"})]})}),i.jsx("tbody",{children:J.map(V=>{var q;return i.jsxs("tr",{children:[i.jsx("td",{children:V.name}),i.jsx("td",{children:V.componentKey}),i.jsx("td",{children:((q=V.relationships)==null?void 0:q.brandCode)||""}),i.jsx("td",{className:"text-center",children:i.jsxs("div",{className:"flex items-center justify-center",children:[i.jsx(be,{onClick:()=>D(V),className:"mr-2","aria-label":"Edit",children:i.jsx(Ar,{})}),i.jsx(be,{onClick:()=>I(V.id),className:"btn-delete","aria-label":"Delete",children:i.jsx(qt,{})})]})})]},V.id)})})]}),i.jsxs("form",{onSubmit:N,className:"space-y-2 max-w-[50rem]",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:"Name"}),i.jsx("input",{className:"w-full p-2 border rounded",value:c,onChange:V=>d(V.target.value),required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:"Component"}),i.jsxs("select",{className:"w-full p-2 border rounded",value:o,onChange:V=>l(V.target.value),children:[i.jsx("option",{value:"",children:"Select..."}),t.map(V=>i.jsx("option",{value:V.id,children:V.label},V.id))]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:"Brand"}),i.jsxs("select",{className:"w-full p-2 border rounded",value:p,onChange:V=>k(V.target.value),children:[i.jsx("option",{value:"",children:"None"}),s.map(V=>i.jsxs("option",{value:V.code,children:[V.code," ",V.name?`- ${V.name}`:""]},V.id))]})]}),Ae&&i.jsx("div",{className:"space-y-2",children:(K=Ae.attributes)==null?void 0:K.map(V=>{const q=h[V.key],ae=L=>f({...h,[V.key]:L}),Ee=L=>Array.isArray(L)?L:typeof L=="string"?L.split(/[;,\n]+/).map(B=>B.trim()).filter(Boolean):[];return i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:V.label}),V.inputType==="textarea"?i.jsx("textarea",{className:"w-full p-2 border rounded",value:q||"",onChange:L=>ae(L.target.value)}):V.inputType==="list"?i.jsx(Ds,{id:`attr-${V.key}`,value:Ee(q),onChange:ae}):V.inputType==="image"?i.jsxs("div",{children:[i.jsx("input",{type:"file",accept:"image/*",onChange:L=>ae({url:L.target.files[0]?URL.createObjectURL(L.target.files[0]):(q==null?void 0:q.url)||"",file:L.target.files[0]||null}),className:"w-full p-2 border rounded"}),(q==null?void 0:q.url)&&i.jsx("img",{src:q.url,alt:V.label,className:"mt-1 max-w-[125px] w-auto h-auto"})]}):i.jsx("input",{className:"w-full p-2 border rounded",type:V.inputType,value:q||"",onChange:L=>ae(L.target.value)})]},V.key)})}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(Vt,{type:"submit",variant:"primary",children:S?"Save Instance":"Add Instance"}),S&&i.jsx(Vt,{type:"button",onClick:E,variant:"secondary",className:"px-2 py-0.5",children:"Cancel"})]})]}),S&&i.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:i.jsx("div",{className:"bg-white p-4 rounded shadow max-w-lg w-full relative dark:bg-[var(--dark-sidebar-bg)] dark:text-[var(--dark-text)]",children:i.jsxs("form",{onSubmit:N,className:"space-y-2",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:"Name"}),i.jsx("input",{className:"w-full p-2 border rounded",value:c,onChange:V=>d(V.target.value),required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:"Component"}),i.jsxs("select",{className:"w-full p-2 border rounded",value:o,onChange:V=>l(V.target.value),children:[i.jsx("option",{value:"",children:"Select..."}),t.map(V=>i.jsx("option",{value:V.id,children:V.label},V.id))]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:"Brand"}),i.jsxs("select",{className:"w-full p-2 border rounded",value:p,onChange:V=>k(V.target.value),children:[i.jsx("option",{value:"",children:"None"}),s.map(V=>i.jsxs("option",{value:V.code,children:[V.code," ",V.name?`- ${V.name}`:""]},V.id))]})]}),Ae&&i.jsx("div",{className:"space-y-2",children:(z=Ae.attributes)==null?void 0:z.map(V=>{const q=h[V.key],ae=L=>f({...h,[V.key]:L}),Ee=L=>Array.isArray(L)?L:typeof L=="string"?L.split(/[;,\n]+/).map(B=>B.trim()).filter(Boolean):[];return i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:V.label}),V.inputType==="textarea"?i.jsx("textarea",{className:"w-full p-2 border rounded",value:q||"",onChange:L=>ae(L.target.value)}):V.inputType==="list"?i.jsx(Ds,{id:`modal-attr-${V.key}`,value:Ee(q),onChange:ae}):V.inputType==="image"?i.jsxs("div",{children:[i.jsx("input",{type:"file",accept:"image/*",onChange:L=>ae({url:L.target.files[0]?URL.createObjectURL(L.target.files[0]):(q==null?void 0:q.url)||"",file:L.target.files[0]||null}),className:"w-full p-2 border rounded"}),(q==null?void 0:q.url)&&i.jsx("img",{src:q.url,alt:V.label,className:"mt-1 max-w-[125px] w-auto h-auto"})]}):i.jsx("input",{className:"w-full p-2 border rounded",type:V.inputType,value:q||"",onChange:L=>ae(L.target.value)})]},V.key)})}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(Vt,{type:"submit",variant:"primary",children:"Save Instance"}),i.jsx(Vt,{type:"button",onClick:E,variant:"secondary",className:"px-2 py-0.5",children:"Cancel"})]})]})})}),Ae&&i.jsxs("div",{className:"mt-8 space-y-2 max-w-[50rem]",children:[i.jsx("h3",{className:"text-lg",children:"Bulk Add via CSV"}),i.jsx("input",{type:"file",accept:".csv",onChange:pe}),R.length>0&&i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:"Name Column"}),i.jsxs("select",{className:"w-full p-2 border rounded",value:x.name??"",onChange:V=>w({...x,name:V.target.value}),children:[i.jsx("option",{value:"",children:"Ignore"}),R.map((V,q)=>i.jsx("option",{value:q,children:V},q))]})]}),(Y=Ae.attributes)==null?void 0:Y.map(V=>i.jsxs("div",{children:[i.jsxs("label",{className:"block text-sm mb-1",children:[V.label," Column"]}),i.jsxs("select",{className:"w-full p-2 border rounded",value:x[V.key]??"",onChange:q=>w({...x,[V.key]:q.target.value}),children:[i.jsx("option",{value:"",children:"Ignore"}),R.map((q,ae)=>i.jsx("option",{value:ae,children:q},ae))]})]},V.key)),i.jsx(Vt,{type:"button",onClick:Xe,variant:"primary",children:"Add Instances"})]})]})]})},I3=()=>{const[t,e]=m.useState(fs.TYPES);return i.jsxs("div",{className:"min-h-screen p-4",children:[i.jsx("h1",{className:"text-2xl mb-4",children:"Ad Recipe Setup"}),i.jsx(j3,{view:t,setView:e}),t===fs.TYPES&&i.jsx(k3,{}),t===fs.COMPONENTS&&i.jsx(C3,{}),t===fs.INSTANCES&&i.jsx(T3,{}),t===fs.PREVIEW&&i.jsx(Bg,{})]})},ui={TYPES:"types",PREVIEW:"preview",RULES:"rules"},A3=({view:t,setView:e})=>i.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[i.jsxs(_t,{active:t===ui.TYPES,onClick:()=>e(ui.TYPES),children:[i.jsx(Zl,{})," ",i.jsx("span",{children:"Recipe Types"})]}),i.jsxs(_t,{active:t===ui.PREVIEW,onClick:()=>e(ui.PREVIEW),children:[i.jsx(Wi,{})," ",i.jsx("span",{children:"Preview"})]}),i.jsxs(_t,{active:t===ui.RULES,onClick:()=>e(ui.RULES),children:[i.jsx(Vg,{})," ",i.jsx("span",{children:"Rules"})]})]}),R3=()=>{const[t,e]=bt.useState([]),[n,r]=bt.useState(!1),[s,a]=bt.useState(""),[o,l]=bt.useState(""),[c,d]=bt.useState(""),[h,f]=bt.useState(""),[p,k]=bt.useState([{label:"",key:"",inputType:"text"}]),S=m.useMemo(()=>{const N=["brand.name","brand.toneOfVoice","brand.offering","product.name","product.description","product.benefits"];return p.forEach(D=>{D.key&&N.push(D.key)}),N},[p]),[T,C]=bt.useState(null),[j,y]=bt.useState(""),[v,R]=bt.useState(!0),O=bt.useMemo(()=>{const N=j.toLowerCase(),D=t.filter(I=>I.name.toLowerCase().includes(N));return D.sort((I,pe)=>I.name.localeCompare(pe.name)),v||D.reverse(),D},[t,j,v]);bt.useEffect(()=>{(async()=>{try{const D=await Ne(fe(F,"copyRecipeTypes"));e(D.docs.map(I=>({id:I.id,writeInFields:[],...I.data()})))}catch(D){console.error("Failed to fetch copy recipe types",D),e([])}})()},[]);const M=()=>{C(null),a(""),l(""),d(""),f(""),k([{label:"",key:"",inputType:"text"}])},b=()=>{M(),r(!0)},x=async N=>{N.preventDefault();const D={name:s.trim(),primaryPrompt:o,headlinePrompt:c,descriptionPrompt:h,writeInFields:p};try{if(T)await He(ie(F,"copyRecipeTypes",T),D),e(I=>I.map(pe=>pe.id===T?{...pe,...D}:pe));else{const I=await rn(fe(F,"copyRecipeTypes"),D);e(pe=>[...pe,{id:I.id,...D}])}M(),r(!1)}catch(I){console.error("Failed to save type",I)}},w=N=>{C(N.id),a(N.name),l(N.primaryPrompt||""),d(N.headlinePrompt||""),f(N.descriptionPrompt||""),k(N.writeInFields&&N.writeInFields.length>0?N.writeInFields:[{label:"",key:"",inputType:"text"}]),r(!0)},E=async N=>{try{await mn(ie(F,"copyRecipeTypes",N)),e(D=>D.filter(I=>I.id!==N))}catch(D){console.error("Failed to delete type",D)}};return i.jsxs("div",{children:[i.jsxs("div",{className:"flex justify-between mb-2",children:[i.jsxs("div",{children:[i.jsx("input",{type:"text",placeholder:"Filter",value:j,onChange:N=>y(N.target.value),className:"p-1 border rounded mr-2"}),i.jsxs("select",{value:v?"asc":"desc",onChange:N=>R(N.target.value==="asc"),className:"p-1 border rounded",children:[i.jsx("option",{value:"asc",children:"Sort A-Z"}),i.jsx("option",{value:"desc",children:"Sort Z-A"})]})]}),i.jsxs(Vt,{variant:"primary",onClick:b,className:"flex items-center gap-1",children:[i.jsx(Yi,{})," Create Recipe Type"]})]}),O.length===0?i.jsx("p",{children:"No recipe types found."}):i.jsx("div",{className:"overflow-x-auto table-container mb-4",children:i.jsxs("table",{className:"ad-table min-w-max text-sm",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Name"}),i.jsx("th",{children:"Primary Prompt"}),i.jsx("th",{children:"Headline Prompt"}),i.jsx("th",{children:"Description Prompt"}),i.jsx("th",{children:"Actions"})]})}),i.jsx("tbody",{children:O.map(N=>i.jsxs("tr",{children:[i.jsx("td",{children:N.name}),i.jsx("td",{className:"whitespace-pre-wrap break-words max-w-xs",children:N.primaryPrompt||"-"}),i.jsx("td",{className:"whitespace-pre-wrap break-words max-w-xs",children:N.headlinePrompt||"-"}),i.jsx("td",{className:"whitespace-pre-wrap break-words max-w-xs",children:N.descriptionPrompt||"-"}),i.jsx("td",{className:"text-center",children:i.jsxs("div",{className:"flex items-center justify-center gap-2",children:[i.jsx(be,{onClick:()=>w(N),"aria-label":"Edit",children:i.jsx(Ar,{})}),i.jsx(be,{onClick:()=>E(N.id),"aria-label":"Delete",children:i.jsx(qt,{})})]})})]},N.id))})]})}),n&&i.jsx(Hs,{sizeClass:"max-w-2xl",children:i.jsxs("form",{onSubmit:x,className:"space-y-2 max-w-xl",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:"Name"}),i.jsx("input",{className:"w-full p-2 border rounded",value:s,onChange:N=>a(N.target.value),required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:"Primary Prompt"}),i.jsx(Kc,{value:o,onChange:l,placeholders:S})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:"Headline Prompt"}),i.jsx(Kc,{value:c,onChange:d,placeholders:S})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm mb-1",children:"Description Prompt"}),i.jsx(Kc,{value:h,onChange:f,placeholders:S})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-sm",children:"Write-In Fields"}),p.map((N,D)=>i.jsxs("div",{className:"flex gap-2 items-center",children:[i.jsx("input",{className:"p-2 border rounded flex-1",placeholder:"Label",value:N.label,onChange:I=>{const pe=[...p];pe[D].label=I.target.value,k(pe)}}),i.jsx("input",{className:"p-2 border rounded flex-1",placeholder:"Key",value:N.key,onChange:I=>{const pe=[...p];pe[D].key=I.target.value,k(pe)}}),i.jsxs("select",{className:"p-2 border rounded",value:N.inputType,onChange:I=>{const pe=[...p];pe[D].inputType=I.target.value,k(pe)},children:[i.jsx("option",{value:"text",children:"Text"}),i.jsx("option",{value:"number",children:"Number"}),i.jsx("option",{value:"textarea",children:"Textarea"}),i.jsx("option",{value:"image",children:"Image"}),i.jsx("option",{value:"list",children:"List"})]}),N.inputType==="list"&&i.jsx(Ds,{id:`list-${D}`,value:Array.isArray(N.options)?N.options:[],onChange:I=>{const pe=[...p];pe[D].options=I,k(pe)}}),i.jsx("button",{type:"button",onClick:()=>k(p.filter((I,pe)=>pe!==D)),className:"btn-secondary px-2 py-0.5",children:i.jsx(qt,{})})]},D)),i.jsx("button",{type:"button",onClick:()=>k([...p,{label:"",key:"",inputType:"text"}]),className:"btn-secondary px-2 py-0.5",children:"Add Field"})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{type:"submit",className:"btn-primary",children:T?"Save Type":"Add Type"}),i.jsx("button",{type:"button",onClick:()=>{M(),r(!1)},className:"btn-secondary px-2 py-0.5",children:"Cancel"})]})]})})]})},P3=()=>{const[t,e]=m.useState(ui.TYPES);return i.jsxs("div",{className:"min-h-screen p-4 space-y-4",children:[i.jsx("h1",{className:"text-2xl mb-2",children:"Copy Recipes"}),i.jsx(A3,{view:t,setView:e}),t===ui.TYPES&&i.jsx(R3,{}),t===ui.PREVIEW&&i.jsx(Tu,{}),t===ui.RULES&&i.jsx("p",{children:"Guidelines coming soon."})]})},D3=()=>{const[t,e]=m.useState(""),[n,r]=m.useState(""),[s,a]=m.useState(""),[o,l]=m.useState(""),[c,d]=m.useState(!1),[h,f]=m.useState([]),[p,k]=m.useState([]),[S,T]=m.useState(!1),[C,j]=m.useState(""),[y,v]=m.useState("created"),[R,O]=m.useState("all"),[M,b]=m.useState(0),x=25,[w,E]=m.useState({trigger:"adGroupCreated",audience:"",title:"",body:""}),[N,D]=m.useState(null),I=async()=>{try{const G=await Ne(Ye(fe(F,"notifications"),lo("createdAt","desc")));f(G.docs.map(ne=>({id:ne.id,...ne.data()})))}catch(G){console.error("Failed to load notifications",G),f([])}},pe=async()=>{try{const G=await Ne(Ye(fe(F,"notificationRules"),lo("createdAt","desc")));k(G.docs.map(ne=>({id:ne.id,...ne.data()})))}catch(G){console.error("Failed to load rules",G),k([])}};m.useEffect(()=>{I(),pe()},[]),m.useEffect(()=>{b(0)},[C,y,h.length]);const Xe=async G=>{G.preventDefault(),d(!0);try{await rn(fe(F,"notifications"),{title:t,body:n,audience:s,sendNow:!o,triggerTime:o?new Date(o):null,createdAt:Mt()}),e(""),r(""),a(""),l(""),I()}catch(ne){console.error("Failed to save notification",ne)}finally{d(!1)}},Ae=async G=>{G.preventDefault();try{if(N)await He(ie(F,"notificationRules",N),{trigger:w.trigger,audience:w.audience,titleTemplate:w.title,bodyTemplate:w.body}),k(ne=>ne.map(de=>de.id===N?{...de,trigger:w.trigger,audience:w.audience,title:w.title,body:w.body,titleTemplate:w.title,bodyTemplate:w.body}:de)),D(null);else{const ne=await rn(fe(F,"notificationRules"),{trigger:w.trigger,audience:w.audience,titleTemplate:w.title,bodyTemplate:w.body,active:!0,createdAt:Mt()});k(de=>[...de,{id:ne.id,...w,active:!0}])}E({trigger:"adGroupCreated",audience:"",title:"",body:""})}catch(ne){console.error("Failed to save rule",ne)}},J=async(G,ne)=>{try{await He(ie(F,"notificationRules",G),{active:!ne}),k(de=>de.map(Qe=>Qe.id===G?{...Qe,active:!ne}:Qe))}catch(de){console.error("Failed to update rule",de)}},K=G=>{E({trigger:G.trigger,audience:G.audience,title:G.title||G.titleTemplate||"",body:G.body||G.bodyTemplate||""}),D(G.id)},z=()=>{E({trigger:"adGroupCreated",audience:"",title:"",body:""}),D(null)},Y=async G=>{if(window.confirm("Delete this rule?"))try{await mn(ie(F,"notificationRules",G)),k(ne=>ne.filter(de=>de.id!==G))}catch(ne){console.error("Failed to delete rule",ne)}},V=async G=>{if(window.confirm("Delete this notification?"))try{await mn(ie(F,"notifications",G)),f(ne=>ne.filter(de=>de.id!==G))}catch(ne){console.error("Failed to delete notification",ne)}},q=C.toLowerCase(),ae=h.filter(G=>{var ne,de;return!q||((ne=G.title)==null?void 0:ne.toLowerCase().includes(q))||((de=G.audience)==null?void 0:de.toLowerCase().includes(q))}).sort((G,ne)=>{var de,Qe;return y==="title"?(G.title||"").localeCompare(ne.title||""):y==="audience"?(G.audience||"").localeCompare(ne.audience||""):(((de=ne.createdAt)==null?void 0:de.seconds)||0)-(((Qe=G.createdAt)==null?void 0:Qe.seconds)||0)}),Ee=Math.ceil(ae.length/x)||1,L=Math.min(M,Ee-1),B=ae.slice(L*x,L*x+x);return i.jsxs("div",{className:"min-h-screen p-4",children:[i.jsx("h1",{className:"text-2xl mb-4",children:"Notifications"}),i.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[i.jsxs(_t,{active:R==="all",onClick:()=>O("all"),children:[i.jsx(ZV,{})," ",i.jsx("span",{children:"All Notifications"})]}),i.jsxs(_t,{active:R==="automations",onClick:()=>O("automations"),children:[i.jsx(yx,{})," ",i.jsx("span",{children:"Automations"})]})]}),R==="all"&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex items-center justify-between mb-2 flex-wrap gap-2",children:[i.jsxs("button",{onClick:()=>T(!0),className:"btn-primary flex items-center gap-1",children:[i.jsx(Yi,{}),"Create Notification"]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("select",{value:y,onChange:G=>v(G.target.value),className:"p-1 border rounded",children:[i.jsx("option",{value:"created",children:"Created"}),i.jsx("option",{value:"title",children:"Title"}),i.jsx("option",{value:"audience",children:"Audience"})]}),i.jsx("input",{type:"text",placeholder:"Filter",value:C,onChange:G=>j(G.target.value),className:"p-1 border rounded"})]})]}),S&&i.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:i.jsx("div",{className:"bg-white p-4 rounded shadow max-w-md w-full dark:bg-[var(--dark-sidebar-bg)] dark:text-[var(--dark-text)] overflow-y-auto max-h-[90vh]",children:i.jsxs("form",{onSubmit:Xe,className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Audience"}),i.jsx("input",{type:"text",value:s,onChange:G=>a(G.target.value),className:"w-full p-2 border rounded",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Title"}),i.jsx("input",{type:"text",value:t,onChange:G=>e(G.target.value),className:"w-full p-2 border rounded",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Body"}),i.jsx("textarea",{value:n,onChange:G=>r(G.target.value),className:"w-full p-2 border rounded",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Trigger Time"}),i.jsx("input",{type:"datetime-local",value:o,onChange:G=>l(G.target.value),className:"w-full p-2 border rounded"}),i.jsx("p",{className:"text-xs text-gray-500",children:"Leave blank to send immediately."})]}),i.jsx("button",{type:"submit",className:"btn-primary",disabled:c,children:c?"Saving...":"Save Notification"}),i.jsx("div",{className:"text-right mt-2",children:i.jsx("button",{onClick:()=>T(!1),className:"btn-secondary px-3 py-1",children:"Close"})})]})})}),i.jsx("h2",{className:"text-xl mt-8 mb-2",children:"History"}),h.length===0?i.jsx("p",{children:"No notifications found."}):i.jsxs(i.Fragment,{children:[i.jsxs(Un,{children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Title"}),i.jsx("th",{children:"Audience"}),i.jsx("th",{children:"Trigger"}),i.jsx("th",{children:"Sent At"}),i.jsx("th",{})]})}),i.jsx("tbody",{children:B.map(G=>i.jsxs("tr",{children:[i.jsx("td",{children:G.title}),i.jsx("td",{children:G.audience}),i.jsx("td",{children:G.triggerTime?new Date(G.triggerTime.seconds*1e3).toLocaleString():"Now"}),i.jsx("td",{children:G.sentAt?new Date(G.sentAt.seconds*1e3).toLocaleString():""}),i.jsx("td",{children:i.jsx(be,{onClick:()=>V(G.id),"aria-label":"Delete",children:i.jsx(qt,{})})})]},G.id))})]}),i.jsxs("div",{className:"flex justify-between items-center mt-2",children:[i.jsx("button",{type:"button",onClick:()=>b(G=>Math.max(0,G-1)),disabled:L===0,className:"btn-secondary px-3 py-1",children:"Previous"}),i.jsxs("span",{children:["Page ",L+1," of ",Ee]}),i.jsx("button",{type:"button",onClick:()=>b(G=>G+1<Ee?G+1:G),disabled:L+1>=Ee,className:"btn-secondary px-3 py-1",children:"Next"})]})]})]}),R==="automations"&&i.jsxs(i.Fragment,{children:[i.jsx("h2",{className:"text-xl mt-8 mb-2",children:"Automation Rules"}),i.jsxs("form",{onSubmit:Ae,className:"space-y-2 max-w-md mb-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Trigger"}),i.jsxs("select",{value:w.trigger,onChange:G=>E(ne=>({...ne,trigger:G.target.value})),className:"w-full p-2 border rounded",children:[i.jsx("option",{value:"adGroupCreated",children:"Ad Group Created"}),i.jsx("option",{value:"adGroupStatusUpdated",children:"Ad Group Status Updated"}),i.jsx("option",{value:"accountCreated",children:"Account Created"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Audience"}),i.jsx("input",{type:"text",value:w.audience,onChange:G=>E(ne=>({...ne,audience:G.target.value})),className:"w-full p-2 border rounded",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Title Template"}),i.jsx("input",{type:"text",value:w.title,onChange:G=>E(ne=>({...ne,title:G.target.value})),className:"w-full p-2 border rounded",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Body Template"}),i.jsx("textarea",{value:w.body,onChange:G=>E(ne=>({...ne,body:G.target.value})),className:"w-full p-2 border rounded",required:!0})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{type:"submit",className:"btn-primary",children:N?"Update Rule":"Save Rule"}),N&&i.jsx("button",{type:"button",onClick:z,className:"btn-secondary",children:"Cancel"})]})]}),p.length===0?i.jsx("p",{children:"No rules configured."}):i.jsxs(Un,{children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Trigger"}),i.jsx("th",{children:"Audience"}),i.jsx("th",{children:"Active"}),i.jsx("th",{children:"Actions"})]})}),i.jsx("tbody",{children:p.map(G=>i.jsxs("tr",{children:[i.jsx("td",{children:G.trigger}),i.jsx("td",{children:G.audience}),i.jsx("td",{children:G.active?"yes":"no"}),i.jsx("td",{children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(be,{onClick:()=>K(G),"aria-label":"Edit",children:i.jsx(Ar,{})}),i.jsx("button",{onClick:()=>J(G.id,G.active),className:"underline mr-2",children:G.active?"Disable":"Enable"}),i.jsx(be,{onClick:()=>Y(G.id),"aria-label":"Delete",children:i.jsx(qt,{})})]})})]},G.id))})]})]})]})},L3=({user:t,role:e})=>{const[n,r]=m.useState(""),[s,a]=m.useState(""),[o,l]=m.useState(""),[c,d]=m.useState(!1),[h,f]=m.useState(!1),[p,k]=m.useState("sms"),[S,T]=m.useState(""),[C,j]=m.useState(""),y=ti(),v=t&&Ja(t).enrolledFactors.length>0,R=async()=>{if(!(!t||!v)&&window.confirm("Turning off MFA makes your account more vulnerable. Are you sure you want to continue?"))try{const x=Ja(t).enrolledFactors[0];await Ja(t).unenroll(x),j("MFA disabled")}catch(x){T(x.message)}},O=x=>{const w=x.replace(/\D/g,"");return w?"+"+w:""};if(!t||!["admin","client","agency","designer","manager","editor"].includes(e))return i.jsx("p",{className:"p-4",children:"MFA enrollment not allowed for this account."});if(!t.emailVerified)return i.jsx("div",{className:"flex justify-center p-4",children:i.jsxs("div",{className:"w-80 space-y-2",children:[i.jsx("p",{children:"Please verify your email before enrolling MFA"}),i.jsx("button",{type:"button",className:"w-full btn-primary",onClick:()=>If(t),children:"Resend Verification Email"})]})});const M=async x=>{x.preventDefault(),T(""),j(""),d(!0);try{const w=await Ja(Fe.currentUser).getSession(),E=new gi(Fe),N={phoneNumber:O(n),session:w},D=new qE(Fe,"recaptcha-container",{size:"invisible",callback:()=>{}}),I=await E.verifyPhoneNumber(N,D);l(I),k("verify")}catch(w){w.code==="auth/requires-recent-login"?(j("Please sign in again to enroll MFA."),await FE(Fe),y("/login")):T(w.message)}finally{d(!1)}},b=async x=>{x.preventDefault(),T(""),f(!0);try{const w=gi.credential(o,s),E=ov.assertion(w);await Ja(Fe.currentUser).enroll(E,"Phone"),j("Enrollment complete"),k("done")}catch(w){T(w.message)}finally{f(!1)}};return i.jsx("div",{className:"flex justify-center p-4",children:i.jsxs("div",{className:"w-80 space-y-4",children:[i.jsx("h1",{className:"text-2xl mb-2",children:"Two-Factor Authentication"}),i.jsx("p",{className:"text-sm text-gray-600",children:"Add an extra layer of security to your account by requiring a code when you sign in."}),v&&(t==null?void 0:t.metadata.lastLoginAt)&&i.jsxs("p",{className:"text-xs text-gray-500",children:["Last MFA login: ",new Date(Number(t.metadata.lastLoginAt)).toLocaleString()]}),p==="sms"&&i.jsxs("form",{onSubmit:M,className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Phone Number"}),i.jsx("input",{type:"tel",value:n,onChange:x=>r(O(x.target.value)),className:"w-full p-2 border rounded",required:!0})]}),S&&i.jsx("p",{className:"text-red-500 text-sm",children:S}),i.jsx("button",{type:"submit",className:"w-full btn-primary",disabled:c,children:c?"Sending...":"Send Code"})]}),p==="verify"&&i.jsxs("form",{onSubmit:b,className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Verification Code"}),i.jsx("input",{type:"text",value:s,onChange:x=>a(x.target.value),className:"w-full p-2 border rounded",required:!0})]}),S&&i.jsx("p",{className:"text-red-500 text-sm",children:S}),i.jsx("button",{type:"submit",className:"w-full btn-primary",disabled:h,children:h?"Verifying...":"Verify"})]}),C&&i.jsx("p",{className:"text-green-600 mt-2 text-sm",children:C}),i.jsx("div",{id:"recaptcha-container"}),v&&i.jsx("button",{type:"button",onClick:R,className:"w-full btn-secondary",children:"Disable MFA"})]})})},O3=({user:t,role:e,children:n})=>{const r=ti(),s=Es();return bt.useEffect(()=>{t&&["admin","client","agency","designer","manager","editor"].includes(e)&&Ja(t).enrolledFactors.length===0&&s.pathname!=="/mfa-settings"&&r("/mfa-settings",{replace:!0})},[t,e,s.pathname,r]),i.jsx(i.Fragment,{children:n})},M3=Po(ni);async function CS(t){const e=`Campfire/site-logo/${t.name}`,n=xi(M3,e);return await Jl(n,t,{cacheControl:"public,max-age=31536000,immutable"}),await Xl(n)}const F3=Po(ni);async function V3(t){const e=`Campfire/site-icon/${t.name}`,n=xi(F3,e);return await Jl(n,t,{cacheControl:"public,max-age=31536000,immutable"}),await Xl(n)}const U3=Po(ni);async function B3(t){const e=`Campfire/campfire-logo/${t.name}`,n=xi(U3,e);return await Jl(n,t,{cacheControl:"public,max-age=31536000,immutable"}),await Xl(n)}const $3=()=>{const{settings:t,saveSettings:e}=tp(),[n,r]=m.useState(""),[s,a]=m.useState(null),[o,l]=m.useState(""),[c,d]=m.useState(null),[h,f]=m.useState(""),[p,k]=m.useState(null),[S,T]=m.useState("#ea580c"),[C,j]=m.useState(!1),[y,v]=m.useState("");m.useEffect(()=>{r(t.logoUrl||""),a(null),l(t.campfireLogoUrl||""),d(null),f(t.iconUrl||""),k(null),T(t.accentColor||"#ea580c")},[t]);const R=x=>{const w=x.target.files[0];a(w||null),r(w?URL.createObjectURL(w):t.logoUrl||"")},O=x=>{const w=x.target.files[0];d(w||null),l(w?URL.createObjectURL(w):t.campfireLogoUrl||"")},M=x=>{const w=x.target.files[0];k(w||null),f(w?URL.createObjectURL(w):t.iconUrl||"")},b=async x=>{x.preventDefault(),j(!0),v("");try{let w=n;s&&(w=await CS(s));let E=o;c&&(E=await B3(c));let N=h;p&&(N=await V3(p)),await e({logoUrl:w,iconUrl:N,accentColor:S,campfireLogoUrl:E}),r(w),a(null),l(E),d(null),f(N),k(null),v("Settings saved")}catch(w){console.error("Failed to save settings",w),v("Failed to save settings")}finally{j(!1)}};return i.jsxs("div",{className:"min-h-screen p-4",children:[i.jsx("h1",{className:"text-2xl mb-4",children:"Site Settings"}),i.jsxs("form",{onSubmit:b,className:"space-y-4 max-w-sm",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Logo"}),i.jsx("input",{type:"file",accept:"image/*",onChange:R,className:"w-full p-2 border rounded"}),n&&i.jsx(Pn,{pngUrl:n,alt:"Logo preview",loading:"eager",className:"mt-2 max-h-16 w-auto"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Campfire Logo"}),i.jsx("input",{type:"file",accept:"image/*",onChange:O,className:"w-full p-2 border rounded"}),o&&i.jsx(Pn,{pngUrl:o,alt:"Campfire logo preview",loading:"eager",className:"mt-2 max-h-16 w-auto"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Site Icon"}),i.jsx("input",{type:"file",accept:"image/*",onChange:M,className:"w-full p-2 border rounded"}),h&&i.jsx(Pn,{pngUrl:h,alt:"Icon preview",loading:"eager",className:"mt-2 max-h-16 w-auto"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Accent Color"}),i.jsx("input",{type:"color",value:S,onChange:x=>T(x.target.value),className:"w-full p-2 border rounded h-10"})]}),y&&i.jsx("p",{className:"text-sm",children:y}),i.jsx("button",{type:"submit",className:"btn-primary",disabled:C,children:C?"Saving...":"Save Settings"})]})]})},ap=({tabs:t=[],logoUrl:e,logoAlt:n,applySiteAccent:r=!0})=>{const s=ti(),a=Es(),[o,l]=bt.useState(!1),[c,d]=bt.useState({}),{settings:h}=tp(r),[f,p]=bt.useState(!1),k=e||h.logoUrl||Gs,S=y=>{uo("Navigate to",y.path),y.path&&s(y.path),l(!1)},T=()=>{FE(Fe).catch(y=>console.error("Failed to sign out",y))},C=y=>d(v=>({...v,[y]:!v[y]})),j=i.jsx(i.Fragment,{children:t.map(y=>{const v=a.pathname+a.search;if(y.children){const M=y.children.some(w=>v.startsWith(w.path)),b=c[y.label]||M,x=(M?"text-accent font-medium border border-accent dark:border-accent bg-accent-10 ":"text-gray-700 dark:text-gray-200 hover:bg-accent-10 border border-transparent dark:!border-transparent ")+"rounded-xl w-full text-center px-3 py-[0.9rem] transition-colors duration-200";return i.jsxs("div",{className:"space-y-1",children:[i.jsx("button",{onClick:()=>C(y.label),className:x,children:y.label}),i.jsx("div",{className:`overflow-hidden transition-all duration-300 ${b?"max-h-96":"max-h-0"}`,children:i.jsx("div",{className:"mt-1 space-y-1",children:y.children.map(w=>{const N=(w.path&&v.startsWith(w.path)?"text-accent font-medium border border-accent dark:border-accent bg-accent-10 ":"text-gray-700 dark:text-gray-200 hover:bg-accent-10 border border-transparent dark:!border-transparent ")+"rounded-lg w-full text-center text-sm px-3 py-2 transition-colors duration-200";return i.jsx("button",{onClick:()=>S(w),className:N,children:w.label},w.label)})})})]},y.label)}const O=(y.path&&v.startsWith(y.path)?"text-accent font-medium border border-accent dark:border-accent bg-accent-10 ":"text-gray-700 dark:text-gray-200 hover:bg-accent-10 border border-transparent dark:!border-transparent ")+"rounded-xl w-full text-center px-3 py-[0.9rem] transition-colors duration-200";return i.jsx("button",{onClick:()=>S(y),className:O,children:y.label},y.label)})});return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"hidden md:flex fixed top-0 left-0 w-[250px] border-r bg-white dark:bg-[var(--dark-sidebar-bg)] dark:border-[var(--dark-sidebar-hover)] p-4 flex-col h-screen justify-between",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"relative mx-auto mt-4 mb-4 h-16 flex items-center justify-center",children:[!f&&i.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:i.jsx("div",{className:"loading-ring w-6 h-6"})}),i.jsx(Pn,{pngUrl:k,alt:n||"Logo",loading:"eager",cacheKey:k,className:`max-h-full w-auto ${f?"":"opacity-0"}`,onLoad:()=>p(!0),onError:()=>p(!0)})]}),j]}),i.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[i.jsx("button",{onClick:T,className:"text-gray-700 dark:text-gray-200 hover:bg-accent-10 w-full text-center font-bold px-3 py-[0.9rem] rounded-xl",children:"Log Out"}),i.jsx("footer",{className:"text-xs text-gray-400 dark:text-gray-500 text-center",children:"© 2025 Studio Tak. All rights reserved."})]})]}),i.jsx("button",{type:"button","aria-label":"Menu",className:"md:hidden fixed top-4 right-2 m-2 text-2xl z-40",onClick:()=>l(!0),children:"☰"}),o&&i.jsxs("div",{className:"fixed inset-0 bg-white dark:bg-[var(--dark-sidebar-bg)] p-4 flex flex-col h-full justify-between z-50",children:[i.jsx("button",{type:"button","aria-label":"Close menu",className:"absolute top-4 right-4 text-2xl",onClick:()=>l(!1),children:"×"}),i.jsxs("div",{className:"space-y-2 mt-8",children:[i.jsxs("div",{className:"relative mx-auto mt-4 mb-4 h-16 flex items-center justify-center",children:[!f&&i.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:i.jsx("div",{className:"loading-ring w-6 h-6"})}),i.jsx(Pn,{pngUrl:k,alt:n||"Logo",loading:"eager",cacheKey:k,className:`max-h-full w-auto ${f?"":"opacity-0"}`,onLoad:()=>p(!0),onError:()=>p(!0)})]}),j]}),i.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[i.jsx("button",{onClick:T,className:"text-gray-700 dark:text-gray-200 hover:bg-accent-10 w-full text-center font-bold px-3 py-[0.9rem] rounded-xl",children:"Log Out"}),i.jsx("footer",{className:"text-xs text-gray-400 dark:text-gray-500 text-center",children:"© 2025 Studio Tak. All rights reserved."})]})]})]})},z3=[{label:"Campfire",path:"/dashboard/client"},{label:"Request",path:"/request"},{label:"Brand Profile",path:"/brand-profile"},{label:"Account Settings",path:"/account-settings"}],G3=[{label:"Tickets",path:"/admin/tickets"},{label:"Ad Groups",path:"/admin/ad-groups"},{label:"Brands",path:"/admin/brands"},{label:"Account Settings",path:"/account-settings"}],H3=[{label:"Tickets",path:"/editor/tickets"},{label:"Ad Groups",path:"/editor/ad-groups"},{label:"Brands",path:"/editor/brands"},{label:"Account Settings",path:"/account-settings"}],q3=({agencyId:t,role:e})=>{const n=e==="manager",r=e==="editor",{agency:s}=Ju(n||r?null:t),a=n?G3:r?H3:z3;return i.jsx(ap,{tabs:a,logoUrl:n?void 0:t?s.logoUrl:void 0,logoAlt:n?void 0:t?`${s.name} logo`:void 0,applySiteAccent:n||r||!t})},W3=[{label:"Dashboard",path:"/admin/dashboard"},{label:"Tickets",path:"/admin/tickets"},{label:"Ad Groups",path:"/admin/ad-groups"},{label:"Accounts",path:"/admin/accounts"},{label:"Brands",path:"/admin/brands"},{label:"Agencies",path:"/admin/agencies"},{label:"Settings",children:[{label:"Ad Recipes",path:"/admin/ad-recipes"},{label:"Copy Recipes",path:"/admin/copy-recipes"},{label:"Notifications",path:"/admin/notifications"},{label:"Account Settings",path:"/admin/account-settings"},{label:"Site Settings",path:"/admin/site-settings"}]}],__=()=>i.jsx(ap,{tabs:W3}),K3=[{label:"Notifications",path:"/designer/notifications"},{label:"Ad Groups",path:"/dashboard/designer"},{label:"Account Settings",path:"/designer/account-settings"}],Q3=()=>i.jsx(ap,{tabs:K3}),Y3=({agencyId:t})=>{const{agency:e}=Ju(t),n=t?`?agencyId=${t}`:"",r=[{label:"Dashboard",path:`/agency/dashboard${n}`},{label:"Ad Groups",path:`/agency/ad-groups${n}`},{label:"Brands",path:`/agency/brands${n}`},{label:"Theme",path:`/agency/theme${n}`},{label:"Account Settings",path:`/agency/account-settings${n}`}];return i.jsx(ap,{tabs:r,logoUrl:e.logoUrl,logoAlt:`${e.name} logo`,applySiteAccent:!1})},J3=({role:t,agencyId:e,isAdmin:n})=>n?i.jsx(__,{}):t==="admin"?i.jsx(__,{}):t==="designer"?i.jsx(Q3,{}):t==="agency"?i.jsx(Y3,{agencyId:e}):i.jsx(q3,{agencyId:["manager","editor"].includes(t)?null:e,role:t}),X3=()=>{const t=new URLSearchParams(Es().search).get("agencyId"),{agency:e,saveAgency:n}=Ju(t),[r,s]=m.useState(""),[a,o]=m.useState(null),[l,c]=m.useState(Dl),[d,h]=m.useState(!1),[f,p]=m.useState("");m.useEffect(()=>{s(e.logoUrl||""),c(e.themeColor||Dl),o(null)},[e]);const k=T=>{const C=T.target.files[0];o(C||null),s(C?URL.createObjectURL(C):e.logoUrl||"")},S=async T=>{if(T.preventDefault(),!!t){h(!0),p("");try{let C=r;a&&(C=await CS(a)),await n({logoUrl:C,themeColor:l}),o(null),p("Settings saved")}catch(C){console.error("Failed to save settings",C),p("Failed to save settings")}finally{h(!1)}}};return i.jsxs("div",{className:"min-h-screen p-4",children:[i.jsx("h1",{className:"text-2xl mb-4",children:"Agency Theme"}),i.jsxs("form",{onSubmit:S,className:"space-y-4 max-w-sm",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Logo"}),i.jsx("input",{type:"file",accept:"image/*",onChange:k,className:"w-full p-2 border rounded"}),r&&i.jsx(Pn,{pngUrl:r,alt:"Logo preview",loading:"eager",className:"mt-2 max-h-16 w-auto"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Theme Color"}),i.jsx("input",{type:"color",value:l,onChange:T=>c(T.target.value),className:"w-full p-2 border rounded h-10"})]}),f&&i.jsx("p",{className:"text-sm",children:f}),i.jsx("button",{type:"submit",className:"btn-primary",disabled:d,children:d?"Saving...":"Save Settings"})]})]})},Z3=()=>{const t=new URLSearchParams(Es().search).get("agencyId"),[e,n]=m.useState([]),[r,s]=m.useState(!0),[a,o]=m.useState(null),[l,c]=m.useState({code:"",name:"",toneOfVoice:"",offering:""}),[d,h]=m.useState("");m.useEffect(()=>{(async()=>{if(!t){n([]),s(!1);return}s(!0);try{const y=Ye(fe(F,"brands"),Je("agencyId","==",t)),R=(await Ne(y)).docs.map(O=>({id:O.id,...O.data()}));n(R)}catch(y){console.error("Failed to fetch brands",y),n([])}finally{s(!1)}})()},[t]);const f=async j=>{if(j.preventDefault(),!(!t||!l.code.trim())){h("");try{const y=await rn(fe(F,"brands"),{code:l.code.trim(),name:l.name.trim(),agencyId:t,toneOfVoice:l.toneOfVoice.trim(),offering:l.offering.trim(),archived:!1,archivedAt:null,archivedBy:null,createdAt:Mt()});n(v=>[...v,{id:y.id,code:l.code.trim(),name:l.name.trim(),agencyId:t,toneOfVoice:l.toneOfVoice.trim(),offering:l.offering.trim(),archived:!1,archivedAt:null,archivedBy:null}]),c({code:"",name:"",toneOfVoice:"",offering:""}),h("Brand added")}catch(y){console.error("Failed to add brand",y),h("Failed to add brand")}}},p=j=>{o(j.id),c({code:j.code||"",name:j.name||"",toneOfVoice:j.toneOfVoice||"",offering:j.offering||""})},k=()=>o(null),S=async j=>{try{await He(ie(F,"brands",j),{code:l.code,name:l.name,toneOfVoice:l.toneOfVoice,offering:l.offering}),n(y=>y.map(v=>v.id===j?{...v,code:l.code,name:l.name,toneOfVoice:l.toneOfVoice,offering:l.offering}:v)),o(null)}catch(y){console.error("Failed to update brand",y)}},T=async j=>{if(window.confirm("Delete this brand?"))try{await mn(ie(F,"brands",j)),n(y=>y.filter(v=>v.id!==j))}catch(y){console.error("Failed to delete brand",y)}},C=[...e].sort((j,y)=>(j.code||"").localeCompare(y.code||""));return i.jsxs("div",{className:"min-h-screen p-4",children:[i.jsx("h1",{className:"text-2xl mb-4",children:"Brands"}),i.jsxs("form",{onSubmit:f,className:"space-y-2 max-w-sm mb-6",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Code"}),i.jsx("input",{type:"text",value:l.code,onChange:j=>c(y=>({...y,code:j.target.value})),className:"w-full p-2 border rounded",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Name"}),i.jsx("input",{type:"text",value:l.name,onChange:j=>c(y=>({...y,name:j.target.value})),className:"w-full p-2 border rounded"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Tone of Voice"}),i.jsx("input",{type:"text",value:l.toneOfVoice,onChange:j=>c(y=>({...y,toneOfVoice:j.target.value})),className:"w-full p-2 border rounded"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Offering"}),i.jsx("input",{type:"text",value:l.offering,onChange:j=>c(y=>({...y,offering:j.target.value})),className:"w-full p-2 border rounded"})]}),d&&i.jsx("p",{className:"text-sm",children:d}),i.jsx("button",{type:"submit",className:"btn-primary",children:"Add Brand"})]}),r?i.jsx("p",{children:"Loading brands..."}):e.length===0?i.jsx("p",{children:"No brands found."}):i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"overflow-x-auto table-container",children:i.jsxs("table",{className:"ad-table min-w-max",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Code"}),i.jsx("th",{children:"Name"}),i.jsx("th",{children:"Tone of Voice"}),i.jsx("th",{children:"Offering"}),i.jsx("th",{children:"Actions"})]})}),i.jsx("tbody",{children:e.map(j=>i.jsxs("tr",{children:[i.jsx("td",{children:a===j.id?i.jsx("input",{type:"text",value:l.code,onChange:y=>c(v=>({...v,code:y.target.value})),className:"w-full p-1 border rounded"}):j.code}),i.jsx("td",{children:a===j.id?i.jsx("input",{type:"text",value:l.name,onChange:y=>c(v=>({...v,name:y.target.value})),className:"w-full p-1 border rounded"}):j.name}),i.jsx("td",{children:a===j.id?i.jsx("input",{type:"text",value:l.toneOfVoice,onChange:y=>c(v=>({...v,toneOfVoice:y.target.value})),className:"w-full p-1 border rounded"}):j.toneOfVoice||""}),i.jsx("td",{children:a===j.id?i.jsx("input",{type:"text",value:l.offering,onChange:y=>c(v=>({...v,offering:y.target.value})),className:"w-full p-1 border rounded"}):j.offering||""}),i.jsx("td",{className:"text-center",children:a===j.id?i.jsxs(i.Fragment,{children:[i.jsx("button",{onClick:()=>S(j.id),className:"underline text-gray-700 mr-2",children:"Save"}),i.jsx("button",{onClick:k,className:"underline",children:"Cancel"})]}):i.jsxs(i.Fragment,{children:[i.jsx("button",{onClick:()=>p(j),className:"underline text-gray-700 mr-2",children:"Edit"}),i.jsx("button",{onClick:()=>T(j.id),className:"underline btn-delete",children:"Delete"})]})})]},j.id))})]})}),i.jsx("div",{className:"grid gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 mt-6",children:C.map(j=>i.jsx(bx,{brand:j},j.id))})]})]})},e6=()=>{const t=new URLSearchParams(Es().search).get("agencyId"),[e,n]=m.useState([]),[r,s]=m.useState(!0),a=Fe.currentUser,{role:o}=Fr(a==null?void 0:a.uid),l=async(f,p,k)=>{if(window.confirm("Delete this group?"))try{await ES(f,p,k),n(S=>S.filter(T=>T.id!==f))}catch(S){console.error("Failed to delete group",S)}},[c,d]=m.useState(null),h=async(f,p)=>{let k=`${window.location.origin}/review/${f}${p?`?agency=${p}`:""}`;const S=new URLSearchParams;a!=null&&a.email&&S.set("email",a.email),o&&S.set("role",o);const T=S.toString();T&&(k+=(p?"&":"?")+T);const C=fo();try{await He(ie(F,"adGroups",f),{password:C})}catch(j){console.error("Failed to set password",j)}d({url:k,password:C})};return m.useEffect(()=>{(async()=>{if(!t){n([]),s(!1);return}s(!0);try{const k=(await Ne(Ye(fe(F,"brands"),Je("agencyId","==",t)))).docs.map(C=>C.data().code).filter(Boolean);if(k.length===0){n([]),s(!1);return}const S=await Ne(Ye(fe(F,"adGroups"),Je("brandCode","in",k))),T=await Promise.all(S.docs.map(async C=>{const j=C.data();let y=0,v=0,R=0;const O=new Set;try{const b=await Ne(fe(F,"adGroups",C.id,"assets"));v=b.docs.length,b.docs.forEach(x=>{const w=x.data();w.status==="ready"&&(R+=1);const E=w.recipeCode||Ft(w.filename||"").recipeCode;E&&O.add(E)}),y=O.size}catch(b){console.error("Failed to load assets",b),y=0}const M=j.designerId?await sp(j.designerId):"";return{id:C.id,...j,recipeCount:y,assetCount:v,readyCount:R,counts:{approved:j.approvedCount||0,rejected:j.rejectedCount||0,edit:j.editCount||0},designerName:M}}));n(T.filter(C=>C.status!=="archived"))}catch(p){console.error("Failed to fetch groups",p),n([])}finally{s(!1)}})()},[t]),i.jsxs("div",{className:"min-h-screen p-4",children:[i.jsx("h1",{className:"text-2xl mb-4",children:"Ad Groups"}),r?i.jsx("p",{children:"Loading groups..."}):e.length===0?i.jsx("p",{children:"No ad groups found."}):i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"sm:hidden space-y-4",children:e.map(f=>i.jsx(ko,{group:f,onReview:()=>window.location.href=`/review/${f.id}${t?`?agency=${t}`:""}`,onShare:()=>h(f.id,t),onDelete:()=>l(f.id,f.brandCode,f.name)},f.id))}),i.jsx("div",{className:"hidden sm:block",children:i.jsxs(Un,{children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Group Name"}),i.jsx("th",{children:"Brand"}),i.jsx("th",{children:"Status"}),i.jsx("th",{children:"Actions"})]})}),i.jsx("tbody",{children:e.map(f=>i.jsxs("tr",{children:[i.jsx("td",{children:f.name}),i.jsx("td",{children:f.brandCode}),i.jsx("td",{children:i.jsx(Ca,{status:f.status})}),i.jsx("td",{className:"text-center",children:i.jsxs("div",{className:"flex items-center justify-center",children:[i.jsx(IconButton,{as:$n,to:`/ad-group/${f.id}`,"aria-label":"View Details",children:i.jsx(Wi,{})}),i.jsx(IconButton,{as:$n,to:`/review/${f.id}${t?`?agency=${t}`:""}`,className:"ml-2","aria-label":"Review",children:i.jsx(FiCheckCircle,{})}),i.jsx(IconButton,{onClick:()=>h(f.id,t),className:"ml-2","aria-label":"Share Link",children:i.jsx(Ol,{})}),i.jsx(IconButton,{onClick:()=>l(f.id,f.brandCode,f.name),className:"ml-2 btn-delete","aria-label":"Delete",children:i.jsx(qt,{})})]})})]},f.id))})]})})]}),c&&i.jsx(Xu,{url:c.url,password:c.password,onClose:()=>d(null)})]})},t6=()=>i.jsx("div",{className:"full-screen-spinner","data-testid":"full-screen-spinner",children:i.jsx("div",{className:"loading-ring"})}),n6=t=>{m.useEffect(()=>t?((async()=>{try{const r=await navigator.serviceWorker.register("/firebase-messaging-sw.js"),s=await UV(X0,{vapidKey:"BHVn4o8nW7nriA-hnKA_wGXtVnL5xy5-M-iE9bKQfLXDVnKMRb06pT7JT9CqOQFbPdiAVk1IHYg_XD4GFMEzwQ4",serviceWorkerRegistration:r});s&&await Jn(ie(F,"users",t.uid),{fcmToken:s},{merge:!0})}catch(r){console.error("Failed to obtain FCM token",r)}})(),BV(X0,()=>{})):void 0,[t])},r6=async(t,e)=>{try{let n=fe(F,"adAssets");t&&(n=Ye(n,Je("brandCode","==",t)));const s=(await Ne(n)).docs.map(l=>({id:l.id,...l.data()})),a=Object.fromEntries(s.filter(l=>l.url).map(l=>[l.url,l])),o=[...s];for(const l of Array.isArray(e)?e:[]){if(a[l.url])continue;const c={id:Math.random().toString(36).slice(2),...l};o.push(c),a[l.url]=c}await wx(t,o)}catch(n){console.error("Failed to save tagger results",n)}};function s6(){m.useEffect(()=>{const t=oh("pendingTaggerJobId"),e=oh("pendingTaggerJobBrand")||"";if(!t||oh("taggerModalOpen")==="true")return;const n=a=>{a.status==="complete"?(r6(e,a.results),so("pendingTaggerJobId"),so("pendingTaggerJobBrand")):a.status==="error"&&(so("pendingTaggerJobId"),so("pendingTaggerJobBrand"))};let r=null;return(async()=>{try{const a=await gn(ie(F,"taggerJobs",t));if(a.exists()){const o=a.data();if(o.status==="complete"||o.status==="error"){n(o);return}}r=ps(ie(F,"taggerJobs",t),o=>{const l=o.data();l&&(l.status==="complete"||l.status==="error")&&n(l)})}catch(a){console.error("Failed to watch tagger job",a)}})(),()=>{r&&r()}},[])}const i6=()=>(xx(),null),a6=()=>{const[t,e]=bt.useState(null),[n,r]=bt.useState(!0);bt.useEffect(()=>{const O={current:!1},M=QR(Fe,b=>{b&&!O.current&&(O.current=!0,b.getIdToken(!0).catch(x=>{console.error("Failed to refresh ID token",x)})),e(b),r(!1)});return()=>{M()}},[]);const{role:s,brandCodes:a,agencyId:o,loading:l}=Fr(t==null?void 0:t.uid),{isAdmin:c,loading:d}=v3(),{settings:h,loading:f}=tp(!o),{agency:p,loading:k}=Ju(o),[S,T]=bt.useState(!1);n6(t),s6(),bt.useEffect(()=>{const O=o?p.logoUrl||Gs:h.logoUrl||Gs;if(!O){T(!0);return}T(!1);const M=new Image;M.onload=()=>T(!0),M.onerror=()=>T(!0),M.src=O},[p.logoUrl,h.logoUrl,o]);const C=!n&&!l&&!d&&!f&&!k&&S,j=Es();if(bt.useEffect(()=>{C&&document.body.classList.remove("pre-theme")},[C]),!C)return i.jsx(t6,{});const y=t&&!t.isAnonymous,v=c?"admin":s,R=y?v==="agency"?`/agency/dashboard?agencyId=${o}`:v==="admin"?"/admin/ad-groups":v==="manager"?"/admin/tickets":v==="editor"?"/editor/tickets":`/dashboard/${v}`:"/login";return y&&!v?i.jsx("div",{className:"flex items-center justify-center min-h-screen text-center",children:"No role assigned to this account. Please contact support."}):i.jsxs(i.Fragment,{children:[i.jsx(i6,{}),i.jsx(O3,{user:t,role:v,children:i.jsxs("div",{className:"min-h-screen flex",children:[y&&i.jsx(J3,{role:v,isAdmin:c,agencyId:o}),i.jsx("div",{className:`flex flex-col flex-grow box-border min-w-0 max-w-full ${y?"md:pl-[250px]":""}`,children:i.jsx("div",{className:"flex-grow page-transition",children:i.jsxs(WI,{location:j,children:[i.jsx(dt,{path:"/login",element:y?i.jsx(ut,{to:R,replace:!0}):i.jsx(WV,{onLogin:()=>e(Fe.currentUser)})}),i.jsx(dt,{path:"/signup",element:y?i.jsx(ut,{to:R,replace:!0}):i.jsx(mU,{})}),i.jsx(dt,{path:"/signup/designer",element:y?i.jsx(ut,{to:R,replace:!0}):i.jsx(yU,{})}),i.jsx(dt,{path:"/",element:t?i.jsx(ut,{to:R,replace:!0}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/dashboard/designer",element:t?i.jsx(At,{requiredRole:"designer",userRole:v,isAdmin:c,loading:l,children:i.jsx(BU,{})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/designer/notifications",element:t?i.jsx(At,{requiredRole:"designer",userRole:v,isAdmin:c,loading:l,children:i.jsx(h3,{brandCodes:a})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/designer/account-settings",element:t?i.jsx(At,{requiredRole:"designer",userRole:v,isAdmin:c,loading:l,children:i.jsx(f3,{})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/admin/accounts",element:t?i.jsx(At,{requiredRole:["admin","manager"],userRole:v,isAdmin:c,loading:l,children:i.jsx(y3,{})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/admin/accounts/new",element:t?i.jsx(At,{requiredRole:["admin","manager"],userRole:v,isAdmin:c,loading:l,children:i.jsx(g3,{})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/dashboard/client",element:t?i.jsx(At,{requiredRole:"client",userRole:v,isAdmin:c,loading:l,children:i.jsx(zU,{user:t,brandCodes:a})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/admin/dashboard",element:t?i.jsx(At,{requiredRole:["admin","manager"],userRole:v,isAdmin:c,loading:l,children:i.jsx(e3,{})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/admin/tickets",element:t?i.jsx(At,{requiredRole:["admin","manager"],userRole:v,isAdmin:c,loading:l,children:i.jsx(kS,{})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/editor/tickets",element:t?i.jsx(At,{requiredRole:"editor",userRole:v,isAdmin:c,loading:l,children:i.jsx(XU,{})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/admin/ad-groups",element:t?i.jsx(At,{requiredRole:["admin","manager"],userRole:v,isAdmin:c,loading:l,children:i.jsx(HU,{})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/editor/ad-groups",element:t?i.jsx(At,{requiredRole:"editor",userRole:v,isAdmin:c,loading:l,children:i.jsx(qU,{})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/admin/agencies",element:t?i.jsx(At,{requiredRole:["admin","manager"],userRole:v,isAdmin:c,loading:l,children:i.jsx(_3,{})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/agency/dashboard",element:t?i.jsx(At,{requiredRole:"agency",userRole:v,isAdmin:c,loading:l,children:i.jsx(t3,{})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/agency/theme",element:t?i.jsx(At,{requiredRole:"agency",userRole:v,isAdmin:c,loading:l,children:i.jsx(X3,{})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/agency/brands",element:t?i.jsx(At,{requiredRole:"agency",userRole:v,isAdmin:c,loading:l,children:i.jsx(Z3,{})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/agency/account-settings",element:t?i.jsx(At,{requiredRole:"agency",userRole:v,isAdmin:c,loading:l,children:i.jsx(m3,{})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/agency/ad-groups",element:t?i.jsx(At,{requiredRole:"agency",userRole:v,isAdmin:c,loading:l,children:i.jsx(e6,{})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/review/:groupId",element:i.jsx(TU,{})}),i.jsx(dt,{path:"/request",element:t?i.jsx(At,{requiredRole:"client",userRole:v,isAdmin:c,loading:l,children:i.jsx(n3,{})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/brand-profile",element:t?i.jsx(At,{requiredRole:"client",userRole:v,isAdmin:c,loading:l,children:i.jsx(cm,{})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/account-settings",element:t?i.jsx(At,{requiredRole:["client","manager","editor"],userRole:v,isAdmin:c,loading:l,children:i.jsx(d3,{})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/mfa-settings",element:t?i.jsx(At,{requiredRole:["admin","client","agency","designer","manager"],userRole:v,isAdmin:c,loading:l,children:i.jsx(L3,{user:t,role:v})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/ad-group/:id",element:t?i.jsx(At,{requiredRole:["designer","admin","agency","client","manager","editor"],userRole:v,isAdmin:c,loading:l,children:i.jsx(UU,{})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/admin/brands",element:t?i.jsx(At,{requiredRole:["admin","manager"],userRole:v,isAdmin:c,loading:l,children:i.jsx(w3,{})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/editor/brands",element:t?i.jsx(At,{requiredRole:"editor",userRole:v,isAdmin:c,loading:l,children:i.jsx(b3,{})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/admin/ad-recipes",element:t?i.jsx(At,{requiredRole:["admin","manager"],userRole:v,isAdmin:c,loading:l,children:i.jsx(I3,{})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/admin/copy-recipes",element:t?i.jsx(At,{requiredRole:["admin","manager"],userRole:v,isAdmin:c,loading:l,children:i.jsx(P3,{})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/admin/notifications",element:t?i.jsx(At,{requiredRole:["admin","manager"],userRole:v,isAdmin:c,loading:l,children:i.jsx(D3,{})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/admin/site-settings",element:t?i.jsx(At,{requiredRole:["admin","manager"],userRole:v,isAdmin:c,loading:l,children:i.jsx($3,{})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/admin/account-settings",element:t?i.jsx(At,{requiredRole:"admin",userRole:v,isAdmin:c,loading:l,children:i.jsx(p3,{})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/admin/brands/new",element:t?i.jsx(At,{requiredRole:"admin",userRole:v,isAdmin:c,loading:l,children:i.jsx(x3,{})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/admin/brands/:id",element:t?i.jsx(At,{requiredRole:["admin","manager"],userRole:v,isAdmin:c,loading:l,children:i.jsx(cm,{})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"/editor/brands/:id",element:t?i.jsx(At,{requiredRole:"editor",userRole:v,isAdmin:c,loading:l,children:i.jsx(cm,{})}):i.jsx(ut,{to:"/login",replace:!0})}),i.jsx(dt,{path:"*",element:i.jsx(ut,{to:"/",replace:!0})})]})},j.pathname)})]})})]})},o6=dm.createRoot(document.getElementById("root"));o6.render(i.jsx(eA,{children:i.jsx(a6,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").catch(()=>{})});
